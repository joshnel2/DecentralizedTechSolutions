import{r as i,a6 as e,h as F}from"./vendor-DrKzkH4x.js";import{e as Xe,a as es,L as U}from"./router-CNLU_KyZ.js";import{d as K,a as ss,b as as,i as ts}from"./index-CCWWoMiH.js";import{p as be}from"./dateUtils-Bq7Z0P5c.js";import{s}from"./DetailPage.module-Bt939KNz.js";import{C as ls}from"./ConfirmationModal-X7YGPBKC.js";import{aE as Pe,an as is,S as ns,az as ce,au as cs,av as rs,v as Ee,a0 as ds,Y as os,M as ie,aF as ms,aG as hs,x as ve,F as W,D as ne,as as P,J as Ne,Q as us,am as fe,ao as xs,X as q,aA as js}from"./icons-BtUkkwGS.js";import{f as A,p as Q,b as ps}from"./date-utils-BkNAU8cl.js";import"./doc-parsers-U1nJMjtM.js";import"./react-dom-DfB-QKj2.js";import"./pdf-worker-CVmCB3lP.js";import"./state-72d44OIA.js";const vs=[{value:"active",label:"Active",color:"var(--apex-success)"},{value:"inactive",label:"Inactive",color:"var(--apex-muted)"}];function Fs(){var Fe;const{id:d}=Xe(),v=es(),r=K(),{clients:N,matters:y,invoices:o,documents:u,timeEntries:x,updateClient:t,deleteClient:f,fetchClients:p,addMatter:L,fetchMatters:C,addInvoice:k,fetchInvoices:h,addTimeEntry:c,fetchTimeEntries:l,updateTimeEntry:j,deleteTimeEntry:S}=ss(),{openChat:T}=as(),[B,Ge]=i.useState("overview"),[qe,X]=i.useState(!1),[ge,_]=i.useState(!1),[$e,Z]=i.useState(!1),[Re,re]=i.useState(!1),[He,ee]=i.useState(!1),[de,oe]=i.useState(null),[ye,me]=i.useState(!1),he=i.useRef(null),ue=i.useRef(null),[E,xe]=i.useState(5),[Se,Ce]=i.useState(""),[we,Ie]=i.useState(!1),[O,ke]=i.useState(""),[z,$]=i.useState([]),[Ve,je]=i.useState(!1),[R,se]=i.useState(""),[Y,pe]=i.useState("all"),[Me,De]=i.useState([]),[Ue,Te]=i.useState(!1),[H,J]=i.useState({isOpen:!1,title:"",message:"",confirmText:"Confirm",type:"danger",onConfirm:()=>{}});i.useEffect(()=>{B==="communications"&&d&&(Te(!0),ts.getClientCommunications(d).then(a=>De(a.communications||[])).catch(()=>De([])).finally(()=>Te(!1)))},[B,d]),i.useEffect(()=>{function a(n){he.current&&!he.current.contains(n.target)&&_(!1),ue.current&&!ue.current.contains(n.target)&&me(!1)}return document.addEventListener("mousedown",a),()=>document.removeEventListener("mousedown",a)},[]);const m=i.useMemo(()=>N.find(a=>a.id===d),[N,d]),g=i.useMemo(()=>y.filter(a=>a.clientId===d).sort((a,n)=>new Date(n.createdAt).getTime()-new Date(a.createdAt).getTime()),[y,d]),G=i.useMemo(()=>o.filter(a=>a.clientId===d).sort((a,n)=>new Date(n.createdAt).getTime()-new Date(a.createdAt).getTime()),[o,d]),ze=i.useMemo(()=>u.filter(a=>a.clientId===d),[u,d]),Ae=i.useMemo(()=>g.map(a=>a.id),[g]),w=i.useMemo(()=>x.filter(a=>Ae.includes(a.matterId)).sort((a,n)=>new Date(n.date).getTime()-new Date(a.date).getTime()),[x,Ae]),V=i.useMemo(()=>w.filter(a=>{var n;if(R){const b=R.toLowerCase(),M=a.matterId?y.find(Ke=>Ke.id===a.matterId):null,I=((n=M==null?void 0:M.name)==null?void 0:n.toLowerCase())||"";if(!((a.description||"").toLowerCase().includes(b)||I.includes(b)))return!1}return!(Y==="billed"&&!a.billed||Y==="unbilled"&&a.billed)}),[w,R,Y,y]),ae=i.useMemo(()=>{const a=w.reduce((I,D)=>I+D.hours,0),n=w.filter(I=>I.billable).reduce((I,D)=>I+D.hours,0),b=w.filter(I=>I.billed).reduce((I,D)=>I+D.amount,0),M=w.filter(I=>!I.billed&&I.billable).reduce((I,D)=>I+D.amount,0);return{totalHours:a,billableHours:n,totalBilled:b,totalUnbilled:M}},[w]),te=i.useMemo(()=>{const a=g.length,n=g.filter(D=>D.status==="active").length,b=G.reduce((D,le)=>D+le.total,0),M=G.reduce((D,le)=>D+le.amountPaid,0),I=b-M;return{totalMatters:a,activeMatters:n,totalBilled:b,totalPaid:M,outstanding:I}},[g,G]),Be=async()=>{if(!(E<=0||!O)){Ie(!0);try{const a=g.find(n=>n.id===O);await c({matterId:O,date:new Date().toISOString(),hours:E/60,description:Se||`Quick time entry - ${E} minutes`,billable:!0,billed:!1,rate:(a==null?void 0:a.billingRate)||0,aiGenerated:!1,status:"pending",entryType:"manual",updatedAt:new Date().toISOString()}),xe(10),Ce(""),await l({limit:500})}catch(a){console.error("Failed to save quick time entry:",a),r.error("Failed to save time entry")}finally{Ie(!1)}}};i.useEffect(()=>{g.length>0&&!O&&ke(g[0].id)},[g,O]),i.useEffect(()=>{l({limit:500})},[]);const Qe=async a=>{var b;const n=w.find(M=>M.id===a);J({isOpen:!0,title:"Delete Time Entry",message:`Are you sure you want to delete this time entry? (${(n==null?void 0:n.hours)||0} hours - $${((b=n==null?void 0:n.amount)==null?void 0:b.toLocaleString())||0})`,confirmText:"Delete",type:"danger",onConfirm:async()=>{try{await S(a),await l({limit:500}),J(M=>({...M,isOpen:!1}))}catch(M){console.error("Failed to delete time entry:",M),r.error("Failed to delete time entry")}}})},We=a=>{$(n=>n.includes(a)?n.filter(b=>b!==a):[...n,a])},_e=()=>{const a=w.filter(b=>!b.billed&&b.billable).map(b=>b.id),n=a.every(b=>z.includes(b));$(n?[]:a)},Ze=i.useMemo(()=>w.filter(a=>z.includes(a.id)).reduce((a,n)=>a+n.amount,0),[w,z]),Ye=i.useMemo(()=>w.filter(a=>z.includes(a.id)).reduce((a,n)=>a+n.hours,0),[w,z]),Le=i.useMemo(()=>V.filter(a=>!a.billed&&a.billable),[V]),Je=a=>{const n=g.find(b=>b.id===a);return(n==null?void 0:n.name)||"Unknown Matter"};return m?e.jsxs("div",{className:s.detailPage,children:[e.jsxs("div",{className:s.header,children:[e.jsxs("div",{className:s.headerTop,children:[e.jsxs(U,{to:"/app/clients",className:s.backLink,children:[e.jsx(is,{size:18}),"Back to Clients"]}),e.jsxs("div",{className:s.headerActions,children:[e.jsx("button",{className:s.iconBtn,onClick:()=>T({label:`Client: ${m.name}`,contextType:"client-detail",suggestedQuestions:["Summarize this client's matters and billing history","What is the outstanding balance for this client?","Show me recent activity for this client","What matters are currently active for this client?"]}),title:"AI Analysis",children:e.jsx(ns,{size:18})}),e.jsx("button",{className:s.iconBtn,onClick:()=>X(!0),title:"Edit Client",children:e.jsx(ce,{size:18})}),e.jsxs("div",{className:s.menuWrapper,ref:he,children:[e.jsx("button",{className:s.iconBtn,onClick:()=>_(!ge),title:"More Options",children:e.jsx(cs,{size:18})}),ge&&e.jsxs("div",{className:s.dropdown,children:[e.jsxs("button",{className:s.dropdownItem,onClick:()=>{_(!1),X(!0)},children:[e.jsx(ce,{size:14}),"Edit Client"]}),e.jsxs("button",{className:s.dropdownItem,onClick:async()=>{await t(d,{isActive:!m.isActive}),_(!1),p()},children:[e.jsx(rs,{size:14}),m.isActive?"Deactivate":"Activate"]}),e.jsx("div",{className:s.dropdownDivider}),e.jsxs("button",{className:F(s.dropdownItem,s.danger),onClick:()=>{_(!1),J({isOpen:!0,title:"Delete Client",message:`Are you sure you want to delete "${m.name}"? This action cannot be undone and will remove all associated matters, invoices, and documents.`,confirmText:"Delete Client",type:"danger",onConfirm:async()=>{try{await f(d),J(a=>({...a,isOpen:!1})),v("/app/clients")}catch(a){console.error("Failed to delete client:",a),r.error("Failed to delete client")}}})},children:[e.jsx(Ee,{size:14}),"Delete Client"]})]})]})]})]}),e.jsxs("div",{className:s.headerMain,children:[e.jsx("div",{className:s.headerIcon,children:m.type==="company"?e.jsx(ds,{size:28}):e.jsx(Pe,{size:28})}),e.jsxs("div",{className:s.headerInfo,children:[e.jsxs("div",{className:s.headerMeta,children:[e.jsx("span",{className:s.typeTag,children:m.type==="company"?"Organization":"Individual"}),e.jsxs("div",{className:s.statusDropdownWrapper,ref:ue,children:[e.jsxs("button",{className:F(s.statusBadge,s.clickable,s[m.isActive?"active":"inactive"]),onClick:()=>me(!ye),children:[m.isActive?"Active":"Inactive",e.jsx(os,{size:12})]}),ye&&e.jsx("div",{className:s.statusDropdown,children:vs.map(a=>e.jsxs("button",{className:F(s.statusOption,(m.isActive?"active":"inactive")===a.value&&s.selected),onClick:async()=>{await t(d,{isActive:a.value==="active"}),me(!1),p()},children:[e.jsx("span",{className:s.statusDot,style:{background:a.color}}),a.label]},a.value))})]})]}),e.jsx("h1",{children:m.name}),e.jsxs("div",{className:s.contactInfo,children:[e.jsxs("span",{children:[e.jsx(ie,{size:14})," ",m.email]}),e.jsxs("span",{children:[e.jsx(ms,{size:14})," ",m.phone]}),e.jsxs("span",{children:[e.jsx(hs,{size:14})," ",m.addressCity,", ",m.addressState]})]})]})]}),e.jsxs("div",{className:s.quickStats,children:[e.jsxs("div",{className:s.quickStat,children:[e.jsx(ve,{size:18}),e.jsxs("div",{children:[e.jsx("span",{className:s.statValue,children:te.activeMatters}),e.jsx("span",{className:s.statLabel,children:"Active Matters"})]})]}),e.jsxs("div",{className:s.quickStat,children:[e.jsx(W,{size:18}),e.jsxs("div",{children:[e.jsx("span",{className:s.statValue,children:te.totalMatters}),e.jsx("span",{className:s.statLabel,children:"Total Matters"})]})]}),e.jsxs("div",{className:s.quickStat,children:[e.jsx(ne,{size:18}),e.jsxs("div",{children:[e.jsxs("span",{className:s.statValue,children:["$",te.totalBilled.toLocaleString()]}),e.jsx("span",{className:s.statLabel,children:"Total Billed"})]})]}),e.jsxs("div",{className:s.quickStat,children:[e.jsx(ne,{size:18}),e.jsxs("div",{children:[e.jsxs("span",{className:s.statValue,children:["$",te.outstanding.toLocaleString()]}),e.jsx("span",{className:s.statLabel,children:"Outstanding"})]})]})]}),g.length>0&&e.jsxs("div",{className:s.quickTimeWidget,children:[e.jsxs("span",{className:s.quickTimeLabel,children:[e.jsx(P,{size:14}),"Quick Time"]}),e.jsx("select",{value:O,onChange:a=>ke(a.target.value),style:{padding:"0.5rem 0.75rem",background:"var(--apex-deep)",border:"1px solid rgba(255, 255, 255, 0.1)",borderRadius:"var(--radius-md)",color:"var(--apex-white)",fontSize:"0.875rem",maxWidth:"200px"},children:g.map(a=>e.jsx("option",{value:a.id,children:a.name},a.id))}),e.jsxs("div",{className:s.quickTimeControls,children:[e.jsx("button",{className:s.quickTimeBtn,onClick:()=>xe(Math.max(0,E-5)),children:"−"}),e.jsxs("div",{className:s.quickTimeDisplay,children:[e.jsx(Ne,{size:14}),E," min"]}),e.jsx("button",{className:s.quickTimeBtn,onClick:()=>xe(E+5),children:"+"})]}),e.jsx("input",{type:"text",className:s.quickTimeNotes,placeholder:"What did you work on?",value:Se,onChange:a=>Ce(a.target.value),onKeyPress:a=>a.key==="Enter"&&Be()}),e.jsx("button",{className:s.quickTimeSave,onClick:Be,disabled:E<=0||!O||we,children:we?"Saving...":"Add Time"})]})]}),e.jsx("div",{className:s.tabs,children:["overview","notes","matters","time","billing","documents","communications"].map(a=>e.jsx("button",{className:F(s.tab,B===a&&s.active),onClick:()=>Ge(a),children:a.charAt(0).toUpperCase()+a.slice(1)},a))}),e.jsxs("div",{className:s.content,children:[B==="overview"&&e.jsxs("div",{className:s.overviewGrid,children:[e.jsxs("div",{className:s.card,children:[e.jsx("h3",{children:"Contact Information"}),e.jsxs("div",{className:s.detailGrid,children:[e.jsxs("div",{className:s.detailItem,children:[e.jsx("span",{className:s.detailLabel,children:"Email"}),e.jsx("span",{className:s.detailValue,children:m.email})]}),e.jsxs("div",{className:s.detailItem,children:[e.jsx("span",{className:s.detailLabel,children:"Phone"}),e.jsx("span",{className:s.detailValue,children:m.phone})]}),e.jsxs("div",{className:s.detailItem,children:[e.jsx("span",{className:s.detailLabel,children:"Address"}),e.jsx("span",{className:s.detailValue,children:m.addressStreet})]}),e.jsxs("div",{className:s.detailItem,children:[e.jsx("span",{className:s.detailLabel,children:"City, State ZIP"}),e.jsxs("span",{className:s.detailValue,children:[m.addressCity,", ",m.addressState," ",m.addressZip]})]}),((Fe=m.clientInfo)==null?void 0:Fe.billingContact)&&e.jsxs("div",{className:s.detailItem,children:[e.jsx("span",{className:s.detailLabel,children:"Billing Contact"}),e.jsx("span",{className:s.detailValue,children:m.clientInfo.billingContact})]})]})]}),e.jsxs("div",{className:s.card,children:[e.jsxs("div",{className:s.cardHeader,children:[e.jsxs("h3",{children:[e.jsx(ve,{size:18})," Active Matters"]}),e.jsxs("button",{className:s.addBtn,onClick:()=>Z(!0),children:[e.jsx(P,{size:14}),"Add"]})]}),e.jsxs("div",{className:s.matterList,children:[g.filter(a=>a.status==="active").slice(0,5).map(a=>e.jsxs(U,{to:`/app/matters/${a.id}`,className:s.matterItem,children:[e.jsxs("div",{children:[e.jsx("span",{className:s.matterName,children:a.name}),e.jsx("span",{className:s.matterNumber,children:a.number})]}),e.jsx("span",{className:s.matterType,children:(a.type||"other").replace(/_/g," ")})]},a.id)),g.filter(a=>a.status==="active").length===0&&e.jsx("p",{className:s.noData,children:"No active matters"})]})]}),e.jsxs("div",{className:s.card,children:[e.jsx("div",{className:s.cardHeader,children:e.jsxs("h3",{children:[e.jsx(ne,{size:18})," Recent Invoices"]})}),e.jsxs("div",{className:s.invoiceList,children:[G.slice(0,5).map(a=>e.jsxs("div",{className:s.invoiceItem,children:[e.jsxs("div",{children:[e.jsx("span",{className:s.invoiceNumber,children:a.number}),e.jsx("span",{className:s.invoiceDate,children:A(Q(a.issueDate),"MMM d, yyyy")})]}),e.jsxs("div",{className:s.invoiceRight,children:[e.jsxs("span",{className:s.invoiceAmount,children:["$",a.total.toLocaleString()]}),e.jsx("span",{className:F(s.badge,s[a.status]),children:a.status})]})]},a.id)),G.length===0&&e.jsx("p",{className:s.noData,children:"No invoices yet"})]})]})]}),B==="notes"&&e.jsx(ys,{notes:m.notes||"",onSave:async a=>{await t(d,{notes:a}),await p()}}),B==="matters"&&e.jsxs("div",{className:s.mattersTab,children:[e.jsxs("div",{className:s.tabHeader,children:[e.jsx("h2",{children:"All Matters"}),e.jsxs("button",{className:s.primaryBtn,onClick:()=>Z(!0),children:[e.jsx(P,{size:18}),"New Matter"]})]}),e.jsxs("div",{className:s.tableCard,children:[e.jsxs("table",{className:s.table,children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Matter"}),e.jsx("th",{children:"Type"}),e.jsx("th",{children:"Status"}),e.jsx("th",{children:"Opened"})]})}),e.jsx("tbody",{children:g.map(a=>e.jsxs("tr",{children:[e.jsx("td",{children:e.jsxs(U,{to:`/app/matters/${a.id}`,children:[e.jsx("div",{children:a.name}),e.jsx("div",{style:{fontSize:"0.75rem",color:"var(--apex-text)"},children:a.number})]})}),e.jsx("td",{style:{textTransform:"capitalize"},children:(a.type||"other").replace(/_/g," ")}),e.jsx("td",{children:e.jsx("span",{className:F(s.badge,s[a.status]),children:a.status.replace(/_/g," ")})}),e.jsx("td",{children:a.openDate?A(Q(a.openDate),"MMM d, yyyy"):"—"})]},a.id))})]}),g.length===0&&e.jsx("div",{className:s.emptyTable,children:"No matters for this client"})]})]}),B==="time"&&e.jsxs("div",{className:s.timeTab,children:[e.jsxs("div",{className:s.tabHeader,children:[e.jsx("h2",{children:"Time Entries"}),e.jsx("div",{className:s.tabActions,children:e.jsxs("button",{className:s.primaryBtn,onClick:()=>ee(!0),disabled:g.length===0,children:[e.jsx(P,{size:18}),"New Time Entry"]})})]}),e.jsxs("div",{className:s.timeStats,children:[e.jsxs("div",{className:s.timeStat,children:[e.jsx(Ne,{size:20}),e.jsxs("div",{children:[e.jsxs("span",{className:s.timeStatValue,children:[ae.totalHours.toFixed(1),"h"]}),e.jsx("span",{className:s.timeStatLabel,children:"Total Hours"})]})]}),e.jsxs("div",{className:s.timeStat,children:[e.jsx(us,{size:20}),e.jsxs("div",{children:[e.jsxs("span",{className:s.timeStatValue,children:[ae.billableHours.toFixed(1),"h"]}),e.jsx("span",{className:s.timeStatLabel,children:"Billable"})]})]}),e.jsxs("div",{className:s.timeStat,children:[e.jsx(ne,{size:20}),e.jsxs("div",{children:[e.jsxs("span",{className:s.timeStatValue,children:["$",ae.totalUnbilled.toLocaleString()]}),e.jsx("span",{className:s.timeStatLabel,children:"Unbilled"})]})]}),e.jsxs("div",{className:s.timeStat,children:[e.jsx(fe,{size:20}),e.jsxs("div",{children:[e.jsxs("span",{className:s.timeStatValue,children:["$",ae.totalBilled.toLocaleString()]}),e.jsx("span",{className:s.timeStatLabel,children:"Billed"})]})]})]}),z.length>0&&e.jsxs("div",{className:s.selectionBar,children:[e.jsxs("div",{className:s.selectionInfo,children:[e.jsx(fe,{size:18}),e.jsxs("span",{children:[z.length," entries selected"]}),e.jsxs("span",{className:s.selectionAmount,children:[Ye.toFixed(1),"h • $",Ze.toLocaleString()]})]}),e.jsxs("div",{className:s.selectionActions,children:[e.jsx("button",{className:s.clearSelectionBtn,onClick:()=>$([]),children:"Clear"}),e.jsxs("button",{className:s.createInvoiceBtn,onClick:()=>je(!0),children:[e.jsx(W,{size:16}),"Create Invoice"]})]})]}),Le.length>0&&z.length===0&&e.jsx("div",{className:s.selectAllBar,children:e.jsxs("button",{className:s.selectAllBtn,onClick:_e,children:["Select All Unbilled (",Le.length,")"]})}),w.length>0&&e.jsxs("div",{className:s.filterBar,children:[e.jsxs("div",{className:s.searchInputWrapper,children:[e.jsx(xs,{size:16,className:s.searchIcon}),e.jsx("input",{type:"text",placeholder:"Search by description or matter...",value:R,onChange:a=>se(a.target.value),className:s.searchInput}),R&&e.jsx("button",{className:s.clearSearchBtn,onClick:()=>se(""),children:e.jsx(q,{size:14})})]}),e.jsxs("div",{className:s.filterControls,children:[e.jsxs("select",{value:Y,onChange:a=>pe(a.target.value),className:s.filterSelect,children:[e.jsx("option",{value:"all",children:"All Status"}),e.jsx("option",{value:"unbilled",children:"Unbilled"}),e.jsx("option",{value:"billed",children:"Billed"})]}),(R||Y!=="all")&&e.jsx("button",{className:s.clearFiltersBtn,onClick:()=>{se(""),pe("all")},children:"Clear Filters"})]}),V.length!==w.length&&e.jsxs("span",{className:s.filterCount,children:["Showing ",V.length," of ",w.length," entries"]})]}),g.length===0?e.jsxs("div",{className:s.emptyTime,children:[e.jsx(ve,{size:48}),e.jsx("p",{children:"No matters for this client yet"}),e.jsxs("button",{className:s.primaryBtn,onClick:()=>Z(!0),children:[e.jsx(P,{size:18}),"Create First Matter"]})]}):w.length===0?e.jsxs("div",{className:s.emptyTime,children:[e.jsx(Ne,{size:48}),e.jsx("p",{children:"No time entries yet"}),e.jsxs("button",{className:s.primaryBtn,onClick:()=>ee(!0),children:[e.jsx(P,{size:18}),"Log First Time Entry"]})]}):V.length===0?e.jsxs("div",{className:s.emptyTime,children:[e.jsx(js,{size:48}),e.jsx("p",{children:"No entries match your filters"}),e.jsx("button",{className:s.primaryBtn,onClick:()=>{se(""),pe("all")},children:"Clear Filters"})]}):e.jsx("div",{className:s.timeEntryCards,children:V.map(a=>e.jsxs("div",{className:F(s.timeEntryCard,z.includes(a.id)&&s.selected),children:[!a.billed&&a.billable&&e.jsx("div",{className:s.entryCheckbox,children:e.jsx("input",{type:"checkbox",checked:z.includes(a.id),onChange:()=>We(a.id)})}),e.jsxs("div",{className:s.timeEntryDate,children:[e.jsx("span",{className:s.timeEntryDay,children:A(be(a.date),"d")}),e.jsx("span",{className:s.timeEntryMonth,children:A(be(a.date),"MMM")})]}),e.jsxs("div",{className:s.timeEntryContent,children:[e.jsx("span",{className:s.timeEntryDesc,children:a.description||"No description"}),e.jsxs("div",{className:s.timeEntryMeta,children:[e.jsx(U,{to:`/app/matters/${a.matterId}`,style:{color:"var(--apex-gold-bright)"},children:Je(a.matterId)}),e.jsxs("span",{style:{marginLeft:"8px"},children:[a.hours,"h @ $",a.rate,"/hr"]})]})]}),e.jsxs("div",{className:s.timeEntryRight,children:[e.jsxs("span",{className:s.timeEntryAmount,children:["$",a.amount.toLocaleString()]}),e.jsx("span",{className:F(s.badge,a.billed?s.billed:s.unbilled),children:a.billed?"Billed":"Unbilled"})]}),e.jsxs("div",{className:s.cardActions,style:{marginLeft:"12px"},children:[e.jsx("button",{className:s.iconBtn,onClick:()=>oe(a),title:"Edit",style:{padding:"6px"},children:e.jsx(ce,{size:14})}),e.jsx("button",{className:s.iconBtn,onClick:()=>Qe(a.id),title:"Delete",style:{padding:"6px",color:"var(--apex-error)"},children:e.jsx(Ee,{size:14})})]})]},a.id))})]}),B==="billing"&&e.jsxs("div",{className:s.billingTab,children:[e.jsxs("div",{className:s.tabHeader,children:[e.jsx("h2",{children:"Invoices"}),e.jsxs("button",{className:s.primaryBtn,onClick:()=>re(!0),children:[e.jsx(P,{size:18}),"Create Invoice"]})]}),e.jsxs("div",{className:s.tableCard,children:[e.jsxs("table",{className:s.table,children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Invoice #"}),e.jsx("th",{children:"Matter"}),e.jsx("th",{children:"Issue Date"}),e.jsx("th",{children:"Due Date"}),e.jsx("th",{children:"Amount"}),e.jsx("th",{children:"Status"})]})}),e.jsx("tbody",{children:G.map(a=>{const n=y.find(b=>b.id===a.matterId);return e.jsxs("tr",{children:[e.jsx("td",{children:a.number}),e.jsx("td",{children:e.jsx(U,{to:`/app/matters/${n==null?void 0:n.id}`,children:n==null?void 0:n.name})}),e.jsx("td",{children:A(Q(a.issueDate),"MMM d, yyyy")}),e.jsx("td",{children:A(Q(a.dueDate),"MMM d, yyyy")}),e.jsxs("td",{children:["$",a.total.toLocaleString()]}),e.jsx("td",{children:e.jsx("span",{className:F(s.badge,s[a.status]),children:a.status})})]},a.id)})})]}),G.length===0&&e.jsx("div",{className:s.emptyTable,children:"No invoices yet"})]})]}),B==="documents"&&e.jsxs("div",{className:s.documentsTab,children:[e.jsxs("div",{className:s.tabHeader,children:[e.jsx("h2",{children:"Documents"}),e.jsxs("button",{className:s.primaryBtn,onClick:()=>{const a=document.createElement("input");a.type="file",a.multiple=!0,a.onchange=n=>{const b=n.target.files;b&&b.length>0&&r.info(`${b.length} document(s) selected`,`Ready to upload to ${m==null?void 0:m.name}'s file.`)},a.click()},children:[e.jsx(P,{size:18}),"Upload Document"]})]}),e.jsxs("div",{className:s.docGrid,children:[ze.map(a=>e.jsxs("div",{className:s.docCard,children:[e.jsx("div",{className:s.docIcon,children:e.jsx(W,{size:24})}),e.jsxs("div",{className:s.docInfo,children:[e.jsx("span",{className:s.docName,children:a.name}),e.jsx("span",{className:s.docMeta,children:A(Q(a.uploadedAt),"MMM d, yyyy")})]})]},a.id)),ze.length===0&&e.jsxs("div",{className:s.emptyDocs,children:[e.jsx(W,{size:48}),e.jsx("p",{children:"No documents uploaded"})]})]})]}),B==="communications"&&e.jsxs("div",{className:s.documentsTab,children:[e.jsxs("div",{className:s.tabHeader,children:[e.jsx("h2",{children:"Communications"}),e.jsxs("p",{style:{color:"var(--text-secondary)",fontSize:"0.9rem",margin:"0.5rem 0 0"},children:["Emails from ",m.email," are automatically linked here. You can also ask the AI to link specific emails."]})]}),Ue?e.jsxs("div",{className:s.emptyDocs,children:[e.jsx(ie,{size:48}),e.jsx("p",{children:"Loading communications..."})]}):Me.length>0?e.jsx("div",{className:s.docGrid,children:Me.map(a=>e.jsxs("div",{className:s.docCard,style:{cursor:"pointer"},onClick:()=>v(`/app/integrations/outlook?emailId=${a.emailId}`),title:"Open in Outlook",children:[e.jsx("div",{className:s.docIcon,children:e.jsx(ie,{size:24})}),e.jsxs("div",{className:s.docInfo,children:[e.jsx("span",{className:s.docName,children:a.subject||"(No Subject)"}),e.jsxs("span",{className:s.docMeta,children:["From: ",a.from]}),e.jsx("span",{className:s.docMeta,children:a.receivedAt?A(Q(a.receivedAt),"MMM d, yyyy h:mm a"):"Date unknown"}),a.notes&&e.jsx("span",{className:s.docMeta,style:{fontStyle:"italic"},children:a.notes})]})]},a.id||a.emailId))}):e.jsxs("div",{className:s.emptyDocs,children:[e.jsx(ie,{size:48}),e.jsx("p",{children:"No communications linked yet"}),e.jsx("p",{style:{fontSize:"0.85rem",color:"var(--text-tertiary)"},children:"Connect Outlook in Settings → Integrations to auto-link emails from this client"})]})]})]}),qe&&e.jsx(Ns,{client:m,onClose:()=>X(!1),onSave:async a=>{await t(d,a),X(!1),p()}}),$e&&e.jsx(bs,{clientId:m.id,clientName:m.name,onClose:()=>Z(!1),onSave:async a=>{await L(a),Z(!1),C()}}),Re&&e.jsx(gs,{clientId:m.id,clientName:m.name,clientMatters:g,onClose:()=>re(!1),onSave:async a=>{await k(a),re(!1),h()}}),He&&e.jsx(Oe,{clientName:m.name,clientMatters:g,onClose:()=>ee(!1),onSave:async a=>{await c(a),ee(!1),await l({limit:500})}}),de&&e.jsx(Oe,{clientName:m.name,clientMatters:g,existingEntry:de,onClose:()=>oe(null),onSave:async a=>{await j(de.id,a),oe(null),await l({limit:500})}}),Ve&&m&&e.jsx(fs,{onClose:()=>{je(!1),$([])},selectedEntries:w.filter(a=>z.includes(a.id)),client:m,matters:g,onCreateInvoice:async a=>{try{await k(a);for(const n of z)await j(n,{billed:!0});await l({limit:500}),await h(),$([]),je(!1)}catch(n){console.error("Failed to create invoice:",n),r.error("Failed to create invoice","Please try again.")}}}),e.jsx(ls,{isOpen:H.isOpen,onClose:()=>J(a=>({...a,isOpen:!1})),onConfirm:H.onConfirm,title:H.title,message:H.message,confirmText:H.confirmText,type:H.type})]}):e.jsxs("div",{className:s.notFound,children:[e.jsx(Pe,{size:48}),e.jsx("h2",{children:"Client not found"}),e.jsx(U,{to:"/app/clients",children:"Back to Clients"})]})}function Ns({client:d,onClose:v,onSave:r}){const[N,y]=i.useState(!1),[o,u]=i.useState({name:d.name||"",email:d.email||"",phone:d.phone||"",type:d.type||"person",addressStreet:d.addressStreet||"",addressCity:d.addressCity||"",addressState:d.addressState||"",addressZip:d.addressZip||"",notes:d.notes||"",isActive:d.isActive!==!1}),x=async t=>{if(t.preventDefault(),!N){y(!0);try{await r(o)}finally{y(!1)}}};return e.jsx("div",{className:s.modalOverlay,onClick:v,children:e.jsxs("div",{className:s.modal,onClick:t=>t.stopPropagation(),children:[e.jsxs("div",{className:s.modalHeader,children:[e.jsx("h2",{children:"Edit Client"}),e.jsx("button",{onClick:v,className:s.closeBtn,children:e.jsx(q,{size:20})})]}),e.jsxs("form",{onSubmit:x,className:s.modalForm,children:[e.jsxs("div",{className:s.formGroup,children:[e.jsx("label",{children:"Client Type"}),e.jsxs("select",{value:o.type,onChange:t=>u({...o,type:t.target.value}),children:[e.jsx("option",{value:"person",children:"Individual"}),e.jsx("option",{value:"company",children:"Organization"})]})]}),e.jsxs("div",{className:s.formGroup,children:[e.jsx("label",{children:o.type==="company"?"Organization Name":"Full Name"}),e.jsx("input",{type:"text",value:o.name,onChange:t=>u({...o,name:t.target.value}),required:!0})]}),e.jsxs("div",{className:s.formRow,children:[e.jsxs("div",{className:s.formGroup,children:[e.jsx("label",{children:"Email"}),e.jsx("input",{type:"email",value:o.email,onChange:t=>u({...o,email:t.target.value})})]}),e.jsxs("div",{className:s.formGroup,children:[e.jsx("label",{children:"Phone"}),e.jsx("input",{type:"tel",value:o.phone,onChange:t=>u({...o,phone:t.target.value})})]})]}),e.jsxs("div",{className:s.formGroup,children:[e.jsx("label",{children:"Street Address"}),e.jsx("input",{type:"text",value:o.addressStreet,onChange:t=>u({...o,addressStreet:t.target.value})})]}),e.jsxs("div",{className:s.formRow,children:[e.jsxs("div",{className:s.formGroup,children:[e.jsx("label",{children:"City"}),e.jsx("input",{type:"text",value:o.addressCity,onChange:t=>u({...o,addressCity:t.target.value})})]}),e.jsxs("div",{className:s.formGroup,children:[e.jsx("label",{children:"State"}),e.jsx("input",{type:"text",value:o.addressState,onChange:t=>u({...o,addressState:t.target.value})})]}),e.jsxs("div",{className:s.formGroup,children:[e.jsx("label",{children:"ZIP"}),e.jsx("input",{type:"text",value:o.addressZip,onChange:t=>u({...o,addressZip:t.target.value})})]})]}),e.jsxs("div",{className:s.formGroup,children:[e.jsx("label",{children:"Notes"}),e.jsx("textarea",{value:o.notes,onChange:t=>u({...o,notes:t.target.value}),rows:3})]}),e.jsx("div",{className:s.formGroup,children:e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[e.jsx("input",{type:"checkbox",checked:o.isActive,onChange:t=>u({...o,isActive:t.target.checked})}),"Active Client"]})}),e.jsxs("div",{className:s.modalActions,children:[e.jsx("button",{type:"button",onClick:v,className:s.cancelBtn,disabled:N,children:"Cancel"}),e.jsx("button",{type:"submit",className:s.saveBtn,disabled:N,children:N?"Saving...":"Save Changes"})]})]})]})})}function bs({clientId:d,clientName:v,onClose:r,onSave:N}){const y=K(),[o,u]=i.useState(!1),[x,t]=i.useState({name:"",description:"",clientId:d,type:"litigation",status:"active",priority:"medium",billingType:"hourly",billingRate:450,openDate:new Date().toISOString()}),f=async p=>{if(p.preventDefault(),!o){if(!x.name.trim()){y.warning("Please enter a matter name");return}u(!0);try{await N(x)}finally{u(!1)}}};return e.jsx("div",{className:s.modalOverlay,onClick:r,children:e.jsxs("div",{className:s.modal,onClick:p=>p.stopPropagation(),children:[e.jsxs("div",{className:s.modalHeader,children:[e.jsxs("h2",{children:["New Matter for ",v]}),e.jsx("button",{onClick:r,className:s.closeBtn,children:e.jsx(q,{size:20})})]}),e.jsxs("form",{onSubmit:f,className:s.modalForm,children:[e.jsxs("div",{className:s.formGroup,children:[e.jsx("label",{children:"Matter Name *"}),e.jsx("input",{type:"text",value:x.name,onChange:p=>t({...x,name:p.target.value}),placeholder:"e.g., Contract Dispute - ABC Corp",required:!0,autoFocus:!0})]}),e.jsxs("div",{className:s.formRow,children:[e.jsxs("div",{className:s.formGroup,children:[e.jsx("label",{children:"Matter Type"}),e.jsxs("select",{value:x.type,onChange:p=>t({...x,type:p.target.value}),children:[e.jsx("option",{value:"litigation",children:"Litigation"}),e.jsx("option",{value:"corporate",children:"Corporate"}),e.jsx("option",{value:"real_estate",children:"Real Estate"}),e.jsx("option",{value:"intellectual_property",children:"Intellectual Property"}),e.jsx("option",{value:"employment",children:"Employment"}),e.jsx("option",{value:"personal_injury",children:"Personal Injury"}),e.jsx("option",{value:"estate_planning",children:"Estate Planning"}),e.jsx("option",{value:"other",children:"Other"})]})]}),e.jsxs("div",{className:s.formGroup,children:[e.jsx("label",{children:"Priority"}),e.jsxs("select",{value:x.priority,onChange:p=>t({...x,priority:p.target.value}),children:[e.jsx("option",{value:"low",children:"Low"}),e.jsx("option",{value:"medium",children:"Medium"}),e.jsx("option",{value:"high",children:"High"}),e.jsx("option",{value:"urgent",children:"Urgent"})]})]})]}),e.jsxs("div",{className:s.formRow,children:[e.jsxs("div",{className:s.formGroup,children:[e.jsx("label",{children:"Billing Type"}),e.jsxs("select",{value:x.billingType,onChange:p=>t({...x,billingType:p.target.value}),children:[e.jsx("option",{value:"hourly",children:"Hourly"}),e.jsx("option",{value:"flat_fee",children:"Flat Fee"}),e.jsx("option",{value:"contingency",children:"Contingency"}),e.jsx("option",{value:"retainer",children:"Retainer"})]})]}),e.jsxs("div",{className:s.formGroup,children:[e.jsx("label",{children:"Billing Rate ($/hr)"}),e.jsx("input",{type:"number",value:x.billingRate,onChange:p=>t({...x,billingRate:parseInt(p.target.value)||0})})]})]}),e.jsxs("div",{className:s.formGroup,children:[e.jsx("label",{children:"Description"}),e.jsx("textarea",{value:x.description,onChange:p=>t({...x,description:p.target.value}),placeholder:"Brief description of the matter...",rows:3})]}),e.jsxs("div",{className:s.modalActions,children:[e.jsx("button",{type:"button",onClick:r,className:s.cancelBtn,disabled:o,children:"Cancel"}),e.jsx("button",{type:"submit",className:s.saveBtn,disabled:o,children:o?"Creating...":"Create Matter"})]})]})]})})}function fs({onClose:d,selectedEntries:v,client:r,matters:N,onCreateInvoice:y}){const[o,u]=i.useState(!1),[x,t]=i.useState(""),f=v.reduce((h,c)=>h+c.amount,0),p=v.reduce((h,c)=>h+c.hours,0),L=i.useMemo(()=>{const h={};return v.forEach(c=>{const l=N.find(S=>S.id===c.matterId),j=c.matterId||"no-matter";h[j]||(h[j]={matter:l,entries:[],total:0,hours:0}),h[j].entries.push(c),h[j].total+=c.amount,h[j].hours+=c.hours}),Object.values(h)},[v,N]),C=i.useMemo(()=>[...new Set(v.map(c=>c.matterId))].map(c=>N.find(l=>l.id===c)).filter(Boolean),[v,N]);i.useEffect(()=>{C.length===1&&t(C[0].id)},[C]);const k=async()=>{var h;u(!0);try{const c=v.map(l=>{const j=N.find(S=>S.id===l.matterId);return{description:`${(j==null?void 0:j.name)||"Legal Services"}: ${l.description||"Services rendered"}`,quantity:l.hours,rate:l.rate,amount:l.amount}});await y({clientId:r.id,matterId:x||((h=C[0])==null?void 0:h.id),issueDate:new Date().toISOString(),dueDate:new Date(Date.now()+30*24*60*60*1e3).toISOString(),status:"draft",subtotal:f,total:f,amountPaid:0,lineItems:c,timeEntryIds:v.map(l=>l.id)})}finally{u(!1)}};return e.jsx("div",{className:s.modalOverlay,onClick:d,children:e.jsxs("div",{className:s.billModal,onClick:h=>h.stopPropagation(),children:[e.jsxs("div",{className:s.billModalHeader,children:[e.jsxs("div",{className:s.billModalTitle,children:[e.jsx(W,{size:20}),e.jsx("h2",{children:"Create Invoice"})]}),e.jsx("button",{onClick:d,className:s.closeBtn,children:e.jsx(q,{size:20})})]}),e.jsxs("div",{className:s.billModalContent,children:[e.jsxs("div",{className:s.billClientInfo,children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Client:"})," ",r.name]}),C.length===1&&e.jsxs("div",{children:[e.jsx("strong",{children:"Matter:"})," ",C[0].name]})]}),C.length>1&&e.jsxs("div",{className:s.formGroup,children:[e.jsx("label",{children:"Primary Matter for Invoice"}),e.jsxs("select",{value:x,onChange:h=>t(h.target.value),children:[e.jsx("option",{value:"",children:"Select matter..."}),C.map(h=>e.jsx("option",{value:h.id,children:h.name},h.id))]})]}),e.jsxs("div",{className:s.billSummaryCompact,children:[e.jsxs("div",{className:s.billStatItem,children:[e.jsx("span",{className:s.billStatValue,children:v.length}),e.jsx("span",{className:s.billStatLabel,children:"Entries"})]}),e.jsx("div",{className:s.billStatDivider}),e.jsxs("div",{className:s.billStatItem,children:[e.jsxs("span",{className:s.billStatValue,children:[p.toFixed(1),"h"]}),e.jsx("span",{className:s.billStatLabel,children:"Hours"})]}),e.jsx("div",{className:s.billStatDivider}),e.jsxs("div",{className:s.billStatItem,children:[e.jsxs("span",{className:s.billStatValue,children:["$",f.toLocaleString()]}),e.jsx("span",{className:s.billStatLabel,children:"Total"})]})]}),e.jsxs("div",{className:s.billPreviewList,children:[e.jsx("div",{className:s.billPreviewHeader,children:"Time Entries by Matter"}),e.jsx("div",{className:s.billPreviewItems,children:L.map((h,c)=>{var l;return e.jsxs("div",{className:s.billPreviewItem,children:[e.jsxs("div",{className:s.billPreviewItemLeft,children:[e.jsx("span",{className:s.billPreviewDesc,children:((l=h.matter)==null?void 0:l.name)||"Unknown Matter"}),e.jsxs("span",{className:s.billPreviewMeta,children:[h.entries.length," entries"]})]}),e.jsxs("div",{className:s.billPreviewItemRight,children:[e.jsxs("span",{className:s.billPreviewHours,children:[h.hours.toFixed(1),"h"]}),e.jsxs("span",{className:s.billPreviewAmount,children:["$",h.total.toLocaleString()]})]})]},c)})})]}),e.jsx("div",{className:s.billNote,children:e.jsx("span",{children:"Invoice created as draft • Time entries marked as billed"})})]}),e.jsxs("div",{className:s.billModalFooter,children:[e.jsx("button",{onClick:d,className:s.cancelBtn,disabled:o,children:"Cancel"}),e.jsx("button",{onClick:k,className:s.saveBtn,disabled:o||v.length===0,children:o?"Creating...":`Create Invoice ($${f.toLocaleString()})`})]})]})})}function Oe({clientName:d,clientMatters:v,existingEntry:r,onClose:N,onSave:y}){var k,h;const o=K(),[u,x]=i.useState(!1),[t,f]=i.useState({matterId:(r==null?void 0:r.matterId)||((k=v[0])==null?void 0:k.id)||"",date:r!=null&&r.date?A(be(r.date),"yyyy-MM-dd"):A(new Date,"yyyy-MM-dd"),hours:(r==null?void 0:r.hours)||1,rate:(r==null?void 0:r.rate)||((h=v[0])==null?void 0:h.billingRate)||450,description:(r==null?void 0:r.description)||"",billable:(r==null?void 0:r.billable)!==void 0?r.billable:!0}),p=c=>{const l=v.find(j=>j.id===c);f({...t,matterId:c,rate:(l==null?void 0:l.billingRate)||t.rate})},L=c=>{const[l,j,S]=c.split("-").map(Number);return new Date(l,j-1,S,12,0,0).toISOString()},C=async c=>{if(c.preventDefault(),!u){if(!t.matterId){o.warning("Please select a matter");return}x(!0);try{await y({...t,date:L(t.date),billed:(r==null?void 0:r.billed)||!1,aiGenerated:!1})}finally{x(!1)}}};return v.find(c=>c.id===t.matterId),e.jsx("div",{className:s.modalOverlay,onClick:N,children:e.jsxs("div",{className:s.modal,onClick:c=>c.stopPropagation(),children:[e.jsxs("div",{className:s.modalHeader,children:[e.jsx("h2",{children:r?"Edit Time Entry":"New Time Entry"}),e.jsx("button",{onClick:N,className:s.closeBtn,children:e.jsx(q,{size:20})})]}),e.jsxs("form",{onSubmit:C,className:s.modalForm,children:[e.jsxs("div",{className:s.formInfo,children:[e.jsx("strong",{children:"Client:"})," ",d]}),e.jsxs("div",{className:s.formGroup,children:[e.jsx("label",{children:"Matter *"}),e.jsxs("select",{value:t.matterId,onChange:c=>p(c.target.value),required:!0,children:[e.jsx("option",{value:"",children:"Select a matter..."}),v.map(c=>e.jsx("option",{value:c.id,children:c.name},c.id))]})]}),e.jsxs("div",{className:s.formRow,children:[e.jsxs("div",{className:s.formGroup,children:[e.jsx("label",{children:"Date"}),e.jsx("input",{type:"date",value:t.date,onChange:c=>f({...t,date:c.target.value}),required:!0})]}),e.jsxs("div",{className:s.formGroup,children:[e.jsx("label",{children:"Hours"}),e.jsx("input",{type:"number",step:"0.1",min:"0.1",value:t.hours,onChange:c=>f({...t,hours:parseFloat(c.target.value)||0}),required:!0})]})]}),e.jsxs("div",{className:s.formRow,children:[e.jsxs("div",{className:s.formGroup,children:[e.jsx("label",{children:"Rate ($/hr)"}),e.jsx("input",{type:"number",value:t.rate,onChange:c=>f({...t,rate:parseFloat(c.target.value)||0}),required:!0})]}),e.jsxs("div",{className:s.formGroup,children:[e.jsx("label",{children:"Total"}),e.jsxs("div",{className:s.formValue,children:["$",(t.hours*t.rate).toFixed(2)]})]})]}),e.jsxs("div",{className:s.formGroup,children:[e.jsx("label",{children:"Description (optional)"}),e.jsx("textarea",{value:t.description,onChange:c=>f({...t,description:c.target.value}),placeholder:"Describe the work performed...",rows:3})]}),e.jsx("div",{className:s.formGroup,children:e.jsxs("label",{className:s.checkboxLabel,children:[e.jsx("input",{type:"checkbox",checked:t.billable,onChange:c=>f({...t,billable:c.target.checked})}),"Billable"]})}),e.jsxs("div",{className:s.modalActions,children:[e.jsx("button",{type:"button",onClick:N,className:s.cancelBtn,disabled:u,children:"Cancel"}),e.jsx("button",{type:"submit",className:s.saveBtn,disabled:u,children:u?"Saving...":r?"Update Time Entry":"Save Time Entry"})]})]})]})})}function gs({clientId:d,clientName:v,clientMatters:r,onClose:N,onSave:y}){var c;const o=K(),[u,x]=i.useState(!1),[t,f]=i.useState({clientId:d,matterId:((c=r[0])==null?void 0:c.id)||"",issueDate:A(new Date,"yyyy-MM-dd"),dueDate:A(ps(new Date,30),"yyyy-MM-dd"),notes:"",lineItems:[{description:"Professional Legal Services",quantity:1,rate:0,amount:0}]}),p=()=>{f({...t,lineItems:[...t.lineItems,{description:"",quantity:1,rate:0,amount:0}]})},L=l=>{f({...t,lineItems:t.lineItems.filter((j,S)=>S!==l)})},C=(l,j,S)=>{const T=[...t.lineItems];T[l]={...T[l],[j]:S},(j==="quantity"||j==="rate")&&(T[l].amount=T[l].quantity*T[l].rate),j==="amount"&&T[l].quantity>0&&(T[l].rate=S/T[l].quantity),f({...t,lineItems:T})},k=t.lineItems.reduce((l,j)=>l+(j.amount||0),0),h=async l=>{if(l.preventDefault(),!u){if(k<=0){o.warning("Please add at least one line item with an amount");return}x(!0);try{await y({...t,total:k,status:"draft",amountPaid:0,subtotal:k,issueDate:new Date(t.issueDate).toISOString(),dueDate:new Date(t.dueDate).toISOString()})}finally{x(!1)}}};return e.jsx("div",{className:s.modalOverlay,onClick:N,children:e.jsxs("div",{className:s.modal,onClick:l=>l.stopPropagation(),style:{maxWidth:"600px"},children:[e.jsxs("div",{className:s.modalHeader,children:[e.jsxs("h2",{children:["New Invoice for ",v]}),e.jsx("button",{onClick:N,className:s.closeBtn,children:e.jsx(q,{size:20})})]}),e.jsxs("form",{onSubmit:h,className:s.modalForm,children:[r.length>0&&e.jsxs("div",{className:s.formGroup,children:[e.jsx("label",{children:"Related Matter"}),e.jsxs("select",{value:t.matterId,onChange:l=>f({...t,matterId:l.target.value}),children:[e.jsx("option",{value:"",children:"No specific matter"}),r.map(l=>e.jsx("option",{value:l.id,children:l.name},l.id))]})]}),e.jsxs("div",{className:s.formRow,children:[e.jsxs("div",{className:s.formGroup,children:[e.jsx("label",{children:"Issue Date"}),e.jsx("input",{type:"date",value:t.issueDate,onChange:l=>f({...t,issueDate:l.target.value}),required:!0})]}),e.jsxs("div",{className:s.formGroup,children:[e.jsx("label",{children:"Due Date"}),e.jsx("input",{type:"date",value:t.dueDate,onChange:l=>f({...t,dueDate:l.target.value}),required:!0})]})]}),e.jsxs("div",{className:s.formGroup,children:[e.jsx("label",{children:"Line Items"}),e.jsxs("div",{className:s.lineItems,children:[t.lineItems.map((l,j)=>e.jsxs("div",{className:s.lineItem,children:[e.jsx("input",{type:"text",placeholder:"Description",value:l.description,onChange:S=>C(j,"description",S.target.value),style:{flex:2}}),e.jsx("input",{type:"number",placeholder:"Qty",value:l.quantity,onChange:S=>C(j,"quantity",parseFloat(S.target.value)||0),style:{width:"60px"}}),e.jsx("input",{type:"number",placeholder:"Rate",value:l.rate,onChange:S=>C(j,"rate",parseFloat(S.target.value)||0),style:{width:"80px"}}),e.jsx("input",{type:"number",placeholder:"Amount",value:l.amount,onChange:S=>C(j,"amount",parseFloat(S.target.value)||0),style:{width:"100px"}}),t.lineItems.length>1&&e.jsx("button",{type:"button",onClick:()=>L(j),className:s.removeLineBtn,children:e.jsx(q,{size:14})})]},j)),e.jsxs("button",{type:"button",onClick:p,className:s.addLineBtn,children:[e.jsx(P,{size:14})," Add Line Item"]})]})]}),e.jsxs("div",{className:s.invoiceTotal,children:[e.jsx("span",{children:"Total:"}),e.jsxs("span",{children:["$",k.toLocaleString(void 0,{minimumFractionDigits:2})]})]}),e.jsxs("div",{className:s.formGroup,children:[e.jsx("label",{children:"Notes"}),e.jsx("textarea",{value:t.notes,onChange:l=>f({...t,notes:l.target.value}),placeholder:"Additional notes for the invoice...",rows:2})]}),e.jsxs("div",{className:s.modalActions,children:[e.jsx("button",{type:"button",onClick:N,className:s.cancelBtn,disabled:u,children:"Cancel"}),e.jsx("button",{type:"submit",className:s.saveBtn,disabled:u,children:u?"Creating...":`Create Invoice ($${k.toLocaleString()})`})]})]})]})})}function ys({notes:d,onSave:v}){const r=K(),[N,y]=i.useState(!1),[o,u]=i.useState(d),[x,t]=i.useState(!1),[f,p]=i.useState(!1);i.useEffect(()=>{N||u(d)},[d,N]);const L=async()=>{t(!0),p(!1);try{await v(o),y(!1),p(!0),setTimeout(()=>p(!1),3e3)}catch(k){console.error("Failed to save notes:",k),r.error("Failed to save notes","Please try again.")}finally{t(!1)}},C=()=>{u(d),y(!1)};return e.jsxs("div",{className:s.notesTab,children:[e.jsxs("div",{className:s.tabHeader,children:[e.jsx("h2",{children:"Notes"}),e.jsx("div",{className:s.tabActions,children:N?e.jsxs(e.Fragment,{children:[e.jsx("button",{className:s.cancelBtn,onClick:C,disabled:x,children:"Cancel"}),e.jsx("button",{className:s.primaryBtn,onClick:L,disabled:x,children:x?"Saving...":"Save Notes"})]}):e.jsxs("button",{className:s.primaryBtn,onClick:()=>y(!0),children:[e.jsx(ce,{size:18}),"Edit Notes"]})})]}),f&&e.jsxs("div",{className:s.successMessage,children:[e.jsx(fe,{size:18}),"Notes saved successfully!"]}),e.jsx("div",{className:s.notesCard,children:N?e.jsx("textarea",{className:s.notesTextarea,value:o,onChange:k=>u(k.target.value),placeholder:"Add internal notes about this client...",autoFocus:!0}):e.jsx("div",{className:s.notesDisplay,children:d?e.jsx("p",{style:{whiteSpace:"pre-wrap",color:"var(--apex-white)",lineHeight:"1.8",margin:0,fontSize:"0.95rem"},children:d}):e.jsxs("div",{className:s.emptyNotes,children:[e.jsx(W,{size:48}),e.jsx("p",{children:"No notes yet"}),e.jsx("span",{children:'Click "Edit Notes" to add internal notes about this client.'})]})})})]})}export{Fs as ClientDetailPage};
