import{r as o,a6 as e}from"./vendor-DrKzkH4x.js";import{a as Q,e as Z,d as ee}from"./router-CNLU_KyZ.js";import{k as I}from"./index-CCWWoMiH.js";import{L as z,al as se,aW as R,F as E,r as ne,p as te,aB as re,bX as ae,a as le,aE as H,J as U,t as ie}from"./icons-BtUkkwGS.js";import{f as w,p as b}from"./date-utils-BkNAU8cl.js";import"./doc-parsers-U1nJMjtM.js";import"./react-dom-DfB-QKj2.js";import"./pdf-worker-CVmCB3lP.js";import"./state-72d44OIA.js";const oe="_container_rflet_1",ce="_fullscreen_rflet_10",de="_loading_rflet_19",me="_comparing_rflet_20",pe="_spinning_rflet_30",he="_spin_rflet_30",_e="_header_rflet_40",fe="_headerLeft_rflet_49",ue="_backBtn_rflet_55",xe="_headerIcon_rflet_74",ve="_docName_rflet_92",je="_headerActions_rflet_101",Ne="_iconBtn_rflet_106",ye="_downloadBtn_rflet_125",ge="_versionSelectors_rflet_149",we="_versionSelect_rflet_149",be="_compareArrow_rflet_190",Ce="_toolbar_rflet_196",Se="_viewModes_rflet_209",Me="_active_rflet_233",Te="_stats_rflet_239",Be="_statAdded_rflet_245",Ae="_statRemoved_rflet_250",$e="_statChanged_rflet_255",Le="_statWords_rflet_260",ke="_error_rflet_265",Ve="_content_rflet_277",De="_sideBySide_rflet_284",Ie="_panel_rflet_291",ze="_panelHeader_rflet_300",Re="_versionBadge_rflet_310",Ee="_panelTitle_rflet_323",He="_panelMeta_rflet_328",Ue="_panelContent_rflet_337",We="_equal_rflet_354",qe="_deleted_rflet_358",Oe="_inserted_rflet_366",Pe="_unified_rflet_374",Fe="_legend_rflet_386",Ge="_legendDeleted_rflet_392",Je="_legendInserted_rflet_406",Xe="_changesList_rflet_421",Ye="_changeItem_rflet_427",Ke="_insert_rflet_366",Qe="_replace_rflet_442",Ze="_changeHeader_rflet_446",es="_changeType_rflet_452",ss="_changeContent_rflet_469",ns="_oldContent_rflet_473",ts="_newContent_rflet_474",rs="_label_rflet_480",as="_text_rflet_496",ls="_noChanges_rflet_510",is="_emptyState_rflet_530",os="_emptyDiff_rflet_570",s={container:oe,fullscreen:ce,loading:de,comparing:me,spinning:pe,spin:he,header:_e,headerLeft:fe,backBtn:ue,headerIcon:xe,docName:ve,headerActions:je,iconBtn:Ne,downloadBtn:ye,versionSelectors:ge,versionSelect:we,compareArrow:be,toolbar:Ce,viewModes:Se,active:Me,stats:Te,statAdded:Be,statRemoved:Ae,statChanged:$e,statWords:Le,error:ke,content:Ve,sideBySide:De,panel:Ie,panelHeader:ze,versionBadge:Re,new:"_new_rflet_319",panelTitle:Ee,panelMeta:He,panelContent:Ue,equal:We,deleted:qe,inserted:Oe,unified:Pe,legend:Fe,legendDeleted:Ge,legendInserted:Je,changesList:Xe,changeItem:Ye,insert:Ke,delete:"_delete_rflet_358",replace:Qe,changeHeader:Ze,changeType:es,changeContent:ss,oldContent:ns,newContent:ts,label:rs,text:as,noChanges:ls,emptyState:is,emptyDiff:os};function cs(C,N){const m=C.split(/(\s+)/),h=N.split(/(\s+)/),f=[];let i=0,r=0;for(;i<m.length||r<h.length;){if(i>=m.length){f.push({type:"insert",oldText:"",newText:h.slice(r).join(""),oldStart:i,newStart:r});break}if(r>=h.length){f.push({type:"delete",oldText:m.slice(i).join(""),newText:"",oldStart:i,newStart:r});break}if(m[i]===h[r])f.push({type:"equal",oldText:m[i],newText:h[r],oldStart:i,newStart:r}),i++,r++;else{let y=!1;for(let c=r+1;c<Math.min(r+10,h.length);c++)if(m[i]===h[c]){f.push({type:"insert",oldText:"",newText:h.slice(r,c).join(""),oldStart:i,newStart:r}),r=c,y=!0;break}if(!y){for(let c=i+1;c<Math.min(i+10,m.length);c++)if(m[c]===h[r]){f.push({type:"delete",oldText:m.slice(i,c).join(""),newText:"",oldStart:i,newStart:r}),i=c,y=!0;break}}y||(f.push({type:"replace",oldText:m[i],newText:h[r],oldStart:i,newStart:r}),i++,r++)}}return f}function ys(){const C=Q(),{documentId:N}=Z(),[m,h]=ee(),f=m.get("v1"),i=m.get("v2"),[r,y]=o.useState([]),[c,W]=o.useState(""),[a,q]=o.useState(null),[l,O]=o.useState(null),[x,$]=o.useState(parseInt(f||"0")),[v,L]=o.useState(parseInt(i||"0")),[P,k]=o.useState(!0),[S,V]=o.useState(!1),[D,T]=o.useState(null),[g,B]=o.useState("side-by-side"),[ds,ms]=o.useState(!0),[M,F]=o.useState(!1);o.useEffect(()=>{N&&G()},[N]),o.useEffect(()=>{x>0&&v>0&&x!==v&&J()},[x,v]);const G=async()=>{var n;try{k(!0);const t=await I.getVersions(N);if(y(t.versions||[]),W(t.documentName||"Document"),((n=t.versions)==null?void 0:n.length)>=2){const d=t.versions[0].versionNumber,u=t.versions[1].versionNumber;x||$(u),v||L(d)}}catch(t){T(t.message||"Failed to load versions")}finally{k(!1)}},J=async()=>{if(!(!N||x===v))try{V(!0),T(null);const n=await I.compareVersions(N,x,v);q({versionNumber:n.version1.versionNumber,versionLabel:n.version1.versionLabel,content:n.version1.content||"",wordCount:n.version1.wordCount||0,createdBy:n.version1.createdBy||"Unknown",createdAt:n.version1.createdAt}),O({versionNumber:n.version2.versionNumber,versionLabel:n.version2.versionLabel,content:n.version2.content||"",wordCount:n.version2.wordCount||0,createdBy:n.version2.createdBy||"Unknown",createdAt:n.version2.createdAt}),h({v1:String(x),v2:String(v)})}catch(n){T(n.message||"Failed to compare versions")}finally{V(!1)}},j=o.useMemo(()=>!a||!l?[]:cs(a.content,l.content),[a,l]),_=o.useMemo(()=>{const n=j.filter(p=>p.type==="insert").length,t=j.filter(p=>p.type==="delete").length,d=j.filter(p=>p.type==="replace").length,u=((l==null?void 0:l.wordCount)||0)-((a==null?void 0:a.wordCount)||0);return{insertions:n,deletions:t,replacements:d,wordDiff:u}},[j,a,l]),A=n=>j.length?j.map((t,d)=>{if(t.type==="equal")return e.jsx("span",{className:s.equal,children:t.oldText},d);if(n==="unified"){if(t.type==="delete")return e.jsx("span",{className:s.deleted,children:t.oldText},d);if(t.type==="insert")return e.jsx("span",{className:s.inserted,children:t.newText},d);if(t.type==="replace")return e.jsxs("span",{children:[e.jsx("span",{className:s.deleted,children:t.oldText}),e.jsx("span",{className:s.inserted,children:t.newText})]},d)}return n==="old"?t.type==="delete"||t.type==="replace"?e.jsx("span",{className:s.deleted,children:t.oldText},d):null:n==="new"&&(t.type==="insert"||t.type==="replace")?e.jsx("span",{className:s.inserted,children:t.newText},d):null}):e.jsx("div",{className:s.emptyDiff,children:"No differences found"}),X=()=>{const n=j.filter(t=>t.type!=="equal");return n.length?e.jsx("div",{className:s.changesList,children:n.map((t,d)=>e.jsxs("div",{className:`${s.changeItem} ${s[t.type]}`,children:[e.jsx("div",{className:s.changeHeader,children:e.jsxs("span",{className:s.changeType,children:[t.type==="insert"&&"+ Added",t.type==="delete"&&"− Removed",t.type==="replace"&&"↔ Changed"]})}),e.jsxs("div",{className:s.changeContent,children:[(t.type==="delete"||t.type==="replace")&&e.jsxs("div",{className:s.oldContent,children:[e.jsx("span",{className:s.label,children:"Was:"}),e.jsx("span",{className:s.text,children:t.oldText})]}),(t.type==="insert"||t.type==="replace")&&e.jsxs("div",{className:s.newContent,children:[e.jsx("span",{className:s.label,children:"Now:"}),e.jsx("span",{className:s.text,children:t.newText})]})]})]},d))}):e.jsxs("div",{className:s.noChanges,children:[e.jsx(ie,{size:48}),e.jsx("h3",{children:"No differences found"}),e.jsx("p",{children:"These versions are identical"})]})},Y=()=>{if(!a||!l)return;let n=`REDLINE COMPARISON
`;n+=`==================

`,n+=`Document: ${c}
`,n+=`Comparing Version ${a.versionNumber} → Version ${l.versionNumber}

`,n+=`Version ${a.versionNumber}: ${a.createdBy} on ${w(b(a.createdAt),"MMM d, yyyy h:mm a")}
`,n+=`Version ${l.versionNumber}: ${l.createdBy} on ${w(b(l.createdAt),"MMM d, yyyy h:mm a")}

`,n+=`SUMMARY
`,n+=`-------
`,n+=`Additions: ${_.insertions}
`,n+=`Deletions: ${_.deletions}
`,n+=`Changes: ${_.replacements}
`,n+=`Word count change: ${_.wordDiff>0?"+":""}${_.wordDiff}

`,n+=`CHANGES
`,n+=`-------

`,j.filter(p=>p.type!=="equal").forEach((p,K)=>{n+=`[${K+1}] ${p.type.toUpperCase()}
`,p.oldText&&(n+=`  - ${p.oldText}
`),p.newText&&(n+=`  + ${p.newText}
`),n+=`
`});const t=new Blob([n],{type:"text/plain"}),d=URL.createObjectURL(t),u=document.createElement("a");u.href=d,u.download=`${c}_redline_v${a.versionNumber}_v${l.versionNumber}.txt`,document.body.appendChild(u),u.click(),document.body.removeChild(u),URL.revokeObjectURL(d)};return P?e.jsx("div",{className:s.container,children:e.jsxs("div",{className:s.loading,children:[e.jsx(z,{size:32,className:s.spinning}),e.jsx("span",{children:"Loading document versions..."})]})}):e.jsxs("div",{className:`${s.container} ${M?s.fullscreen:""}`,children:[e.jsxs("div",{className:s.header,children:[e.jsxs("div",{className:s.headerLeft,children:[e.jsx("button",{className:s.backBtn,onClick:()=>C(-1),children:e.jsx(se,{size:20})}),e.jsx("div",{className:s.headerIcon,children:e.jsx(R,{size:24})}),e.jsxs("div",{children:[e.jsx("h1",{children:"Compare Versions"}),e.jsxs("p",{className:s.docName,children:[e.jsx(E,{size:14}),c]})]})]}),e.jsxs("div",{className:s.headerActions,children:[e.jsx("button",{className:s.iconBtn,onClick:()=>F(!M),title:M?"Exit fullscreen":"Fullscreen",children:M?e.jsx(ne,{size:18}):e.jsx(te,{size:18})}),e.jsxs("button",{className:s.downloadBtn,onClick:Y,disabled:!a||!l,children:[e.jsx(re,{size:18}),"Export Redline"]})]})]}),e.jsxs("div",{className:s.versionSelectors,children:[e.jsxs("div",{className:s.versionSelect,children:[e.jsx("label",{children:"Original Version"}),e.jsxs("select",{value:x,onChange:n=>$(parseInt(n.target.value)),children:[e.jsx("option",{value:0,children:"Select version..."}),r.map(n=>e.jsxs("option",{value:n.versionNumber,children:["v",n.versionNumber," - ",n.createdByName," (",w(b(n.createdAt),"MMM d, yyyy"),")"]},n.id))]})]}),e.jsx("div",{className:s.compareArrow,children:e.jsx(ae,{size:24})}),e.jsxs("div",{className:s.versionSelect,children:[e.jsx("label",{children:"New Version"}),e.jsxs("select",{value:v,onChange:n=>L(parseInt(n.target.value)),children:[e.jsx("option",{value:0,children:"Select version..."}),r.map(n=>e.jsxs("option",{value:n.versionNumber,children:["v",n.versionNumber," - ",n.createdByName," (",w(b(n.createdAt),"MMM d, yyyy"),")"]},n.id))]})]})]}),e.jsxs("div",{className:s.toolbar,children:[e.jsxs("div",{className:s.viewModes,children:[e.jsx("button",{className:g==="side-by-side"?s.active:"",onClick:()=>B("side-by-side"),children:"Side by Side"}),e.jsx("button",{className:g==="unified"?s.active:"",onClick:()=>B("unified"),children:"Unified"}),e.jsx("button",{className:g==="changes-only"?s.active:"",onClick:()=>B("changes-only"),children:"Changes Only"})]}),a&&l&&e.jsxs("div",{className:s.stats,children:[e.jsxs("span",{className:s.statAdded,children:["+",_.insertions," added"]}),e.jsxs("span",{className:s.statRemoved,children:["−",_.deletions," removed"]}),e.jsxs("span",{className:s.statChanged,children:["↔",_.replacements," changed"]}),e.jsxs("span",{className:s.statWords,children:[_.wordDiff>0?"+":"",_.wordDiff," words"]})]})]}),D&&e.jsxs("div",{className:s.error,children:[e.jsx(le,{size:18}),D]}),S&&e.jsxs("div",{className:s.comparing,children:[e.jsx(z,{size:24,className:s.spinning}),e.jsx("span",{children:"Comparing versions..."})]}),!S&&a&&l&&e.jsxs("div",{className:s.content,children:[g==="side-by-side"&&e.jsxs("div",{className:s.sideBySide,children:[e.jsxs("div",{className:s.panel,children:[e.jsxs("div",{className:s.panelHeader,children:[e.jsxs("span",{className:s.versionBadge,children:["v",a.versionNumber]}),e.jsx("span",{className:s.panelTitle,children:a.versionLabel||`Version ${a.versionNumber}`}),e.jsxs("div",{className:s.panelMeta,children:[e.jsx(H,{size:14}),a.createdBy,e.jsx(U,{size:14}),w(b(a.createdAt),"MMM d, yyyy")]})]}),e.jsx("div",{className:s.panelContent,children:e.jsx("pre",{children:A("old")})})]}),e.jsxs("div",{className:s.panel,children:[e.jsxs("div",{className:s.panelHeader,children:[e.jsxs("span",{className:`${s.versionBadge} ${s.new}`,children:["v",l.versionNumber]}),e.jsx("span",{className:s.panelTitle,children:l.versionLabel||`Version ${l.versionNumber}`}),e.jsxs("div",{className:s.panelMeta,children:[e.jsx(H,{size:14}),l.createdBy,e.jsx(U,{size:14}),w(b(l.createdAt),"MMM d, yyyy")]})]}),e.jsx("div",{className:s.panelContent,children:e.jsx("pre",{children:A("new")})})]})]}),g==="unified"&&e.jsxs("div",{className:s.unified,children:[e.jsxs("div",{className:s.panelHeader,children:[e.jsx("span",{children:"Unified View"}),e.jsxs("span",{className:s.legend,children:[e.jsx("span",{className:s.legendDeleted,children:"Removed"}),e.jsx("span",{className:s.legendInserted,children:"Added"})]})]}),e.jsx("div",{className:s.panelContent,children:e.jsx("pre",{children:A("unified")})})]}),g==="changes-only"&&X()]}),!S&&!a&&!l&&r.length>=2&&e.jsxs("div",{className:s.emptyState,children:[e.jsx(R,{size:48}),e.jsx("h3",{children:"Select versions to compare"}),e.jsx("p",{children:"Choose two versions above to see the differences"})]}),!S&&r.length<2&&e.jsxs("div",{className:s.emptyState,children:[e.jsx(E,{size:48}),e.jsx("h3",{children:"Not enough versions"}),e.jsx("p",{children:"This document needs at least 2 versions to compare"}),e.jsx("button",{onClick:()=>C(-1),children:"Go Back"})]})]})}export{ys as DocumentComparePage};
