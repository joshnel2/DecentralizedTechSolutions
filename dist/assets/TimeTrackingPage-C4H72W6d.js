import{r,a6 as e,h as M}from"./vendor-DrKzkH4x.js";import{a as Ke,u as Ze,L as oe}from"./router-CNLU_KyZ.js";import{a as et,c as tt,d as st,u as at,f as Re,s as lt}from"./index-CCWWoMiH.js";import{p as H,l as ge}from"./dateUtils-Bq7Z0P5c.js";import{c as ye,d as Me,h as it,r as nt,f as V,b as Te}from"./date-utils-BkNAU8cl.js";import{D as _e,as as ke,J as G,aa as De,ab as rt,ac as ct,X as de,Q as ot,F as me,ao as Le,aA as Ee,S as Ae,aH as Ne,az as Fe,ap as dt}from"./icons-BtUkkwGS.js";import"./doc-parsers-U1nJMjtM.js";import"./react-dom-DfB-QKj2.js";import"./pdf-worker-CVmCB3lP.js";import"./state-72d44OIA.js";const mt="_timeTrackingPage_18ahe_1",ht="_header_18ahe_5",ut="_headerLeft_18ahe_12",xt="_headerActions_18ahe_19",pt="_primaryBtn_18ahe_43",bt="_statsRow_18ahe_64",jt="_statCard_18ahe_70",vt="_statValue_18ahe_86",_t="_statLabel_18ahe_92",Nt="_timerSection_18ahe_98",gt="_startTimer_18ahe_106",ft="_startTimerLeft_18ahe_114",St="_startTimerRight_18ahe_126",Ct="_matterSelect_18ahe_132",Bt="_startBtn_18ahe_182",It="_activeTimer_18ahe_201",wt="_timerInfo_18ahe_210",yt="_timerPulse_18ahe_216",Mt="_timerDetails_18ahe_229",Tt="_timerMatter_18ahe_235",kt="_timerClient_18ahe_240",Dt="_timerElapsed_18ahe_245",Lt="_timerControls_18ahe_252",Et="_pauseBtn_18ahe_258",At="_resumeBtn_18ahe_259",Ft="_stopBtn_18ahe_260",Rt="_discardBtn_18ahe_261",zt="_timerSummary_18ahe_315",Ht="_timerSummaryItem_18ahe_326",Gt="_weeklyChart_18ahe_335",$t="_chartBars_18ahe_350",Pt="_chartBar_18ahe_350",Ot="_barContainer_18ahe_364",Ut="_bar_18ahe_364",Vt="_barLabel_18ahe_383",Wt="_barValue_18ahe_389",qt="_recentSection_18ahe_492",Yt="_entriesTable_18ahe_512",Jt="_matterCell_18ahe_538",Qt="_matterNum_18ahe_543",Xt="_descCell_18ahe_548",Kt="_aiTag_18ahe_554",Zt="_statusBadge_18ahe_565",es="_billed_18ahe_587",ts="_unbilled_18ahe_598",ss="_billingStatusCell_18ahe_610",as="_invoiceLink_18ahe_616",ls="_editBtn_18ahe_637",is="_modalOverlay_18ahe_657",ns="_modal_18ahe_657",rs="_modalHeader_18ahe_679",cs="_closeBtn_18ahe_694",os="_modalForm_18ahe_702",ds="_formGroup_18ahe_709",ms="_formRow_18ahe_792",hs="_entryTotal_18ahe_798",us="_modalActions_18ahe_805",xs="_cancelBtn_18ahe_813",ps="_saveBtn_18ahe_823",bs="_unbilledCard_18ahe_845",js="_billBar_18ahe_855",vs="_hasBillBar_18ahe_884",_s="_billBarInfo_18ahe_888",Ns="_billBarAmount_18ahe_905",gs="_billBarActions_18ahe_914",fs="_clearSelectionBtn_18ahe_919",Ss="_billSelectedBtn_18ahe_936",Cs="_filterBar_18ahe_958",Bs="_searchInputWrapper_18ahe_967",Is="_searchIcon_18ahe_974",ws="_searchInput_18ahe_967",ys="_clearSearchBtn_18ahe_1002",Ms="_filterControls_18ahe_1022",Ts="_filterSelect_18ahe_1028",ks="_clearFiltersBtn_18ahe_1064",Ds="_recentHeader_18ahe_1081",Ls="_sectionTitleGroup_18ahe_1098",Es="_sectionSubtitle_18ahe_1104",As="_emptyState_18ahe_1111",Fs="_addEntryBtn_18ahe_1131",Rs="_noMatter_18ahe_1152",zs="_noDesc_18ahe_1153",Hs="_selectAllBtn_18ahe_1158",Gs="_entryCheckbox_18ahe_1174",$s="_checkboxDisabled_18ahe_1181",Ps="_billUnbilledBtn_18ahe_1187",Os="_clickableCard_18ahe_1210",Us="_selectedRow_18ahe_1222",Vs="_billModal_18ahe_1231",Ws="_billModalHeader_18ahe_1243",qs="_billModalTitle_18ahe_1252",Ys="_billModalContent_18ahe_1270",Js="_billModalFooter_18ahe_1279",Qs="_billSummaryCompact_18ahe_1290",Xs="_billStatItem_18ahe_1300",Ks="_billStatValue_18ahe_1307",Zs="_billStatLabel_18ahe_1313",ea="_billStatDivider_18ahe_1319",ta="_groupingToggle_18ahe_1326",sa="_groupingLabel_18ahe_1332",aa="_toggleGroup_18ahe_1337",la="_toggleBtn_18ahe_1345",ia="_active_18ahe_201",na="_invoicePreviewCompact_18ahe_1367",ra="_previewHeader_18ahe_1373",ca="_previewListCompact_18ahe_1380",oa="_previewItemCompact_18ahe_1385",da="_previewItemLeft_18ahe_1397",ma="_previewClientName_18ahe_1404",ha="_previewMatterName_18ahe_1413",ua="_previewItemRight_18ahe_1421",xa="_previewItemHours_18ahe_1428",pa="_previewItemAmount_18ahe_1433",ba="_billNote_18ahe_1440",ja="_cancelBtnSecondary_18ahe_1453",va="_createInvoiceBtn_18ahe_1469",t={timeTrackingPage:mt,header:ht,headerLeft:ut,headerActions:xt,primaryBtn:pt,statsRow:bt,statCard:jt,statValue:vt,statLabel:_t,timerSection:Nt,startTimer:gt,startTimerLeft:ft,startTimerRight:St,matterSelect:Ct,startBtn:Bt,activeTimer:It,timerInfo:wt,timerPulse:yt,timerDetails:Mt,timerMatter:Tt,timerClient:kt,timerElapsed:Dt,timerControls:Lt,pauseBtn:Et,resumeBtn:At,stopBtn:Ft,discardBtn:Rt,timerSummary:zt,timerSummaryItem:Ht,weeklyChart:Gt,chartBars:$t,chartBar:Pt,barContainer:Ot,bar:Ut,barLabel:Vt,barValue:Wt,recentSection:qt,entriesTable:Yt,matterCell:Jt,matterNum:Qt,descCell:Xt,aiTag:Kt,statusBadge:Zt,billed:es,unbilled:ts,billingStatusCell:ss,invoiceLink:as,editBtn:ls,modalOverlay:is,modal:ns,modalHeader:rs,closeBtn:cs,modalForm:os,formGroup:ds,formRow:ms,entryTotal:hs,modalActions:us,cancelBtn:xs,saveBtn:ps,unbilledCard:bs,billBar:js,hasBillBar:vs,billBarInfo:_s,billBarAmount:Ns,billBarActions:gs,clearSelectionBtn:fs,billSelectedBtn:Ss,filterBar:Cs,searchInputWrapper:Bs,searchIcon:Is,searchInput:ws,clearSearchBtn:ys,filterControls:Ms,filterSelect:Ts,clearFiltersBtn:ks,recentHeader:Ds,sectionTitleGroup:Ls,sectionSubtitle:Es,emptyState:As,addEntryBtn:Fs,noMatter:Rs,noDesc:zs,selectAllBtn:Hs,entryCheckbox:Gs,checkboxDisabled:$s,billUnbilledBtn:Ps,clickableCard:Os,selectedRow:Us,billModal:Vs,billModalHeader:Ws,billModalTitle:qs,billModalContent:Ys,billModalFooter:Js,billSummaryCompact:Qs,billStatItem:Xs,billStatValue:Ks,billStatLabel:Zs,billStatDivider:ea,groupingToggle:ta,groupingLabel:sa,toggleGroup:aa,toggleBtn:la,active:ia,invoicePreviewCompact:na,previewHeader:ra,previewListCompact:ca,previewItemCompact:oa,previewItemLeft:da,previewClientName:ma,previewMatterName:ha,previewItemRight:ua,previewItemHours:xa,previewItemAmount:pa,billNote:ba,cancelBtnSecondary:ja,createInvoiceBtn:va};function La(){const{timeEntries:d,matters:o,clients:b,addTimeEntry:T,updateTimeEntry:N,addInvoice:w,fetchTimeEntries:n,fetchMatters:p,fetchClients:x,fetchInvoices:l}=et(),{timer:j,startTimer:m,pauseTimer:A,resumeTimer:D,stopTimer:he,discardTimer:i,isTimerActive:u}=tt(),h=Ke(),v=Ze(),_=st();r.useEffect(()=>{n({}),p(),x()},[n,p,x]),r.useEffect(()=>{var s;(s=v.state)!=null&&s.showSaveModal&&j.elapsed>0&&(ee(!0),h(v.pathname,{replace:!0,state:{}}))},[v.state,j.elapsed,h,v.pathname]);const{user:C}=at(),[ze,K]=r.useState(!1),[He,Z]=r.useState(!1),[Ge,ee]=r.useState(!1),[B,k]=r.useState([]),[ue,te]=r.useState(null),[se,fe]=r.useState(""),[F,$e]=r.useState(""),[$,ae]=r.useState(""),[W,xe]=r.useState(""),[q,pe]=r.useState("all"),[P,le]=r.useState(""),[Y,be]=r.useState(""),[J,je]=r.useState("all"),Pe=r.useMemo(()=>F?o.filter(s=>s.status==="active"&&s.clientId===F):o.filter(s=>s.status==="active"),[o,F]),Se=r.useMemo(()=>{const s=new Date,a=ye(s),c=Me(s);return it({start:a,end:c})},[]),ie=r.useMemo(()=>{const s=new Date,a=ye(s),c=Me(s),f=d.filter(S=>{const y=H(S.date);return y>=a&&y<=c}),g=f.reduce((S,y)=>S+y.hours,0),Q=f.filter(S=>S.billable).reduce((S,y)=>S+y.hours,0),X=f.reduce((S,y)=>S+y.amount,0),I=Se.map(S=>({day:S,hours:f.filter(y=>nt(H(y.date),S)).reduce((y,ve)=>y+ve.hours,0)}));return{totalHours:g,billableHours:Q,totalValue:X,byDay:I}},[d,Se]),ne=r.useMemo(()=>{const s=new Date;return s.setDate(s.getDate()-7),s.setHours(0,0,0,0),s},[]),R=r.useMemo(()=>[...d].filter(s=>H(s.date)>=ne).sort((s,a)=>new Date(a.date).getTime()-new Date(s.date).getTime()),[d,ne]),O=r.useMemo(()=>R.filter(s=>{var a,c;if($){const f=$.toLowerCase(),g=s.matterId?o.find(z=>z.id===s.matterId):null,Q=((a=g==null?void 0:g.name)==null?void 0:a.toLowerCase())||"",X=((c=g==null?void 0:g.number)==null?void 0:c.toLowerCase())||"",I=g?b.find(z=>z.id===g.clientId):null,S=((I==null?void 0:I.name)||(I==null?void 0:I.displayName)||"").toLowerCase();if(!((s.description||"").toLowerCase().includes(f)||Q.includes(f)||X.includes(f)||S.includes(f)))return!1}return!(W&&s.matterId!==W||q==="billed"&&!s.billed||q==="unbilled"&&s.billed)}),[R,$,W,q,o,b]),Oe=r.useMemo(()=>{const s=[...new Set(R.map(a=>a.matterId).filter(Boolean))];return o.filter(a=>s.includes(a.id))},[R,o]),L=r.useMemo(()=>[...d].filter(s=>H(s.date)<ne).sort((s,a)=>new Date(a.date).getTime()-new Date(s.date).getTime()),[d,ne]),U=r.useMemo(()=>L.filter(s=>{var a,c;if(P){const f=P.toLowerCase(),g=s.matterId?o.find(z=>z.id===s.matterId):null,Q=((a=g==null?void 0:g.name)==null?void 0:a.toLowerCase())||"",X=((c=g==null?void 0:g.number)==null?void 0:c.toLowerCase())||"",I=g?b.find(z=>z.id===g.clientId):null,S=((I==null?void 0:I.name)||(I==null?void 0:I.displayName)||"").toLowerCase();if(!((s.description||"").toLowerCase().includes(f)||Q.includes(f)||X.includes(f)||S.includes(f)))return!1}return!(Y&&s.matterId!==Y||J==="billed"&&!s.billed||J==="unbilled"&&s.billed)}),[L,P,Y,J,o,b]),E=r.useMemo(()=>d.filter(s=>!s.billed&&s.billable),[d]),re=r.useMemo(()=>O.filter(s=>!s.billed&&s.billable),[O]),ce=r.useMemo(()=>U.filter(s=>!s.billed&&s.billable),[U]),Ue=r.useMemo(()=>{const s=[...new Set(L.map(a=>a.matterId).filter(Boolean))];return o.filter(a=>s.includes(a.id))},[L,o]),Ce=r.useMemo(()=>E.reduce((s,a)=>s+a.amount,0),[E]),Ve=r.useMemo(()=>d.filter(s=>B.includes(s.id)).reduce((s,a)=>s+a.amount,0),[d,B]),Be=s=>{var a;return s?((a=o.find(c=>c.id===s))==null?void 0:a.name)||"Unknown":"No Matter"},Ie=s=>{var a;return s&&((a=o.find(c=>c.id===s))==null?void 0:a.number)||""},we=s=>{k(a=>a.includes(s)?a.filter(c=>c!==s):[...a,s])},We=()=>{const s=re.map(c=>c.id),a=s.every(c=>B.includes(c));k(a?c=>c.filter(f=>!s.includes(f)):c=>[...new Set([...c,...s])])},qe=()=>{const s=ce.map(c=>c.id),a=s.every(c=>B.includes(c));k(a?c=>c.filter(f=>!s.includes(f)):c=>[...new Set([...c,...s])])},Ye=()=>{const s=E.map(a=>a.id);k(s),Z(!0)},Je=()=>{const s=E.map(c=>c.id);if(s.length===0)return;const a=s.every(c=>B.includes(c));k(a?[]:s)},Qe=()=>{he(),ee(!0)},Xe=()=>{const s=se?o.find(c=>c.id===se):null,a=F?b.find(c=>c.id===F):null;m({matterId:se||void 0,matterName:s==null?void 0:s.name,clientId:F||void 0,clientName:(a==null?void 0:a.name)||(a==null?void 0:a.displayName)})};return e.jsxs("div",{className:M(t.timeTrackingPage,B.length>0&&t.hasBillBar),children:[e.jsxs("div",{className:t.header,children:[e.jsx("div",{className:t.headerLeft,children:e.jsx("h1",{children:"Time Tracking"})}),e.jsxs("div",{className:t.headerActions,children:[E.length>0&&e.jsxs("button",{className:t.billUnbilledBtn,onClick:Ye,children:[e.jsx(_e,{size:18}),"Bill Unbilled ($",Ce.toLocaleString(),")"]}),e.jsxs("button",{className:t.primaryBtn,onClick:()=>K(!0),children:[e.jsx(ke,{size:18}),"New Entry"]})]})]}),e.jsx("div",{className:t.timerSection,children:u?e.jsxs("div",{className:t.activeTimer,children:[e.jsxs("div",{className:t.timerInfo,children:[e.jsx("div",{className:t.timerPulse,children:e.jsx(G,{size:20})}),e.jsxs("div",{className:t.timerDetails,children:[e.jsxs("span",{className:t.timerMatter,children:[j.matterName||"General Time",j.clientName&&e.jsxs("span",{className:t.timerClient,children:[" • ",j.clientName]})]}),e.jsx("span",{className:t.timerElapsed,children:Re(j.elapsed)})]})]}),e.jsxs("div",{className:t.timerControls,children:[j.isPaused?e.jsxs("button",{className:t.resumeBtn,onClick:D,title:"Resume",children:[e.jsx(De,{size:18}),"Resume"]}):e.jsxs("button",{className:t.pauseBtn,onClick:A,title:"Pause",children:[e.jsx(rt,{size:18}),"Pause"]}),e.jsxs("button",{className:t.stopBtn,onClick:Qe,title:"Stop & Save",children:[e.jsx(ct,{size:18}),"Stop"]}),e.jsx("button",{className:t.discardBtn,onClick:i,title:"Discard",children:e.jsx(de,{size:18})})]})]}):e.jsxs("div",{className:t.startTimer,children:[e.jsxs("div",{className:t.startTimerLeft,children:[e.jsx(G,{size:20}),e.jsx("span",{children:"Start Timer"})]}),e.jsxs("div",{className:t.startTimerRight,children:[e.jsxs("select",{value:F,onChange:s=>{$e(s.target.value),fe("")},className:t.matterSelect,children:[e.jsx("option",{value:"",children:"All Clients"}),b.filter(s=>s.isActive).map(s=>e.jsx("option",{value:s.id,children:s.name||s.displayName},s.id))]}),e.jsxs("select",{value:se,onChange:s=>fe(s.target.value),className:t.matterSelect,children:[e.jsx("option",{value:"",children:"No matter (general time)"}),Pe.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]}),e.jsxs("button",{className:t.startBtn,onClick:Xe,children:[e.jsx(De,{size:18}),"Start"]})]})]})}),e.jsxs("div",{className:t.statsRow,children:[e.jsxs("div",{className:t.statCard,children:[e.jsx(G,{size:20}),e.jsxs("div",{children:[e.jsxs("span",{className:t.statValue,children:[ie.totalHours.toFixed(1),"h"]}),e.jsx("span",{className:t.statLabel,children:"This Week"})]})]}),e.jsxs("div",{className:t.statCard,children:[e.jsx(ot,{size:20}),e.jsxs("div",{children:[e.jsxs("span",{className:t.statValue,children:[ie.billableHours.toFixed(1),"h"]}),e.jsx("span",{className:t.statLabel,children:"Billable"})]})]}),e.jsxs("div",{className:t.statCard,children:[e.jsx(_e,{size:20}),e.jsxs("div",{children:[e.jsxs("span",{className:t.statValue,children:["$",ie.totalValue.toLocaleString()]}),e.jsx("span",{className:t.statLabel,children:"Value"})]})]}),e.jsxs("button",{className:M(t.statCard,t.unbilledCard,t.clickableCard),onClick:Je,title:E.length>0?`Click to select all ${E.length} unbilled entries`:"No unbilled entries",children:[e.jsx(me,{size:20}),e.jsxs("div",{children:[e.jsxs("span",{className:t.statValue,children:["$",Ce.toLocaleString()]}),e.jsxs("span",{className:t.statLabel,children:["Unbilled (",E.length,")"]})]})]})]}),e.jsxs("div",{className:t.weeklyChart,children:[e.jsx("h3",{children:"Weekly Overview"}),e.jsx("div",{className:t.chartBars,children:ie.byDay.map(({day:s,hours:a})=>e.jsxs("div",{className:t.chartBar,children:[e.jsx("div",{className:t.barContainer,children:e.jsx("div",{className:t.bar,style:{height:`${Math.min(a/10*100,100)}%`}})}),e.jsx("span",{className:t.barLabel,children:V(s,"EEE")}),e.jsxs("span",{className:t.barValue,children:[a.toFixed(1),"h"]})]},s.toISOString()))})]}),e.jsxs("div",{className:t.recentSection,children:[e.jsxs("div",{className:t.recentHeader,children:[e.jsxs("div",{className:t.sectionTitleGroup,children:[e.jsx("h3",{children:"Recent Time Entries"}),e.jsx("span",{className:t.sectionSubtitle,children:O.length===R.length?"Past 7 days":`Showing ${O.length} of ${R.length} entries`})]}),e.jsx("div",{className:t.headerActions,children:re.length>0&&e.jsx("button",{className:t.selectAllBtn,onClick:We,children:re.every(s=>B.includes(s.id))?"Deselect Recent":`Select Unbilled (${re.length})`})})]}),e.jsxs("div",{className:t.filterBar,children:[e.jsxs("div",{className:t.searchInputWrapper,children:[e.jsx(Le,{size:16,className:t.searchIcon}),e.jsx("input",{type:"text",placeholder:"Search by description, matter, or client...",value:$,onChange:s=>ae(s.target.value),className:t.searchInput}),$&&e.jsx("button",{className:t.clearSearchBtn,onClick:()=>ae(""),children:e.jsx(de,{size:14})})]}),e.jsxs("div",{className:t.filterControls,children:[e.jsxs("select",{value:W,onChange:s=>xe(s.target.value),className:t.filterSelect,children:[e.jsx("option",{value:"",children:"All Matters"}),Oe.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]}),e.jsxs("select",{value:q,onChange:s=>pe(s.target.value),className:t.filterSelect,children:[e.jsx("option",{value:"all",children:"All Status"}),e.jsx("option",{value:"unbilled",children:"Unbilled"}),e.jsx("option",{value:"billed",children:"Billed"})]}),($||W||q!=="all")&&e.jsx("button",{className:t.clearFiltersBtn,onClick:()=>{ae(""),xe(""),pe("all")},children:"Clear Filters"})]})]}),R.length===0?e.jsxs("div",{className:t.emptyState,children:[e.jsx(G,{size:24}),e.jsx("p",{children:"No time entries in the past 7 days"}),e.jsxs("button",{className:t.addEntryBtn,onClick:()=>K(!0),children:[e.jsx(ke,{size:16}),"Add Time Entry"]})]}):O.length===0?e.jsxs("div",{className:t.emptyState,children:[e.jsx(Ee,{size:24}),e.jsx("p",{children:"No entries match your filters"}),e.jsx("button",{className:t.addEntryBtn,onClick:()=>{ae(""),xe(""),pe("all")},children:"Clear Filters"})]}):e.jsx("div",{className:t.entriesTable,children:e.jsxs("table",{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:{width:"40px"}}),e.jsx("th",{children:"Date"}),e.jsx("th",{children:"Matter"}),e.jsx("th",{children:"Description"}),e.jsx("th",{children:"Hours"}),e.jsx("th",{children:"Amount"}),e.jsx("th",{children:"Status"}),e.jsx("th",{style:{width:"60px"},children:"Actions"})]})}),e.jsx("tbody",{children:O.map(s=>e.jsxs("tr",{className:M(B.includes(s.id)&&t.selectedRow),children:[e.jsx("td",{children:e.jsx("input",{type:"checkbox",checked:B.includes(s.id),onChange:()=>we(s.id),className:M(t.entryCheckbox,s.billed&&t.checkboxDisabled),disabled:s.billed,title:s.billed?"Already billed":s.billable?"Select for billing":"Non-billable entry"})}),e.jsx("td",{children:V(H(s.date),"MMM d, yyyy")}),e.jsx("td",{children:s.matterId?e.jsx(oe,{to:`/app/matters/${s.matterId}`,children:e.jsxs("div",{className:t.matterCell,children:[e.jsx("span",{children:Be(s.matterId)}),e.jsx("span",{className:t.matterNum,children:Ie(s.matterId)})]})}):e.jsx("span",{className:t.noMatter,children:"No Matter"})}),e.jsx("td",{children:e.jsxs("div",{className:t.descCell,children:[s.description||e.jsx("span",{className:t.noDesc,children:"No description"}),s.aiGenerated&&e.jsx("span",{className:t.aiTag,children:e.jsx(Ae,{size:10})})]})}),e.jsxs("td",{children:[s.hours,"h"]}),e.jsxs("td",{children:["$",s.amount.toLocaleString()]}),e.jsx("td",{children:e.jsx("div",{className:t.billingStatusCell,children:s.billed&&s.invoiceNumber?e.jsxs(oe,{to:"/app/billing",className:M(t.statusBadge,t.billed,t.invoiceLink),title:`View Invoice ${s.invoiceNumber}`,children:[e.jsx(me,{size:12}),s.invoiceNumber]}):s.billed?e.jsxs("span",{className:M(t.statusBadge,t.billed),children:[e.jsx(Ne,{size:12}),"Billed"]}):e.jsxs("span",{className:M(t.statusBadge,t.unbilled),children:[e.jsx(G,{size:12}),"Unbilled"]})})}),e.jsx("td",{children:e.jsx("button",{className:t.editBtn,onClick:()=>te(s),title:"Edit Entry",children:e.jsx(Fe,{size:14})})})]},s.id))})]})})]}),L.length>0&&e.jsxs("div",{className:t.recentSection,children:[e.jsxs("div",{className:t.recentHeader,children:[e.jsxs("div",{className:t.sectionTitleGroup,children:[e.jsx("h3",{children:"All Time Entries"}),e.jsx("span",{className:t.sectionSubtitle,children:U.length===L.length?`${L.length} older entries`:`Showing ${U.length} of ${L.length} entries`})]}),e.jsx("div",{className:t.headerActions,children:ce.length>0&&e.jsx("button",{className:t.selectAllBtn,onClick:qe,children:ce.every(s=>B.includes(s.id))?"Deselect Older":`Select Unbilled (${ce.length})`})})]}),e.jsxs("div",{className:t.filterBar,children:[e.jsxs("div",{className:t.searchInputWrapper,children:[e.jsx(Le,{size:16,className:t.searchIcon}),e.jsx("input",{type:"text",placeholder:"Search by description, matter, or client...",value:P,onChange:s=>le(s.target.value),className:t.searchInput}),P&&e.jsx("button",{className:t.clearSearchBtn,onClick:()=>le(""),children:e.jsx(de,{size:14})})]}),e.jsxs("div",{className:t.filterControls,children:[e.jsxs("select",{value:Y,onChange:s=>be(s.target.value),className:t.filterSelect,children:[e.jsx("option",{value:"",children:"All Matters"}),Ue.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]}),e.jsxs("select",{value:J,onChange:s=>je(s.target.value),className:t.filterSelect,children:[e.jsx("option",{value:"all",children:"All Status"}),e.jsx("option",{value:"unbilled",children:"Unbilled"}),e.jsx("option",{value:"billed",children:"Billed"})]}),(P||Y||J!=="all")&&e.jsx("button",{className:t.clearFiltersBtn,onClick:()=>{le(""),be(""),je("all")},children:"Clear Filters"})]})]}),U.length===0?e.jsxs("div",{className:t.emptyState,children:[e.jsx(Ee,{size:24}),e.jsx("p",{children:"No entries match your filters"}),e.jsx("button",{className:t.addEntryBtn,onClick:()=>{le(""),be(""),je("all")},children:"Clear Filters"})]}):e.jsx("div",{className:t.entriesTable,children:e.jsxs("table",{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:{width:"40px"}}),e.jsx("th",{children:"Date"}),e.jsx("th",{children:"Matter"}),e.jsx("th",{children:"Description"}),e.jsx("th",{children:"Hours"}),e.jsx("th",{children:"Amount"}),e.jsx("th",{children:"Status"}),e.jsx("th",{style:{width:"60px"},children:"Actions"})]})}),e.jsx("tbody",{children:U.map(s=>e.jsxs("tr",{className:M(B.includes(s.id)&&t.selectedRow),children:[e.jsx("td",{children:e.jsx("input",{type:"checkbox",checked:B.includes(s.id),onChange:()=>we(s.id),className:M(t.entryCheckbox,s.billed&&t.checkboxDisabled),disabled:s.billed,title:s.billed?"Already billed":s.billable?"Select for billing":"Non-billable entry"})}),e.jsx("td",{children:V(H(s.date),"MMM d, yyyy")}),e.jsx("td",{children:s.matterId?e.jsx(oe,{to:`/app/matters/${s.matterId}`,children:e.jsxs("div",{className:t.matterCell,children:[e.jsx("span",{children:Be(s.matterId)}),e.jsx("span",{className:t.matterNum,children:Ie(s.matterId)})]})}):e.jsx("span",{className:t.noMatter,children:"No Matter"})}),e.jsx("td",{children:e.jsxs("div",{className:t.descCell,children:[s.description||e.jsx("span",{className:t.noDesc,children:"No description"}),s.aiGenerated&&e.jsx("span",{className:t.aiTag,children:e.jsx(Ae,{size:10})})]})}),e.jsxs("td",{children:[s.hours,"h"]}),e.jsxs("td",{children:["$",s.amount.toLocaleString()]}),e.jsx("td",{children:e.jsx("div",{className:t.billingStatusCell,children:s.billed&&s.invoiceNumber?e.jsxs(oe,{to:"/app/billing",className:M(t.statusBadge,t.billed,t.invoiceLink),title:`View Invoice ${s.invoiceNumber}`,children:[e.jsx(me,{size:12}),s.invoiceNumber]}):s.billed?e.jsxs("span",{className:M(t.statusBadge,t.billed),children:[e.jsx(Ne,{size:12}),"Billed"]}):e.jsxs("span",{className:M(t.statusBadge,t.unbilled),children:[e.jsx(G,{size:12}),"Unbilled"]})})}),e.jsx("td",{children:e.jsx("button",{className:t.editBtn,onClick:()=>te(s),title:"Edit Entry",children:e.jsx(Fe,{size:14})})})]},s.id))})]})})]}),ze&&e.jsx(_a,{onClose:()=>K(!1),onSave:async s=>{try{await T(s),K(!1),await n({})}catch(a){console.error("Failed to create time entry:",a),_.error("Failed to create time entry","Please try again.")}},matters:o,userId:(C==null?void 0:C.id)||""}),He&&e.jsx(fa,{onClose:()=>Z(!1),selectedEntries:d.filter(s=>B.includes(s.id)),matters:o,clients:b,onCreateInvoice:async s=>{try{await w(s),await n({}),await l(),k([]),Z(!1),h("/app/billing")}catch(a){console.error("Failed to create invoice:",a),_.error("Failed to create invoice","Please try again.")}}}),ue&&e.jsx(Na,{entry:ue,matters:o,onClose:()=>te(null),onSave:async s=>{try{await N(ue.id,s),te(null),await n({})}catch(a){console.error("Failed to update time entry:",a),_.error("Failed to update time entry","Please try again.")}}}),Ge&&e.jsx(ga,{timer:j,matters:o,onClose:()=>{ee(!1),i()},onSave:async s=>{try{await T(s),ee(!1),i(),await n({})}catch(a){console.error("Failed to save time entry:",a),_.error("Failed to save time entry","Please try again.")}}}),B.length>0&&e.jsxs("div",{className:t.billBar,children:[e.jsxs("div",{className:t.billBarInfo,children:[e.jsx(Ne,{size:24}),e.jsxs("span",{children:[e.jsx("strong",{children:B.length})," entries selected"]}),e.jsxs("span",{className:t.billBarAmount,children:["$",Ve.toLocaleString()]})]}),e.jsxs("div",{className:t.billBarActions,children:[e.jsx("button",{className:t.clearSelectionBtn,onClick:()=>k([]),children:"Clear"}),e.jsxs("button",{className:t.billSelectedBtn,onClick:()=>Z(!0),children:[e.jsx(_e,{size:20}),"Create Invoice"]})]})]})]})}function _a({onClose:d,onSave:o,matters:b,userId:T}){const[N,w]=r.useState(!1),[n,p]=r.useState({matterId:"",date:V(new Date,"yyyy-MM-dd"),hours:1,description:"",billable:!0,rate:450}),x=async l=>{if(l.preventDefault(),!N){w(!0);try{await o({...n,matterId:n.matterId||void 0,date:ge(n.date),billed:!1,aiGenerated:!1})}finally{w(!1)}}};return e.jsx("div",{className:t.modalOverlay,onClick:d,children:e.jsxs("div",{className:t.modal,onClick:l=>l.stopPropagation(),children:[e.jsxs("div",{className:t.modalHeader,children:[e.jsx("h2",{children:"New Time Entry"}),e.jsx("button",{onClick:d,className:t.closeBtn,children:"×"})]}),e.jsxs("form",{onSubmit:x,className:t.modalForm,children:[e.jsxs("div",{className:t.formGroup,children:[e.jsx("label",{children:"Matter (optional)"}),e.jsxs("select",{value:n.matterId,onChange:l=>{const j=b.find(m=>m.id===l.target.value);p({...n,matterId:l.target.value,rate:(j==null?void 0:j.billingRate)||450})},children:[e.jsx("option",{value:"",children:"No matter selected"}),b.map(l=>e.jsx("option",{value:l.id,children:l.name},l.id))]})]}),e.jsxs("div",{className:t.formRow,children:[e.jsxs("div",{className:t.formGroup,children:[e.jsx("label",{children:"Date"}),e.jsx("input",{type:"date",value:n.date,onChange:l=>p({...n,date:l.target.value})})]}),e.jsxs("div",{className:t.formGroup,children:[e.jsx("label",{children:"Hours"}),e.jsx("input",{type:"number",value:n.hours,onChange:l=>p({...n,hours:parseFloat(l.target.value)}),min:"0.1",step:"0.1"})]})]}),e.jsxs("div",{className:t.formGroup,children:[e.jsx("label",{children:"Description (optional)"}),e.jsx("textarea",{value:n.description,onChange:l=>p({...n,description:l.target.value}),placeholder:"Describe the work performed",rows:3})]}),e.jsxs("div",{className:t.formRow,children:[e.jsxs("div",{className:t.formGroup,children:[e.jsx("label",{children:"Rate ($/hr)"}),e.jsx("input",{type:"number",value:n.rate,onChange:l=>p({...n,rate:parseInt(l.target.value)})})]}),e.jsxs("div",{className:t.formGroup,children:[e.jsx("label",{children:"Billable"}),e.jsxs("select",{value:n.billable?"yes":"no",onChange:l=>p({...n,billable:l.target.value==="yes"}),children:[e.jsx("option",{value:"yes",children:"Yes"}),e.jsx("option",{value:"no",children:"No"})]})]})]}),e.jsxs("div",{className:t.entryTotal,children:["Total: $",(n.hours*n.rate).toLocaleString()]}),e.jsxs("div",{className:t.modalActions,children:[e.jsx("button",{type:"button",onClick:d,className:t.cancelBtn,disabled:N,children:"Cancel"}),e.jsx("button",{type:"submit",className:t.saveBtn,disabled:N,children:N?"Saving...":"Save Entry"})]})]})]})})}function Na({entry:d,matters:o,onClose:b,onSave:T}){const[N,w]=r.useState(!1),[n,p]=r.useState({matterId:d.matterId||"",date:V(H(d.date),"yyyy-MM-dd"),hours:d.hours,description:d.description||"",billable:d.billable,rate:d.rate}),x=async l=>{if(l.preventDefault(),!N){w(!0);try{await T({...n,matterId:n.matterId||void 0,date:ge(n.date)})}finally{w(!1)}}};return e.jsx("div",{className:t.modalOverlay,onClick:b,children:e.jsxs("div",{className:t.modal,onClick:l=>l.stopPropagation(),children:[e.jsxs("div",{className:t.modalHeader,children:[e.jsx("h2",{children:"Edit Time Entry"}),e.jsx("button",{onClick:b,className:t.closeBtn,children:"×"})]}),e.jsxs("form",{onSubmit:x,className:t.modalForm,children:[e.jsxs("div",{className:t.formGroup,children:[e.jsx("label",{children:"Matter (optional)"}),e.jsxs("select",{value:n.matterId,onChange:l=>{const j=o.find(m=>m.id===l.target.value);p({...n,matterId:l.target.value,rate:(j==null?void 0:j.billingRate)||n.rate})},children:[e.jsx("option",{value:"",children:"No matter selected"}),o.map(l=>e.jsx("option",{value:l.id,children:l.name},l.id))]})]}),e.jsxs("div",{className:t.formRow,children:[e.jsxs("div",{className:t.formGroup,children:[e.jsx("label",{children:"Date"}),e.jsx("input",{type:"date",value:n.date,onChange:l=>p({...n,date:l.target.value})})]}),e.jsxs("div",{className:t.formGroup,children:[e.jsx("label",{children:"Hours"}),e.jsx("input",{type:"number",value:n.hours,onChange:l=>p({...n,hours:parseFloat(l.target.value)}),min:"0.1",step:"0.1"})]})]}),e.jsxs("div",{className:t.formGroup,children:[e.jsx("label",{children:"Description (optional)"}),e.jsx("textarea",{value:n.description,onChange:l=>p({...n,description:l.target.value}),placeholder:"Describe the work performed",rows:3})]}),e.jsxs("div",{className:t.formRow,children:[e.jsxs("div",{className:t.formGroup,children:[e.jsx("label",{children:"Rate ($/hr)"}),e.jsx("input",{type:"number",value:n.rate,onChange:l=>p({...n,rate:parseInt(l.target.value)})})]}),e.jsxs("div",{className:t.formGroup,children:[e.jsx("label",{children:"Billable"}),e.jsxs("select",{value:n.billable?"yes":"no",onChange:l=>p({...n,billable:l.target.value==="yes"}),children:[e.jsx("option",{value:"yes",children:"Yes"}),e.jsx("option",{value:"no",children:"No"})]})]})]}),e.jsxs("div",{className:t.entryTotal,children:["Total: $",(n.hours*n.rate).toLocaleString()]}),e.jsxs("div",{className:t.modalActions,children:[e.jsx("button",{type:"button",onClick:b,className:t.cancelBtn,disabled:N,children:"Cancel"}),e.jsx("button",{type:"submit",className:t.saveBtn,disabled:N,children:N?"Saving...":"Save Changes"})]})]})]})})}function ga({timer:d,matters:o,onClose:b,onSave:T}){const[N,w]=r.useState(!1),n=lt(d.elapsed),p=d.matterId?o.find(m=>m.id===d.matterId):null,[x,l]=r.useState({matterId:d.matterId||"",date:V(new Date,"yyyy-MM-dd"),hours:Math.max(.01,n),description:"",billable:!0,rate:(p==null?void 0:p.billingRate)||450}),j=async m=>{if(m.preventDefault(),!N){w(!0);try{await T({...x,matterId:x.matterId||void 0,date:ge(x.date),billed:!1,aiGenerated:!1})}finally{w(!1)}}};return e.jsx("div",{className:t.modalOverlay,onClick:b,children:e.jsxs("div",{className:t.modal,onClick:m=>m.stopPropagation(),children:[e.jsxs("div",{className:t.modalHeader,children:[e.jsxs("h2",{children:[e.jsx(dt,{size:20,style:{marginRight:"8px"}}),"Save Time Entry"]}),e.jsx("button",{onClick:b,className:t.closeBtn,children:"×"})]}),e.jsxs("form",{onSubmit:j,className:t.modalForm,children:[e.jsxs("div",{className:t.timerSummary,children:[e.jsxs("div",{className:t.timerSummaryItem,children:[e.jsx(G,{size:16}),e.jsxs("span",{children:["Timer: ",Re(d.elapsed)]})]}),d.matterName&&e.jsx("div",{className:t.timerSummaryItem,children:e.jsxs("span",{children:["Matter: ",d.matterName]})})]}),e.jsxs("div",{className:t.formGroup,children:[e.jsx("label",{children:"Matter (optional)"}),e.jsxs("select",{value:x.matterId,onChange:m=>{const A=o.find(D=>D.id===m.target.value);l({...x,matterId:m.target.value,rate:(A==null?void 0:A.billingRate)||450})},children:[e.jsx("option",{value:"",children:"No matter selected"}),o.map(m=>e.jsx("option",{value:m.id,children:m.name},m.id))]})]}),e.jsxs("div",{className:t.formRow,children:[e.jsxs("div",{className:t.formGroup,children:[e.jsx("label",{children:"Date"}),e.jsx("input",{type:"date",value:x.date,onChange:m=>l({...x,date:m.target.value})})]}),e.jsxs("div",{className:t.formGroup,children:[e.jsx("label",{children:"Hours"}),e.jsx("input",{type:"number",value:x.hours,onChange:m=>l({...x,hours:parseFloat(m.target.value)}),min:"0.01",step:"0.01"})]})]}),e.jsxs("div",{className:t.formGroup,children:[e.jsx("label",{children:"Description (optional)"}),e.jsx("textarea",{value:x.description,onChange:m=>l({...x,description:m.target.value}),placeholder:"Describe the work performed...",rows:3})]}),e.jsxs("div",{className:t.formRow,children:[e.jsxs("div",{className:t.formGroup,children:[e.jsx("label",{children:"Rate ($/hr)"}),e.jsx("input",{type:"number",value:x.rate,onChange:m=>l({...x,rate:parseInt(m.target.value)})})]}),e.jsxs("div",{className:t.formGroup,children:[e.jsx("label",{children:"Billable"}),e.jsxs("select",{value:x.billable?"yes":"no",onChange:m=>l({...x,billable:m.target.value==="yes"}),children:[e.jsx("option",{value:"yes",children:"Yes"}),e.jsx("option",{value:"no",children:"No"})]})]})]}),e.jsxs("div",{className:t.entryTotal,children:["Total: $",(x.hours*x.rate).toLocaleString()]}),e.jsxs("div",{className:t.modalActions,children:[e.jsx("button",{type:"button",onClick:b,className:t.cancelBtn,disabled:N,children:"Discard"}),e.jsx("button",{type:"submit",className:t.saveBtn,disabled:N,children:N?"Saving...":"Save Entry"})]})]})]})})}function fa({onClose:d,selectedEntries:o,matters:b,clients:T,onCreateInvoice:N}){const[w,n]=r.useState(!1),[p,x]=r.useState("matter"),l=r.useMemo(()=>{const i={};return o.forEach(u=>{const h=b.find(C=>C.id===u.matterId),v=h?T.find(C=>C.id===h.clientId):null,_=u.matterId||"no-matter";i[_]||(i[_]={matter:h,client:v,entries:[],total:0,hours:0}),i[_].entries.push(u),i[_].total+=u.amount,i[_].hours+=u.hours}),Object.values(i).filter(u=>u.matter&&u.client)},[o,b,T]),j=r.useMemo(()=>{const i={};return o.forEach(u=>{const h=b.find(C=>C.id===u.matterId),v=h?T.find(C=>C.id===h.clientId):null,_=(v==null?void 0:v.id)||"unknown";i[_]||(i[_]={client:v,matters:[],entries:[],total:0,hours:0}),h&&!i[_].matters.find(C=>C.id===h.id)&&i[_].matters.push(h),i[_].entries.push(u),i[_].total+=u.amount,i[_].hours+=u.hours}),Object.values(i).filter(u=>u.client)},[o,b,T]),m=o.reduce((i,u)=>i+u.amount,0),A=o.reduce((i,u)=>i+u.hours,0),D=p==="matter"?l.length:j.length,he=async()=>{n(!0);try{if(p==="matter")for(const i of l){if(!i.matter||!i.client)continue;const u=i.entries.map(h=>({type:"fee",description:h.description||"Legal services",quantity:h.hours,rate:h.rate,amount:h.amount}));await N({clientId:i.client.id,matterId:i.matter.id,issueDate:new Date().toISOString(),dueDate:Te(new Date,30).toISOString(),lineItems:u,timeEntryIds:i.entries.map(h=>h.id)})}else for(const i of j){if(!i.client)continue;const u=i.entries.map(v=>{const _=b.find(C=>C.id===v.matterId);return{type:"fee",description:`${(_==null?void 0:_.name)||"Legal Services"}: ${v.description||"Services rendered"}`,quantity:v.hours,rate:v.rate,amount:v.amount}}),h=i.matters[0];await N({clientId:i.client.id,matterId:h==null?void 0:h.id,issueDate:new Date().toISOString(),dueDate:Te(new Date,30).toISOString(),lineItems:u,timeEntryIds:i.entries.map(v=>v.id)})}}finally{n(!1)}};return e.jsx("div",{className:t.modalOverlay,onClick:d,children:e.jsxs("div",{className:t.billModal,onClick:i=>i.stopPropagation(),children:[e.jsxs("div",{className:t.billModalHeader,children:[e.jsxs("div",{className:t.billModalTitle,children:[e.jsx(me,{size:20}),e.jsx("h2",{children:"Create Invoice"})]}),e.jsx("button",{onClick:d,className:t.closeBtn,children:e.jsx(de,{size:20})})]}),e.jsxs("div",{className:t.billModalContent,children:[e.jsxs("div",{className:t.billSummaryCompact,children:[e.jsxs("div",{className:t.billStatItem,children:[e.jsx("span",{className:t.billStatValue,children:o.length}),e.jsx("span",{className:t.billStatLabel,children:"Entries"})]}),e.jsx("div",{className:t.billStatDivider}),e.jsxs("div",{className:t.billStatItem,children:[e.jsxs("span",{className:t.billStatValue,children:[A.toFixed(1),"h"]}),e.jsx("span",{className:t.billStatLabel,children:"Hours"})]}),e.jsx("div",{className:t.billStatDivider}),e.jsxs("div",{className:t.billStatItem,children:[e.jsxs("span",{className:t.billStatValue,children:["$",m.toLocaleString()]}),e.jsx("span",{className:t.billStatLabel,children:"Total"})]})]}),e.jsxs("div",{className:t.groupingToggle,children:[e.jsx("span",{className:t.groupingLabel,children:"Group by:"}),e.jsxs("div",{className:t.toggleGroup,children:[e.jsx("button",{className:M(t.toggleBtn,p==="matter"&&t.active),onClick:()=>x("matter"),children:"Matter"}),e.jsx("button",{className:M(t.toggleBtn,p==="client"&&t.active),onClick:()=>x("client"),children:"Client"})]})]}),e.jsxs("div",{className:t.invoicePreviewCompact,children:[e.jsx("div",{className:t.previewHeader,children:e.jsxs("span",{children:[D," invoice",D!==1?"s":""," to create"]})}),e.jsx("div",{className:t.previewListCompact,children:p==="matter"?l.map((i,u)=>{var h,v;return e.jsxs("div",{className:t.previewItemCompact,children:[e.jsxs("div",{className:t.previewItemLeft,children:[e.jsx("span",{className:t.previewClientName,children:((h=i.client)==null?void 0:h.name)||"Unknown"}),e.jsx("span",{className:t.previewMatterName,children:((v=i.matter)==null?void 0:v.name)||"Unknown"})]}),e.jsxs("div",{className:t.previewItemRight,children:[e.jsxs("span",{className:t.previewItemHours,children:[i.hours.toFixed(1),"h"]}),e.jsxs("span",{className:t.previewItemAmount,children:["$",i.total.toLocaleString()]})]})]},u)}):j.map((i,u)=>{var h;return e.jsxs("div",{className:t.previewItemCompact,children:[e.jsxs("div",{className:t.previewItemLeft,children:[e.jsx("span",{className:t.previewClientName,children:((h=i.client)==null?void 0:h.name)||"Unknown"}),e.jsxs("span",{className:t.previewMatterName,children:[i.matters.length," matter",i.matters.length!==1?"s":""]})]}),e.jsxs("div",{className:t.previewItemRight,children:[e.jsxs("span",{className:t.previewItemHours,children:[i.hours.toFixed(1),"h"]}),e.jsxs("span",{className:t.previewItemAmount,children:["$",i.total.toLocaleString()]})]})]},u)})})]}),e.jsx("div",{className:t.billNote,children:e.jsx("span",{children:"Invoices created as drafts • Time entries marked as billed"})})]}),e.jsxs("div",{className:t.billModalFooter,children:[e.jsx("button",{onClick:d,className:t.cancelBtnSecondary,disabled:w,children:"Cancel"}),e.jsx("button",{onClick:he,className:t.createInvoiceBtn,disabled:w||D===0,children:w?"Creating...":`Create ${D} Invoice${D!==1?"s":""}`})]})]})})}export{La as TimeTrackingPage};
