import{r as a,a6 as e}from"./vendor-DrKzkH4x.js";import{d as je,u as be}from"./index-CCWWoMiH.js";import{a as ke}from"./router-CNLU_KyZ.js";import{a4 as p,al as Ne,bj as Ie,aX as Re,f as I,I as L,A as R,t as Ae,X as F,as as z,bk as Pe,v as Be,ak as De,G as $,aE as A,F as w,x as O,bl as Ee,y as G,ap as Ve,ao as Te,$ as Me,s as H,b4 as Le,Y as Fe,c as ze,d as He}from"./icons-BtUkkwGS.js";import"./doc-parsers-U1nJMjtM.js";import"./react-dom-DfB-QKj2.js";import"./pdf-worker-CVmCB3lP.js";import"./state-72d44OIA.js";const Ue="_page_137t0_1",$e="_backButton_137t0_7",Oe="_header_137t0_25",Ge="_headerLeft_137t0_32",qe="_loading_137t0_55",We="_tabs_137t0_76",Qe="_tab_137t0_76",Xe="_active_137t0_105",Ye="_content_137t0_111",Je="_rolesLayout_137t0_116",Ze="_rolesPanel_137t0_123",Ke="_rolesPanelHeader_137t0_130",es="_addRoleButton_137t0_145",ss="_rolesList_137t0_165",is="_roleItem_137t0_169",ts="_selected_137t0_187",ns="_roleIcon_137t0_192",as="_roleInfo_137t0_202",rs="_roleName_137t0_207",os="_roleStats_137t0_214",ls="_roleUserCount_137t0_220",cs="_chevron_137t0_228",ds="_permissionsPanel_137t0_233",ms="_permissionsPanelHeader_137t0_240",us="_selectedRoleInfo_137t0_249",ps="_selectedRoleIcon_137t0_255",gs="_permissionActions_137t0_277",_s="_resetButton_137t0_282",vs="_saveButton_137t0_283",hs="_permissionsToolbar_137t0_321",xs="_searchBox_137t0_329",fs="_expandControls_137t0_359",ys="_ownerWarning_137t0_380",ws="_permissionCategories_137t0_390",Cs="_permissionCategory_137t0_396",Ss="_categoryHeader_137t0_404",js="_categoryName_137t0_426",bs="_categoryCount_137t0_432",ks="_permissionList_137t0_440",Ns="_permissionRow_137t0_444",Is="_changed_137t0_461",Rs="_permissionInfo_137t0_465",As="_permissionName_137t0_469",Ps="_sensitiveIcon_137t0_478",Bs="_permissionDesc_137t0_482",Ds="_permissionToggle_137t0_489",Es="_granted_137t0_504",Vs="_denied_137t0_509",Ts="_matrixContainer_137t0_524",Ms="_matrixInfo_137t0_531",Ls="_matrixScroll_137t0_547",Fs="_matrix_137t0_524",zs="_matrixCorner_137t0_575",Hs="_categoryRow_137t0_580",Us="_matrixCategoryCell_137t0_587",$s="_matrixPermCell_137t0_591",Os="_matrixCell_137t0_606",Gs="_templatesContainer_137t0_621",qs="_templatesHeader_137t0_628",Ws="_addTemplateButton_137t0_649",Qs="_templatesList_137t0_668",Xs="_templateCard_137t0_674",Ys="_templateIcon_137t0_689",Js="_templateInfo_137t0_699",Zs="_templateType_137t0_716",Ks="_templateActions_137t0_723",ei="_systemBadge_137t0_748",si="_inheritanceContainer_137t0_757",ii="_inheritanceHeader_137t0_764",ti="_inheritanceRules_137t0_782",ni="_inheritanceRule_137t0_782",ai="_ruleFlow_137t0_797",ri="_ruleEntity_137t0_803",oi="_ruleDetails_137t0_812",li="_modeSelect_137t0_825",ci="_inheritanceNote_137t0_840",i={page:Ue,backButton:$e,header:Oe,headerLeft:Ge,loading:qe,tabs:We,tab:Qe,active:Xe,content:Ye,rolesLayout:Je,rolesPanel:Ze,rolesPanelHeader:Ke,addRoleButton:es,rolesList:ss,roleItem:is,selected:ts,roleIcon:ns,roleInfo:as,roleName:rs,roleStats:os,roleUserCount:ls,chevron:cs,permissionsPanel:ds,permissionsPanelHeader:ms,selectedRoleInfo:us,selectedRoleIcon:ps,permissionActions:gs,resetButton:_s,saveButton:vs,permissionsToolbar:hs,searchBox:xs,expandControls:fs,ownerWarning:ys,permissionCategories:ws,permissionCategory:Cs,categoryHeader:Ss,categoryName:js,categoryCount:bs,permissionList:ks,permissionRow:Ns,changed:Is,permissionInfo:Rs,permissionName:As,sensitiveIcon:Ps,permissionDesc:Bs,permissionToggle:Ds,granted:Es,denied:Vs,matrixContainer:Ts,matrixInfo:Ms,matrixScroll:Ls,matrix:Fs,matrixCorner:zs,categoryRow:Hs,matrixCategoryCell:Us,matrixPermCell:$s,matrixCell:Os,templatesContainer:Gs,templatesHeader:qs,addTemplateButton:Ws,templatesList:Qs,templateCard:Xs,templateIcon:Ys,templateInfo:Js,templateType:Zs,templateActions:Ks,systemBadge:ei,inheritanceContainer:si,inheritanceHeader:ii,inheritanceRules:ti,inheritanceRule:ni,ruleFlow:ai,ruleEntity:ri,ruleDetails:oi,modeSelect:li,inheritanceNote:ci},di={admin:H,matters:O,clients:G,billing:$,documents:w,calendar:w,reports:w,integrations:H,ai:p,security:Me},U={owner:Ee,admin:p,attorney:O,paralegal:w,staff:A,billing:$,readonly:De};function Ci(){const q=ke(),C=je(),{user:g}=be(),[_,W]=a.useState("roles"),[v,Q]=a.useState([]),[d,P]=a.useState(null),[m,X]=a.useState([]),[S,B]=a.useState({}),[Y,J]=a.useState([]),[Z,D]=a.useState(!0),[E,V]=a.useState(!1),[h,K]=a.useState(""),[T,j]=a.useState(new Set),[mi,ee]=a.useState(!1),[ui,se]=a.useState(!1),[ie,x]=a.useState(!1),[f,y]=a.useState({}),te=[{id:"roles",name:"Roles & Permissions",icon:p},{id:"matrix",name:"Permission Matrix",icon:Ie},{id:"templates",name:"Templates",icon:Re},{id:"inheritance",name:"Inheritance Rules",icon:I}];a.useEffect(()=>{ne()},[]),a.useEffect(()=>{d&&ae(d)},[d]);const ne=async()=>{D(!0);try{const s=re();Q(s),s.length>0&&!d&&P(s[0].slug);const t=oe();X(t),J(le())}catch(s){console.error("Failed to load permissions data:",s),C.error("Failed to load permissions")}finally{D(!1)}},ae=async s=>{try{const t=b(s);B(t),y({}),x(!1)}catch(t){console.error("Failed to load role permissions:",t)}},re=()=>[{slug:"owner",name:"Owner",description:"Full access to all features and settings",color:"#F59E0B",icon:"crown",isSystem:!0,userCount:1},{slug:"admin",name:"Administrator",description:"Administrative access to firm settings",color:"#8B5CF6",icon:"shield",isSystem:!0,userCount:2},{slug:"attorney",name:"Attorney",description:"Standard attorney with case management",color:"#3B82F6",icon:"briefcase",isSystem:!0,userCount:5},{slug:"paralegal",name:"Paralegal",description:"Paralegal with document and case support",color:"#10B981",icon:"file-text",isSystem:!0,userCount:3},{slug:"staff",name:"Staff",description:"General staff with limited access",color:"#64748B",icon:"user",isSystem:!0,userCount:4},{slug:"billing",name:"Billing Specialist",description:"Focus on billing and financial operations",color:"#EC4899",icon:"credit-card",isSystem:!0,userCount:1},{slug:"readonly",name:"Read Only",description:"View-only access to permitted items",color:"#94A3B8",icon:"eye",isSystem:!0,userCount:0}],oe=()=>[{id:"matters",name:"Matters",permissions:[{key:"matters:create",name:"Create Matters",description:"Create new matters",isSensitive:!1},{key:"matters:view",name:"View Matters",description:"View matter details",isSensitive:!1},{key:"matters:view_restricted",name:"View Restricted Matters",description:"View matters marked as restricted",isSensitive:!1},{key:"matters:edit",name:"Edit Matters",description:"Modify matter information",isSensitive:!1},{key:"matters:delete",name:"Delete Matters",description:"Delete or archive matters",isSensitive:!0},{key:"matters:assign",name:"Assign Team Members",description:"Add team members to matters",isSensitive:!1},{key:"matters:manage_permissions",name:"Manage Permissions",description:"Control who can access matters",isSensitive:!1},{key:"matters:close",name:"Close Matters",description:"Close/reopen matters",isSensitive:!1},{key:"matters:transfer",name:"Transfer Matters",description:"Transfer matters between clients",isSensitive:!0}]},{id:"clients",name:"Clients",permissions:[{key:"clients:create",name:"Create Clients",description:"Create new client records",isSensitive:!1},{key:"clients:view",name:"View Clients",description:"View client information",isSensitive:!1},{key:"clients:view_restricted",name:"View Restricted Clients",description:"View clients marked as restricted",isSensitive:!1},{key:"clients:edit",name:"Edit Clients",description:"Modify client information",isSensitive:!1},{key:"clients:delete",name:"Delete Clients",description:"Delete client records",isSensitive:!0},{key:"clients:merge",name:"Merge Clients",description:"Merge duplicate client records",isSensitive:!0},{key:"clients:view_confidential",name:"View Confidential",description:"View SSN, financial details",isSensitive:!0}]},{id:"billing",name:"Billing",permissions:[{key:"billing:create",name:"Create Time Entries",description:"Record time and expenses",isSensitive:!1},{key:"billing:view",name:"View Billing",description:"View time entries and invoices",isSensitive:!1},{key:"billing:view_all",name:"View All Billing",description:"View billing for all users",isSensitive:!1},{key:"billing:edit",name:"Edit Billing",description:"Modify time entries and expenses",isSensitive:!1},{key:"billing:edit_others",name:"Edit Others' Billing",description:"Edit other users time entries",isSensitive:!0},{key:"billing:delete",name:"Delete Billing",description:"Delete time entries and expenses",isSensitive:!0},{key:"billing:approve",name:"Approve Time",description:"Approve time entries for billing",isSensitive:!1},{key:"billing:create_invoices",name:"Create Invoices",description:"Generate and send invoices",isSensitive:!1},{key:"billing:void_invoices",name:"Void Invoices",description:"Void sent invoices",isSensitive:!0},{key:"billing:apply_discounts",name:"Apply Discounts",description:"Add discounts to invoices",isSensitive:!1},{key:"billing:view_trust",name:"View Trust Accounts",description:"View IOLTA trust balances",isSensitive:!1},{key:"billing:manage_trust",name:"Manage Trust",description:"Deposit/withdraw from trust",isSensitive:!0}]},{id:"documents",name:"Documents",permissions:[{key:"documents:upload",name:"Upload Documents",description:"Upload new documents",isSensitive:!1},{key:"documents:view",name:"View Documents",description:"View and download documents",isSensitive:!1},{key:"documents:view_confidential",name:"View Confidential",description:"Access confidential documents",isSensitive:!1},{key:"documents:edit",name:"Edit Documents",description:"Edit and version documents",isSensitive:!1},{key:"documents:delete",name:"Delete Documents",description:"Delete documents",isSensitive:!0},{key:"documents:share_external",name:"Share External",description:"Share documents outside firm",isSensitive:!1},{key:"documents:manage_folders",name:"Manage Folders",description:"Create/delete folders",isSensitive:!1},{key:"documents:manage_permissions",name:"Manage Permissions",description:"Set document access rights",isSensitive:!1}]},{id:"calendar",name:"Calendar",permissions:[{key:"calendar:create",name:"Create Events",description:"Create calendar events",isSensitive:!1},{key:"calendar:view",name:"View Calendar",description:"View calendar and events",isSensitive:!1},{key:"calendar:view_all",name:"View All Calendars",description:"See all users calendars",isSensitive:!1},{key:"calendar:edit",name:"Edit Events",description:"Modify calendar events",isSensitive:!1},{key:"calendar:delete",name:"Delete Events",description:"Remove calendar events",isSensitive:!1},{key:"calendar:manage_deadlines",name:"Manage Deadlines",description:"Set and modify legal deadlines",isSensitive:!1}]},{id:"reports",name:"Reports",permissions:[{key:"reports:view",name:"View Reports",description:"Access reporting dashboard",isSensitive:!1},{key:"reports:view_financial",name:"View Financial Reports",description:"Access financial/revenue reports",isSensitive:!1},{key:"reports:view_productivity",name:"View Productivity",description:"View user productivity metrics",isSensitive:!1},{key:"reports:create",name:"Create Reports",description:"Generate custom reports",isSensitive:!1},{key:"reports:export",name:"Export Reports",description:"Export report data",isSensitive:!1},{key:"reports:schedule",name:"Schedule Reports",description:"Set up automated reports",isSensitive:!1}]},{id:"admin",name:"Administration",permissions:[{key:"firm:manage",name:"Manage Firm Settings",description:"Access and modify firm-wide settings",isSensitive:!0},{key:"firm:billing",name:"Manage Firm Billing",description:"Manage firm subscription and billing",isSensitive:!0},{key:"firm:delete",name:"Delete Firm",description:"Permanently delete the firm account",isSensitive:!0},{key:"users:invite",name:"Invite Users",description:"Send invitations to new team members",isSensitive:!1},{key:"users:manage",name:"Manage Users",description:"Edit user profiles and settings",isSensitive:!0},{key:"users:delete",name:"Delete Users",description:"Remove users from the firm",isSensitive:!0},{key:"users:view_rates",name:"View Billing Rates",description:"See hourly rates for all users",isSensitive:!1},{key:"users:edit_rates",name:"Edit Billing Rates",description:"Modify hourly rates for users",isSensitive:!0},{key:"groups:manage",name:"Manage Groups",description:"Create and manage team groups",isSensitive:!1},{key:"integrations:manage",name:"Manage Integrations",description:"Connect/disconnect integrations",isSensitive:!0},{key:"audit:view",name:"View Audit Logs",description:"Access activity audit logs",isSensitive:!0}]},{id:"ai",name:"AI Features",permissions:[{key:"ai:use_assistant",name:"Use AI Assistant",description:"Chat with AI assistant",isSensitive:!1},{key:"ai:use_drafting",name:"AI Document Drafting",description:"Generate documents with AI",isSensitive:!1},{key:"ai:use_analysis",name:"AI Analysis",description:"Use AI for analysis tasks",isSensitive:!1},{key:"ai:view_suggestions",name:"View AI Suggestions",description:"See AI-generated suggestions",isSensitive:!1},{key:"ai:train_model",name:"Train AI",description:"Provide feedback to improve AI",isSensitive:!1}]},{id:"security",name:"Security",permissions:[{key:"audit:view",name:"View Audit Logs",description:"Access activity audit logs",isSensitive:!0},{key:"audit:export",name:"Export Audit Logs",description:"Export audit log data",isSensitive:!0},{key:"security:manage_sessions",name:"Manage Sessions",description:"Force logout sessions",isSensitive:!0},{key:"security:manage_2fa",name:"Manage 2FA",description:"Configure 2FA requirements",isSensitive:!0},{key:"security:manage_api_keys",name:"Manage API Keys",description:"Create/revoke API keys",isSensitive:!0}]}],b=s=>{const n={owner:["firm:manage","firm:billing","firm:delete","users:invite","users:manage","users:delete","users:view_rates","users:edit_rates","groups:manage","matters:create","matters:view","matters:view_restricted","matters:edit","matters:delete","matters:assign","matters:manage_permissions","matters:close","matters:transfer","clients:create","clients:view","clients:view_restricted","clients:edit","clients:delete","clients:merge","clients:view_confidential","billing:create","billing:view","billing:view_all","billing:edit","billing:edit_others","billing:delete","billing:approve","billing:create_invoices","billing:void_invoices","billing:apply_discounts","billing:view_trust","billing:manage_trust","documents:upload","documents:view","documents:view_confidential","documents:edit","documents:delete","documents:share_external","documents:manage_folders","documents:manage_permissions","calendar:create","calendar:view","calendar:view_all","calendar:edit","calendar:delete","calendar:manage_deadlines","reports:view","reports:view_financial","reports:view_productivity","reports:create","reports:export","reports:schedule","integrations:manage","ai:use_assistant","ai:use_drafting","ai:use_analysis","ai:view_suggestions","ai:train_model","audit:view","audit:export","security:manage_sessions","security:manage_2fa","security:manage_api_keys"],admin:["users:invite","users:manage","users:view_rates","users:edit_rates","groups:manage","matters:create","matters:view","matters:view_restricted","matters:edit","matters:delete","matters:assign","matters:manage_permissions","matters:close","clients:create","clients:view","clients:view_restricted","clients:edit","clients:delete","billing:create","billing:view","billing:view_all","billing:edit","billing:edit_others","billing:approve","billing:create_invoices","billing:apply_discounts","billing:view_trust","documents:upload","documents:view","documents:view_confidential","documents:edit","documents:delete","documents:manage_folders","documents:manage_permissions","calendar:create","calendar:view","calendar:view_all","calendar:edit","calendar:delete","calendar:manage_deadlines","reports:view","reports:view_financial","reports:view_productivity","reports:create","reports:export","integrations:manage","ai:use_assistant","ai:use_drafting","ai:use_analysis","ai:view_suggestions","audit:view","security:manage_sessions"],attorney:["matters:create","matters:view","matters:edit","matters:assign","matters:close","clients:create","clients:view","clients:edit","billing:create","billing:view","billing:edit","billing:create_invoices","documents:upload","documents:view","documents:edit","documents:manage_folders","calendar:create","calendar:view","calendar:edit","calendar:delete","calendar:manage_deadlines","reports:view","reports:view_productivity","ai:use_assistant","ai:use_drafting","ai:use_analysis","ai:view_suggestions"],paralegal:["matters:view","matters:edit","clients:view","billing:create","billing:view","billing:edit","documents:upload","documents:view","documents:edit","calendar:create","calendar:view","calendar:edit","ai:use_assistant","ai:view_suggestions"],staff:["matters:view","clients:view","billing:view","documents:view","calendar:create","calendar:view","calendar:edit","ai:use_assistant"],billing:["matters:view","clients:view","billing:create","billing:view","billing:view_all","billing:edit","billing:approve","billing:create_invoices","billing:apply_discounts","billing:view_trust","billing:manage_trust","reports:view","reports:view_financial","reports:create","reports:export","ai:use_assistant"],readonly:["matters:view","clients:view","billing:view","documents:view","calendar:view","reports:view"]}[s]||[],r={};return m.forEach(o=>{o.permissions.forEach(c=>{r[c.key]={key:c.key,value:n.includes(c.key)?"granted":"denied",source:"default"}})}),r},le=()=>[{id:"1",name:"Full Access",description:"Complete access to matter",type:"matter",permissions:{level:"admin",canEdit:!0,canViewDocs:!0,canViewNotes:!0},icon:"shield-check",color:"#10B981",isSystem:!0},{id:"2",name:"Read Only",description:"View-only access",type:"matter",permissions:{level:"view",canEdit:!1,canViewDocs:!0,canViewNotes:!0},icon:"eye",color:"#64748B",isSystem:!0},{id:"3",name:"Collaborator",description:"Can view and edit",type:"matter",permissions:{level:"edit",canEdit:!0,canViewDocs:!0,canViewNotes:!0},icon:"users",color:"#3B82F6",isSystem:!0},{id:"4",name:"Billing Only",description:"Access to billing info only",type:"matter",permissions:{level:"view",canEdit:!1,canViewDocs:!1,canViewNotes:!1,canViewBilling:!0},icon:"credit-card",color:"#EC4899",isSystem:!0}],ce=s=>{var r;const t=f[s]??((r=S[s])==null?void 0:r.value)??"denied";let n;t==="granted"?n="denied":n="granted",y(o=>({...o,[s]:n})),x(!0)},M=s=>{var t;return f[s]??((t=S[s])==null?void 0:t.value)??"denied"},de=async()=>{if(d){V(!0);try{const s={...S};Object.entries(f).forEach(([t,n])=>{s[t]={key:t,value:n,source:"custom"}}),B(s),y({}),x(!1),C.success("Permissions saved","Role permissions have been updated")}catch(s){console.error("Failed to save permissions:",s),C.error("Failed to save permissions")}finally{V(!1)}}},me=()=>{y({}),x(!1)},ue=s=>{const t=new Set(T);t.has(s)?t.delete(s):t.add(s),j(t)},pe=()=>{j(new Set(m.map(s=>s.id)))},ge=()=>{j(new Set)},_e=a.useMemo(()=>{if(!h)return m;const s=h.toLowerCase();return m.map(t=>({...t,permissions:t.permissions.filter(n=>n.name.toLowerCase().includes(s)||n.description.toLowerCase().includes(s)||n.key.toLowerCase().includes(s))})).filter(t=>t.permissions.length>0)},[m,h]),ve=s=>{const t=b(s);return Object.values(t).filter(n=>n.value==="granted").length},he=()=>m.reduce((s,t)=>s+t.permissions.length,0),u=(g==null?void 0:g.role)==="owner"||(g==null?void 0:g.role)==="admin",xe=()=>e.jsxs("div",{className:i.rolesPanel,children:[e.jsxs("div",{className:i.rolesPanelHeader,children:[e.jsx("h3",{children:"Roles"}),u&&e.jsxs("button",{className:i.addRoleButton,onClick:()=>ee(!0),children:[e.jsx(z,{size:16}),"New Role"]})]}),e.jsx("div",{className:i.rolesList,children:v.map(s=>{const t=U[s.slug]||A,n=d===s.slug,r=ve(s.slug),o=he();return e.jsxs("button",{className:`${i.roleItem} ${n?i.selected:""}`,onClick:()=>P(s.slug),children:[e.jsx("div",{className:i.roleIcon,style:{backgroundColor:`${s.color}20`,color:s.color},children:e.jsx(t,{size:18})}),e.jsxs("div",{className:i.roleInfo,children:[e.jsx("span",{className:i.roleName,children:s.name}),e.jsxs("span",{className:i.roleStats,children:[r," / ",o," permissions"]})]}),e.jsxs("div",{className:i.roleUserCount,children:[e.jsx(G,{size:14}),e.jsx("span",{children:s.userCount})]}),e.jsx(I,{size:16,className:i.chevron})]},s.slug)})})]}),fe=()=>{const s=v.find(n=>n.slug===d);if(!s)return null;const t=U[s.slug]||A;return e.jsxs("div",{className:i.permissionsPanel,children:[e.jsxs("div",{className:i.permissionsPanelHeader,children:[e.jsxs("div",{className:i.selectedRoleInfo,children:[e.jsx("div",{className:i.selectedRoleIcon,style:{backgroundColor:`${s.color}20`,color:s.color},children:e.jsx(t,{size:24})}),e.jsxs("div",{children:[e.jsxs("h2",{children:[s.name," Permissions"]}),e.jsx("p",{children:s.description})]})]}),u&&e.jsx("div",{className:i.permissionActions,children:ie&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{className:i.resetButton,onClick:me,children:[e.jsx(F,{size:16}),"Reset"]}),e.jsxs("button",{className:i.saveButton,onClick:de,disabled:E,children:[e.jsx(Ve,{size:16}),E?"Saving...":"Save Changes"]})]})})]}),e.jsxs("div",{className:i.permissionsToolbar,children:[e.jsxs("div",{className:i.searchBox,children:[e.jsx(Te,{size:16}),e.jsx("input",{type:"text",placeholder:"Search permissions...",value:h,onChange:n=>K(n.target.value)})]}),e.jsxs("div",{className:i.expandControls,children:[e.jsx("button",{onClick:pe,children:"Expand All"}),e.jsx("button",{onClick:ge,children:"Collapse All"})]})]}),s.isSystem&&s.slug==="owner"&&e.jsxs("div",{className:i.ownerWarning,children:[e.jsx(R,{size:16}),e.jsx("span",{children:"Owner role has full access. Permissions cannot be modified."})]}),e.jsx("div",{className:i.permissionCategories,children:_e.map(n=>{const r=T.has(n.id),o=di[n.id]||p,c=n.permissions.filter(l=>M(l.key)==="granted").length;return e.jsxs("div",{className:i.permissionCategory,children:[e.jsxs("button",{className:i.categoryHeader,onClick:()=>ue(n.id),children:[e.jsx(o,{size:18}),e.jsx("span",{className:i.categoryName,children:n.name}),e.jsxs("span",{className:i.categoryCount,children:[c," / ",n.permissions.length]}),r?e.jsx(Le,{size:16}):e.jsx(Fe,{size:16})]}),r&&e.jsx("div",{className:i.permissionList,children:n.permissions.map(l=>{const k=M(l.key)==="granted",Se=f[l.key]!==void 0,N=s.slug==="owner";return e.jsxs("div",{className:`${i.permissionRow} ${Se?i.changed:""}`,children:[e.jsxs("div",{className:i.permissionInfo,children:[e.jsxs("span",{className:i.permissionName,children:[l.name,l.isSensitive&&e.jsx(R,{size:12,className:i.sensitiveIcon})]}),e.jsx("span",{className:i.permissionDesc,children:l.description})]}),e.jsx("button",{className:`${i.permissionToggle} ${k?i.granted:i.denied}`,onClick:()=>!N&&u&&ce(l.key),disabled:N||!u,title:N?"Owner has full access":k?"Revoke":"Grant",children:k?e.jsxs(e.Fragment,{children:[e.jsx(ze,{size:20}),e.jsx("span",{children:"Granted"})]}):e.jsxs(e.Fragment,{children:[e.jsx(He,{size:20}),e.jsx("span",{children:"Denied"})]})})]},l.key)})})]},n.id)})})]})},ye=()=>e.jsxs("div",{className:i.matrixContainer,children:[e.jsxs("div",{className:i.matrixInfo,children:[e.jsx(L,{size:16}),e.jsx("span",{children:"This matrix shows all permissions across all roles. Click a cell to toggle."})]}),e.jsx("div",{className:i.matrixScroll,children:e.jsxs("table",{className:i.matrix,children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:i.matrixCorner,children:"Permission"}),v.map(s=>e.jsx("th",{style:{color:s.color},children:s.name},s.slug))]})}),e.jsx("tbody",{children:m.map(s=>e.jsxs(e.Fragment,{children:[e.jsx("tr",{className:i.categoryRow,children:e.jsx("td",{colSpan:v.length+1,className:i.matrixCategoryCell,children:s.name})},`cat-${s.id}`),s.permissions.map(t=>e.jsxs("tr",{children:[e.jsxs("td",{className:i.matrixPermCell,children:[e.jsx("span",{children:t.name}),t.isSensitive&&e.jsx(R,{size:12})]}),v.map(n=>{var c;const o=((c=b(n.slug)[t.key])==null?void 0:c.value)==="granted";return e.jsx("td",{className:`${i.matrixCell} ${o?i.granted:i.denied}`,children:o?e.jsx(Ae,{size:14}):e.jsx(F,{size:14})},`${n.slug}-${t.key}`)})]},t.key))]}))})]})})]}),we=()=>e.jsxs("div",{className:i.templatesContainer,children:[e.jsxs("div",{className:i.templatesHeader,children:[e.jsxs("div",{children:[e.jsx("h3",{children:"Permission Templates"}),e.jsx("p",{children:"Pre-configured permission sets for quick application to matters, clients, or documents"})]}),u&&e.jsxs("button",{className:i.addTemplateButton,onClick:()=>se(!0),children:[e.jsx(z,{size:16}),"New Template"]})]}),e.jsx("div",{className:i.templatesList,children:Y.map(s=>e.jsxs("div",{className:i.templateCard,children:[e.jsx("div",{className:i.templateIcon,style:{backgroundColor:`${s.color}20`,color:s.color},children:e.jsx(p,{size:24})}),e.jsxs("div",{className:i.templateInfo,children:[e.jsx("h4",{children:s.name}),e.jsx("p",{children:s.description}),e.jsxs("span",{className:i.templateType,children:[s.type," template"]})]}),e.jsxs("div",{className:i.templateActions,children:[s.isSystem&&e.jsx("span",{className:i.systemBadge,children:"System"}),u&&!s.isSystem&&e.jsxs(e.Fragment,{children:[e.jsx("button",{title:"Edit",children:e.jsx(Pe,{size:16})}),e.jsx("button",{title:"Delete",children:e.jsx(Be,{size:16})})]})]})]},s.id))})]}),Ce=()=>e.jsxs("div",{className:i.inheritanceContainer,children:[e.jsxs("div",{className:i.inheritanceHeader,children:[e.jsx("h3",{children:"Permission Inheritance Rules"}),e.jsx("p",{children:"Configure how permissions cascade from parent entities to children"})]}),e.jsx("div",{className:i.inheritanceRules,children:[{source:"Client",target:"Matter",mode:"additive",description:"Matters inherit client permissions plus their own"},{source:"Matter",target:"Document",mode:"inherit",description:"Documents inherit matter permissions by default"},{source:"Folder",target:"Document",mode:"inherit",description:"Documents in folders inherit folder permissions"},{source:"Group",target:"User",mode:"additive",description:"Users get group permissions plus their own"},{source:"Role",target:"User",mode:"inherit",description:"Users inherit base permissions from their role"}].map((s,t)=>e.jsxs("div",{className:i.inheritanceRule,children:[e.jsxs("div",{className:i.ruleFlow,children:[e.jsx("span",{className:i.ruleEntity,children:s.source}),e.jsx(I,{size:16}),e.jsx("span",{className:i.ruleEntity,children:s.target})]}),e.jsxs("div",{className:i.ruleDetails,children:[e.jsxs("select",{value:s.mode,disabled:!u,className:i.modeSelect,children:[e.jsx("option",{value:"inherit",children:"Inherit"}),e.jsx("option",{value:"additive",children:"Additive"}),e.jsx("option",{value:"override",children:"Override"}),e.jsx("option",{value:"none",children:"None"})]}),e.jsx("p",{children:s.description})]})]},t))}),e.jsxs("div",{className:i.inheritanceNote,children:[e.jsx(L,{size:16}),e.jsxs("span",{children:[e.jsx("strong",{children:"Inherit:"})," Child uses parent permissions.",e.jsx("strong",{children:" Additive:"})," Child gets parent + own permissions.",e.jsx("strong",{children:" Override:"})," Child permissions replace parent.",e.jsx("strong",{children:" None:"})," No inheritance."]})]})]});return Z?e.jsxs("div",{className:i.loading,children:[e.jsx(p,{size:48}),e.jsx("p",{children:"Loading permissions..."})]}):e.jsxs("div",{className:i.page,children:[e.jsxs("button",{className:i.backButton,onClick:()=>q("/app/settings"),children:[e.jsx(Ne,{size:16}),"Back to Settings"]}),e.jsx("div",{className:i.header,children:e.jsxs("div",{className:i.headerLeft,children:[e.jsx(p,{size:32}),e.jsxs("div",{children:[e.jsx("h1",{children:"Permissions & Access Control"}),e.jsx("p",{children:"Configure roles, permissions, and access rules for your firm"})]})]})}),e.jsx("div",{className:i.tabs,children:te.map(s=>{const t=s.icon;return e.jsxs("button",{className:`${i.tab} ${_===s.id?i.active:""}`,onClick:()=>W(s.id),children:[e.jsx(t,{size:16}),s.name]},s.id)})}),e.jsxs("div",{className:i.content,children:[_==="roles"&&e.jsxs("div",{className:i.rolesLayout,children:[xe(),fe()]}),_==="matrix"&&ye(),_==="templates"&&we(),_==="inheritance"&&Ce()]})]})}export{Ci as PermissionsSettingsPage,Ci as default};
