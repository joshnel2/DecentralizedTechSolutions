import{r as v,a6 as e,h as P}from"./vendor-DrKzkH4x.js";import{a as nt,d as at,L as De}from"./router-CNLU_KyZ.js";import{a as ot,u as it,g as lt,d as Ie,j as je}from"./index-CCWWoMiH.js";import{C as rt}from"./ConfirmationModal-X7YGPBKC.js";import{p as I,s as J,e as X,l as Z,w as Be,f as k}from"./date-utils-BkNAU8cl.js";import{as as ye,am as ke,i as Pe,J as ct,a as Fe,aH as Ae,aI as ze,aE as dt,y as mt,ao as ut,F as Le,ac as ht,f as vt,ak as $e,az as fe,aB as Re,M as be,au as pt,G as Ee,o as gt,v as He}from"./icons-BtUkkwGS.js";import"./doc-parsers-U1nJMjtM.js";import"./react-dom-DfB-QKj2.js";import"./pdf-worker-CVmCB3lP.js";import"./state-72d44OIA.js";const xt="_billingPage_1ovnq_1",_t="_fadeIn_1ovnq_1",jt="_header_1ovnq_6",yt="_headerLeft_1ovnq_13",ft="_headerSubtitle_1ovnq_21",bt="_headerActions_1ovnq_26",It="_aiBtn_1ovnq_32",wt="_primaryBtn_1ovnq_52",Nt="_secondaryBtn_1ovnq_72",Ct="_dashboardGrid_1ovnq_93",qt="_metricsRow_1ovnq_100",St="_metricCard_1ovnq_106",Mt="_metricHeader_1ovnq_113",Dt="_metricIcon_1ovnq_120",Bt="_metricTrend_1ovnq_129",kt="_metricValue_1ovnq_137",Pt="_metricLabel_1ovnq_144",At="_metricSubtext_1ovnq_150",Lt="_billNowLink_1ovnq_155",$t="_agingCard_1ovnq_173",Tt="_agingHeader_1ovnq_181",Ft="_agingTotal_1ovnq_197",zt="_agingBars_1ovnq_202",Rt="_agingItem_1ovnq_208",Et="_agingLabel_1ovnq_215",Ht="_agingBarWrapper_1ovnq_220",Ot="_agingBar_1ovnq_202",Gt="_current_1ovnq_233",Vt="_thirty_1ovnq_237",Wt="_sixty_1ovnq_241",Qt="_ninety_1ovnq_245",Ut="_ninetyPlus_1ovnq_249",Yt="_agingAmount_1ovnq_253",Kt="_quickActions_1ovnq_261",Jt="_quickActionBtn_1ovnq_271",Xt="_tabs_1ovnq_293",Zt="_tab_1ovnq_293",es="_active_1ovnq_324",ts="_tabCount_1ovnq_329",ss="_filters_1ovnq_342",ns="_viewToggle_1ovnq_350",as="_viewToggleBtn_1ovnq_359",os="_searchBox_1ovnq_389",is="_filterGroup_1ovnq_414",ls="_filterSelect_1ovnq_419",rs="_invoiceList_1ovnq_469",cs="_invoiceCard_1ovnq_476",ds="_pastDue_1ovnq_490",ms="_selectedCard_1ovnq_494",us="_invoiceCheckbox_1ovnq_500",hs="_uncheckedIcon_1ovnq_509",vs="_checkedIcon_1ovnq_518",ps="_selectionBar_1ovnq_523",gs="_selectionInfo_1ovnq_534",xs="_mergeHint_1ovnq_545",_s="_selectionActions_1ovnq_550",js="_clearSelectionBtn_1ovnq_555",ys="_mergeBtn_1ovnq_571",fs="_mergeModal_1ovnq_592",bs="_mergeModalTitle_1ovnq_601",Is="_mergeModalContent_1ovnq_614",ws="_mergeInfo_1ovnq_621",Ns="_mergeSummary_1ovnq_630",Cs="_mergeSummaryItem_1ovnq_638",qs="_mergeSelectSection_1ovnq_656",Ss="_mergeSelectHint_1ovnq_667",Ms="_mergeInvoiceList_1ovnq_673",Ds="_mergeInvoiceOption_1ovnq_679",Bs="_selected_1ovnq_494",ks="_mergeInvoiceDetails_1ovnq_704",Ps="_mergeInvoiceNumber_1ovnq_711",As="_mergeInvoiceAmount_1ovnq_716",Ls="_mergeInvoiceDate_1ovnq_721",$s="_mergeWarning_1ovnq_727",Ts="_mergeModalFooter_1ovnq_739",Fs="_mergeConfirmBtn_1ovnq_748",zs="_invoiceMain_1ovnq_773",Rs="_invoiceInfo_1ovnq_780",Es="_invoiceNumber_1ovnq_784",Hs="_invoiceClient_1ovnq_794",Os="_invoiceMatter_1ovnq_809",Gs="_invoiceDates_1ovnq_824",Vs="_invoiceDate_1ovnq_824",Ws="_overdue_1ovnq_843",Qs="_daysOverdue_1ovnq_847",Us="_invoiceAmount_1ovnq_856",Ys="_totalAmount_1ovnq_860",Ks="_paidAmount_1ovnq_866",Js="_dueAmount_1ovnq_871",Xs="_invoiceStatus_1ovnq_876",Zs="_invoiceActions_1ovnq_881",en="_actionBtn_1ovnq_888",tn="_statusBadge_1ovnq_905",sn="_paid_1ovnq_866",nn="_sent_1ovnq_919",an="_draft_1ovnq_929",on="_partial_1ovnq_940",ln="_emptyState_1ovnq_946",rn="_menuWrapper_1ovnq_975",cn="_dropdown_1ovnq_984",dn="_dropdownFadeIn_1ovnq_1",mn="_dropdownItem_1ovnq_1009",un="_dropdownDivider_1ovnq_1024",hn="_success_1ovnq_1035",vn="_danger_1ovnq_1043",pn="_modalOverlay_1ovnq_1052",gn="_modal_1ovnq_1052",xn="_modalHeader_1ovnq_1073",_n="_closeBtn_1ovnq_1088",jn="_modalForm_1ovnq_1096",yn="_formGroup_1ovnq_1105",fn="_formRow_1ovnq_1186",bn="_modalActions_1ovnq_1192",In="_cancelBtn_1ovnq_1200",wn="_saveBtn_1ovnq_1210",Nn="_paymentInfo_1ovnq_1228",Cn="_paymentInfoRow_1ovnq_1235",qn="_highlight_1ovnq_1247",Sn="_lineItemsSection_1ovnq_1259",Mn="_lineItemsHeader_1ovnq_1263",Dn="_addLineItemBtn_1ovnq_1276",Bn="_lineItemsTable_1ovnq_1294",kn="_lineItemsTableHeader_1ovnq_1301",Pn="_lineItemRow_1ovnq_1315",An="_removeLineItemBtn_1ovnq_1342",Ln="_lineItemsTotal_1ovnq_1362",$n="_previewModal_1ovnq_1383",Tn="_previewHeader_1ovnq_1395",Fn="_previewTitle_1ovnq_1403",zn="_previewContent_1ovnq_1415",Rn="_previewSection_1ovnq_1421",En="_previewRow_1ovnq_1425",Hn="_previewColumn_1ovnq_1432",On="_previewItems_1ovnq_1452",Gn="_previewTotals_1ovnq_1489",Vn="_previewTotalRow_1ovnq_1497",Wn="_final_1ovnq_1509",Qn="_paymentAmount_1ovnq_1521",Un="_previewActions_1ovnq_1525",Yn="_slideUpMobile_1ovnq_1",t={billingPage:xt,fadeIn:_t,header:jt,headerLeft:yt,headerSubtitle:ft,headerActions:bt,aiBtn:It,primaryBtn:wt,secondaryBtn:Nt,dashboardGrid:Ct,metricsRow:qt,metricCard:St,metricHeader:Mt,metricIcon:Dt,metricTrend:Bt,metricValue:kt,metricLabel:Pt,metricSubtext:At,billNowLink:Lt,agingCard:$t,agingHeader:Tt,agingTotal:Ft,agingBars:zt,agingItem:Rt,agingLabel:Et,agingBarWrapper:Ht,agingBar:Ot,current:Gt,thirty:Vt,sixty:Wt,ninety:Qt,ninetyPlus:Ut,agingAmount:Yt,quickActions:Kt,quickActionBtn:Jt,tabs:Xt,tab:Zt,active:es,tabCount:ts,filters:ss,viewToggle:ns,viewToggleBtn:as,searchBox:os,filterGroup:is,filterSelect:ls,invoiceList:rs,invoiceCard:cs,pastDue:ds,selectedCard:ms,invoiceCheckbox:us,uncheckedIcon:hs,checkedIcon:vs,selectionBar:ps,selectionInfo:gs,mergeHint:xs,selectionActions:_s,clearSelectionBtn:js,mergeBtn:ys,mergeModal:fs,mergeModalTitle:bs,mergeModalContent:Is,mergeInfo:ws,mergeSummary:Ns,mergeSummaryItem:Cs,mergeSelectSection:qs,mergeSelectHint:Ss,mergeInvoiceList:Ms,mergeInvoiceOption:Ds,selected:Bs,mergeInvoiceDetails:ks,mergeInvoiceNumber:Ps,mergeInvoiceAmount:As,mergeInvoiceDate:Ls,mergeWarning:$s,mergeModalFooter:Ts,mergeConfirmBtn:Fs,invoiceMain:zs,invoiceInfo:Rs,invoiceNumber:Es,invoiceClient:Hs,invoiceMatter:Os,invoiceDates:Gs,invoiceDate:Vs,overdue:Ws,daysOverdue:Qs,invoiceAmount:Us,totalAmount:Ys,paidAmount:Ks,dueAmount:Js,invoiceStatus:Xs,invoiceActions:Zs,actionBtn:en,statusBadge:tn,paid:sn,sent:nn,draft:an,void:"_void_1ovnq_934",partial:on,emptyState:ln,menuWrapper:rn,dropdown:cn,dropdownFadeIn:dn,dropdownItem:mn,dropdownDivider:un,success:hn,danger:vn,modalOverlay:pn,modal:gn,modalHeader:xn,closeBtn:_n,modalForm:jn,formGroup:yn,formRow:fn,modalActions:bn,cancelBtn:In,saveBtn:wn,paymentInfo:Nn,paymentInfoRow:Cn,highlight:qn,lineItemsSection:Sn,lineItemsHeader:Mn,addLineItemBtn:Dn,lineItemsTable:Bn,lineItemsTableHeader:kn,lineItemRow:Pn,removeLineItemBtn:An,lineItemsTotal:Ln,previewModal:$n,previewHeader:Tn,previewTitle:Fn,previewContent:zn,previewSection:Rn,previewRow:En,previewColumn:Hn,previewItems:On,previewTotals:Gn,previewTotalRow:Vn,final:Wn,paymentAmount:Qn,previewActions:Un,slideUpMobile:Yn},Kn=[{value:"my",label:"My Billing"},{value:"all",label:"All Billing"}];function da(){const{invoices:n,clients:d,matters:f,timeEntries:x,expenses:C,fetchInvoices:y,fetchClients:p,fetchMatters:j,fetchTimeEntries:M,addInvoice:g,updateInvoice:c}=ot(),{firm:r,user:w}=it(),{emailInvoice:$}=lt();nt();const u=Ie(),[b,G]=at(),z=(w==null?void 0:w.role)==="owner"||(w==null?void 0:w.role)==="admin"||(w==null?void 0:w.role)==="billing",[R,i]=v.useState("my");v.useEffect(()=>{const s=z?R:"my";y({view:s}),p({view:s}),j({view:s}),M({})},[R,z]);const[_,q]=v.useState(""),[S,Oe]=v.useState("all"),[ee,Ge]=v.useState("all"),[Ve,te]=v.useState(!1),[We,re]=v.useState(null),[ce,se]=v.useState(null),[ne,E]=v.useState(null),[Qe,ae]=v.useState(!1),[we,oe]=v.useState(null),[A,H]=v.useState(null),de=v.useRef(null),[me,ue]=v.useState({isOpen:!1,invoiceId:"",invoiceNumber:""}),[V,he]=v.useState([]),[Ue,ve]=v.useState(!1);v.useEffect(()=>{function s(a){de.current&&!de.current.contains(a.target)&&E(null)}return document.addEventListener("mousedown",s),()=>document.removeEventListener("mousedown",s)},[]),v.useEffect(()=>{const s=b.get("action"),a=b.get("clientId");s==="new"&&(te(!0),a&&re(a),G({}))},[b,G]);const pe=async(s,a)=>{try{await c(s,{status:a}),E(null),y()}catch(m){console.error("Failed to update invoice status:",m),u.error("Failed to update invoice status")}},Ye=s=>{oe(s),ae(!0),E(null)},Ne=s=>{se(s),E(null)},ge=s=>{const a=d.find(m=>m.id===s.clientId);$({id:s.id,invoiceNumber:s.number,clientName:(a==null?void 0:a.displayName)||(a==null?void 0:a.name)||"Client",total:s.total}),E(null)},Ce=async s=>{var ie;E(null);const a=d.find(B=>B.id===s.clientId),m=f.find(B=>B.id===s.matterId),D=(r==null?void 0:r.name)||"Law Firm",L=r!=null&&r.address?`${r.address}${r.city?`, ${r.city}`:""}${r.state?`, ${r.state}`:""} ${r.zipCode||""}`:"",h=(r==null?void 0:r.phone)||"",Q=(r==null?void 0:r.email)||"",U=(a==null?void 0:a.name)||(a==null?void 0:a.displayName)||"Client",N=a!=null&&a.addressStreet?`${a.addressStreet}${a.addressCity?`, ${a.addressCity}`:""}${a.addressState?`, ${a.addressState}`:""} ${a.addressZip||""}`.trim():"",T=(a==null?void 0:a.email)||"",xe=`
      <!DOCTYPE html>
      <html>
      <head>
        <style>
          body { font-family: 'Georgia', serif; margin: 40px; color: #333; }
          .header { display: flex; justify-content: space-between; margin-bottom: 40px; border-bottom: 3px solid #1a1a2e; padding-bottom: 20px; }
          .company { font-size: 28px; font-weight: bold; color: #1a1a2e; margin-bottom: 8px; }
          .company-details { font-size: 12px; color: #666; line-height: 1.6; }
          .invoice-title { font-size: 36px; color: #F59E0B; margin-bottom: 10px; font-weight: bold; }
          .invoice-number { font-size: 16px; color: #1a1a2e; margin-bottom: 10px; font-weight: 600; }
          .info-section { display: flex; justify-content: space-between; margin-bottom: 40px; }
          .info-block { flex: 1; }
          .info-label { font-size: 11px; color: #888; text-transform: uppercase; margin-bottom: 5px; letter-spacing: 1px; }
          .info-value { font-size: 14px; margin-bottom: 15px; line-height: 1.5; }
          .client-name { font-size: 16px; font-weight: bold; color: #1a1a2e; }
          table { width: 100%; border-collapse: collapse; margin-bottom: 30px; }
          th { background: #1a1a2e; color: white; text-align: left; padding: 14px; font-size: 11px; text-transform: uppercase; letter-spacing: 1px; }
          th.amount { text-align: right; }
          td { padding: 14px; border-bottom: 1px solid #eee; }
          td.amount { text-align: right; }
          .totals { margin-left: auto; width: 280px; background: #f9f9f9; padding: 20px; border-radius: 8px; }
          .total-row { display: flex; justify-content: space-between; padding: 8px 0; font-size: 14px; }
          .total-row.final { font-size: 20px; font-weight: bold; border-top: 2px solid #1a1a2e; padding-top: 15px; margin-top: 10px; color: #1a1a2e; }
          .status { display: inline-block; padding: 6px 14px; border-radius: 20px; font-size: 11px; font-weight: bold; text-transform: uppercase; letter-spacing: 1px; }
          .status.paid { background: #d4edda; color: #155724; }
          .status.sent { background: #cce5ff; color: #004085; }
          .status.draft { background: #e2e3e5; color: #383d41; }
          .status.overdue { background: #f8d7da; color: #721c24; }
          .status.partial { background: #fff3cd; color: #856404; }
          .footer { margin-top: 40px; padding-top: 20px; border-top: 2px solid #eee; font-size: 12px; color: #666; }
          .footer p { margin: 8px 0; }
          @media print { body { margin: 20px; } }
        </style>
      </head>
      <body>
        <div class="header">
          <div>
            <div class="company">${D}</div>
            <div class="company-details">
              ${L?`${L}<br>`:""}
              ${h?`Tel: ${h}<br>`:""}
              ${Q?`Email: ${Q}`:""}
            </div>
          </div>
          <div style="text-align: right;">
            <div class="invoice-title">INVOICE</div>
            <div class="invoice-number">Invoice #${s.number}</div>
            <span class="status ${s.status}">${s.status.toUpperCase()}</span>
          </div>
        </div>
        
        <div class="info-section">
          <div class="info-block">
            <div class="info-label">Bill To</div>
            <div class="info-value">
              <span class="client-name">${U}</span><br>
              ${N?`${N}<br>`:""}
              ${T||""}
            </div>
          </div>
          <div class="info-block">
            <div class="info-label">Matter</div>
            <div class="info-value">
              <strong>${(m==null?void 0:m.name)||"General Legal Services"}</strong><br>
              ${m!=null&&m.number?`Matter #: ${m.number}`:""}
            </div>
          </div>
          <div class="info-block" style="text-align: right;">
            <div class="info-label">Issue Date</div>
            <div class="info-value">${k(I(s.issueDate),"MMMM d, yyyy")}</div>
            <div class="info-label">Due Date</div>
            <div class="info-value">${k(I(s.dueDate),"MMMM d, yyyy")}</div>
          </div>
        </div>

        <table>
          <thead>
            <tr>
              <th>Description</th>
              <th>Quantity</th>
              <th>Rate</th>
              <th class="amount">Amount</th>
            </tr>
          </thead>
          <tbody>
            ${((ie=s.lineItems)==null?void 0:ie.length)>0?s.lineItems.map(B=>`
                <tr>
                  <td>${B.description||"Legal Services"}</td>
                  <td>${B.quantity||1}</td>
                  <td>$${(B.rate||0).toFixed(2)}</td>
                  <td class="amount">$${(B.amount||B.quantity*B.rate||0).toFixed(2)}</td>
                </tr>
              `).join(""):`
                <tr>
                  <td>Professional Legal Services for ${(m==null?void 0:m.name)||"Legal Matter"}</td>
                  <td>1</td>
                  <td>$${s.total.toFixed(2)}</td>
                  <td class="amount">$${s.total.toFixed(2)}</td>
                </tr>
              `}
          </tbody>
        </table>

        <div class="totals">
          <div class="total-row">
            <span>Subtotal:</span>
            <span>$${(s.subtotal||s.total).toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})}</span>
          </div>
          ${s.taxAmount?`
          <div class="total-row">
            <span>Tax:</span>
            <span>$${s.taxAmount.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})}</span>
          </div>
          `:""}
          ${s.amountPaid>0?`
          <div class="total-row">
            <span>Payments Received:</span>
            <span style="color: #10B981;">-$${s.amountPaid.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})}</span>
          </div>
          `:""}
          <div class="total-row final">
            <span>Amount Due:</span>
            <span>$${(s.total-s.amountPaid).toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})}</span>
          </div>
        </div>

        <div class="footer">
          <p><strong>Payment Terms:</strong> Net 30 days</p>
          <p><strong>Make checks payable to:</strong> ${D}</p>
          <p>Thank you for your business. Please include the invoice number (${s.number}) with your payment.</p>
        </div>
      </body>
      </html>
    `,Y=window.open("","_blank");Y&&(Y.document.write(xe),Y.document.close(),Y.print())},W=v.useMemo(()=>{const s=new Date,a=n.filter(o=>{const l=I(o.issueDate);return l>=J(s)&&l<=X(s)}),m=n.filter(o=>{const l=I(o.issueDate),F=J(Z(s,1)),_e=X(Z(s,1));return l>=F&&l<=_e}),D=n.reduce((o,l)=>o+l.total,0),L=n.reduce((o,l)=>o+l.amountPaid,0),h=a.reduce((o,l)=>o+l.total,0),Q=a.reduce((o,l)=>o+l.amountPaid,0),U=m.reduce((o,l)=>o+l.total,0),N=x.filter(o=>o.billed),T=N.reduce((o,l)=>o+(l.amount||l.hours*l.rate),0),xe=N.filter(o=>{const l=I(o.date);return l>=J(s)&&l<=X(s)}),Y=N.filter(o=>{const l=I(o.date),F=J(Z(s,1)),_e=X(Z(s,1));return l>=F&&l<=_e}),ie=xe.reduce((o,l)=>o+(l.amount||l.hours*l.rate),0),B=Y.reduce((o,l)=>o+(l.amount||l.hours*l.rate),0),Xe=D>0?D:T,Me=h>0?h:ie,le=U>0?U:B,Ze=n.filter(o=>o.status==="sent"||o.status==="overdue"||o.status==="partial").reduce((o,l)=>o+(l.total-l.amountPaid),0),K={current:0,thirtyDays:0,sixtyDays:0,ninetyDays:0,ninetyPlus:0};n.filter(o=>o.status==="sent"||o.status==="overdue"||o.status==="partial").forEach(o=>{const l=Be(s,I(o.dueDate)),F=o.total-o.amountPaid;l<=0?K.current+=F:l<=30?K.thirtyDays+=F:l<=60?K.sixtyDays+=F:l<=90?K.ninetyDays+=F:K.ninetyPlus+=F});const et=x.filter(o=>o.billable&&!o.billed).reduce((o,l)=>o+l.amount,0),tt=C.filter(o=>o.billable&&!o.billed).reduce((o,l)=>o+l.amount,0),st=le>0?(Me-le)/le*100:0;return{totalBilled:Xe,totalPaid:L,outstanding:Ze,thisMonthBilled:Me,thisMonthCollected:Q,lastMonthBilled:le,aging:K,unbilledTime:et,unbilledExpenses:tt,trend:st}},[n,x,C]),qe=v.useMemo(()=>n.filter(s=>{var Q,U;const a=d.find(N=>N.id===s.clientId),m=f.find(N=>N.id===s.matterId),D=s.number.toLowerCase().includes(_.toLowerCase())||((Q=a==null?void 0:a.name)==null?void 0:Q.toLowerCase().includes(_.toLowerCase()))||((U=m==null?void 0:m.name)==null?void 0:U.toLowerCase().includes(_.toLowerCase())),L=S==="all"||s.status===S;let h=!0;if(ee!=="all"){const N=I(s.issueDate),T=new Date;ee==="thisMonth"?h=N>=J(T)&&N<=X(T):ee==="lastMonth"&&(h=N>=J(Z(T,1))&&N<=X(Z(T,1)))}return D&&L&&h}).sort((s,a)=>new Date(a.createdAt).getTime()-new Date(s.createdAt).getTime()),[n,d,f,_,S,ee]),O=n.filter(s=>V.includes(s.id)),Se=v.useMemo(()=>{if(O.length<2)return!1;const s=[...new Set(O.map(a=>a.matterId))];return s.length!==1||!s[0]?!1:O.every(a=>a.status!=="paid"&&a.status!=="void")},[O]),Ke=(s,a)=>{a.stopPropagation(),he(m=>m.includes(s)?m.filter(D=>D!==s):[...m,s])},Je=()=>{he([])};return e.jsxs("div",{className:t.billingPage,children:[e.jsxs("div",{className:t.header,children:[e.jsxs("div",{className:t.headerLeft,children:[e.jsx("h1",{children:z&&R==="all"?"All Billing":"My Billing"}),e.jsx("p",{className:t.headerSubtitle,children:z&&R==="all"?"Manage all firm invoices, payments, and billing":"Your invoices, payments, and billing"})]}),e.jsx("div",{className:t.headerActions,children:e.jsxs("button",{className:t.primaryBtn,onClick:()=>te(!0),children:[e.jsx(ye,{size:18}),"New Invoice"]})})]}),e.jsxs("div",{className:t.metricsRow,children:[e.jsxs("div",{className:t.metricCard,children:[e.jsx("div",{className:t.metricHeader,children:e.jsx("div",{className:t.metricIcon,style:{background:"rgba(16, 185, 129, 0.1)"},children:e.jsx(ke,{size:20,style:{color:"#10B981"}})})}),e.jsxs("div",{className:t.metricValue,children:["$",W.totalPaid.toLocaleString()]}),e.jsx("div",{className:t.metricLabel,children:"Total Collected"})]}),e.jsxs("div",{className:t.metricCard,children:[e.jsx("div",{className:t.metricHeader,children:e.jsx("div",{className:t.metricIcon,style:{background:"rgba(59, 130, 246, 0.1)"},children:e.jsx(Pe,{size:20,style:{color:"#3B82F6"}})})}),e.jsxs("div",{className:t.metricValue,children:["$",W.thisMonthBilled.toLocaleString()]}),e.jsx("div",{className:t.metricLabel,children:"Billed This Month"})]}),e.jsxs("div",{className:t.metricCard,children:[e.jsx("div",{className:t.metricHeader,children:e.jsx("div",{className:t.metricIcon,style:{background:"rgba(245, 158, 11, 0.1)"},children:e.jsx(ct,{size:20,style:{color:"#F59E0B"}})})}),e.jsxs("div",{className:t.metricValue,children:["$",W.outstanding.toLocaleString()]}),e.jsx("div",{className:t.metricLabel,children:"Outstanding"})]}),e.jsxs("div",{className:t.metricCard,children:[e.jsx("div",{className:t.metricHeader,children:e.jsx("div",{className:t.metricIcon,style:{background:"rgba(239, 68, 68, 0.1)"},children:e.jsx(Fe,{size:20,style:{color:"#EF4444"}})})}),e.jsxs("div",{className:t.metricValue,children:["$",(W.aging.thirtyDays+W.aging.sixtyDays+W.aging.ninetyDays+W.aging.ninetyPlus).toLocaleString()]}),e.jsx("div",{className:t.metricLabel,children:"Overdue"})]})]}),V.length>0&&e.jsxs("div",{className:t.selectionBar,children:[e.jsxs("div",{className:t.selectionInfo,children:[e.jsx(Ae,{size:20}),e.jsxs("span",{children:[e.jsx("strong",{children:V.length})," invoice",V.length>1?"s":""," selected"]}),Se&&e.jsx("span",{className:t.mergeHint,children:"(Same matter - can merge)"})]}),e.jsxs("div",{className:t.selectionActions,children:[e.jsx("button",{className:t.clearSelectionBtn,onClick:Je,children:"Clear"}),Se&&e.jsxs("button",{className:t.mergeBtn,onClick:()=>ve(!0),children:[e.jsx(ze,{size:18}),"Merge Invoices"]})]})]}),e.jsx("div",{className:t.tabs,children:[{id:"all",label:"All Invoices",count:n.length},{id:"draft",label:"Draft",count:n.filter(s=>s.status==="draft").length},{id:"sent",label:"Sent",count:n.filter(s=>s.status==="sent").length},{id:"overdue",label:"Overdue",count:n.filter(s=>s.status==="overdue").length},{id:"paid",label:"Paid",count:n.filter(s=>s.status==="paid").length}].map(s=>e.jsxs("button",{className:P(t.tab,S===s.id&&t.active),onClick:()=>Oe(s.id==="all"?"all":s.id),children:[s.label,e.jsx("span",{className:t.tabCount,children:s.count})]},s.id))}),e.jsxs("div",{className:t.filters,children:[z&&e.jsx("div",{className:t.viewToggle,children:Kn.map(s=>e.jsxs("button",{className:P(t.viewToggleBtn,R===s.value&&t.active),onClick:()=>i(s.value),children:[s.value==="my"?e.jsx(dt,{size:14}):e.jsx(mt,{size:14}),s.label]},s.value))}),e.jsxs("div",{className:t.searchBox,children:[e.jsx(ut,{size:18}),e.jsx("input",{type:"text",placeholder:"Search by invoice #, client, or matter...",value:_,onChange:s=>q(s.target.value)})]}),e.jsx("div",{className:t.filterGroup,children:e.jsxs("select",{value:ee,onChange:s=>Ge(s.target.value),className:t.filterSelect,children:[e.jsx("option",{value:"all",children:"All Time"}),e.jsx("option",{value:"thisMonth",children:"This Month"}),e.jsx("option",{value:"lastMonth",children:"Last Month"})]})})]}),e.jsx("div",{className:t.invoiceList,children:qe.length===0?e.jsxs("div",{className:t.emptyState,children:[e.jsx(Le,{size:48}),e.jsx("h3",{children:"No invoices found"}),e.jsx("p",{children:"Create your first invoice to get started"}),e.jsxs("button",{className:t.primaryBtn,onClick:()=>te(!0),children:[e.jsx(ye,{size:18}),"Create Invoice"]})]}):qe.map(s=>{const a=d.find(h=>h.id===s.clientId),m=f.find(h=>h.id===s.matterId),D=Be(I(s.dueDate),new Date),L=D<0&&s.status!=="paid";return e.jsx("div",{className:P(t.invoiceCard,L&&t.pastDue,V.includes(s.id)&&t.selectedCard),onClick:()=>H(s),style:{cursor:"pointer",zIndex:ne===s.id?100:1,position:"relative"},children:e.jsxs("div",{className:t.invoiceMain,children:[e.jsx("div",{className:t.invoiceCheckbox,onClick:h=>Ke(s.id,h),children:V.includes(s.id)?e.jsx(Ae,{size:20,className:t.checkedIcon}):e.jsx(ht,{size:20,className:t.uncheckedIcon})}),e.jsxs("div",{className:t.invoiceInfo,children:[e.jsxs("div",{className:t.invoiceNumber,children:[e.jsx(Le,{size:16}),s.number]}),e.jsxs("div",{className:t.invoiceClient,onClick:h=>h.stopPropagation(),children:[e.jsx(De,{to:`/app/clients/${s.clientId}`,children:(a==null?void 0:a.name)||"Unknown Client"}),m&&e.jsxs("span",{className:t.invoiceMatter,children:[e.jsx(vt,{size:12}),e.jsx(De,{to:`/app/matters/${s.matterId}`,children:m.name})]})]})]}),e.jsxs("div",{className:t.invoiceDates,children:[e.jsxs("div",{className:t.invoiceDate,children:[e.jsx("span",{children:"Issued:"}),k(I(s.issueDate),"MMM d, yyyy")]}),e.jsxs("div",{className:P(t.invoiceDate,L&&t.overdue),children:[e.jsx("span",{children:"Due:"}),k(I(s.dueDate),"MMM d, yyyy"),L&&e.jsxs("span",{className:t.daysOverdue,children:[Math.abs(D)," days overdue"]})]})]}),e.jsxs("div",{className:t.invoiceAmount,children:[e.jsxs("div",{className:t.totalAmount,children:["$",s.total.toLocaleString()]}),s.amountPaid>0&&s.amountPaid<s.total&&e.jsxs("div",{className:t.paidAmount,children:["$",s.amountPaid.toLocaleString()," paid"]}),s.status!=="paid"&&s.amountPaid<s.total&&e.jsxs("div",{className:t.dueAmount,children:["$",(s.total-s.amountPaid).toLocaleString()," due"]})]}),e.jsx("div",{className:t.invoiceStatus,children:e.jsx("span",{className:P(t.statusBadge,t[s.status]),children:s.status})}),e.jsxs("div",{className:t.invoiceActions,onClick:h=>h.stopPropagation(),children:[e.jsx("button",{className:t.actionBtn,onClick:h=>{h.stopPropagation(),H(s)},title:"Preview",children:e.jsx($e,{size:16})}),e.jsx("button",{className:t.actionBtn,onClick:h=>{h.stopPropagation(),Ne(s)},title:"Edit",children:e.jsx(fe,{size:16})}),e.jsx("button",{className:t.actionBtn,onClick:h=>{h.stopPropagation(),Ce(s)},title:"Download PDF",children:e.jsx(Re,{size:16})}),e.jsx("button",{className:t.actionBtn,onClick:h=>{h.stopPropagation(),ge(s)},title:"Email Invoice",children:e.jsx(be,{size:16})}),e.jsxs("div",{className:t.menuWrapper,ref:ne===s.id?de:null,children:[e.jsx("button",{className:t.actionBtn,onClick:h=>{h.stopPropagation(),E(ne===s.id?null:s.id)},children:e.jsx(pt,{size:16})}),ne===s.id&&e.jsxs("div",{className:t.dropdown,children:[e.jsxs("button",{className:t.dropdownItem,onClick:()=>Ne(s),children:[e.jsx(fe,{size:14}),"Edit Invoice"]}),e.jsxs("button",{className:t.dropdownItem,onClick:()=>H(s),children:[e.jsx($e,{size:14}),"Preview"]}),e.jsxs("button",{className:t.dropdownItem,onClick:()=>ge(s),children:[e.jsx(be,{size:14}),"Email Invoice"]}),s.status==="draft"&&e.jsxs("button",{className:t.dropdownItem,onClick:()=>pe(s.id,"sent"),children:[e.jsx(Pe,{size:14}),"Mark as Sent"]}),(s.status==="sent"||s.status==="overdue"||s.status==="partial")&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{className:t.dropdownItem,onClick:()=>Ye(s),children:[e.jsx(Ee,{size:14}),"Record Payment"]}),e.jsxs("button",{className:P(t.dropdownItem,t.success),onClick:()=>pe(s.id,"paid"),children:[e.jsx(ke,{size:14}),"Mark as Paid"]})]}),e.jsx("div",{className:t.dropdownDivider}),s.status!=="void"&&s.status!=="paid"&&e.jsxs("button",{className:P(t.dropdownItem,t.danger),onClick:()=>{ue({isOpen:!0,invoiceId:s.id,invoiceNumber:s.number}),E(null)},children:[e.jsx(gt,{size:14}),"Void Invoice"]})]})]})]})]})},s.id)})}),A&&e.jsx(Jn,{invoice:A,client:d.find(s=>s.id===A.clientId),matter:f.find(s=>s.id===A.matterId),firm:r,onClose:()=>H(null),onDownload:()=>Ce(A),onEdit:()=>{se(A),H(null)},onRecordPayment:()=>{oe(A),ae(!0),H(null)},onEmail:()=>{ge(A),H(null)},onDelete:async()=>{if(confirm(`Are you sure you want to delete invoice ${A.number}? This action cannot be undone.`))try{await je.delete(A.id),H(null),y()}catch(s){console.error("Failed to delete invoice:",s),u.error("Failed to delete invoice")}}}),Ve&&e.jsx(Te,{onClose:()=>{te(!1),re(null)},onSave:async s=>{try{await g({...s,status:"draft",amountPaid:0,subtotal:s.total}),te(!1),re(null),y()}catch(a){console.error("Failed to create invoice:",a),u.error("Failed to create invoice","Please try again.")}},clients:d,matters:f,prefilledClientId:We}),ce&&e.jsx(Te,{invoice:ce,onClose:()=>se(null),onSave:async s=>{try{await c(ce.id,s),se(null),y()}catch(a){console.error("Failed to update invoice:",a),u.error("Failed to update invoice","Please try again.")}},clients:d,matters:f}),Qe&&we&&e.jsx(Xn,{invoice:we,onClose:()=>{ae(!1),oe(null)},onSave:async(s,a)=>{try{await je.recordPayment(s,a),ae(!1),oe(null),y()}catch(m){throw console.error("Failed to record payment:",m),m}}}),e.jsx(rt,{isOpen:me.isOpen,onClose:()=>ue({isOpen:!1,invoiceId:"",invoiceNumber:""}),onConfirm:async()=>{await pe(me.invoiceId,"void"),ue({isOpen:!1,invoiceId:"",invoiceNumber:""})},title:"Void Invoice",message:`Are you sure you want to void invoice ${me.invoiceNumber}? This action will mark the invoice as voided and cannot be undone.`,confirmText:"Void Invoice",type:"danger"}),Ue&&O.length>=2&&e.jsx(Zn,{invoices:O,matter:f.find(s=>{var a;return s.id===((a=O[0])==null?void 0:a.matterId)}),client:d.find(s=>{var a;return s.id===((a=O[0])==null?void 0:a.clientId)}),onClose:()=>ve(!1),onMerge:async s=>{try{await je.merge(s,V.filter(a=>a!==s)),ve(!1),he([]),y()}catch(a){console.error("Failed to merge invoices:",a),u.error("Failed to merge invoices","Please try again.")}}})]})}function Jn({invoice:n,client:d,matter:f,firm:x,onClose:C,onDownload:y,onEdit:p,onRecordPayment:j,onEmail:M,onDelete:g}){var c;return e.jsx("div",{className:t.modalOverlay,onClick:C,children:e.jsxs("div",{className:t.previewModal,onClick:r=>r.stopPropagation(),children:[e.jsxs("div",{className:t.previewHeader,children:[e.jsxs("div",{className:t.previewTitle,children:[e.jsxs("h2",{children:["Invoice ",n.number]}),e.jsx("span",{className:P(t.statusBadge,t[n.status]),children:n.status})]}),e.jsx("button",{onClick:C,className:t.closeBtn,children:"×"})]}),e.jsxs("div",{className:t.previewContent,children:[e.jsxs("div",{className:t.previewSection,children:[e.jsxs("div",{className:t.previewRow,children:[e.jsxs("div",{className:t.previewColumn,children:[e.jsx("label",{children:"From"}),e.jsx("strong",{children:(x==null?void 0:x.name)||"Your Law Firm"}),(x==null?void 0:x.address)&&e.jsx("p",{children:x.address})]}),e.jsxs("div",{className:t.previewColumn,children:[e.jsx("label",{children:"Bill To"}),e.jsx("strong",{children:(d==null?void 0:d.name)||"Client"}),(d==null?void 0:d.email)&&e.jsx("p",{children:d.email})]})]}),e.jsxs("div",{className:t.previewRow,children:[e.jsxs("div",{className:t.previewColumn,children:[e.jsx("label",{children:"Matter"}),e.jsx("strong",{children:(f==null?void 0:f.name)||"General Services"})]}),e.jsxs("div",{className:t.previewColumn,children:[e.jsx("label",{children:"Issue Date"}),e.jsx("strong",{children:k(I(n.issueDate),"MMMM d, yyyy")})]}),e.jsxs("div",{className:t.previewColumn,children:[e.jsx("label",{children:"Due Date"}),e.jsx("strong",{children:k(I(n.dueDate),"MMMM d, yyyy")})]})]})]}),e.jsx("div",{className:t.previewItems,children:e.jsxs("table",{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Description"}),e.jsx("th",{children:"Qty"}),e.jsx("th",{children:"Rate"}),e.jsx("th",{children:"Amount"})]})}),e.jsx("tbody",{children:((c=n.lineItems)==null?void 0:c.length)>0?n.lineItems.map((r,w)=>{var $,u;return e.jsxs("tr",{children:[e.jsx("td",{children:r.description}),e.jsx("td",{children:r.quantity}),e.jsxs("td",{children:["$",($=r.rate)==null?void 0:$.toFixed(2)]}),e.jsxs("td",{children:["$",(u=r.amount)==null?void 0:u.toFixed(2)]})]},w)}):e.jsxs("tr",{children:[e.jsx("td",{children:"Legal Services"}),e.jsx("td",{children:"1"}),e.jsxs("td",{children:["$",n.total.toFixed(2)]}),e.jsxs("td",{children:["$",n.total.toFixed(2)]})]})})]})}),e.jsxs("div",{className:t.previewTotals,children:[e.jsxs("div",{className:t.previewTotalRow,children:[e.jsx("span",{children:"Subtotal"}),e.jsxs("span",{children:["$",(n.subtotal||n.total).toLocaleString()]})]}),n.amountPaid>0&&e.jsxs("div",{className:t.previewTotalRow,children:[e.jsx("span",{children:"Payments"}),e.jsxs("span",{className:t.paymentAmount,children:["-$",n.amountPaid.toLocaleString()]})]}),e.jsxs("div",{className:P(t.previewTotalRow,t.final),children:[e.jsx("span",{children:"Amount Due"}),e.jsxs("span",{children:["$",(n.total-n.amountPaid).toLocaleString()]})]})]})]}),e.jsxs("div",{className:t.previewActions,children:[e.jsxs("button",{className:t.cancelBtn,onClick:g,style:{color:"#EF4444",borderColor:"rgba(239, 68, 68, 0.3)"},children:[e.jsx(He,{size:16}),"Delete"]}),e.jsxs("button",{className:t.secondaryBtn,onClick:p,children:[e.jsx(fe,{size:16}),"Edit Invoice"]}),n.status!=="paid"&&n.status!=="void"&&e.jsxs("button",{className:t.secondaryBtn,onClick:j,children:[e.jsx(Ee,{size:16}),"Record Payment"]}),e.jsxs("button",{className:t.secondaryBtn,onClick:M,children:[e.jsx(be,{size:16}),"Email Invoice"]}),e.jsxs("button",{className:t.primaryBtn,onClick:y,children:[e.jsx(Re,{size:16}),"Download PDF"]})]})]})})}function Te({invoice:n,onClose:d,onSave:f,clients:x,matters:C,prefilledClientId:y}){var z,R;const p=Ie(),j=!!n,[M,g]=v.useState(!1),[c,r]=v.useState({clientId:(n==null?void 0:n.clientId)||y||((z=x[0])==null?void 0:z.id)||"",matterId:(n==null?void 0:n.matterId)||"",issueDate:n!=null&&n.issueDate?k(I(n.issueDate),"yyyy-MM-dd"):k(new Date,"yyyy-MM-dd"),dueDate:n!=null&&n.dueDate?k(I(n.dueDate),"yyyy-MM-dd"):k(new Date(Date.now()+30*24*60*60*1e3),"yyyy-MM-dd"),notes:(n==null?void 0:n.notes)||"",lineItems:((R=n==null?void 0:n.lineItems)==null?void 0:R.length)>0?n.lineItems:[{description:"Professional Legal Services",quantity:1,rate:0,amount:0}]}),w=()=>{r({...c,lineItems:[...c.lineItems,{description:"",quantity:1,rate:0,amount:0}]})},$=i=>{r({...c,lineItems:c.lineItems.filter((_,q)=>q!==i)})},u=(i,_,q)=>{const S=[...c.lineItems];S[i]={...S[i],[_]:q},(_==="quantity"||_==="rate")&&(S[i].amount=S[i].quantity*S[i].rate),_==="amount"&&S[i].quantity>0&&(S[i].rate=q/S[i].quantity),r({...c,lineItems:S})},b=c.lineItems.reduce((i,_)=>i+(_.amount||0),0),G=async i=>{if(i.preventDefault(),!M){if(!c.clientId){p.warning("Please select a client");return}if(b<=0){p.warning("Please add at least one line item with an amount");return}g(!0);try{await f({...c,total:b,issueDate:new Date(c.issueDate).toISOString(),dueDate:new Date(c.dueDate).toISOString()})}finally{g(!1)}}};return e.jsx("div",{className:t.modalOverlay,onClick:d,children:e.jsxs("div",{className:t.modal,onClick:i=>i.stopPropagation(),style:{maxWidth:"700px"},children:[e.jsxs("div",{className:t.modalHeader,children:[e.jsx("h2",{children:j?"Edit Invoice":"New Invoice"}),e.jsx("button",{onClick:d,className:t.closeBtn,children:"×"})]}),e.jsxs("form",{onSubmit:G,className:t.modalForm,children:[e.jsxs("div",{className:t.formGroup,children:[e.jsx("label",{children:"Client *"}),e.jsxs("select",{value:c.clientId,onChange:i=>r({...c,clientId:i.target.value,matterId:""}),required:!0,children:[e.jsx("option",{value:"",children:"Select a client"}),x.map(i=>e.jsx("option",{value:i.id,children:i.name||i.displayName},i.id))]})]}),e.jsxs("div",{className:t.formGroup,children:[e.jsx("label",{children:"Matter (optional)"}),e.jsxs("select",{value:c.matterId,onChange:i=>r({...c,matterId:i.target.value}),children:[e.jsx("option",{value:"",children:"No specific matter"}),C.filter(i=>!c.clientId||i.clientId===c.clientId).map(i=>e.jsx("option",{value:i.id,children:i.name||i.title},i.id))]})]}),e.jsxs("div",{className:t.formRow,children:[e.jsxs("div",{className:t.formGroup,children:[e.jsx("label",{children:"Issue Date"}),e.jsx("input",{type:"date",value:c.issueDate,onChange:i=>r({...c,issueDate:i.target.value}),required:!0})]}),e.jsxs("div",{className:t.formGroup,children:[e.jsx("label",{children:"Due Date"}),e.jsx("input",{type:"date",value:c.dueDate,onChange:i=>r({...c,dueDate:i.target.value}),required:!0})]})]}),e.jsxs("div",{className:t.lineItemsSection,children:[e.jsxs("div",{className:t.lineItemsHeader,children:[e.jsx("label",{children:"Line Items"}),e.jsxs("button",{type:"button",onClick:w,className:t.addLineItemBtn,children:[e.jsx(ye,{size:14}),"Add Item"]})]}),e.jsxs("div",{className:t.lineItemsTable,children:[e.jsxs("div",{className:t.lineItemsTableHeader,children:[e.jsx("span",{style:{flex:2},children:"Description"}),e.jsx("span",{style:{width:"80px",textAlign:"center"},children:"Qty"}),e.jsx("span",{style:{width:"100px",textAlign:"right"},children:"Rate"}),e.jsx("span",{style:{width:"120px",textAlign:"right"},children:"Amount"}),e.jsx("span",{style:{width:"40px"}})]}),c.lineItems.map((i,_)=>e.jsxs("div",{className:t.lineItemRow,children:[e.jsx("input",{type:"text",value:i.description,onChange:q=>u(_,"description",q.target.value),placeholder:"Description",style:{flex:2},required:!0}),e.jsx("input",{type:"number",value:i.quantity,onChange:q=>u(_,"quantity",parseFloat(q.target.value)||0),min:"0",step:"0.5",style:{width:"80px",textAlign:"center"}}),e.jsxs("div",{style:{width:"100px",position:"relative"},children:[e.jsx("span",{style:{position:"absolute",left:"8px",top:"50%",transform:"translateY(-50%)",color:"#666"},children:"$"}),e.jsx("input",{type:"number",value:i.rate,onChange:q=>u(_,"rate",parseFloat(q.target.value)||0),min:"0",step:"0.01",style:{width:"100%",textAlign:"right",paddingLeft:"20px"}})]}),e.jsxs("div",{style:{width:"120px",position:"relative"},children:[e.jsx("span",{style:{position:"absolute",left:"8px",top:"50%",transform:"translateY(-50%)",color:"#666"},children:"$"}),e.jsx("input",{type:"number",value:i.amount,onChange:q=>u(_,"amount",parseFloat(q.target.value)||0),min:"0",step:"0.01",style:{width:"100%",textAlign:"right",paddingLeft:"20px",fontWeight:"bold"}})]}),e.jsx("button",{type:"button",onClick:()=>$(_),className:t.removeLineItemBtn,disabled:c.lineItems.length===1,style:{width:"40px"},children:e.jsx(He,{size:14})})]},_)),e.jsxs("div",{className:t.lineItemsTotal,children:[e.jsx("span",{children:"Total:"}),e.jsxs("span",{className:t.totalAmount,children:["$",b.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})]})]})]})]}),e.jsxs("div",{className:t.formGroup,children:[e.jsx("label",{children:"Notes"}),e.jsx("textarea",{value:c.notes,onChange:i=>r({...c,notes:i.target.value}),placeholder:"Invoice notes...",rows:3})]}),e.jsxs("div",{className:t.modalActions,children:[e.jsx("button",{type:"button",onClick:d,className:t.cancelBtn,disabled:M,children:"Cancel"}),e.jsx("button",{type:"submit",className:t.saveBtn,disabled:M,children:M?"Saving...":j?"Save Changes":`Create Invoice ($${b.toLocaleString(void 0,{minimumFractionDigits:2})})`})]})]})]})})}function Xn({invoice:n,onClose:d,onSave:f}){const x=Ie(),[C,y]=v.useState(!1),[p,j]=v.useState({amount:n.total-n.amountPaid,paymentMethod:"check",reference:"",paymentDate:k(new Date,"yyyy-MM-dd"),notes:"",syncToQuickBooks:!0}),M=async g=>{if(g.preventDefault(),!C){if(p.amount<=0){x.warning("Please enter a valid payment amount");return}y(!0);try{await f(n.id,p),d()}catch(c){console.error("Failed to record payment:",c),x.error("Failed to record payment")}finally{y(!1)}}};return e.jsx("div",{className:t.modalOverlay,onClick:d,children:e.jsxs("div",{className:t.modal,onClick:g=>g.stopPropagation(),children:[e.jsxs("div",{className:t.modalHeader,children:[e.jsx("h2",{children:"Record Payment"}),e.jsx("button",{onClick:d,className:t.closeBtn,children:"×"})]}),e.jsxs("form",{onSubmit:M,className:t.modalForm,children:[e.jsxs("div",{className:t.paymentInfo,children:[e.jsxs("div",{className:t.paymentInfoRow,children:[e.jsx("span",{children:"Invoice:"}),e.jsx("strong",{children:n.number})]}),e.jsxs("div",{className:t.paymentInfoRow,children:[e.jsx("span",{children:"Total:"}),e.jsxs("strong",{children:["$",n.total.toLocaleString()]})]}),e.jsxs("div",{className:t.paymentInfoRow,children:[e.jsx("span",{children:"Previously Paid:"}),e.jsxs("strong",{children:["$",n.amountPaid.toLocaleString()]})]}),e.jsxs("div",{className:P(t.paymentInfoRow,t.highlight),children:[e.jsx("span",{children:"Amount Due:"}),e.jsxs("strong",{children:["$",(n.total-n.amountPaid).toLocaleString()]})]})]}),e.jsxs("div",{className:t.formGroup,children:[e.jsx("label",{children:"Payment Amount"}),e.jsx("input",{type:"number",step:"0.01",value:p.amount,onChange:g=>j({...p,amount:parseFloat(g.target.value)||0}),required:!0})]}),e.jsxs("div",{className:t.formRow,children:[e.jsxs("div",{className:t.formGroup,children:[e.jsx("label",{children:"Payment Method"}),e.jsxs("select",{value:p.paymentMethod,onChange:g=>j({...p,paymentMethod:g.target.value}),children:[e.jsx("option",{value:"check",children:"Check"}),e.jsx("option",{value:"wire",children:"Wire Transfer"}),e.jsx("option",{value:"ach",children:"ACH"}),e.jsx("option",{value:"credit_card",children:"Credit Card"}),e.jsx("option",{value:"cash",children:"Cash"}),e.jsx("option",{value:"other",children:"Other"})]})]}),e.jsxs("div",{className:t.formGroup,children:[e.jsx("label",{children:"Payment Date"}),e.jsx("input",{type:"date",value:p.paymentDate,onChange:g=>j({...p,paymentDate:g.target.value}),required:!0})]})]}),e.jsxs("div",{className:t.formGroup,children:[e.jsx("label",{children:"Reference / Check #"}),e.jsx("input",{type:"text",value:p.reference,onChange:g=>j({...p,reference:g.target.value}),placeholder:"e.g., Check #1234"})]}),e.jsxs("div",{className:t.formGroup,children:[e.jsx("label",{children:"Notes"}),e.jsx("textarea",{value:p.notes,onChange:g=>j({...p,notes:g.target.value}),placeholder:"Payment notes...",rows:2})]}),e.jsxs("div",{className:t.formGroup,children:[e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"8px",cursor:"pointer"},children:[e.jsx("input",{type:"checkbox",checked:p.syncToQuickBooks,onChange:g=>j({...p,syncToQuickBooks:g.target.checked}),style:{width:"16px",height:"16px",accentColor:"var(--apex-gold)"}}),e.jsx("span",{style:{fontWeight:400},children:"Sync payment to QuickBooks"})]}),e.jsx("p",{style:{fontSize:"0.75rem",color:"var(--apex-muted)",marginTop:"4px"},children:"If connected, this payment will be automatically recorded in QuickBooks"})]}),e.jsxs("div",{className:t.modalActions,children:[e.jsx("button",{type:"button",onClick:d,className:t.cancelBtn,disabled:C,children:"Cancel"}),e.jsx("button",{type:"submit",className:t.saveBtn,disabled:C,children:C?"Recording...":"Record Payment"})]})]})]})})}function Zn({invoices:n,matter:d,client:f,onClose:x,onMerge:C}){var $;const[y,p]=v.useState(!1),[j,M]=v.useState((($=n[0])==null?void 0:$.id)||""),g=n.reduce((u,b)=>u+b.total,0),c=n.reduce((u,b)=>u+b.amountPaid,0),r=n.reduce((u,b)=>{var G;return u+(((G=b.lineItems)==null?void 0:G.length)||0)},0),w=async()=>{if(j){p(!0);try{await C(j)}finally{p(!1)}}};return e.jsx("div",{className:t.modalOverlay,onClick:x,children:e.jsxs("div",{className:t.mergeModal,onClick:u=>u.stopPropagation(),children:[e.jsxs("div",{className:t.modalHeader,children:[e.jsxs("div",{className:t.mergeModalTitle,children:[e.jsx(ze,{size:20}),e.jsx("h2",{children:"Merge Invoices"})]}),e.jsx("button",{onClick:x,className:t.closeBtn,children:"×"})]}),e.jsxs("div",{className:t.mergeModalContent,children:[e.jsx("div",{className:t.mergeInfo,children:e.jsxs("p",{children:["Combine ",e.jsxs("strong",{children:[n.length," invoices"]})," for matter ",e.jsx("strong",{children:(d==null?void 0:d.name)||"Unknown"})," into one invoice."]})}),e.jsxs("div",{className:t.mergeSummary,children:[e.jsxs("div",{className:t.mergeSummaryItem,children:[e.jsx("span",{children:"Total Amount"}),e.jsxs("strong",{children:["$",g.toLocaleString()]})]}),e.jsxs("div",{className:t.mergeSummaryItem,children:[e.jsx("span",{children:"Already Paid"}),e.jsxs("strong",{children:["$",c.toLocaleString()]})]}),e.jsxs("div",{className:t.mergeSummaryItem,children:[e.jsx("span",{children:"Line Items"}),e.jsx("strong",{children:r})]})]}),e.jsxs("div",{className:t.mergeSelectSection,children:[e.jsx("label",{children:"Keep invoice number:"}),e.jsx("p",{className:t.mergeSelectHint,children:"The selected invoice number will be kept. All line items from other invoices will be merged into this one."}),e.jsx("div",{className:t.mergeInvoiceList,children:n.map(u=>e.jsxs("label",{className:P(t.mergeInvoiceOption,j===u.id&&t.selected),children:[e.jsx("input",{type:"radio",name:"keepInvoice",value:u.id,checked:j===u.id,onChange:b=>M(b.target.value)}),e.jsxs("div",{className:t.mergeInvoiceDetails,children:[e.jsx("span",{className:t.mergeInvoiceNumber,children:u.number}),e.jsxs("span",{className:t.mergeInvoiceAmount,children:["$",u.total.toLocaleString()]}),e.jsx("span",{className:t.mergeInvoiceDate,children:k(I(u.issueDate),"MMM d, yyyy")})]})]},u.id))})]}),e.jsxs("div",{className:t.mergeWarning,children:[e.jsx(Fe,{size:16}),e.jsx("span",{children:"Other invoices will be voided after merging. This action cannot be undone."})]})]}),e.jsxs("div",{className:t.mergeModalFooter,children:[e.jsx("button",{onClick:x,className:t.cancelBtn,disabled:y,children:"Cancel"}),e.jsx("button",{onClick:w,className:t.mergeConfirmBtn,disabled:y||!j,children:y?"Merging...":`Merge ${n.length} Invoices`})]})]})})}export{da as BillingPage};
