import{r as l,a6 as e,h as _}from"./vendor-DrKzkH4x.js";import{u as J,m as x}from"./index-CCWWoMiH.js";import{a as K}from"./router-CNLU_KyZ.js";import{L as A,al as X,a4 as F,a as L,t as Y,ao as Z,aH as ee,ac as se,ax as P,$ as I}from"./icons-BtUkkwGS.js";import"./doc-parsers-U1nJMjtM.js";import"./react-dom-DfB-QKj2.js";import"./pdf-worker-CVmCB3lP.js";import"./state-72d44OIA.js";const te="_page_10k86_3",ie="_loading_10k86_9",le="_spinner_10k86_19",ae="_header_10k86_28",re="_backBtn_10k86_33",ne="_headerContent_10k86_53",ce="_error_10k86_73",oe="_success_10k86_73",de="_content_10k86_106",me="_mattersPanel_10k86_120",ue="_actionsPanel_10k86_120",he="_panelHeader_10k86_127",pe="_selectionCount_10k86_142",_e="_filters_10k86_148",xe="_searchBox_10k86_155",je="_filterSelect_10k86_180",ge="_selectAllBtn_10k86_223",ve="_matterList_10k86_243",fe="_emptyList_10k86_248",be="_matterItem_10k86_255",ye="_selected_10k86_269",ke="_matterInfo_10k86_281",Ne="_matterNumber_10k86_286",Ce="_matterName_10k86_294",Se="_matterClient_10k86_303",Be="_visibilityBadge_10k86_309",we="_restricted_10k86_322",Ae="_actionForm_10k86_327",Fe="_formGroup_10k86_331",Le="_select_10k86_142",Pe="_visibilityOptions_10k86_356",Ie="_visibilityOption_10k86_356",ze="_active_10k86_383",Ge="_applyBtn_10k86_389",Me="_infoBox_10k86_416",t={page:te,loading:ie,spinner:le,header:ae,backBtn:re,headerContent:ne,error:ce,success:oe,content:de,mattersPanel:me,actionsPanel:ue,panelHeader:he,selectionCount:pe,filters:_e,searchBox:xe,filterSelect:je,selectAllBtn:ge,matterList:ve,emptyList:fe,matterItem:be,selected:ye,matterInfo:ke,matterNumber:Ne,matterName:Ce,matterClient:Se,visibilityBadge:Be,restricted:we,actionForm:Ae,formGroup:Fe,select:Le,visibilityOptions:Pe,visibilityOption:Ie,active:ze,applyBtn:Ge,infoBox:Me};function qe(){const j=K(),{user:g}=J(),[z,b]=l.useState(!0),[y,k]=l.useState(!1),[N,r]=l.useState(null),[C,v]=l.useState(null),[G,M]=l.useState([]),[O,R]=l.useState([]),[U,V]=l.useState([]),[a,h]=l.useState([]),[o,E]=l.useState(""),[f,H]=l.useState("all"),[i,T]=l.useState("visibility"),[p,S]=l.useState("firm_wide"),[d,W]=l.useState(""),[m,q]=l.useState("");l.useEffect(()=>{g&&!["owner","admin"].includes(g.role)&&j("/app/settings")},[g,j]),l.useEffect(()=>{B()},[]);async function B(){try{b(!0),r(null);const[s,n,u]=await Promise.all([x.getAll(),x.getAvailableUsers(),x.getAvailableGroups()]);M(s.matters||[]),R(n.users||[]),V(u.groups||[])}catch(s){r(s.message||"Failed to load data")}finally{b(!1)}}const c=G.filter(s=>{var w;const n=!o||s.name.toLowerCase().includes(o.toLowerCase())||s.number.toLowerCase().includes(o.toLowerCase())||(((w=s.clientName)==null?void 0:w.toLowerCase())||"").includes(o.toLowerCase()),u=f==="all"||s.visibility===f;return n&&u});function D(s){h(n=>n.includes(s)?n.filter(u=>u!==s):[...n,s])}function $(){a.length===c.length?h([]):h(c.map(s=>s.id))}async function Q(){if(a.length===0){r("Please select at least one matter");return}try{k(!0),r(null),v(null);const s={matterIds:a};if(i==="visibility")s.visibility=p,s.action="add";else if(i==="add_user"){if(!d){r("Please select a user");return}s.action="add",s.userId=d}else if(i==="add_group"){if(!m){r("Please select a group");return}s.action="add",s.groupId=m}else if(i==="remove_user"){if(!d){r("Please select a user");return}s.action="remove",s.userId=d}else if(i==="remove_group"){if(!m){r("Please select a group");return}s.action="remove",s.groupId=m}const n=await x.bulkUpdatePermissions(s);v(`Updated ${n.results.success} matter${n.results.success!==1?"s":""} successfully`),h([]),await B()}catch(s){r(s.message||"Failed to apply bulk action")}finally{k(!1)}}return z?e.jsx("div",{className:t.page,children:e.jsxs("div",{className:t.loading,children:[e.jsx(A,{className:t.spinner,size:32}),e.jsx("span",{children:"Loading matters..."})]})}):e.jsxs("div",{className:t.page,children:[e.jsxs("div",{className:t.header,children:[e.jsxs("button",{className:t.backBtn,onClick:()=>j("/app/settings"),children:[e.jsx(X,{size:18}),"Back to Settings"]}),e.jsxs("div",{className:t.headerContent,children:[e.jsxs("h1",{children:[e.jsx(F,{size:28}),"Bulk Edit Permissions"]}),e.jsx("p",{children:"Update visibility and permissions for multiple matters at once"})]})]}),N&&e.jsxs("div",{className:t.error,children:[e.jsx(L,{size:18}),N,e.jsx("button",{onClick:()=>r(null),children:"×"})]}),C&&e.jsxs("div",{className:t.success,children:[e.jsx(Y,{size:18}),C,e.jsx("button",{onClick:()=>v(null),children:"×"})]}),e.jsxs("div",{className:t.content,children:[e.jsxs("div",{className:t.mattersPanel,children:[e.jsxs("div",{className:t.panelHeader,children:[e.jsx("h2",{children:"Select Matters"}),e.jsxs("span",{className:t.selectionCount,children:[a.length," of ",c.length," selected"]})]}),e.jsxs("div",{className:t.filters,children:[e.jsxs("div",{className:t.searchBox,children:[e.jsx(Z,{size:16}),e.jsx("input",{type:"text",placeholder:"Search matters...",value:o,onChange:s=>E(s.target.value)})]}),e.jsxs("select",{value:f,onChange:s=>H(s.target.value),className:t.filterSelect,children:[e.jsx("option",{value:"all",children:"All Visibility"}),e.jsx("option",{value:"firm_wide",children:"Firm Wide Only"}),e.jsx("option",{value:"restricted",children:"Restricted Only"})]})]}),e.jsxs("button",{className:t.selectAllBtn,onClick:$,children:[a.length===c.length&&c.length>0?e.jsx(ee,{size:18}):e.jsx(se,{size:18}),a.length===c.length&&c.length>0?"Deselect All":"Select All"]}),e.jsx("div",{className:t.matterList,children:c.length===0?e.jsx("div",{className:t.emptyList,children:"No matters match your filters"}):c.map(s=>e.jsxs("label",{className:_(t.matterItem,a.includes(s.id)&&t.selected),children:[e.jsx("input",{type:"checkbox",checked:a.includes(s.id),onChange:()=>D(s.id)}),e.jsxs("div",{className:t.matterInfo,children:[e.jsx("span",{className:t.matterNumber,children:s.number}),e.jsx("span",{className:t.matterName,children:s.name}),s.clientName&&e.jsx("span",{className:t.matterClient,children:s.clientName})]}),e.jsx("span",{className:_(t.visibilityBadge,s.visibility==="restricted"&&t.restricted),children:s.visibility==="firm_wide"?e.jsxs(e.Fragment,{children:[e.jsx(P,{size:12})," Firm Wide"]}):e.jsxs(e.Fragment,{children:[e.jsx(I,{size:12})," Restricted"]})})]},s.id))})]}),e.jsxs("div",{className:t.actionsPanel,children:[e.jsx("div",{className:t.panelHeader,children:e.jsx("h2",{children:"Bulk Action"})}),e.jsxs("div",{className:t.actionForm,children:[e.jsxs("div",{className:t.formGroup,children:[e.jsx("label",{children:"Action Type"}),e.jsxs("select",{value:i,onChange:s=>T(s.target.value),className:t.select,children:[e.jsx("option",{value:"visibility",children:"Change Visibility"}),e.jsx("option",{value:"add_user",children:"Add User to Matters"}),e.jsx("option",{value:"add_group",children:"Add Group to Matters"}),e.jsx("option",{value:"remove_user",children:"Remove User from Matters"}),e.jsx("option",{value:"remove_group",children:"Remove Group from Matters"})]})]}),i==="visibility"&&e.jsxs("div",{className:t.formGroup,children:[e.jsx("label",{children:"New Visibility"}),e.jsxs("div",{className:t.visibilityOptions,children:[e.jsxs("button",{type:"button",className:_(t.visibilityOption,p==="firm_wide"&&t.active),onClick:()=>S("firm_wide"),children:[e.jsx(P,{size:18}),e.jsx("span",{children:"Firm Wide"})]}),e.jsxs("button",{type:"button",className:_(t.visibilityOption,p==="restricted"&&t.active),onClick:()=>S("restricted"),children:[e.jsx(I,{size:18}),e.jsx("span",{children:"Restricted"})]})]})]}),(i==="add_user"||i==="remove_user")&&e.jsxs("div",{className:t.formGroup,children:[e.jsx("label",{children:"Select User"}),e.jsxs("select",{value:d,onChange:s=>W(s.target.value),className:t.select,children:[e.jsx("option",{value:"",children:"Choose a user..."}),O.map(s=>e.jsxs("option",{value:s.id,children:[s.name," (",s.email,")"]},s.id))]})]}),(i==="add_group"||i==="remove_group")&&e.jsxs("div",{className:t.formGroup,children:[e.jsx("label",{children:"Select Group"}),e.jsxs("select",{value:m,onChange:s=>q(s.target.value),className:t.select,children:[e.jsx("option",{value:"",children:"Choose a group..."}),U.map(s=>e.jsxs("option",{value:s.id,children:[s.name," (",s.memberCount," members)"]},s.id))]})]}),e.jsx("button",{className:t.applyBtn,onClick:Q,disabled:y||a.length===0,children:y?e.jsxs(e.Fragment,{children:[e.jsx(A,{className:t.spinner,size:18}),"Processing..."]}):e.jsxs(e.Fragment,{children:[e.jsx(F,{size:18}),"Apply to ",a.length," Matter",a.length!==1?"s":""]})}),e.jsxs("div",{className:t.infoBox,children:[e.jsx(L,{size:16}),e.jsxs("p",{children:[i==="visibility"&&e.jsxs(e.Fragment,{children:["Changing visibility to ",e.jsx("strong",{children:p==="firm_wide"?"Firm Wide":"Restricted"})," will update all selected matters."]}),i==="add_user"&&e.jsx(e.Fragment,{children:"The selected user will be granted access to all selected restricted matters."}),i==="add_group"&&e.jsx(e.Fragment,{children:"All members of the selected group will be granted access to all selected restricted matters."}),i==="remove_user"&&e.jsx(e.Fragment,{children:"The selected user will lose access to all selected restricted matters (unless they are the responsible attorney)."}),i==="remove_group"&&e.jsx(e.Fragment,{children:"The selected group will lose access to all selected restricted matters."})]})]})]})]})]})]})}export{qe as BulkPermissionsPage,qe as default};
