import{r,a6 as e,h as E}from"./vendor-DrKzkH4x.js";import{d as et,k as He,h as it,a as dt,u as mt,b as ut,g as ht,E as xt,w as Qe}from"./index-CCWWoMiH.js";import{u as _t}from"./aiStore-CKroQOhS.js";import{L as re,a as pt,R as qe,K as Te,aN as Ke,U as xe,H as Je,x as he,aO as tt,f as st,aB as We,X as at,t as ft,aP as nt,v as rt,F as q,aQ as ot,aR as gt,k as lt,aS as jt,a4 as vt,ao as Nt,J as wt,y as yt,aT as Ct,aH as Ye,ac as Xe,Y as Bt,$ as bt,S as St,ae as kt,j as It}from"./icons-BtUkkwGS.js";import{C as Ze}from"./ConfirmationModal-X7YGPBKC.js";import{D as Dt,S as zt}from"./ShareDocumentModal-Uqa4Lxgn.js";import{a as At}from"./router-CNLU_KyZ.js";import{a as Ft,p as Mt}from"./date-utils-BkNAU8cl.js";import"./doc-parsers-U1nJMjtM.js";import"./react-dom-DfB-QKj2.js";import"./pdf-worker-CVmCB3lP.js";import"./state-72d44OIA.js";const Ut="_container_1x83r_1",Lt="_header_1x83r_11",$t="_adminBadge_1x83r_30",Ot="_headerActions_1x83r_40",Rt="_refreshBtn_1x83r_79",Et="_content_1x83r_149",Pt="_sidebar_1x83r_156",Ht="_sidebarHeader_1x83r_165",Gt="_statsCount_1x83r_178",Tt="_folderTree_1x83r_184",Wt="_folderRow_1x83r_194",Vt="_selected_1x83r_212",Qt="_folderIcon_1x83r_217",qt="_folderName_1x83r_234",Kt="_sectionLabel_1x83r_241",Jt="_matterSection_1x83r_251",Yt="_main_1x83r_263",Xt="_breadcrumb_1x83r_270",Zt="_breadcrumbItem_1x83r_281",es="_breadcrumbSep_1x83r_305",ts="_refreshing_1x83r_379",ss="_documentsTable_1x83r_390",as="_docRow_1x83r_424",ns="_selectedDoc_1x83r_433",rs="_nameCell_1x83r_437",os="_docName_1x83r_443",ls="_pdfIcon_1x83r_448",cs="_spreadsheetIcon_1x83r_449",is="_imageIcon_1x83r_450",ds="_wordIcon_1x83r_451",ms="_ownedBadge_1x83r_453",us="_sharedBadge_1x83r_462",hs="_rootFolder_1x83r_480",xs="_folderCell_1x83r_500",_s="_folderLink_1x83r_504",ps="_searchBar_1x83r_546",fs="_searchInput_1x83r_552",gs="_rowActions_1x83r_575",js="_downloadBtn_1x83r_580",vs="_emptyRow_1x83r_605",Ns="_emptyState_1x83r_609",ws="_emptyHint_1x83r_622",ys="_footer_1x83r_628",Cs="_divider_1x83r_639",Bs="_loading_1x83r_649",bs="_error_1x83r_649",Ss="_retryBtn_1x83r_674",ks="_spinner_1x83r_693",Is="_pagination_1x83r_703",Ds="_pageBtn_1x83r_713",zs="_pageInfo_1x83r_734",As="_newFolderBtn_1x83r_740",Fs="_uploadBtn_1x83r_741",Ms="_dragOver_1x83r_782",Us="_dragOverlay_1x83r_786",Ls="_dragHint_1x83r_807",$s="_uploadProgress_1x83r_813",Os="_modalOverlay_1x83r_825",Rs="_modal_1x83r_825",Es="_modalHeader_1x83r_856",Ps="_modalClose_1x83r_874",Hs="_modalBody_1x83r_893",Gs="_formGroup_1x83r_897",Ts="_folderHint_1x83r_924",Ws="_folderErrorMsg_1x83r_933",Vs="_modalFooter_1x83r_942",Qs="_cancelBtn_1x83r_952",qs="_createBtn_1x83r_969",Ks="_contextMenu_1x83r_994",Js="_contextMenuItem_1x83r_1004",Ys="_deleteItem_1x83r_1025",a={container:Ut,header:Lt,adminBadge:$t,headerActions:Ot,refreshBtn:Rt,content:Et,sidebar:Pt,sidebarHeader:Ht,statsCount:Gt,folderTree:Tt,folderRow:Wt,selected:Vt,folderIcon:Qt,folderName:qt,sectionLabel:Kt,matterSection:Jt,main:Yt,breadcrumb:Xt,breadcrumbItem:Zt,breadcrumbSep:es,refreshing:ts,documentsTable:ss,docRow:as,selectedDoc:ns,nameCell:rs,docName:os,pdfIcon:ls,spreadsheetIcon:cs,imageIcon:is,wordIcon:ds,ownedBadge:ms,sharedBadge:us,rootFolder:hs,folderCell:xs,folderLink:_s,searchBar:ps,searchInput:fs,rowActions:gs,downloadBtn:js,emptyRow:vs,emptyState:Ns,emptyHint:ws,footer:ys,divider:Cs,loading:Bs,error:bs,retryBtn:Ss,spinner:ks,pagination:Is,pageBtn:Ds,pageInfo:zs,newFolderBtn:As,uploadBtn:Fs,dragOver:Ms,dragOverlay:Us,dragHint:Ls,uploadProgress:$s,modalOverlay:Os,modal:Rs,modalHeader:Es,modalClose:Ps,modalBody:Hs,formGroup:Gs,folderHint:Ts,folderErrorMsg:Ws,modalFooter:Vs,cancelBtn:Qs,createBtn:qs,contextMenu:Ks,contextMenuItem:Js,deleteItem:Ys},De=5*60*1e3;let C={data:null,timestamp:0,searchQuery:""};function oe(){C={data:null,timestamp:0,searchQuery:""}}function Xs({onDocumentSelect:m,onFolderSelect:v,selectedDocumentId:I,showHeader:F=!0,className:$,onUpload:ze}){var Se,ke,Ie;const le=et(),[ce,Ae]=r.useState(()=>!(C.data&&Date.now()-C.timestamp<De&&C.searchQuery==="")),[Fe,_e]=r.useState(null),[c,pe]=r.useState(()=>C.data&&Date.now()-C.timestamp<De&&C.searchQuery===""?C.data:null),[_,D]=r.useState(null),[fe,Me]=r.useState(null),[y,W]=r.useState(""),[K]=r.useState(100),[J,Y]=r.useState(0),Ue=r.useRef(!0),[ge,M]=r.useState(!1),[X,p]=r.useState(""),[U,je]=r.useState(!1),[ve,ie]=r.useState(null),[B,P]=r.useState(null),[Le,Ne]=r.useState(null),[$e,g]=r.useState(""),[H,N]=r.useState(null),[G,Z]=r.useState(!1),[ee,we]=r.useState(!1),[V,te]=r.useState(null),se=r.useRef(null),A=r.useRef(null),z=r.useCallback(async(s=!1)=>{if(!(!s&&y===""&&C.data&&Date.now()-C.timestamp<De&&C.searchQuery===y&&c)){c||Ae(!0),_e(null);try{const o=await He.browseAllFiles(y||void 0),b={isAdmin:(o==null?void 0:o.isAdmin)??!1,files:(o==null?void 0:o.files)??[],matters:(o==null?void 0:o.matters)??[],hasUnassigned:(o==null?void 0:o.hasUnassigned)??!1,stats:(o==null?void 0:o.stats)??{totalFiles:0,totalSize:0},configured:(o==null?void 0:o.configured)??!0,message:o==null?void 0:o.message,error:o==null?void 0:o.error,source:o==null?void 0:o.source};pe(b),y===""&&(C={data:b,timestamp:Date.now(),searchQuery:""})}catch(o){console.error("Failed to load files:",o),_e(o.message||"Failed to load documents")}finally{Ae(!1)}}},[y,c]);r.useEffect(()=>{Ue.current&&(Ue.current=!1,c||z())},[z,c]),r.useEffect(()=>{if(y===""&&C.data&&Date.now()-C.timestamp<De){pe(C.data);return}const s=setTimeout(()=>{z()},300);return()=>clearTimeout(s)},[y,z]);const de=async(s,d)=>{d&&d.stopPropagation(),Me(s.id);try{const o="https://apexai-api.azurewebsites.net/api",b=localStorage.getItem("apex-access-token")||localStorage.getItem("token")||"",t=await fetch(`${o}/documents/${s.id}/download`,{headers:{Authorization:`Bearer ${b}`}});if(!t.ok)throw new Error("Download failed");const i=await t.blob(),l=window.URL.createObjectURL(i),u=document.createElement("a");u.href=l,u.download=s.originalName||s.name,document.body.appendChild(u),u.click(),window.URL.revokeObjectURL(l),document.body.removeChild(u)}catch(o){console.error("Download failed:",o),le.error("Failed to download file",o.message||"Unknown error")}finally{Me(null)}},O=s=>{D(s),v==null||v(s||"")},ae=async()=>{if(!X.trim()){ie("Folder name is required");return}je(!0),ie(null);try{await He.createFolder({name:X.trim(),parentPath:_?`matter-${_}`:"/",matterId:_&&_!=="unassigned"?_:void 0}),M(!1),p(""),oe(),z(!0)}catch(s){ie(s.message||"Failed to create folder")}finally{je(!1)}},ye=async s=>{if(confirm("Are you sure you want to delete this folder? Files inside may become unassigned.")){N(s);try{await He.deleteFolder(s),oe(),z(!0)}catch(d){console.error("Failed to delete folder:",d),le.error("Failed to delete folder",d.message||"Unknown error")}finally{N(null)}}},Oe=s=>{s.preventDefault(),s.stopPropagation(),Z(!0)},j=s=>{s.preventDefault(),s.stopPropagation(),se.current&&!se.current.contains(s.relatedTarget)&&Z(!1)},R=s=>{s.preventDefault(),s.stopPropagation()},Re=async s=>{s.preventDefault(),s.stopPropagation(),Z(!1);const d=Array.from(s.dataTransfer.files);d.length!==0&&await me(d)},T=async s=>{const d=Array.from(s.target.files||[]);d.length!==0&&(await me(d),A.current&&(A.current.value=""))},me=async s=>{we(!0),te({current:0,total:s.length});try{for(let d=0;d<s.length;d++){te({current:d+1,total:s.length});const o={};_&&_!=="unassigned"&&(o.matterId=_),await it.upload(s[d],o)}oe(),z(!0)}catch(d){console.error("Upload failed:",d),le.error("Failed to upload file(s)",d.message||"Unknown error")}finally{we(!1),te(null)}};r.useEffect(()=>{const s=()=>P(null);if(B)return document.addEventListener("click",s),()=>document.removeEventListener("click",s)},[B]);const Ee=(s,d)=>{var b;const o=((b=d==null?void 0:d.split(".").pop())==null?void 0:b.toLowerCase())||"";return s!=null&&s.includes("pdf")||o==="pdf"?e.jsx(q,{size:16,className:a.pdfIcon}):s!=null&&s.includes("spreadsheet")||["xls","xlsx","csv"].includes(o)?e.jsx(ot,{size:16,className:a.spreadsheetIcon}):s!=null&&s.includes("image")||["jpg","jpeg","png","gif"].includes(o)?e.jsx(gt,{size:16,className:a.imageIcon}):s!=null&&s.includes("word")||["doc","docx","rtf"].includes(o)?e.jsx(q,{size:16,className:a.wordIcon}):e.jsx(lt,{size:16})},Ce=s=>{const d=Number(s);if(!d||isNaN(d))return"-";const o=["B","KB","MB","GB"];let b=d,t=0;for(;b>=1024&&t<o.length-1;)b/=1024,t++;return`${b.toFixed(1)} ${o[t]}`},Q=((Se=c==null?void 0:c.files)==null?void 0:Se.filter(s=>_===null?!0:_==="unassigned"?!s.matterId:s.matterId===_))||[],ne=Math.ceil(Q.length/K),Be=Q.slice(J*K,(J+1)*K),be=_==="unassigned"?"Unassigned":(Ie=(ke=c==null?void 0:c.matters)==null?void 0:ke.find(s=>s.id===_))==null?void 0:Ie.name;return r.useEffect(()=>{Y(0)},[_,y]),ce&&!c?e.jsx("div",{className:`${a.container} ${$||""}`,children:e.jsxs("div",{className:a.loading,children:[e.jsx(re,{size:32,className:a.spinner}),e.jsx("p",{children:"Loading documents..."})]})}):Fe?e.jsx("div",{className:`${a.container} ${$||""}`,children:e.jsxs("div",{className:a.error,children:[e.jsx(pt,{size:32}),e.jsx("p",{children:Fe}),e.jsxs("button",{onClick:()=>z(),className:a.retryBtn,children:[e.jsx(qe,{size:16})," Retry"]})]})}):e.jsxs("div",{className:`${a.container} ${$||""}`,children:[F&&e.jsxs("div",{className:a.header,children:[e.jsxs("h2",{children:[e.jsx(Te,{size:24}),"Documents",(c==null?void 0:c.isAdmin)&&e.jsx("span",{className:a.adminBadge,children:"Admin View"})]}),e.jsxs("div",{className:a.headerActions,children:[e.jsxs("button",{onClick:()=>M(!0),className:a.newFolderBtn,title:"Create new folder",children:[e.jsx(Ke,{size:16}),"New Folder"]}),e.jsxs("button",{onClick:()=>{var s;return(s=A.current)==null?void 0:s.click()},className:a.uploadBtn,title:"Upload files",disabled:ee,children:[e.jsx(xe,{size:16}),ee?"Uploading...":"Upload"]}),e.jsx("button",{onClick:()=>z(!0),className:a.refreshBtn,title:"Refresh",children:e.jsx(qe,{size:16})})]})]}),e.jsx("input",{ref:A,type:"file",multiple:!0,style:{display:"none"},onChange:T}),e.jsxs("div",{ref:se,className:`${a.content} ${G?a.dragOver:""}`,onDragEnter:Oe,onDragLeave:j,onDragOver:R,onDrop:Re,children:[G&&e.jsxs("div",{className:a.dragOverlay,children:[e.jsx(xe,{size:48}),e.jsx("p",{children:"Drop files here to upload"}),_&&_!=="unassigned"&&e.jsx("span",{className:a.dragHint,children:"Files will be added to the selected matter"})]}),ee&&V&&e.jsxs("div",{className:a.uploadProgress,children:[e.jsx(re,{size:16,className:a.spinner}),e.jsxs("span",{children:["Uploading ",V.current," of ",V.total,"..."]})]}),e.jsxs("div",{className:a.sidebar,children:[e.jsxs("div",{className:a.sidebarHeader,children:[e.jsx("span",{children:"Matters"}),(c==null?void 0:c.stats)&&e.jsxs("span",{className:a.statsCount,children:[c.stats.totalFiles," files"]})]}),e.jsxs("div",{className:a.folderTree,children:[e.jsxs("div",{className:`${a.folderRow} ${_===null?a.selected:""}`,onClick:()=>O(null),children:[e.jsx(Je,{size:16,className:a.folderIcon}),e.jsx("span",{className:a.folderName,children:"All Documents"})]}),(c==null?void 0:c.matters)&&c.matters.length>0&&e.jsxs("div",{className:a.matterSection,children:[e.jsx("div",{className:a.sectionLabel,children:"Matters"}),c.matters.map(s=>e.jsxs("div",{className:`${a.folderRow} ${_===s.id?a.selected:""}`,onClick:()=>O(s.id),style:{paddingLeft:"16px"},children:[e.jsx(he,{size:14,className:a.folderIcon}),e.jsxs("span",{className:a.folderName,title:s.name,children:[s.caseNumber?`${s.caseNumber} - `:"",s.name]})]},s.id))]}),(c==null?void 0:c.hasUnassigned)&&e.jsxs("div",{className:`${a.folderRow} ${_==="unassigned"?a.selected:""}`,onClick:()=>O("unassigned"),style:{paddingLeft:"16px",marginTop:"8px"},children:[e.jsx(tt,{size:14,className:a.folderIcon}),e.jsx("span",{className:a.folderName,children:"Unassigned"})]})]})]}),e.jsxs("div",{className:a.main,children:[e.jsxs("div",{className:a.breadcrumb,children:[e.jsxs("button",{onClick:()=>O(null),className:a.breadcrumbItem,children:[e.jsx(Je,{size:14}),e.jsx("span",{children:"All Documents"})]}),be&&e.jsxs(e.Fragment,{children:[e.jsx(st,{size:14,className:a.breadcrumbSep}),e.jsx("span",{className:a.breadcrumbItem,children:be})]})]}),ce&&e.jsxs("div",{className:a.refreshing,children:[e.jsx(re,{size:16,className:a.spinner}),e.jsx("span",{children:"Refreshing..."})]}),e.jsx("div",{className:a.searchBar,children:e.jsx("input",{type:"text",placeholder:"Search documents...",value:y,onChange:s=>W(s.target.value),className:a.searchInput})}),e.jsx("div",{className:a.documentsTable,children:e.jsxs("table",{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Name"}),e.jsx("th",{children:"Matter"}),e.jsx("th",{children:"Size"}),e.jsx("th",{children:"Actions"})]})}),e.jsx("tbody",{children:Be.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:4,className:a.emptyRow,children:e.jsxs("div",{className:a.emptyState,children:[e.jsx(Te,{size:32}),e.jsx("p",{children:(c==null?void 0:c.message)||"No documents found"}),e.jsx("p",{className:a.emptyHint,children:"Upload documents to your matters to see them here"})]})})}):Be.map(s=>e.jsxs("tr",{className:`${a.docRow} ${I===s.id?a.selectedDoc:""}`,onClick:()=>m==null?void 0:m(s),children:[e.jsx("td",{children:e.jsxs("div",{className:a.nameCell,children:[Ee(s.contentType,s.name),e.jsx("span",{className:a.docName,children:s.originalName||s.name}),s.isOwned&&e.jsx("span",{className:a.ownedBadge,title:"You own this document",children:"Owner"}),s.isShared&&!s.isOwned&&e.jsx("span",{className:a.sharedBadge,title:"Shared with you",children:"Shared"})]})}),e.jsx("td",{className:a.folderCell,children:s.matterName?e.jsxs("button",{className:a.folderLink,onClick:d=>{d.stopPropagation(),O(s.matterId)},title:s.matterName,children:[s.matterNumber?`${s.matterNumber} - `:"",s.matterName]}):e.jsx("span",{className:a.rootFolder,children:"Unassigned"})}),e.jsx("td",{children:Ce(s.size)}),e.jsx("td",{children:e.jsx("div",{className:a.rowActions,children:e.jsx("button",{className:a.downloadBtn,onClick:d=>de(s,d),disabled:fe===s.id,title:"Download",children:fe===s.id?e.jsx(re,{size:16,className:a.spinner}):e.jsx(We,{size:16})})})})]},s.id))})]})}),ne>1&&e.jsxs("div",{className:a.pagination,children:[e.jsx("button",{onClick:()=>Y(s=>Math.max(0,s-1)),disabled:J===0,className:a.pageBtn,children:"Previous"}),e.jsxs("span",{className:a.pageInfo,children:["Page ",J+1," of ",ne," (",Q.length," documents)"]}),e.jsx("button",{onClick:()=>Y(s=>Math.min(ne-1,s+1)),disabled:J>=ne-1,className:a.pageBtn,children:"Next"})]}),(c==null?void 0:c.stats)&&e.jsxs("div",{className:a.footer,children:[e.jsxs("span",{children:[Q.length," documents in this view"]}),e.jsx("span",{className:a.divider,children:"•"}),e.jsxs("span",{children:[c.stats.totalFiles," total files"]}),e.jsx("span",{className:a.divider,children:"•"}),e.jsx("span",{children:Ce(c.stats.totalSize)}),c.stats.totalMatters&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:a.divider,children:"•"}),e.jsxs("span",{children:[c.stats.totalMatters," matters"]})]})]})]})]}),ge&&e.jsx("div",{className:a.modalOverlay,onClick:()=>M(!1),children:e.jsxs("div",{className:a.modal,onClick:s=>s.stopPropagation(),children:[e.jsxs("div",{className:a.modalHeader,children:[e.jsxs("h3",{children:[e.jsx(Ke,{size:20}),"Create New Folder"]}),e.jsx("button",{className:a.modalClose,onClick:()=>M(!1),children:e.jsx(at,{size:18})})]}),e.jsxs("div",{className:a.modalBody,children:[e.jsxs("div",{className:a.formGroup,children:[e.jsx("label",{children:"Folder Name"}),e.jsx("input",{type:"text",value:X,onChange:s=>p(s.target.value),placeholder:"Enter folder name...",autoFocus:!0,onKeyDown:s=>{s.key==="Enter"&&ae(),s.key==="Escape"&&M(!1)}})]}),_&&_!=="unassigned"&&e.jsx("p",{className:a.folderHint,children:"This folder will be created inside the selected matter"}),ve&&e.jsx("p",{className:a.folderErrorMsg,children:ve})]}),e.jsxs("div",{className:a.modalFooter,children:[e.jsx("button",{className:a.cancelBtn,onClick:()=>M(!1),disabled:U,children:"Cancel"}),e.jsx("button",{className:a.createBtn,onClick:ae,disabled:U||!X.trim(),children:U?e.jsxs(e.Fragment,{children:[e.jsx(re,{size:14,className:a.spinner}),"Creating..."]}):e.jsxs(e.Fragment,{children:[e.jsx(ft,{size:14}),"Create Folder"]})})]})]})}),B&&e.jsxs("div",{className:a.contextMenu,style:{position:"fixed",left:B.x,top:B.y},onClick:s=>s.stopPropagation(),children:[e.jsxs("button",{className:a.contextMenuItem,onClick:()=>{Ne(B.id),g(B.name),P(null)},children:[e.jsx(nt,{size:14}),"Rename"]}),e.jsxs("button",{className:`${a.contextMenuItem} ${a.deleteItem}`,onClick:()=>{ye(B.id),P(null)},children:[e.jsx(rt,{size:14}),"Delete"]})]})]})}const Zs="_documentsPage_ltrlv_3",ea="_header_ltrlv_14",ta="_headerLeft_ltrlv_23",sa="_count_ltrlv_36",aa="_headerActions_ltrlv_41",na="_primaryBtn_ltrlv_48",ra="_secondaryBtn_ltrlv_73",oa="_textBtn_ltrlv_92",la="_bulkBtn_ltrlv_108",ca="_bulkBtnDanger_ltrlv_126",ia="_viewToggle_ltrlv_145",da="_viewBtn_ltrlv_153",ma="_viewBtnActive_ltrlv_170",ua="_categoryLayout_ltrlv_176",ha="_detailsPanel_ltrlv_183",xa="_sidebar_ltrlv_188",_a="_searchBox_ltrlv_194",pa="_categoryNav_ltrlv_229",fa="_categoryBtn_ltrlv_235",ga="_categoryActive_ltrlv_264",ja="_categoryCount_ltrlv_275",va="_quickStats_ltrlv_289",Na="_storageBar_ltrlv_306",wa="_storageUsed_ltrlv_314",ya="_storageText_ltrlv_321",Ca="_mainContent_ltrlv_327",Ba="_categoryHeader_ltrlv_333",ba="_selectAllBtn_ltrlv_347",Sa="_documentGrid_ltrlv_367",ka="_documentCard_ltrlv_374",Ia="_cardSelected_ltrlv_392",Da="_cardActive_ltrlv_397",za="_cardCheckbox_ltrlv_403",Aa="_cardIcon_ltrlv_420",Fa="_cardContent_ltrlv_430",Ma="_cardName_ltrlv_435",Ua="_confidentialIcon_ltrlv_448",La="_cardMeta_ltrlv_452",$a="_cardMatter_ltrlv_460",Oa="_cardSize_ltrlv_470",Ra="_cardDate_ltrlv_474",Ea="_cardActions_ltrlv_478",Pa="_cardAction_ltrlv_478",Ha="_matterList_ltrlv_510",Ga="_matterGroup_ltrlv_516",Ta="_matterHeader_ltrlv_523",Wa="_matterName_ltrlv_551",Va="_matterDocCount_ltrlv_555",Qa="_matterDocs_ltrlv_564",qa="_emptyState_ltrlv_572",Ka="_emptyUploadBtn_ltrlv_601",Ja="_folderBrowser_ltrlv_632",Ya="_modalOverlay_ltrlv_639",Xa="_modal_ltrlv_639",Za="_modalHeader_ltrlv_672",en="_closeBtn_ltrlv_687",tn="_modalForm_ltrlv_707",sn="_fileList_ltrlv_711",an="_fileItem_ltrlv_718",nn="_fileSize_ltrlv_734",rn="_formGroup_ltrlv_740",on="_modalActions_ltrlv_768",ln="_cancelBtn_ltrlv_776",cn="_saveBtn_ltrlv_791",dn="_spin_ltrlv_815",n={documentsPage:Zs,header:ea,headerLeft:ta,count:sa,headerActions:aa,primaryBtn:na,secondaryBtn:ra,textBtn:oa,bulkBtn:la,bulkBtnDanger:ca,viewToggle:ia,viewBtn:da,viewBtnActive:ma,categoryLayout:ua,detailsPanel:ha,sidebar:xa,searchBox:_a,categoryNav:pa,categoryBtn:fa,categoryActive:ga,categoryCount:ja,quickStats:va,storageBar:Na,storageUsed:wa,storageText:ya,mainContent:Ca,categoryHeader:Ba,selectAllBtn:ba,documentGrid:Sa,documentCard:ka,cardSelected:Ia,cardActive:Da,cardCheckbox:za,cardIcon:Aa,cardContent:Fa,cardName:Ma,confidentialIcon:Ua,cardMeta:La,cardMatter:$a,cardSize:Oa,cardDate:Ra,cardActions:Ea,cardAction:Pa,matterList:Ha,matterGroup:Ga,matterHeader:Ta,matterName:Wa,matterDocCount:Va,matterDocs:Qa,emptyState:qa,emptyUploadBtn:Ka,folderBrowser:Ja,modalOverlay:Ya,modal:Xa,modalHeader:Za,closeBtn:en,modalForm:tn,fileList:sn,fileItem:an,fileSize:nn,formGroup:rn,modalActions:on,cancelBtn:ln,saveBtn:cn,spin:dn},mn=(m,v)=>{var F;const I=((F=v==null?void 0:v.split(".").pop())==null?void 0:F.toLowerCase())||"";return m!=null&&m.includes("pdf")||I==="pdf"?{icon:q,color:"#EF4444"}:m!=null&&m.includes("word")||["doc","docx","odt","rtf"].includes(I)?{icon:q,color:"#2563EB"}:m!=null&&m.includes("spreadsheet")||m!=null&&m.includes("excel")||["xls","xlsx","csv"].includes(I)?{icon:ot,color:"#22C55E"}:m!=null&&m.includes("image")||["jpg","jpeg","png","gif","webp","svg"].includes(I)?{icon:It,color:"#A855F7"}:m!=null&&m.includes("presentation")||["ppt","pptx"].includes(I)?{icon:q,color:"#F97316"}:{icon:lt,color:"#64748B"}},Ge=m=>m?m<1024?`${m} B`:m<1024*1024?`${(m/1024).toFixed(1)} KB`:`${(m/1024/1024).toFixed(2)} MB`:"0 B";function Cn(){const m=At(),v=et(),{documents:I,matters:F,fetchDocuments:$,fetchMatters:ze,addDocument:le,deleteDocument:ce,documentsLoading:Ae,mattersLoading:Fe}=dt(),{setSelectedMode:_e,setDocumentContext:c,createConversation:pe,setInitialMessage:_}=_t(),{user:D}=mt(),fe=(D==null?void 0:D.role)==="owner"||(D==null?void 0:D.role)==="admin",{openChat:Me}=ut(),y=r.useRef(null),[W,K]=r.useState(!1),[J,Y]=r.useState(!1),[Ue,ge]=r.useState(!1),[M,X]=r.useState(""),[p,U]=r.useState("all"),[je,ve]=r.useState(new Set),[ie,B]=r.useState(!1),[P,Le]=r.useState([]),[Ne,$e]=r.useState(""),[g,H]=r.useState(null),[N,G]=r.useState(new Set),[Z,ee]=r.useState(!1),[we,V]=r.useState(!1),[te,se]=r.useState(!1),[A,z]=r.useState(()=>{const t=localStorage.getItem("documentsViewMode");return t==="categories"||t==="folders"?t:"categories"}),[de,O]=r.useState({isOpen:!1,docId:"",docName:""}),[ae,ye]=r.useState({isOpen:!1,documentId:"",documentName:""}),{emailDocument:Oe}=ht();r.useEffect(()=>{localStorage.setItem("documentsViewMode",A)},[A]),r.useEffect(()=>{$(),ze()},[$,ze]);const j=r.useMemo(()=>{const t=D==null?void 0:D.id,i=M.toLowerCase(),l=I.filter(h=>(h.originalName||h.name).toLowerCase().includes(i)||h.name.toLowerCase().includes(i)),u=l.filter(h=>h.uploadedBy===t),x=l.filter(h=>{var L,ue;return((L=h.sharedWith)==null?void 0:L.includes(t))||((ue=h.permissions)==null?void 0:ue.some(ct=>ct.userId===t))||h.isSharedWithMe}),w=F.filter(h=>{var L;return((L=h.teamMembers)==null?void 0:L.some(ue=>ue.id===t||ue.userId===t))||h.responsibleAttorney===t}).map(h=>h.id),f=l.filter(h=>h.matterId&&w.includes(h.matterId)),S=new Date;S.setDate(S.getDate()-30);const k=l.filter(h=>h.uploadedAt&&new Date(h.uploadedAt)>S).sort((h,L)=>new Date(L.uploadedAt).getTime()-new Date(h.uploadedAt).getTime()),Ve=l.filter(h=>h.isFavorite),Pe=new Map;return f.forEach(h=>{if(h.matterId){const L=Pe.get(h.matterId)||[];L.push(h),Pe.set(h.matterId,L)}}),{all:l,myUploads:u,sharedWithMe:x,matterDocs:f,byMatter:Pe,recentDocs:k,favorites:Ve,counts:{all:l.length,myUploads:u.length,shared:x.length,matter:f.length,recent:k.length,favorites:Ve.length}}},[I,F,D,M]),R=r.useMemo(()=>{switch(p){case"my-uploads":return j.myUploads;case"shared":return j.sharedWithMe;case"matter":return j.matterDocs;case"recent":return j.recentDocs;case"favorites":return j.favorites;default:return j.all}},[p,j]),Re=t=>{ve(i=>{const l=new Set(i);return l.has(t)?l.delete(t):l.add(t),l})},T=async(t,i)=>{i&&i.stopPropagation();const l="https://apexai-api.azurewebsites.net/api",u=localStorage.getItem("apex-access-token")||localStorage.getItem("token")||"";try{const x=await fetch(`${l}/documents/${t.id}/download`,{headers:{Authorization:`Bearer ${u}`}});if(x.ok){const w=await x.blob(),f=window.URL.createObjectURL(w),S=document.createElement("a");S.href=f,S.download=t.originalName||t.name,document.body.appendChild(S),S.click(),window.URL.revokeObjectURL(f),document.body.removeChild(S)}else v.error("Failed to download document")}catch(x){console.error("Download error:",x),v.error("Failed to download document")}},me=async(t,i=!0,l)=>{l&&l.stopPropagation();const u=[".doc",".docx",".odt",".rtf"],x=t.originalName||t.name;if(!u.some(f=>x.toLowerCase().endsWith(f))){v.warning("Word editing is only available for Word documents (.doc, .docx)");return}ge(!0);try{if(i){const f=await Qe.openDesktop(t.id);f.desktopUrl?window.open(f.desktopUrl,"_blank"):f.webUrl?window.open(f.webUrl,"_blank"):T(t)}else{const f=await Qe.openDocument(t.id);f.editUrl?window.open(f.editUrl,"_blank"):T(t)}}catch(f){console.error("Failed to open Word:",f),T(t)}finally{ge(!1)}},Ee=(t,i)=>{const l=I.find(u=>u.id===t);O({isOpen:!0,docId:t,docName:(l==null?void 0:l.name)||"this document"})},Ce=async()=>{try{await ce(de.docId),O({isOpen:!1,docId:"",docName:""}),H(null),oe(),$()}catch(t){console.error("Failed to delete document:",t),v.error("Failed to delete document")}},Q=(t,i)=>{i&&i.stopPropagation(),ye({isOpen:!0,documentId:t.id,documentName:t.name})},ne=t=>{const i=t.target.files;!i||i.length===0||(Le(Array.from(i)),B(!0),y.current&&(y.current.value=""))},Be=async()=>{if(P.length!==0){K(!0);try{for(const t of P)await le(t,{matterId:Ne||void 0});oe(),$(),B(!1),Le([]),$e(""),v.success(`Uploaded ${P.length} file(s)`)}catch(t){console.error("Upload failed:",t),v.error("Failed to upload file")}finally{K(!1)}}},be=(t,i)=>{i.stopPropagation(),G(l=>{const u=new Set(l);return u.has(t)?u.delete(t):u.add(t),u})},Se=()=>{N.size===R.length?G(new Set):G(new Set(R.map(t=>t.id)))},ke=()=>G(new Set),Ie=async()=>{if(N.size!==0){se(!0);try{const t="https://apexai-api.azurewebsites.net/api",i=localStorage.getItem("apex-access-token")||"";if(N.size===1){const l=Array.from(N)[0],u=I.find(x=>x.id===l);await T(u)}else{const l=await fetch(`${t}/documents/bulk-download`,{method:"POST",headers:{Authorization:`Bearer ${i}`,"Content-Type":"application/json"},body:JSON.stringify({documentIds:Array.from(N)})});if(l.ok){const u=await l.blob(),x=window.URL.createObjectURL(u),w=document.createElement("a");w.href=x,w.download=`documents-${new Date().toISOString().split("T")[0]}.zip`,document.body.appendChild(w),w.click(),window.URL.revokeObjectURL(x),document.body.removeChild(w)}}}catch{v.error("Failed to download documents")}finally{se(!1)}}},s=async()=>{if(N.size!==0){ee(!0);try{await Promise.all(Array.from(N).map(t=>ce(t))),V(!1),G(new Set),H(null),oe(),$()}catch{v.error("Failed to delete some documents")}finally{ee(!1)}}},d=async(t,i)=>{var l;Y(!0);try{const u="https://apexai-api.azurewebsites.net/api",x=localStorage.getItem("apex-access-token")||"";let w="";try{const f=await fetch(`${u}/documents/${t.id}/content`,{headers:{Authorization:`Bearer ${x}`}});if(f.ok){const S=await f.json();((l=S.content)==null?void 0:l.trim().length)>50&&(w=S.content)}}catch{}w||(w=`[Document: ${t.name}]
Type: ${t.type}
Size: ${Ge(t.size)}

Unable to extract text content.`),_e("document"),c({id:t.id,name:t.name,content:w,type:t.type,size:t.size}),pe("document"),H(null),m("/app/ai")}catch{v.error("Failed to analyze document")}finally{Y(!1)}},o=t=>{var i;return t?(i=F.find(l=>l.id===t))==null?void 0:i.name:null},b=({doc:t,showMatter:i=!0})=>{const l=mn(t.type,t.originalName||t.name),u=l.icon,x=N.has(t.id),w=(g==null?void 0:g.id)===t.id,S=[".doc",".docx",".odt",".rtf"].some(k=>(t.originalName||t.name).toLowerCase().endsWith(k));return e.jsxs("div",{className:E(n.documentCard,x&&n.cardSelected,w&&n.cardActive),onClick:()=>H(t),children:[e.jsx("div",{className:n.cardCheckbox,onClick:k=>be(t.id,k),children:x?e.jsx(Ye,{size:18}):e.jsx(Xe,{size:18})}),e.jsx("div",{className:n.cardIcon,style:{backgroundColor:`${l.color}15`,color:l.color},children:e.jsx(u,{size:24})}),e.jsxs("div",{className:n.cardContent,children:[e.jsxs("div",{className:n.cardName,children:[t.originalName||t.name,t.isConfidential&&e.jsx(bt,{size:12,className:n.confidentialIcon})]}),e.jsxs("div",{className:n.cardMeta,children:[i&&t.matterId&&e.jsxs("span",{className:n.cardMatter,children:[e.jsx(he,{size:12}),o(t.matterId)]}),e.jsx("span",{className:n.cardSize,children:Ge(t.size)}),e.jsx("span",{className:n.cardDate,children:t.uploadedAt?Ft(Mt(t.uploadedAt),{addSuffix:!0}):""})]})]}),e.jsxs("div",{className:n.cardActions,children:[S&&e.jsx("button",{className:n.cardAction,onClick:k=>me(t,!0,k),title:"Edit in Word",children:e.jsx(nt,{size:16})}),e.jsx("button",{className:n.cardAction,onClick:k=>{k.stopPropagation(),d(t)},title:"Analyze with AI",children:e.jsx(St,{size:16})}),e.jsx("button",{className:n.cardAction,onClick:k=>Q(t,k),title:"Share",children:e.jsx(kt,{size:16})}),e.jsx("button",{className:n.cardAction,onClick:k=>T(t,k),title:"Download",children:e.jsx(We,{size:16})})]})]})};return e.jsxs("div",{className:n.documentsPage,children:[e.jsxs("div",{className:n.header,children:[e.jsxs("div",{className:n.headerLeft,children:[e.jsx("h1",{children:"Documents"}),e.jsxs("span",{className:n.count,children:[j.counts.all," files"]})]}),e.jsx("div",{className:n.headerActions,children:N.size>0?e.jsxs(e.Fragment,{children:[e.jsxs("button",{className:n.bulkBtn,onClick:Ie,disabled:te,children:[te?e.jsx(re,{size:18,className:n.spin}):e.jsx(We,{size:18}),"Download (",N.size,")"]}),e.jsxs("button",{className:n.bulkBtnDanger,onClick:()=>V(!0),disabled:Z,children:[e.jsx(rt,{size:18}),"Delete (",N.size,")"]}),e.jsxs("button",{className:n.textBtn,onClick:ke,children:[e.jsx(at,{size:18}),"Clear"]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:n.viewToggle,children:[e.jsx("button",{className:E(n.viewBtn,A==="categories"&&n.viewBtnActive),onClick:()=>z("categories"),title:"Category view",children:e.jsx(jt,{size:16})}),e.jsx("button",{className:E(n.viewBtn,A==="folders"&&n.viewBtnActive),onClick:()=>z("folders"),title:"Folder view",children:e.jsx(tt,{size:16})})]}),fe&&e.jsxs("button",{className:n.secondaryBtn,onClick:()=>m("/app/documents/permissions"),children:[e.jsx(vt,{size:18}),"Permissions"]}),e.jsxs("button",{className:n.primaryBtn,onClick:()=>{var t;return(t=y.current)==null?void 0:t.click()},disabled:W,children:[e.jsx(xe,{size:18}),W?"Uploading...":"Upload"]}),e.jsx("input",{ref:y,type:"file",multiple:!0,style:{display:"none"},onChange:ne})]})})]}),A==="categories"&&e.jsxs("div",{className:n.categoryLayout,children:[e.jsxs("div",{className:n.sidebar,children:[e.jsxs("div",{className:n.searchBox,children:[e.jsx(Nt,{size:18}),e.jsx("input",{type:"text",placeholder:"Search documents...",value:M,onChange:t=>X(t.target.value)})]}),e.jsxs("nav",{className:n.categoryNav,children:[e.jsxs("button",{className:E(n.categoryBtn,p==="all"&&n.categoryActive),onClick:()=>U("all"),children:[e.jsx(Te,{size:18}),e.jsx("span",{children:"All Documents"}),e.jsx("span",{className:n.categoryCount,children:j.counts.all})]}),e.jsxs("button",{className:E(n.categoryBtn,p==="recent"&&n.categoryActive),onClick:()=>U("recent"),children:[e.jsx(wt,{size:18}),e.jsx("span",{children:"Recent"}),e.jsx("span",{className:n.categoryCount,children:j.counts.recent})]}),e.jsxs("button",{className:E(n.categoryBtn,p==="my-uploads"&&n.categoryActive),onClick:()=>U("my-uploads"),children:[e.jsx(xe,{size:18}),e.jsx("span",{children:"My Uploads"}),e.jsx("span",{className:n.categoryCount,children:j.counts.myUploads})]}),e.jsxs("button",{className:E(n.categoryBtn,p==="shared"&&n.categoryActive),onClick:()=>U("shared"),children:[e.jsx(yt,{size:18}),e.jsx("span",{children:"Shared With Me"}),e.jsx("span",{className:n.categoryCount,children:j.counts.shared})]}),e.jsxs("button",{className:E(n.categoryBtn,p==="matter"&&n.categoryActive),onClick:()=>U("matter"),children:[e.jsx(he,{size:18}),e.jsx("span",{children:"Matter Documents"}),e.jsx("span",{className:n.categoryCount,children:j.counts.matter})]}),e.jsxs("button",{className:E(n.categoryBtn,p==="favorites"&&n.categoryActive),onClick:()=>U("favorites"),children:[e.jsx(Ct,{size:18}),e.jsx("span",{children:"Favorites"}),e.jsx("span",{className:n.categoryCount,children:j.counts.favorites})]})]}),e.jsxs("div",{className:n.quickStats,children:[e.jsx("h4",{children:"Storage"}),e.jsx("div",{className:n.storageBar,children:e.jsx("div",{className:n.storageUsed,style:{width:"35%"}})}),e.jsx("span",{className:n.storageText,children:"3.5 GB of 10 GB used"})]})]}),e.jsxs("div",{className:n.mainContent,children:[e.jsxs("div",{className:n.categoryHeader,children:[e.jsxs("h2",{children:[p==="all"&&"All Documents",p==="recent"&&"Recent Documents",p==="my-uploads"&&"My Uploads",p==="shared"&&"Shared With Me",p==="matter"&&"Matter Documents",p==="favorites"&&"Favorites"]}),R.length>0&&e.jsxs("button",{className:n.selectAllBtn,onClick:Se,children:[N.size===R.length?e.jsx(Ye,{size:16}):e.jsx(Xe,{size:16}),N.size===R.length?"Deselect All":"Select All"]})]}),p==="matter"?e.jsxs("div",{className:n.matterList,children:[Array.from(j.byMatter.entries()).map(([t,i])=>{const l=F.find(x=>x.id===t),u=je.has(t);return e.jsxs("div",{className:n.matterGroup,children:[e.jsxs("button",{className:n.matterHeader,onClick:()=>Re(t),children:[u?e.jsx(Bt,{size:18}):e.jsx(st,{size:18}),e.jsx(he,{size:18}),e.jsx("span",{className:n.matterName,children:(l==null?void 0:l.name)||"Unknown Matter"}),e.jsxs("span",{className:n.matterDocCount,children:[i.length," docs"]})]}),u&&e.jsx("div",{className:n.matterDocs,children:i.map(x=>e.jsx(b,{doc:x,showMatter:!1},x.id))})]},t)}),j.byMatter.size===0&&e.jsxs("div",{className:n.emptyState,children:[e.jsx(he,{size:48}),e.jsx("h3",{children:"No Matter Documents"}),e.jsx("p",{children:"Documents from your assigned matters will appear here."})]})]}):e.jsxs("div",{className:n.documentGrid,children:[R.map(t=>e.jsx(b,{doc:t},t.id)),R.length===0&&e.jsxs("div",{className:n.emptyState,children:[e.jsx(q,{size:48}),e.jsx("h3",{children:"No Documents"}),e.jsxs("p",{children:[p==="my-uploads"&&"Documents you upload will appear here.",p==="shared"&&"Documents shared with you will appear here.",p==="favorites"&&"Star documents to add them to favorites.",p==="recent"&&"Recently accessed documents will appear here.",p==="all"&&"Upload your first document to get started."]}),e.jsxs("button",{className:n.emptyUploadBtn,onClick:()=>{var t;return(t=y.current)==null?void 0:t.click()},children:[e.jsx(xe,{size:18}),"Upload Document"]})]})]})]}),g&&e.jsx("div",{className:n.detailsPanel,children:e.jsx(Dt,{document:g,onClose:()=>H(null),onOpenInWord:t=>me(g,t),onDownload:()=>T(g),onDelete:()=>Ee(g.id),onShare:()=>Q(g),onAnalyze:()=>d(g),onEmail:()=>Oe({id:g.id,name:g.name,size:g.size})})})]}),A==="folders"&&e.jsx(xt,{children:e.jsx(Xs,{showHeader:!1,className:n.folderBrowser,onDocumentSelect:t=>{const i=I.find(l=>l.id===t.id);H(i||t)},selectedDocumentId:g==null?void 0:g.id})}),ie&&e.jsx("div",{className:n.modalOverlay,onClick:()=>B(!1),children:e.jsxs("div",{className:n.modal,onClick:t=>t.stopPropagation(),children:[e.jsxs("div",{className:n.modalHeader,children:[e.jsx("h2",{children:"Upload Documents"}),e.jsx("button",{onClick:()=>B(!1),className:n.closeBtn,children:"×"})]}),e.jsxs("div",{className:n.modalForm,children:[e.jsx("div",{className:n.fileList,children:P.map((t,i)=>e.jsxs("div",{className:n.fileItem,children:[e.jsx(q,{size:16}),e.jsx("span",{children:t.name}),e.jsxs("span",{className:n.fileSize,children:["(",Ge(t.size),")"]})]},i))}),e.jsxs("div",{className:n.formGroup,children:[e.jsx("label",{children:"Attach to Matter (optional)"}),e.jsxs("select",{value:Ne,onChange:t=>$e(t.target.value),children:[e.jsx("option",{value:"",children:"No matter selected"}),F.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]})]}),e.jsxs("div",{className:n.modalActions,children:[e.jsx("button",{onClick:()=>B(!1),className:n.cancelBtn,disabled:W,children:"Cancel"}),e.jsx("button",{onClick:Be,className:n.saveBtn,disabled:W,children:W?"Uploading...":"Upload"})]})]})]})}),e.jsx(Ze,{isOpen:de.isOpen,title:"Delete Document",message:`Are you sure you want to delete "${de.docName}"? This action cannot be undone.`,confirmText:"Delete",onConfirm:Ce,onClose:()=>O({isOpen:!1,docId:"",docName:""}),type:"danger"}),e.jsx(Ze,{isOpen:we,title:"Delete Documents",message:`Are you sure you want to delete ${N.size} document(s)? This action cannot be undone.`,confirmText:"Delete All",onConfirm:s,onClose:()=>V(!1),type:"danger",isLoading:Z}),e.jsx(zt,{isOpen:ae.isOpen,onClose:()=>ye({isOpen:!1,documentId:"",documentName:""}),documentId:ae.documentId,documentName:ae.documentName})]})}export{Cn as DocumentsPage};
