import{r as o,a6 as e}from"./vendor-DrKzkH4x.js";import{w as N,d as Xe,k as ee,t as Je,l as Ze}from"./index-CCWWoMiH.js";import{a as es}from"./router-CNLU_KyZ.js";import{aU as be,X as Q,$ as te,L as P,aV as Be,aP as ae,E as le,R as se,aB as de,K as ss,a6 as ns,a7 as ts,C as ue,a as he,ak as oe,ae as _e,M as Ae,S as as,v as Ee,aW as me,aE as Pe,J as Re,F as Ce,Y as os,f as is,aK as rs,t as Le,y as De,a4 as Fe,ax as cs,ay as ls,aX as ds}from"./icons-BtUkkwGS.js";import{a as xe,p as ne,f as Te}from"./date-utils-BkNAU8cl.js";function us(i){const{documentId:m,enabled:j=!0,pollInterval:R=15e3,onVersionCreated:S}=i,[D,x]=o.useState({isSyncing:!1,lastSyncAt:null,lastSyncVersion:null,hasChanges:!1,error:null}),z=o.useRef(null),g=o.useRef(!1),L=o.useCallback(async()=>{var u;if(!(!m||g.current)){g.current=!0;try{const l=await N.pollSync(m);l.synced&&l.versionNumber?(x(k=>({...k,lastSyncAt:new Date,lastSyncVersion:l.versionNumber,hasChanges:!1,error:null})),S&&S(l.versionNumber)):l.hasChanges&&x(k=>({...k,hasChanges:!0}))}catch(l){l.status!==404&&!((u=l.message)!=null&&u.includes("token"))&&(console.error("Word sync poll error:",l),x(k=>({...k,error:l.message||"Sync failed"})))}finally{g.current=!1}}},[m,S]),h=o.useCallback(async()=>{if(!m)return{success:!1,error:"No document"};x(u=>({...u,isSyncing:!0,error:null}));try{const u=await N.saveFromWord(m);return u.saved?(x(l=>({...l,isSyncing:!1,lastSyncAt:new Date,lastSyncVersion:u.versionNumber,hasChanges:!1,error:null})),S&&S(u.versionNumber),{success:!0,versionNumber:u.versionNumber}):(x(l=>({...l,isSyncing:!1,hasChanges:!1})),{success:!0,message:u.message||"No changes to sync"})}catch(u){return x(l=>({...l,isSyncing:!1,error:u.message||"Sync failed"})),{success:!1,error:u.message}}},[m,S]),w=o.useCallback(()=>{z.current||(L(),z.current=setInterval(L,R))},[L,R]),I=o.useCallback(()=>{z.current&&(clearInterval(z.current),z.current=null)},[]);return o.useEffect(()=>(j&&m?w():I(),()=>I()),[j,m,w,I]),o.useEffect(()=>{if(!j||!m)return;const u=setInterval(async()=>{try{await N.refreshToken()}catch(l){console.log("Token refresh skipped:",l)}},45*60*1e3);return()=>clearInterval(u)},[j,m]),{...D,syncNow:h,startPolling:w,stopPolling:I,isPolling:!!z.current}}const hs="_panel_ojx4z_2",ms="_header_ojx4z_30",xs="_headerTitle_ojx4z_39",_s="_docInfo_ojx4z_52",ps="_meta_ojx4z_67",js="_closeBtn_ojx4z_72",vs="_lockStatus_ojx4z_93",fs="_lockedStatus_ojx4z_102",ks="_unlockedStatus_ojx4z_106",ys="_lockInfo_ojx4z_110",Ns="_lockExpiry_ojx4z_136",gs="_lockBtn_ojx4z_141",ws="_unlockBtn_ojx4z_141",Ss="_quickActions_ojx4z_182",zs="_openWordBtn_ojx4z_189",bs="_wordOnlineBtn_ojx4z_211",Bs="_syncFromWordBtn_ojx4z_234",Cs="_openBtn_ojx4z_257",Ls="_downloadBtn_ojx4z_279",Is="_syncStatus_ojx4z_304",As="_syncInfo_ojx4z_312",Es="_syncNowBtn_ojx4z_331",Ps="_syncError_ojx4z_350",Rs="_secondaryActions_ojx4z_362",Ds="_actionButton_ojx4z_370",Fs="_aiButton_ojx4z_395",Ts="_deleteButton_ojx4z_416",$s="_compareSection_ojx4z_438",Os="_compareSectionHeader_ojx4z_444",Us="_compareHint_ojx4z_456",Ws="_compareActions_ojx4z_462",Hs="_selectedInfo_ojx4z_469",Vs="_compareBtn_ojx4z_475",Ms="_compareWordBtn_ojx4z_499",qs="_clearBtn_ojx4z_523",Gs="_redlineSection_ojx4z_540",Ks="_redlineHeader_ojx4z_550",Ys="_redlineStats_ojx4z_565",Qs="_additions_ojx4z_572",Xs="_deletions_ojx4z_576",Js="_closeRedlineBtn_ojx4z_580",Zs="_redlineContent_ojx4z_594",en="_versionList_ojx4z_618",sn="_versionListHeader_ojx4z_625",nn="_refreshBtn_ojx4z_641",tn="_timeline_ojx4z_665",an="_versionItem_ojx4z_671",on="_selected_ojx4z_469",rn="_latest_ojx4z_684",cn="_versionContent_ojx4z_684",ln="_timelineConnector_ojx4z_688",dn="_timelineDot_ojx4z_697",un="_timelineLine_ojx4z_709",hn="_versionHeader_ojx4z_730",mn="_versionMeta_ojx4z_738",xn="_versionNumber_ojx4z_744",_n="_latestBadge_ojx4z_753",pn="_versionTime_ojx4z_764",jn="_selectBtn_ojx4z_769",vn="_selectedBtn_ojx4z_789",fn="_versionDetails_ojx4z_796",kn="_editorInfo_ojx4z_804",yn="_changeInfo_ojx4z_816",Nn="_changeType_ojx4z_823",gn="_source_ojx4z_827",wn="_expandedDetails_ojx4z_832",Sn="_detailRow_ojx4z_841",zn="_wordStats_ojx4z_854",bn="_added_ojx4z_861",Bn="_removed_ojx4z_865",Cn="_versionLabel_ojx4z_869",Ln="_versionActions_ojx4z_876",In="_downloadVersionBtn_ojx4z_885",An="_downloadFilename_ojx4z_917",En="_fileAvailable_ojx4z_931",Pn="_textOnly_ojx4z_937",Rn="_versionFileSize_ojx4z_943",Dn="_downloadDisabled_ojx4z_951",Fn="_expandToggle_ojx4z_957",Tn="_loading_ojx4z_978",$n="_error_ojx4z_979",On="_empty_ojx4z_980",Un="_footer_ojx4z_1027",Wn="_integrationHint_ojx4z_1033",Hn="_spinner_ojx4z_1062",Vn="_explorerBtn_ojx4z_1072",Mn="_explorerPathDialog_ojx4z_1094",qn="_explorerPathHeader_ojx4z_1108",Gn="_closePathBtn_ojx4z_1128",Kn="_explorerPathContent_ojx4z_1146",Yn="_pathBox_ojx4z_1153",Qn="_copyPathBtn_ojx4z_1172",Xn="_explorerHint_ojx4z_1188",Jn="_setupLink_ojx4z_1193",n={panel:hs,header:ms,headerTitle:xs,docInfo:_s,meta:ps,closeBtn:js,lockStatus:vs,lockedStatus:fs,unlockedStatus:ks,lockInfo:ys,lockExpiry:Ns,lockBtn:gs,unlockBtn:ws,quickActions:Ss,openWordBtn:zs,wordOnlineBtn:bs,syncFromWordBtn:Bs,openBtn:Cs,downloadBtn:Ls,syncStatus:Is,syncInfo:As,syncNowBtn:Es,syncError:Ps,secondaryActions:Rs,actionButton:Ds,aiButton:Fs,deleteButton:Ts,compareSection:$s,compareSectionHeader:Os,compareHint:Us,compareActions:Ws,selectedInfo:Hs,compareBtn:Vs,compareWordBtn:Ms,clearBtn:qs,redlineSection:Gs,redlineHeader:Ks,redlineStats:Ys,additions:Qs,deletions:Xs,closeRedlineBtn:Js,redlineContent:Zs,versionList:en,versionListHeader:sn,refreshBtn:nn,timeline:tn,versionItem:an,selected:on,latest:rn,versionContent:cn,timelineConnector:ln,timelineDot:dn,timelineLine:un,versionHeader:hn,versionMeta:mn,versionNumber:xn,latestBadge:_n,versionTime:pn,selectBtn:jn,selectedBtn:vn,versionDetails:fn,editorInfo:kn,changeInfo:yn,changeType:Nn,source:gn,expandedDetails:wn,detailRow:Sn,wordStats:zn,added:bn,removed:Bn,versionLabel:Cn,versionActions:Ln,downloadVersionBtn:In,downloadFilename:An,fileAvailable:En,textOnly:Pn,versionFileSize:Rn,downloadDisabled:Dn,expandToggle:Fn,loading:Tn,error:$n,empty:On,footer:Un,integrationHint:Wn,spinner:Hn,explorerBtn:Vn,explorerPathDialog:Mn,explorerPathHeader:qn,closePathBtn:Gn,explorerPathContent:Kn,pathBox:Yn,copyPathBtn:Qn,explorerHint:Xn,setupLink:Jn};function ta({document:i,onClose:m,onOpenInWord:j,onDownload:R,onShare:S,onEmail:D,onAnalyze:x,onDelete:z,onPreview:g}){const L=es(),h=Xe(),[w,I]=o.useState([]),[u,l]=o.useState(!0),[k,A]=o.useState(null),[B,q]=o.useState(!1),[C,b]=o.useState(!1),[v,F]=o.useState([]),[T,U]=o.useState(!1),[W,H]=o.useState(null),[ie,$]=o.useState(!1),[re,X]=o.useState(null),[J,Z]=o.useState(null),[G,t]=o.useState("Z"),[_,O]=o.useState(!1),[y,pe]=o.useState(null),[je,ve]=o.useState(!1),[fe,ke]=o.useState(!1);o.useEffect(()=>{ee.getDrivePreference().then(s=>{s.driveLetter&&t(s.driveLetter)}).catch(()=>{})},[]);const $e=()=>{const s=i.folderPath||i.externalPath||"",r=i.originalName||i.name;let c="";s?c=`${s.replace(/^\/+/,"").replace(/\//g,"\\")}\\${r}`:c=r;const f=`firmdocs://${c.replace(/\\/g,"/")}`,d=window.document.createElement("iframe");d.style.display="none",window.document.body.appendChild(d);const p=setTimeout(()=>{window.document.body.removeChild(d),O(!0)},1500);try{d.contentWindow&&(d.contentWindow.location.href=f),setTimeout(()=>{clearTimeout(p);try{window.document.body.removeChild(d)}catch{}},2e3)}catch{clearTimeout(p);try{window.document.body.removeChild(d)}catch{}O(!0)}},ye=()=>{const s=i.folderPath||i.externalPath||"",r=i.originalName||i.name;if(s){const c=s.replace(/^\/+/,"").replace(/\//g,"\\");return`${G}:\\${c}\\${r}`}return`${G}:\\${r}`};o.useEffect(()=>{const s=[".doc",".docx",".odt",".rtf"],r=i.name||i.originalName||"";b(s.some(c=>r.toLowerCase().endsWith(c)))},[i]);const V=o.useCallback(async()=>{try{const s=await ee.getLockStatus(i.id);pe(s)}catch(s){console.error("Failed to fetch lock status:",s),pe(null)}},[i.id]);o.useEffect(()=>{V();const s=setInterval(V,3e4);return()=>clearInterval(s)},[V]);const Oe=async()=>{ve(!0);try{await ee.acquireLock(i.id,"edit"),await V()}catch(s){s.status===423?(await V(),h.info(`This document is currently being edited by ${(y==null?void 0:y.lockedByName)||"another user"}.`)):h.info("Failed to acquire lock: "+(s.message||"Unknown error"))}finally{ve(!1)}},Ue=async()=>{ke(!0);try{await ee.releaseLock(i.id),await V()}catch(s){h.info("Failed to release lock: "+(s.message||"Unknown error"))}finally{ke(!1)}},[Qt,Xt]=o.useState(!0),{isSyncing:We,lastSyncAt:Ne,lastSyncVersion:ge,hasChanges:He,syncNow:Ve,error:we}=us({documentId:C?i.id:null,enabled:C,pollInterval:15e3,onVersionCreated:s=>{M()}}),M=o.useCallback(async()=>{l(!0),A(null);try{const s=await N.getVersionHistory(i.id);I(s.versions||[]),q(s.hasMicrosoftIntegration)}catch(s){console.error("Failed to fetch versions:",s),A("Could not load version history"),I([])}finally{l(!1)}},[i.id]);o.useEffect(()=>{M()},[M]);const Me=s=>{F(r=>r.includes(s)?r.filter(c=>c!==s):r.length<2?[...r,s].sort((c,f)=>c-f):[r[1],s].sort((c,f)=>c-f)),H(null),$(!1)},qe=async()=>{if(v.length===2){U(!0);try{const s=await N.getRedline(i.id,v[0],v[1]);H({html:s.redline.html,stats:s.redline.stats}),$(!0)}catch(s){console.error("Failed to compare versions:",s),A("Could not generate comparison")}finally{U(!1)}}},Ge=s=>{switch(s){case"upload":return{icon:rs,color:"#22c55e",label:"Uploaded"};case"edit":return{icon:ae,color:"#3b82f6",label:"Edited"};case"restore":return{icon:se,color:"#f59e0b",label:"Restored"};case"auto_save":return{icon:ue,color:"#8b5cf6",label:"Auto-saved"};default:return{icon:Ce,color:"#64748b",label:"Modified"}}},Ke=s=>{switch(s){case"word_online":return"Word Online";case"apex":return"Apex";case"upload":return"Upload";case"external_sync":return"External Sync";default:return s}},Se=s=>s?s<1024?`${s} B`:s<1024*1024?`${(s/1024).toFixed(1)} KB`:`${(s/1024/1024).toFixed(2)} MB`:"0 B",ce=s=>{const r=i.originalName||i.name,c=r.includes(".")?r.substring(r.lastIndexOf(".")):"",f=r.includes(".")?r.substring(0,r.lastIndexOf(".")):r,d=s.createdByName||"Unknown",E=new Date(s.createdAt).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"});return`${f} - ${d} - ${E}${c}`},Ye=async s=>{Z(s.versionNumber);try{const{blob:r,filename:c}=await N.downloadVersion(i.id,s.versionNumber),f=window.URL.createObjectURL(r),d=window.document.createElement("a");d.href=f,d.download=c||ce(s),window.document.body.appendChild(d),d.click(),window.URL.revokeObjectURL(f),window.document.body.removeChild(d)}catch(r){console.error("Failed to download version:",r),A(`Could not download version ${s.versionNumber}. ${r.message||""}`)}finally{Z(null)}};return e.jsxs("div",{className:n.panel,children:[e.jsxs("div",{className:n.header,children:[e.jsxs("div",{className:n.headerTitle,children:[e.jsx(be,{size:20}),e.jsxs("div",{className:n.docInfo,children:[e.jsx("h3",{children:i.originalName||i.name}),e.jsxs("span",{className:n.meta,children:[Se(i.size),i.matterName&&` • ${i.matterName}`]})]})]}),e.jsx("button",{className:n.closeBtn,onClick:m,children:e.jsx(Q,{size:18})})]}),y&&e.jsx("div",{className:`${n.lockStatus} ${y.locked?n.lockedStatus:n.unlockedStatus}`,children:y.locked?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:n.lockInfo,children:[e.jsx(te,{size:16}),e.jsx("span",{children:y.isOwnLock?"You have this document locked":`Locked by ${y.lockedByName}`}),y.expiresAt&&e.jsxs("span",{className:n.lockExpiry,children:["• Expires ",xe(ne(y.expiresAt),{addSuffix:!0})]})]}),y.isOwnLock&&e.jsxs("button",{className:n.unlockBtn,onClick:Ue,disabled:fe,children:[fe?e.jsx(P,{size:14,className:n.spinner}):e.jsx(Be,{size:14}),"Release Lock"]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:n.lockInfo,children:[e.jsx(Be,{size:16}),e.jsx("span",{children:"Document is unlocked"})]}),C&&e.jsxs("button",{className:n.lockBtn,onClick:Oe,disabled:je,children:[je?e.jsx(P,{size:14,className:n.spinner}):e.jsx(te,{size:14}),"Lock for Editing"]})]})}),e.jsxs("div",{className:n.quickActions,children:[C?e.jsxs(e.Fragment,{children:[e.jsxs("button",{className:n.openWordBtn,onClick:()=>j(!0),children:[e.jsx(ae,{size:16}),"Open in Word"]}),e.jsxs("button",{className:n.wordOnlineBtn,onClick:async()=>{try{const s=await N.openDocument(i.id);console.log("[Word Online] API response:",s),s.editUrl&&!s.editUrl.includes("office.com/edit/")?window.open(s.editUrl,"_blank"):s.needsMicrosoftAuth?h.info("Please connect Microsoft 365 in Settings → Integrations first."):s.downloadUrl?confirm("Word Online is not available. Download the document instead?")&&R():h.error("Could not open Word Online",s.message||"Try downloading instead.")}catch(s){console.error("Word Online error:",s),h.info("Could not connect to Word Online. Try downloading instead.")}},children:[e.jsx(le,{size:16}),"Word Online"]}),e.jsxs("button",{className:n.syncFromWordBtn,onClick:async()=>{try{const s=await N.saveFromWord(i.id);s.saved?(h.info(`✓ Synced! Created Version ${s.versionNumber}`),M()):s.reason==="no_changes"?h.info("No changes detected. The document is already up to date."):s.needsReauth?h.info("Please reconnect Microsoft 365 in Settings → Integrations."):h.error("Could not sync",s.message||"Make sure you saved in Word Online first.")}catch(s){console.error("Sync error:",s),s.status===404?h.info("This document hasn't been opened in Word Online yet. Open it first, make changes, then sync."):h.info("Sync failed: "+(s.message||"Unknown error"))}},title:"Pull latest changes from Word Online",children:[e.jsx(se,{size:16}),"Sync from Word"]})]}):e.jsxs("button",{className:n.openBtn,onClick:()=>j(),children:[e.jsx(le,{size:16}),"Open File"]}),e.jsxs("button",{className:n.downloadBtn,onClick:R,children:[e.jsx(de,{size:16}),"Download"]}),e.jsxs("button",{className:n.explorerBtn,onClick:$e,title:"Open in File Explorer (Windows) or Finder (Mac)",children:[e.jsx(ss,{size:16}),"Open in Explorer"]})]}),_&&e.jsxs("div",{className:n.explorerPathDialog,children:[e.jsxs("div",{className:n.explorerPathHeader,children:[e.jsx(ns,{size:16}),e.jsx("span",{children:"Open in File Explorer"}),e.jsx("button",{className:n.closePathBtn,onClick:()=>O(!1),children:e.jsx(Q,{size:14})})]}),e.jsxs("div",{className:n.explorerPathContent,children:[e.jsx("p",{children:"To open this file in your computer's file explorer, copy the path below:"}),e.jsxs("div",{className:n.pathBox,children:[e.jsx("code",{children:ye()}),e.jsx("button",{onClick:()=>{navigator.clipboard.writeText(ye())},className:n.copyPathBtn,children:"Copy"})]}),e.jsxs("p",{className:n.explorerHint,children:[e.jsx("strong",{children:"Tip:"})," Set up your Apex Drive to access files directly.",e.jsx("a",{href:"/app/settings/drive-setup",onClick:()=>L("/app/settings/drive-setup"),className:n.setupLink,children:"Set up Drive →"})]})]})]}),C&&e.jsxs("div",{className:n.syncStatus,children:[e.jsx("div",{className:n.syncInfo,children:We?e.jsxs(e.Fragment,{children:[e.jsx(P,{size:14,className:n.spinner}),e.jsx("span",{children:"Syncing changes from Word..."})]}):He?e.jsxs(e.Fragment,{children:[e.jsx(ts,{size:14}),e.jsx("span",{children:"Changes detected in Word"}),e.jsx("button",{className:n.syncNowBtn,onClick:Ve,children:"Sync Now"})]}):Ne?e.jsxs(e.Fragment,{children:[e.jsx(ue,{size:14}),e.jsxs("span",{children:["Synced ",xe(Ne,{addSuffix:!0}),ge&&` (v${ge})`]})]}):e.jsxs(e.Fragment,{children:[e.jsx(se,{size:14,className:n.spinner}),e.jsx("span",{children:"Auto-sync enabled - edit in Word, changes sync automatically"})]})}),we&&e.jsxs("div",{className:n.syncError,children:[e.jsx(he,{size:12}),e.jsx("span",{children:we})]})]}),e.jsxs("div",{className:n.secondaryActions,children:[g&&e.jsxs("button",{className:n.actionButton,onClick:g,title:"Preview document content",children:[e.jsx(oe,{size:15}),e.jsx("span",{children:"Preview"})]}),S&&e.jsxs("button",{className:n.actionButton,onClick:S,title:"Share with team members",children:[e.jsx(_e,{size:15}),e.jsx("span",{children:"Share"})]}),D&&e.jsxs("button",{className:n.actionButton,onClick:D,title:"Email as attachment",children:[e.jsx(Ae,{size:15}),e.jsx("span",{children:"Email"})]}),x&&e.jsxs("button",{className:n.aiButton,onClick:x,title:"Analyze with AI",children:[e.jsx(as,{size:15}),e.jsx("span",{children:"AI Analysis"})]}),z&&e.jsxs("button",{className:n.deleteButton,onClick:z,title:"Delete document",children:[e.jsx(Ee,{size:15}),e.jsx("span",{children:"Delete"})]})]}),w.length>1&&e.jsxs("div",{className:n.compareSection,children:[e.jsxs("div",{className:n.compareSectionHeader,children:[e.jsx(me,{size:16}),e.jsx("span",{children:"Compare Versions (Redline)"})]}),v.length===2?e.jsxs("div",{className:n.compareActions,children:[e.jsxs("span",{className:n.selectedInfo,children:["Comparing v",v[0]," → v",v[1]]}),e.jsx("button",{className:n.compareBtn,onClick:qe,disabled:T,children:T?e.jsxs(e.Fragment,{children:[e.jsx(P,{size:14,className:n.spinner})," Comparing..."]}):e.jsxs(e.Fragment,{children:[e.jsx(me,{size:14})," View Redline"]})}),e.jsxs("button",{className:n.compareWordBtn,onClick:async()=>{const s=w.find(c=>c.versionNumber===v[0]),r=w.find(c=>c.versionNumber===v[1]);if(!(!s||!r))try{const{blob:c,filename:f}=await N.downloadVersion(i.id,s.versionNumber),d=window.URL.createObjectURL(c),p=window.document.createElement("a");p.href=d,p.download=`v${s.versionNumber} - ${f||i.name}`,window.document.body.appendChild(p),p.click(),window.URL.revokeObjectURL(d),window.document.body.removeChild(p),await new Promise(Qe=>setTimeout(Qe,500));const{blob:E,filename:K}=await N.downloadVersion(i.id,r.versionNumber),ze=window.URL.createObjectURL(E),Y=window.document.createElement("a");Y.href=ze,Y.download=`v${r.versionNumber} - ${K||i.name}`,window.document.body.appendChild(Y),Y.click(),window.URL.revokeObjectURL(ze),window.document.body.removeChild(Y),h.info(`✓ Downloaded both versions!

To compare in Word:
1. Open Microsoft Word
2. Go to Review → Compare → Compare Documents
3. Select "v${s.versionNumber} - ${i.name}" as Original
4. Select "v${r.versionNumber} - ${i.name}" as Revised
5. Click OK to see the redline`)}catch(c){console.error("Failed to download versions:",c),h.info("Failed to download versions. Please try again.")}},disabled:T,children:[e.jsx(de,{size:14})," Compare in Word"]}),e.jsx("button",{className:n.clearBtn,onClick:()=>{F([]),H(null),$(!1)},children:"Clear"})]}):e.jsx("p",{className:n.compareHint,children:"Select 2 versions below to compare changes"})]}),ie&&W&&e.jsxs("div",{className:n.redlineSection,children:[e.jsxs("div",{className:n.redlineHeader,children:[e.jsx("h4",{children:"Redline Comparison"}),e.jsxs("div",{className:n.redlineStats,children:[e.jsxs("span",{className:n.additions,children:["+",W.stats.additions," added"]}),e.jsxs("span",{className:n.deletions,children:["-",W.stats.deletions," removed"]})]}),e.jsx("button",{className:n.closeRedlineBtn,onClick:()=>$(!1),children:e.jsx(Q,{size:14})})]}),e.jsx("div",{className:n.redlineContent,dangerouslySetInnerHTML:{__html:W.html}})]}),e.jsxs("div",{className:n.versionList,children:[e.jsxs("div",{className:n.versionListHeader,children:[e.jsx("h4",{children:"Version History"}),e.jsx("button",{className:n.refreshBtn,onClick:M,disabled:u,children:e.jsx(se,{size:14,className:u?n.spinner:""})})]}),u?e.jsxs("div",{className:n.loading,children:[e.jsx(P,{size:24,className:n.spinner}),e.jsx("span",{children:"Loading version history..."})]}):k?e.jsxs("div",{className:n.error,children:[e.jsx(he,{size:20}),e.jsx("span",{children:k}),e.jsx("button",{onClick:M,children:"Retry"})]}):w.length===0?e.jsxs("div",{className:n.empty,children:[e.jsx(be,{size:32}),e.jsx("p",{children:"No version history available"}),e.jsx("span",{children:"Versions are created when you save changes in Word"})]}):e.jsx("div",{className:n.timeline,children:w.map((s,r)=>{const c=Ge(s.changeType),f=c.icon,d=v.includes(s.versionNumber),p=re===s.versionNumber,E=r===0;return e.jsxs("div",{className:`${n.versionItem} ${d?n.selected:""} ${E?n.latest:""}`,children:[e.jsxs("div",{className:n.timelineConnector,children:[e.jsx("div",{className:n.timelineDot,style:{backgroundColor:c.color},children:e.jsx(f,{size:12})}),r<w.length-1&&e.jsx("div",{className:n.timelineLine})]}),e.jsxs("div",{className:n.versionContent,children:[e.jsxs("div",{className:n.versionHeader,onClick:()=>X(p?null:s.versionNumber),children:[e.jsxs("div",{className:n.versionMeta,children:[e.jsxs("span",{className:n.versionNumber,children:["Version ",s.versionNumber,E&&e.jsx("span",{className:n.latestBadge,children:"Current"})]}),e.jsx("span",{className:n.versionTime,children:s.createdAt?xe(ne(s.createdAt),{addSuffix:!0}):"Unknown"})]}),e.jsx("button",{className:`${n.selectBtn} ${d?n.selectedBtn:""}`,onClick:K=>{K.stopPropagation(),Me(s.versionNumber)},title:d?"Remove from comparison":"Add to comparison",children:d?e.jsx(ue,{size:16}):e.jsx(me,{size:16})})]}),e.jsxs("div",{className:n.versionDetails,children:[e.jsxs("div",{className:n.editorInfo,children:[e.jsx(Pe,{size:14}),e.jsx("span",{children:s.createdByName||"Unknown"})]}),e.jsxs("div",{className:n.changeInfo,children:[e.jsx("span",{className:n.changeType,style:{color:c.color},children:c.label}),s.source&&s.source!=="apex"&&e.jsxs("span",{className:n.source,children:["via ",Ke(s.source)]})]})]}),p&&e.jsxs("div",{className:n.expandedDetails,children:[e.jsxs("div",{className:n.detailRow,children:[e.jsx(Re,{size:12}),e.jsx("span",{children:s.createdAt?Te(ne(s.createdAt),"MMMM d, yyyy 'at' h:mm a"):"Unknown date"})]}),s.changeSummary&&e.jsxs("div",{className:n.detailRow,children:[e.jsx(Ce,{size:12}),e.jsx("span",{children:s.changeSummary})]}),s.wordCount&&e.jsxs("div",{className:n.wordStats,children:[e.jsxs("span",{children:[s.wordCount.toLocaleString()," words"]}),s.wordsAdded!=null&&s.wordsAdded>0&&e.jsxs("span",{className:n.added,children:["+",s.wordsAdded]}),s.wordsRemoved!=null&&s.wordsRemoved>0&&e.jsxs("span",{className:n.removed,children:["-",s.wordsRemoved]})]}),s.versionLabel&&e.jsx("div",{className:n.versionLabel,children:s.versionLabel}),e.jsxs("div",{className:n.versionActions,children:[e.jsx("button",{className:`${n.downloadVersionBtn} ${!s.hasFile&&!s.hasTextContent?n.downloadDisabled:""}`,onClick:K=>{K.stopPropagation(),Ye(s)},disabled:J===s.versionNumber||!s.hasFile&&!s.hasTextContent,title:s.hasFile?`Download: ${s.downloadFilename||ce(s)}`:s.hasTextContent?"Download text content (original file not stored)":"No downloadable content available",children:J===s.versionNumber?e.jsxs(e.Fragment,{children:[e.jsx(P,{size:14,className:n.spinner})," Downloading..."]}):e.jsxs(e.Fragment,{children:[e.jsx(de,{size:14})," Download this version"]})}),e.jsxs("span",{className:n.downloadFilename,children:[s.downloadFilename||ce(s),s.hasFile&&e.jsx("span",{className:n.fileAvailable,children:"✓ File stored"}),!s.hasFile&&s.hasTextContent&&e.jsx("span",{className:n.textOnly,children:"Text only"})]}),s.fileSize&&e.jsx("span",{className:n.versionFileSize,children:Se(s.fileSize)})]})]}),e.jsxs("button",{className:n.expandToggle,onClick:()=>X(p?null:s.versionNumber),children:[p?e.jsx(os,{size:14}):e.jsx(is,{size:14}),e.jsx("span",{children:p?"Less details":"More details"})]})]})]},s.id)})})]}),e.jsx("div",{className:n.footer,children:!B&&C&&e.jsxs("div",{className:n.integrationHint,onClick:()=>L("/app/integrations"),style:{cursor:"pointer"},children:[e.jsx(he,{size:14}),e.jsxs("span",{children:[e.jsx("strong",{children:"Connect Microsoft 365"})," in Integrations for seamless Word editing with version sync"]}),e.jsx(le,{size:12})]})})]})}const Zn="_overlay_u67kk_1",et="_modal_u67kk_13",st="_header_u67kk_25",nt="_headerIcon_u67kk_33",tt="_headerText_u67kk_45",at="_closeBtn_u67kk_66",ot="_notification_u67kk_81",it="_success_u67kk_90",rt="_error_u67kk_95",ct="_loading_u67kk_109",lt="_spinning_u67kk_118",dt="_spin_u67kk_118",ut="_content_u67kk_126",ht="_section_u67kk_132",mt="_sectionHeader_u67kk_149",xt="_addBtn_u67kk_160",_t="_privacyOptions_u67kk_180",pt="_privacyOption_u67kk_180",jt="_active_u67kk_203",vt="_privacyText_u67kk_213",ft="_privacyLabel_u67kk_220",kt="_privacyDesc_u67kk_226",yt="_checkIcon_u67kk_231",Nt="_addUserForm_u67kk_236",gt="_searchInput_u67kk_245",wt="_userList_u67kk_259",St="_userItem_u67kk_267",zt="_userAvatar_u67kk_288",bt="_userInfo_u67kk_309",Bt="_userName_u67kk_316",Ct="_userEmail_u67kk_322",Lt="_noResults_u67kk_330",It="_permissionRow_u67kk_337",At="_optional_u67kk_364",Et="_addUserActions_u67kk_369",Pt="_cancelBtn_u67kk_376",Rt="_shareBtn_u67kk_391",Dt="_sharesList_u67kk_417",Ft="_shareItem_u67kk_424",Tt="_shareAvatar_u67kk_433",$t="_shareInfo_u67kk_452",Ot="_shareName_u67kk_460",Ut="_shareEmail_u67kk_466",Wt="_expires_u67kk_474",Ht="_sharePerms_u67kk_482",Vt="_permBadge_u67kk_487",Mt="_removeBtn_u67kk_499",qt="_noShares_u67kk_514",Gt="_quickActions_u67kk_526",Kt="_actionBtn_u67kk_531",a={overlay:Zn,modal:et,header:st,headerIcon:nt,headerText:tt,closeBtn:at,notification:ot,success:it,error:rt,loading:ct,spinning:lt,spin:dt,content:ut,section:ht,sectionHeader:mt,addBtn:xt,privacyOptions:_t,privacyOption:pt,active:jt,privacyText:vt,privacyLabel:ft,privacyDesc:kt,checkIcon:yt,addUserForm:Nt,searchInput:gt,userList:wt,userItem:St,userAvatar:zt,userInfo:bt,userName:Bt,userEmail:Ct,noResults:Lt,permissionRow:It,optional:At,addUserActions:Et,cancelBtn:Pt,shareBtn:Rt,sharesList:Dt,shareItem:Ft,shareAvatar:Tt,shareInfo:$t,shareName:Ot,shareEmail:Ut,expires:Wt,sharePerms:Ht,permBadge:Vt,removeBtn:Mt,noShares:qt,quickActions:Gt,actionBtn:Kt},Yt=[{value:"private",label:"Private",icon:te,description:"Only you and admins can access"},{value:"shared",label:"Shared",icon:De,description:"You, admins, and people you share with"},{value:"team",label:"Matter Team",icon:Fe,description:"Everyone assigned to the matter"},{value:"firm",label:"Firm-wide",icon:cs,description:"Everyone in the firm can view"}],Ie=[{value:"view",label:"Can view",icon:oe,canEdit:!1,canDownload:!0,canShare:!1},{value:"comment",label:"Can comment",icon:oe,canEdit:!1,canDownload:!0,canShare:!1},{value:"edit",label:"Can edit",icon:ae,canEdit:!0,canDownload:!0,canShare:!1},{value:"full",label:"Full access",icon:Fe,canEdit:!0,canDownload:!0,canShare:!0}];function aa({isOpen:i,onClose:m,documentId:j,documentName:R,currentPrivacy:S="private",isOwner:D=!0}){const[x,z]=o.useState(S),[g,L]=o.useState([]),[h,w]=o.useState([]),[I,u]=o.useState(!0),[l,k]=o.useState(!1),[A,B]=o.useState(null),[q,C]=o.useState(!1),[b,v]=o.useState([]),[F,T]=o.useState(""),[U,W]=o.useState("view"),[H,ie]=o.useState("");o.useEffect(()=>{i&&$()},[i,j]);const $=async()=>{u(!0);try{const[t,_]=await Promise.all([N.getShares(j),Je.getMembers()]);L(t.shares||[]),w(_.members||[])}catch(t){console.error("Failed to load sharing data:",t)}finally{u(!1)}},re=async t=>{k(!0);try{await Ze.updateDocumentPrivacy(j,{privacyLevel:t}),z(t),B({type:"success",message:"Privacy updated"})}catch(_){B({type:"error",message:_.message||"Failed to update privacy"})}finally{k(!1)}},X=async()=>{if(b.length!==0){k(!0);try{const t=Ie.find(_=>_.value===U);await N.shareDocument(j,{userIds:b,permissionLevel:U,canEdit:(t==null?void 0:t.canEdit)||!1,canDownload:(t==null?void 0:t.canDownload)||!0,canShare:(t==null?void 0:t.canShare)||!1,expiresAt:H||void 0}),B({type:"success",message:`Shared with ${b.length} people`}),v([]),C(!1),T(""),$()}catch(t){B({type:"error",message:t.message||"Failed to share"})}finally{k(!1)}}},J=async t=>{try{await N.removeShare(j,t),L(g.filter(_=>_.id!==t)),B({type:"success",message:"Access removed"})}catch(_){B({type:"error",message:_.message||"Failed to remove access"})}},Z=()=>{navigator.clipboard.writeText(`${window.location.origin}/app/documents/${j}`),B({type:"success",message:"Link copied to clipboard"})},G=h.filter(t=>{const _=g.some(y=>y.userId===t.id),O=F===""||`${t.firstName} ${t.lastName}`.toLowerCase().includes(F.toLowerCase())||t.email.toLowerCase().includes(F.toLowerCase());return!_&&O});return i?e.jsx("div",{className:a.overlay,onClick:m,children:e.jsxs("div",{className:a.modal,onClick:t=>t.stopPropagation(),children:[e.jsxs("div",{className:a.header,children:[e.jsx("div",{className:a.headerIcon,children:e.jsx(_e,{size:20})}),e.jsxs("div",{className:a.headerText,children:[e.jsxs("h2",{children:['Share "',R,'"']}),e.jsx("p",{children:"Manage who can access this document"})]}),e.jsx("button",{className:a.closeBtn,onClick:m,children:e.jsx(Q,{size:20})})]}),A&&e.jsxs("div",{className:`${a.notification} ${a[A.type]}`,children:[A.type==="success"?e.jsx(Le,{size:16}):e.jsx(Q,{size:16}),A.message,e.jsx("button",{onClick:()=>B(null),children:"×"})]}),I?e.jsxs("div",{className:a.loading,children:[e.jsx(P,{size:24,className:a.spinning}),e.jsx("span",{children:"Loading..."})]}):e.jsxs("div",{className:a.content,children:[e.jsxs("section",{className:a.section,children:[e.jsx("h3",{children:"Privacy Level"}),e.jsx("div",{className:a.privacyOptions,children:Yt.map(t=>e.jsxs("button",{className:`${a.privacyOption} ${x===t.value?a.active:""}`,onClick:()=>re(t.value),disabled:!D||l,children:[e.jsx(t.icon,{size:18}),e.jsxs("div",{className:a.privacyText,children:[e.jsx("span",{className:a.privacyLabel,children:t.label}),e.jsx("span",{className:a.privacyDesc,children:t.description})]}),x===t.value&&e.jsx(Le,{size:16,className:a.checkIcon})]},t.value))})]}),(x==="shared"||x==="private")&&e.jsxs("section",{className:a.section,children:[e.jsxs("div",{className:a.sectionHeader,children:[e.jsx("h3",{children:"Share with people"}),!q&&e.jsxs("button",{className:a.addBtn,onClick:()=>C(!0),children:[e.jsx(ls,{size:16}),"Add people"]})]}),q&&e.jsxs("div",{className:a.addUserForm,children:[e.jsx("input",{type:"text",placeholder:"Search team members...",value:F,onChange:t=>T(t.target.value),className:a.searchInput,autoFocus:!0}),e.jsxs("div",{className:a.userList,children:[G.slice(0,5).map(t=>e.jsxs("label",{className:a.userItem,children:[e.jsx("input",{type:"checkbox",checked:b.includes(t.id),onChange:_=>{_.target.checked?v([...b,t.id]):v(b.filter(O=>O!==t.id))}}),e.jsx("div",{className:a.userAvatar,children:t.avatarUrl?e.jsx("img",{src:t.avatarUrl,alt:""}):e.jsxs("span",{children:[t.firstName[0],t.lastName[0]]})}),e.jsxs("div",{className:a.userInfo,children:[e.jsxs("span",{className:a.userName,children:[t.firstName," ",t.lastName]}),e.jsx("span",{className:a.userEmail,children:t.email})]})]},t.id)),G.length===0&&e.jsx("div",{className:a.noResults,children:"No matching team members"})]}),e.jsxs("div",{className:a.permissionRow,children:[e.jsx("label",{children:"Permission:"}),e.jsx("select",{value:U,onChange:t=>W(t.target.value),children:Ie.map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))})]}),e.jsxs("div",{className:a.permissionRow,children:[e.jsx("label",{children:"Expires:"}),e.jsx("input",{type:"date",value:H,onChange:t=>ie(t.target.value),min:new Date().toISOString().split("T")[0]}),e.jsx("span",{className:a.optional,children:"(optional)"})]}),e.jsxs("div",{className:a.addUserActions,children:[e.jsx("button",{className:a.cancelBtn,onClick:()=>{C(!1),v([]),T("")},children:"Cancel"}),e.jsxs("button",{className:a.shareBtn,onClick:X,disabled:b.length===0||l,children:[l?e.jsx(P,{size:16,className:a.spinning}):e.jsx(_e,{size:16}),"Share with ",b.length||"..."," ",b.length===1?"person":"people"]})]})]}),g.length>0&&e.jsx("div",{className:a.sharesList,children:g.map(t=>e.jsxs("div",{className:a.shareItem,children:[e.jsx("div",{className:a.shareAvatar,children:t.type==="user"?t.userAvatar?e.jsx("img",{src:t.userAvatar,alt:""}):e.jsx(Pe,{size:16}):e.jsx(De,{size:16})}),e.jsxs("div",{className:a.shareInfo,children:[e.jsx("span",{className:a.shareName,children:t.type==="user"?t.userName:t.groupName}),e.jsxs("span",{className:a.shareEmail,children:[t.type==="user"?t.userEmail:"Group",t.expiresAt&&e.jsxs("span",{className:a.expires,children:[e.jsx(Re,{size:12}),"Expires ",Te(ne(t.expiresAt),"MMM d, yyyy")]})]})]}),e.jsx("div",{className:a.sharePerms,children:t.canEdit?e.jsxs("span",{className:a.permBadge,children:[e.jsx(ae,{size:12})," Edit"]}):e.jsxs("span",{className:a.permBadge,children:[e.jsx(oe,{size:12})," View"]})}),D&&e.jsx("button",{className:a.removeBtn,onClick:()=>J(t.id),title:"Remove access",children:e.jsx(Ee,{size:14})})]},t.id))}),g.length===0&&!q&&e.jsxs("div",{className:a.noShares,children:[e.jsx(te,{size:24}),e.jsx("p",{children:"This document is not shared with anyone yet"})]})]}),e.jsxs("section",{className:a.section,children:[e.jsx("h3",{children:"Quick actions"}),e.jsxs("div",{className:a.quickActions,children:[e.jsxs("button",{className:a.actionBtn,onClick:Z,children:[e.jsx(ds,{size:16}),"Copy link"]}),e.jsxs("button",{className:a.actionBtn,disabled:!0,children:[e.jsx(Ae,{size:16}),"Send via email"]})]})]})]})]})}):null}export{ta as D,aa as S};
