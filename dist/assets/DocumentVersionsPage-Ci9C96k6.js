import{r as i,a6 as e}from"./vendor-DrKzkH4x.js";import{k as x}from"./index-CCWWoMiH.js";import{C as X}from"./ConfirmationModal-X7YGPBKC.js";import{a as Z,e as ee}from"./router-CNLU_KyZ.js";import{L as N,t as se,a as $,al as te,aU as R,F as E,aW as f,aE as ne,J as V,as as ie,u as ae,ak as re,ar as H,S as oe,aP as D,U as ce}from"./icons-BtUkkwGS.js";import{a as le,p as M,f as de}from"./date-utils-BkNAU8cl.js";import"./doc-parsers-U1nJMjtM.js";import"./react-dom-DfB-QKj2.js";import"./pdf-worker-CVmCB3lP.js";import"./state-72d44OIA.js";const me="_container_1tjsg_1",_e="_notification_1tjsg_7",he="_slideIn_1tjsg_1",ge="_success_1tjsg_20",je="_error_1tjsg_26",ve="_loading_1tjsg_46",ue="_spinning_1tjsg_56",pe="_spin_1tjsg_56",xe="_header_1tjsg_66",Ne="_headerLeft_1tjsg_75",fe="_backBtn_1tjsg_81",ye="_headerIcon_1tjsg_100",we="_docName_1tjsg_118",Ce="_headerActions_1tjsg_127",Se="_compareBtn_1tjsg_132",be="_badge_1tjsg_155",Le="_content_1tjsg_186",Be="_timeline_1tjsg_194",ke="_timelineInfo_1tjsg_198",ze="_hint_1tjsg_209",Ie="_emptyState_1tjsg_215",Pe="_versionList_1tjsg_241",Ae="_versionItem_1tjsg_245",Te="_versionLine_1tjsg_251",$e="_versionDot_1tjsg_274",Re="_latest_1tjsg_285",Me="_versionContent_1tjsg_293",Ee="_selected_1tjsg_299",Ve="_previewing_1tjsg_307",He="_versionHeader_1tjsg_315",De="_versionInfo_1tjsg_322",Fe="_versionNumber_1tjsg_328",Oe="_latestBadge_1tjsg_341",Ue="_versionLabel_1tjsg_351",We="_checkbox_1tjsg_360",Ge="_versionMeta_1tjsg_377",Ye="_changeType_1tjsg_386",Je="_author_1tjsg_387",Ke="_time_1tjsg_194",qe="_changeSummary_1tjsg_400",Qe="_versionStats_1tjsg_412",Xe="_added_1tjsg_420",Ze="_removed_1tjsg_428",es="_size_1tjsg_436",ss="_wordCount_1tjsg_437",ts="_versionActions_1tjsg_442",ns="_previewBtn_1tjsg_449",is="_restoreBtn_1tjsg_450",as="_compareWithPrevBtn_1tjsg_451",rs="_previewPane_1tjsg_496",os="_previewLoading_1tjsg_504",cs="_previewContent_1tjsg_514",ls="_versionTimestamp_1tjsg_529",t={container:me,notification:_e,slideIn:he,success:ge,error:je,loading:ve,spinning:ue,spin:pe,header:xe,headerLeft:Ne,backBtn:fe,headerIcon:ye,docName:we,headerActions:Ce,compareBtn:Se,badge:be,content:Le,timeline:Be,timelineInfo:ke,hint:ze,emptyState:Ie,versionList:Pe,versionItem:Ae,versionLine:Te,versionDot:$e,latest:Re,versionContent:Me,selected:Ee,previewing:Ve,versionHeader:He,versionInfo:De,versionNumber:Fe,latestBadge:Oe,versionLabel:Ue,checkbox:We,versionMeta:Ge,changeType:Ye,author:Je,time:Ke,changeSummary:qe,versionStats:Qe,added:Xe,removed:Ze,size:es,wordCount:ss,versionActions:ts,previewBtn:ns,restoreBtn:is,compareWithPrevBtn:as,previewPane:rs,previewLoading:os,previewContent:cs,versionTimestamp:ls},ds={create:ce,edit:D,restore:H,merge:f,auto_save:V,sync:oe,rename:E},ms={create:"Created",edit:"Edited",restore:"Restored",merge:"Merged",auto_save:"Auto-saved",sync:"Synced",rename:"Renamed"};function ys(){var P;const y=Z(),{documentId:c}=ee(),[_,w]=i.useState([]),[F,O]=i.useState(""),[U,C]=i.useState(!0),[S,b]=i.useState(null),[L,B]=i.useState(null),[g,r]=i.useState(null),[l,k]=i.useState([]),[d,j]=i.useState(null),[W,h]=i.useState(null),[G,z]=i.useState(!1),[m,v]=i.useState({isOpen:!1,version:null});i.useEffect(()=>{c&&u()},[c]);const u=async()=>{try{C(!0),B(null);const s=await x.getVersions(c);w(s.versions||[]),O(s.documentName||"Document")}catch(s){B(s.message||"Failed to load version history")}finally{C(!1)}},Y=async s=>{if((d==null?void 0:d.id)===s.id){j(null),h(null);return}if(s.archived&&!s.rehydrating){j(s),h(null),r({type:"error",message:'This version is archived. Click "Retrieve from Archive" to access it (takes 1-15 hours).'});return}if(s.rehydrating){j(s),h(null),r({type:"error",message:"This version is being retrieved from archive. Please check back shortly."});return}try{z(!0),j(s);const n=await x.getVersionContent(c,s.id);if(n.archived){h(null),r({type:"error",message:n.message||"This version needs to be retrieved from archive."}),w(o=>o.map(a=>a.id===s.id?{...a,archived:!0,rehydrating:n.rehydrationPending}:a));return}h(n.content||"")}catch{r({type:"error",message:"Failed to load version content"})}finally{z(!1)}},J=async()=>{if(m.version)try{b(m.version.id),await x.restoreVersion(c,m.version.id),r({type:"success",message:`Restored to version ${m.version.versionNumber}`}),v({isOpen:!1,version:null}),u()}catch(s){r({type:"error",message:s.message||"Failed to restore version"})}finally{b(null)}},I=()=>{if(l.length!==2)return;const[s,n]=l.sort((o,a)=>o-a);y(`/app/documents/${c}/compare?v1=${s}&v2=${n}`)},K=s=>{k(n=>n.includes(s)?n.filter(o=>o!==s):n.length>=2?[n[1],s]:[...n,s])},q=s=>s?s<1024?`${s} B`:s<1024*1024?`${(s/1024).toFixed(1)} KB`:`${(s/(1024*1024)).toFixed(2)} MB`:"-",Q=s=>ds[s]||D;return U?e.jsx("div",{className:t.container,children:e.jsxs("div",{className:t.loading,children:[e.jsx(N,{size:32,className:t.spinning}),e.jsx("span",{children:"Loading version history..."})]})}):e.jsxs("div",{className:t.container,children:[g&&e.jsxs("div",{className:`${t.notification} ${t[g.type]}`,children:[g.type==="success"?e.jsx(se,{size:16}):e.jsx($,{size:16}),g.message,e.jsx("button",{onClick:()=>r(null),children:"Ã—"})]}),e.jsxs("div",{className:t.header,children:[e.jsxs("div",{className:t.headerLeft,children:[e.jsx("button",{className:t.backBtn,onClick:()=>y(-1),children:e.jsx(te,{size:20})}),e.jsx("div",{className:t.headerIcon,children:e.jsx(R,{size:24})}),e.jsxs("div",{children:[e.jsx("h1",{children:"Version History"}),e.jsxs("p",{className:t.docName,children:[e.jsx(E,{size:14}),F]})]})]}),e.jsx("div",{className:t.headerActions,children:e.jsxs("button",{className:t.compareBtn,onClick:I,disabled:l.length!==2,children:[e.jsx(f,{size:18}),"Compare Selected",l.length>0&&e.jsx("span",{className:t.badge,children:l.length})]})})]}),L&&e.jsxs("div",{className:t.error,children:[e.jsx($,{size:18}),L,e.jsx("button",{onClick:u,children:"Retry"})]}),e.jsx("div",{className:t.content,children:e.jsxs("div",{className:t.timeline,children:[e.jsxs("div",{className:t.timelineInfo,children:[e.jsxs("span",{children:[_.length," versions"]}),e.jsx("span",{className:t.hint,children:"Select 2 versions to compare them"})]}),_.length===0?e.jsxs("div",{className:t.emptyState,children:[e.jsx(R,{size:48}),e.jsx("h3",{children:"No version history"}),e.jsx("p",{children:"Versions will be created automatically when you edit this document"})]}):e.jsx("div",{className:t.versionList,children:_.map((s,n)=>{var T;const o=Q(s.changeType),a=n===0,A=l.includes(s.versionNumber),p=(d==null?void 0:d.id)===s.id;return e.jsxs("div",{className:`${t.versionItem} ${A?t.selected:""} ${p?t.previewing:""}`,children:[e.jsx("div",{className:t.versionLine,children:e.jsx("div",{className:`${t.versionDot} ${a?t.latest:""}`})}),e.jsxs("div",{className:t.versionContent,children:[e.jsxs("div",{className:t.versionHeader,children:[e.jsxs("div",{className:t.versionInfo,children:[e.jsxs("span",{className:`${t.versionNumber} ${a?t.latest:""}`,children:["v",s.versionNumber,a&&e.jsx("span",{className:t.latestBadge,children:"Latest"})]}),s.versionLabel&&e.jsx("span",{className:t.versionLabel,children:s.versionLabel})]}),e.jsxs("label",{className:t.checkbox,children:[e.jsx("input",{type:"checkbox",checked:A,onChange:()=>K(s.versionNumber)}),e.jsx("span",{children:"Compare"})]})]}),e.jsxs("div",{className:t.versionMeta,children:[e.jsxs("span",{className:t.changeType,children:[e.jsx(o,{size:14}),ms[s.changeType]||s.changeType]}),e.jsxs("span",{className:t.author,children:[e.jsx(ne,{size:14}),s.createdByName||"Unknown"]}),e.jsxs("span",{className:t.time,children:[e.jsx(V,{size:14}),le(M(s.createdAt),{addSuffix:!0})]})]}),s.changeSummary&&e.jsx("p",{className:t.changeSummary,children:s.changeSummary}),e.jsxs("div",{className:t.versionStats,children:[s.wordsAdded>0&&e.jsxs("span",{className:t.added,children:[e.jsx(ie,{size:12}),s.wordsAdded," words"]}),s.wordsRemoved>0&&e.jsxs("span",{className:t.removed,children:[e.jsx(ae,{size:12}),s.wordsRemoved," words"]}),e.jsx("span",{className:t.size,children:q(s.fileSize)}),e.jsxs("span",{className:t.wordCount,children:[(T=s.wordCount)==null?void 0:T.toLocaleString()," words"]})]}),e.jsxs("div",{className:t.versionActions,children:[e.jsxs("button",{className:t.previewBtn,onClick:()=>Y(s),children:[e.jsx(re,{size:14}),p?"Hide":"Preview"]}),!a&&e.jsxs("button",{className:t.restoreBtn,onClick:()=>v({isOpen:!0,version:s}),disabled:S===s.id,children:[S===s.id?e.jsx(N,{size:14,className:t.spinning}):e.jsx(H,{size:14}),"Restore"]}),n<_.length-1&&e.jsxs("button",{className:t.compareWithPrevBtn,onClick:()=>{k([_[n+1].versionNumber,s.versionNumber]),I()},children:[e.jsx(f,{size:14}),"Compare with previous"]})]}),p&&e.jsx("div",{className:t.previewPane,children:G?e.jsxs("div",{className:t.previewLoading,children:[e.jsx(N,{size:20,className:t.spinning}),e.jsx("span",{children:"Loading content..."})]}):e.jsx("pre",{className:t.previewContent,children:W||"No content available"})}),e.jsx("div",{className:t.versionTimestamp,children:de(M(s.createdAt),"MMMM d, yyyy 'at' h:mm a")})]})]},s.id)})})]})}),e.jsx(X,{isOpen:m.isOpen,onClose:()=>v({isOpen:!1,version:null}),onConfirm:J,title:"Restore Version",message:`Are you sure you want to restore to version ${(P=m.version)==null?void 0:P.versionNumber}? This will create a new version with the restored content.`,confirmText:"Restore",type:"warning"})]})}export{ys as DocumentVersionsPage};
