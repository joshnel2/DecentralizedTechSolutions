import{r as m,a6 as e,h as N}from"./vendor-DrKzkH4x.js";import{a as V,d as R}from"./index-CCWWoMiH.js";import{bd as H,aK as L,bx as I,D as M,y as z,F as O,R as B,ao as q,aB as E,am as K,J as W,X as F}from"./icons-BtUkkwGS.js";import{p as S,x as T,f as A}from"./date-utils-BkNAU8cl.js";import"./doc-parsers-U1nJMjtM.js";import"./react-dom-DfB-QKj2.js";import"./pdf-worker-CVmCB3lP.js";import"./router-CNLU_KyZ.js";import"./state-72d44OIA.js";const Q="_trustPage_dh3nw_1",J="_header_dh3nw_2",X="_headerLeft_dh3nw_3",Y="_headerIcon_dh3nw_4",Z="_headerActions_dh3nw_7",ee="_primaryBtn_dh3nw_8",se="_secondaryBtn_dh3nw_10",ae="_statsGrid_dh3nw_12",te="_statCard_dh3nw_13",ne="_statIcon_dh3nw_14",le="_statValue_dh3nw_15",ce="_statLabel_dh3nw_16",ie="_tabs_dh3nw_17",re="_tab_dh3nw_17",oe="_active_dh3nw_20",de="_toolbar_dh3nw_21",he="_searchBox_dh3nw_22",me="_filterSelect_dh3nw_25",ue="_exportBtn_dh3nw_28",xe="_transactionsList_dh3nw_29",pe="_table_dh3nw_30",je="_alignRight_dh3nw_34",_e="_dateCell_dh3nw_35",be="_clientCell_dh3nw_36",ve="_clientName_dh3nw_37",fe="_matterName_dh3nw_38",Ne="_refCell_dh3nw_39",ge="_typeBadge_dh3nw_40",we="_deposit_dh3nw_41",ye="_disbursement_dh3nw_42",Ce="_transfer_dh3nw_43",Se="_refund_dh3nw_44",Be="_positive_dh3nw_45",Le="_negative_dh3nw_46",Ie="_statusBadge_dh3nw_47",De="_cleared_dh3nw_48",ke="_pending_dh3nw_49",Ae="_balancesList_dh3nw_50",Re="_balanceCard_dh3nw_51",$e="_balanceInfo_dh3nw_52",Me="_balanceClientName_dh3nw_53",ze="_lastActivity_dh3nw_54",Te="_balanceAmount_dh3nw_55",Fe="_balanceActions_dh3nw_56",Ge="_smallBtn_dh3nw_57",Ue="_reconciliationSection_dh3nw_59",Pe="_reconcileCard_dh3nw_60",Ve="_reconcileHeader_dh3nw_61",He="_reconcileStats_dh3nw_65",Oe="_reconcileStat_dh3nw_65",qe="_reconcileLabel_dh3nw_67",Ee="_reconcileValue_dh3nw_68",Ke="_success_dh3nw_69",We="_modalOverlay_dh3nw_70",Qe="_modal_dh3nw_70",Je="_modalHeader_dh3nw_72",Xe="_closeBtn_dh3nw_74",Ye="_modalForm_dh3nw_76",Ze="_formGroup_dh3nw_77",es="_formRow_dh3nw_84",ss="_modalActions_dh3nw_85",as="_cancelBtn_dh3nw_86",s={trustPage:Q,header:J,headerLeft:X,headerIcon:Y,headerActions:Z,primaryBtn:ee,secondaryBtn:se,statsGrid:ae,statCard:te,statIcon:ne,statValue:le,statLabel:ce,tabs:ie,tab:re,active:oe,toolbar:de,searchBox:he,filterSelect:me,exportBtn:ue,transactionsList:xe,table:pe,alignRight:je,dateCell:_e,clientCell:be,clientName:ve,matterName:fe,refCell:Ne,typeBadge:ge,deposit:we,disbursement:ye,transfer:Ce,refund:Se,positive:Be,negative:Le,statusBadge:Ie,cleared:De,pending:ke,balancesList:Ae,balanceCard:Re,balanceInfo:$e,balanceClientName:Me,lastActivity:ze,balanceAmount:Te,balanceActions:Fe,smallBtn:Ge,reconciliationSection:Ue,reconcileCard:Pe,reconcileHeader:Ve,reconcileStats:He,reconcileStat:Oe,reconcileLabel:qe,reconcileValue:Ee,success:Ke,modalOverlay:We,modal:Qe,modalHeader:Je,closeBtn:Xe,modalForm:Ye,formGroup:Ze,formRow:es,modalActions:ss,cancelBtn:as};function xs(){const{clients:_}=V(),d=R(),[h,g]=m.useState([]),[t,n]=m.useState([]),[o,l]=m.useState("ledger"),[w,C]=m.useState(""),[f,i]=m.useState("all"),[p,y]=m.useState(!1),[D,k]=m.useState(!1),[u,G]=m.useState(""),[$,U]=m.useState(null),b=m.useMemo(()=>t.reduce((a,c)=>a+c.balance,0),[t]),P=m.useMemo(()=>h.filter(a=>{const c=a.clientName.toLowerCase().includes(w.toLowerCase())||a.description.toLowerCase().includes(w.toLowerCase()),j=f==="all"||a.type===f;return c&&j}),[h,w,f]);return e.jsxs("div",{className:s.trustPage,children:[e.jsxs("div",{className:s.header,children:[e.jsxs("div",{className:s.headerLeft,children:[e.jsx("div",{className:s.headerIcon,children:e.jsx(H,{size:28})}),e.jsxs("div",{children:[e.jsx("h1",{children:"Linked Accounts"}),e.jsx("p",{children:"Manage linked accounts and transactions"})]})]}),e.jsxs("div",{className:s.headerActions,children:[e.jsxs("button",{className:s.secondaryBtn,onClick:()=>k(!0),children:[e.jsx(L,{size:18})," Disbursement"]}),e.jsxs("button",{className:s.primaryBtn,onClick:()=>y(!0),children:[e.jsx(I,{size:18})," Deposit"]})]})]}),e.jsxs("div",{className:s.statsGrid,children:[e.jsxs("div",{className:s.statCard,children:[e.jsx("div",{className:s.statIcon,children:e.jsx(M,{size:24})}),e.jsxs("div",{className:s.statContent,children:[e.jsxs("span",{className:s.statValue,children:["$",b.toLocaleString()]}),e.jsx("span",{className:s.statLabel,children:"Total Trust Balance"})]})]}),e.jsxs("div",{className:s.statCard,children:[e.jsx("div",{className:s.statIcon,children:e.jsx(z,{size:24})}),e.jsxs("div",{className:s.statContent,children:[e.jsx("span",{className:s.statValue,children:t.length}),e.jsx("span",{className:s.statLabel,children:"Clients with Funds"})]})]}),e.jsxs("div",{className:s.statCard,children:[e.jsx("div",{className:s.statIcon,children:e.jsx(I,{size:24})}),e.jsxs("div",{className:s.statContent,children:[e.jsxs("span",{className:s.statValue,children:["$",h.filter(a=>a.type==="deposit"&&S(a.date)>=T(new Date,30)).reduce((a,c)=>a+c.amount,0).toLocaleString()]}),e.jsx("span",{className:s.statLabel,children:"Deposits This Month"})]})]}),e.jsxs("div",{className:s.statCard,children:[e.jsx("div",{className:s.statIcon,children:e.jsx(L,{size:24})}),e.jsxs("div",{className:s.statContent,children:[e.jsxs("span",{className:s.statValue,children:["$",h.filter(a=>a.type==="disbursement"&&S(a.date)>=T(new Date,30)).reduce((a,c)=>a+Math.abs(c.amount),0).toLocaleString()]}),e.jsx("span",{className:s.statLabel,children:"Disbursements This Month"})]})]})]}),e.jsxs("div",{className:s.tabs,children:[e.jsxs("button",{className:N(s.tab,o==="ledger"&&s.active),onClick:()=>l("ledger"),children:[e.jsx(O,{size:18})," Transaction Ledger"]}),e.jsxs("button",{className:N(s.tab,o==="balances"&&s.active),onClick:()=>l("balances"),children:[e.jsx(z,{size:18})," Client Balances"]}),e.jsxs("button",{className:N(s.tab,o==="reconciliation"&&s.active),onClick:()=>l("reconciliation"),children:[e.jsx(B,{size:18})," Reconciliation"]})]}),o==="ledger"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:s.toolbar,children:[e.jsxs("div",{className:s.searchBox,children:[e.jsx(q,{size:18}),e.jsx("input",{type:"text",placeholder:"Search transactions...",value:w,onChange:a=>C(a.target.value)})]}),e.jsxs("select",{className:s.filterSelect,value:f,onChange:a=>i(a.target.value),children:[e.jsx("option",{value:"all",children:"All Types"}),e.jsx("option",{value:"deposit",children:"Deposits"}),e.jsx("option",{value:"disbursement",children:"Disbursements"}),e.jsx("option",{value:"transfer",children:"Transfers"}),e.jsx("option",{value:"refund",children:"Refunds"})]}),e.jsxs("button",{className:s.exportBtn,onClick:()=>{const a=h.map(r=>`${r.date},${r.type},${r.clientName},${r.matterName||"N/A"},${r.description},$${r.amount}`).join(`
`),c=new Blob([`Date,Type,Client,Matter,Description,Amount
${a}`],{type:"text/csv"}),j=URL.createObjectURL(c),x=document.createElement("a");x.href=j,x.download="trust-transactions.csv",x.click(),URL.revokeObjectURL(j)},children:[e.jsx(E,{size:16})," Export"]})]}),e.jsx("div",{className:s.transactionsList,children:e.jsxs("table",{className:s.table,children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Date"}),e.jsx("th",{children:"Client / Matter"}),e.jsx("th",{children:"Description"}),e.jsx("th",{children:"Reference"}),e.jsx("th",{children:"Type"}),e.jsx("th",{className:s.alignRight,children:"Amount"}),e.jsx("th",{className:s.alignRight,children:"Balance"}),e.jsx("th",{children:"Status"})]})}),e.jsx("tbody",{children:P.map(a=>e.jsxs("tr",{children:[e.jsx("td",{className:s.dateCell,children:A(S(a.date),"MMM d, yyyy")}),e.jsx("td",{children:e.jsxs("div",{className:s.clientCell,children:[e.jsx("span",{className:s.clientName,children:a.clientName}),a.matterName&&e.jsx("span",{className:s.matterName,children:a.matterName})]})}),e.jsx("td",{children:a.description}),e.jsx("td",{className:s.refCell,children:a.reference||"—"}),e.jsx("td",{children:e.jsxs("span",{className:N(s.typeBadge,s[a.type]),children:[a.type==="deposit"&&e.jsx(I,{size:12}),a.type==="disbursement"&&e.jsx(L,{size:12}),a.type==="transfer"&&e.jsx(B,{size:12}),a.type]})}),e.jsxs("td",{className:N(s.alignRight,a.amount>0?s.positive:s.negative),children:[a.amount>0?"+":"",a.amount.toLocaleString("en-US",{style:"currency",currency:"USD"})]}),e.jsxs("td",{className:s.alignRight,children:["$",a.balance.toLocaleString()]}),e.jsx("td",{children:e.jsxs("span",{className:N(s.statusBadge,s[a.status]),children:[a.status==="cleared"&&e.jsx(K,{size:12}),a.status==="pending"&&e.jsx(W,{size:12}),a.status]})})]},a.id))})]})})]}),o==="balances"&&e.jsx("div",{className:s.balancesList,children:t.length>0?t.map(a=>e.jsxs("div",{className:s.balanceCard,children:[e.jsxs("div",{className:s.balanceInfo,children:[e.jsx("span",{className:s.balanceClientName,children:a.clientName}),e.jsxs("span",{className:s.lastActivity,children:["Last activity: ",A(S(a.lastActivity),"MMM d, yyyy")]})]}),e.jsxs("div",{className:s.balanceAmount,children:["$",a.balance.toLocaleString()]}),e.jsxs("div",{className:s.balanceActions,children:[e.jsx("button",{className:s.smallBtn,onClick:()=>d.info(`Ledger for ${a.clientName}:

Showing all trust transactions for this client.
Balance: $${a.balance.toLocaleString()}`),children:"View Ledger"}),e.jsx("button",{className:s.smallBtn,onClick:()=>d.info(`Statement generated for ${a.clientName}

A PDF statement will be available for download.`),children:"Statement"})]})]},a.clientId)):e.jsxs("div",{style:{textAlign:"center",padding:"3rem",color:"var(--apex-text)"},children:[e.jsx(M,{size:48,style:{opacity:.3,marginBottom:"1rem"}}),e.jsx("h3",{style:{color:"var(--apex-white)",marginBottom:"0.5rem"},children:"No Client Balances"}),e.jsx("p",{children:"Record a deposit to see client balances here."})]})}),o==="reconciliation"&&e.jsx("div",{className:s.reconciliationSection,children:e.jsxs("div",{className:s.reconcileCard,children:[e.jsxs("div",{className:s.reconcileHeader,children:[e.jsx(B,{size:24}),e.jsxs("div",{children:[e.jsx("h3",{children:"Account Reconciliation"}),e.jsxs("p",{children:["Last reconciled: ",$?A(S($),"MMMM d, yyyy"):"Never"]})]})]}),e.jsxs("div",{className:s.reconcileStats,children:[e.jsxs("div",{className:s.reconcileStat,children:[e.jsx("span",{className:s.reconcileLabel,children:"Bank Statement Balance"}),e.jsx("span",{className:s.reconcileValue,children:u?`$${parseFloat(u).toLocaleString()}`:"Not set"})]}),e.jsxs("div",{className:s.reconcileStat,children:[e.jsx("span",{className:s.reconcileLabel,children:"Ledger Balance"}),e.jsxs("span",{className:s.reconcileValue,children:["$",b.toLocaleString()]})]}),e.jsxs("div",{className:s.reconcileStat,children:[e.jsx("span",{className:s.reconcileLabel,children:"Difference"}),e.jsx("span",{className:N(s.reconcileValue,u&&parseFloat(u)===b?s.success:""),children:u?`$${Math.abs(parseFloat(u)-b).toLocaleString()}`:"—"})]})]}),e.jsx("div",{style:{display:"flex",gap:"1rem",alignItems:"center",marginBottom:"1rem"},children:e.jsx("input",{type:"number",placeholder:"Enter bank statement balance...",value:u,onChange:a=>G(a.target.value),style:{flex:1,padding:"0.75rem 1rem",background:"var(--apex-slate)",border:"1px solid rgba(255,255,255,0.1)",borderRadius:"8px",color:"var(--apex-white)",fontSize:"1rem"}})}),e.jsxs("button",{className:s.primaryBtn,onClick:()=>{if(!u){d.info("Please enter the bank statement balance first.");return}U(new Date().toISOString()),d.info(`Reconciliation completed!

Bank Balance: $${parseFloat(u).toLocaleString()}
Ledger Balance: $${b.toLocaleString()}
Difference: $${Math.abs(parseFloat(u)-b).toLocaleString()}`)},children:[e.jsx(B,{size:16})," Complete Reconciliation"]})]})}),p&&e.jsx(ts,{clients:_,onClose:()=>y(!1),onSave:a=>{const c=_.find(r=>r.id===a.clientId),j={id:crypto.randomUUID(),clientId:a.clientId,clientName:(c==null?void 0:c.displayName)||(c==null?void 0:c.name)||"Unknown",type:"deposit",amount:a.amount,balance:b+a.amount,description:a.description,reference:a.reference,method:a.method,date:a.date,status:"cleared",createdBy:"user"};g([j,...h]);const x=t.findIndex(r=>r.clientId===a.clientId);if(x>=0){const r=[...t];r[x]={...r[x],balance:r[x].balance+a.amount,lastActivity:a.date},n(r)}else n([...t,{clientId:a.clientId,clientName:(c==null?void 0:c.displayName)||(c==null?void 0:c.name)||"Unknown",balance:a.amount,lastActivity:a.date}]);y(!1)}}),D&&e.jsx(ns,{clients:_,clientBalances:t,onClose:()=>k(!1),onSave:a=>{const c=_.find(v=>v.id===a.clientId),j=t.find(v=>v.clientId===a.clientId);if(!j||j.balance<a.amount){d.info("Insufficient funds for this client");return}const x={id:crypto.randomUUID(),clientId:a.clientId,clientName:(c==null?void 0:c.displayName)||(c==null?void 0:c.name)||"Unknown",type:"disbursement",amount:-a.amount,balance:b-a.amount,description:a.description,reference:a.reference,method:a.method,date:a.date,status:"cleared",createdBy:"user"};g([x,...h]);const r=t.map(v=>v.clientId===a.clientId?{...v,balance:v.balance-a.amount,lastActivity:a.date}:v);n(r),k(!1)}})]})}function ts({clients:_,onClose:d,onSave:h}){const g=R(),[t,n]=m.useState({clientId:"",amount:"",date:new Date().toISOString().split("T")[0],method:"check",reference:"",description:""}),o=l=>{if(l.preventDefault(),!t.clientId||!t.amount||!t.description){g.info("Please fill in all required fields");return}h({...t,amount:parseFloat(t.amount)})};return e.jsx("div",{className:s.modalOverlay,onClick:d,children:e.jsxs("div",{className:s.modal,onClick:l=>l.stopPropagation(),children:[e.jsxs("div",{className:s.modalHeader,children:[e.jsx("h2",{children:"Record Trust Deposit"}),e.jsx("button",{onClick:d,className:s.closeBtn,children:e.jsx(F,{size:20})})]}),e.jsxs("form",{className:s.modalForm,onSubmit:o,children:[e.jsxs("div",{className:s.formGroup,children:[e.jsx("label",{children:"Client *"}),e.jsxs("select",{value:t.clientId,onChange:l=>n({...t,clientId:l.target.value}),required:!0,children:[e.jsx("option",{value:"",children:"Select client..."}),_.map(l=>e.jsx("option",{value:l.id,children:l.displayName||l.name},l.id))]})]}),e.jsxs("div",{className:s.formRow,children:[e.jsxs("div",{className:s.formGroup,children:[e.jsx("label",{children:"Amount *"}),e.jsx("input",{type:"number",step:"0.01",placeholder:"0.00",value:t.amount,onChange:l=>n({...t,amount:l.target.value}),required:!0})]}),e.jsxs("div",{className:s.formGroup,children:[e.jsx("label",{children:"Date *"}),e.jsx("input",{type:"date",value:t.date,onChange:l=>n({...t,date:l.target.value}),required:!0})]})]}),e.jsxs("div",{className:s.formGroup,children:[e.jsx("label",{children:"Payment Method"}),e.jsxs("select",{value:t.method,onChange:l=>n({...t,method:l.target.value}),children:[e.jsx("option",{value:"check",children:"Check"}),e.jsx("option",{value:"wire",children:"Wire Transfer"}),e.jsx("option",{value:"ach",children:"ACH"}),e.jsx("option",{value:"cash",children:"Cash"})]})]}),e.jsxs("div",{className:s.formGroup,children:[e.jsx("label",{children:"Reference/Check Number"}),e.jsx("input",{type:"text",placeholder:"CHK-10234",value:t.reference,onChange:l=>n({...t,reference:l.target.value})})]}),e.jsxs("div",{className:s.formGroup,children:[e.jsx("label",{children:"Description *"}),e.jsx("textarea",{rows:2,placeholder:"Retainer deposit for...",value:t.description,onChange:l=>n({...t,description:l.target.value}),required:!0})]}),e.jsxs("div",{className:s.modalActions,children:[e.jsx("button",{type:"button",onClick:d,className:s.cancelBtn,children:"Cancel"}),e.jsxs("button",{type:"submit",className:s.primaryBtn,children:[e.jsx(I,{size:16})," Record Deposit"]})]})]})]})})}function ns({clients:_,clientBalances:d,onClose:h,onSave:g}){var f;const t=R(),[n,o]=m.useState({clientId:"",amount:"",date:new Date().toISOString().split("T")[0],method:"check",reference:"",description:""}),l=((f=d.find(i=>i.clientId===n.clientId))==null?void 0:f.balance)||0,w=i=>{if(i.preventDefault(),!n.clientId||!n.amount||!n.description){t.info("Please fill in all required fields");return}const p=parseFloat(n.amount);if(p>l){t.info(`Insufficient funds. Available balance: $${l.toLocaleString()}`);return}g({...n,amount:p})},C=_.filter(i=>d.some(p=>p.clientId===i.id&&p.balance>0));return e.jsx("div",{className:s.modalOverlay,onClick:h,children:e.jsxs("div",{className:s.modal,onClick:i=>i.stopPropagation(),children:[e.jsxs("div",{className:s.modalHeader,children:[e.jsx("h2",{children:"Record Disbursement"}),e.jsx("button",{onClick:h,className:s.closeBtn,children:e.jsx(F,{size:20})})]}),e.jsxs("form",{className:s.modalForm,onSubmit:w,children:[e.jsxs("div",{className:s.formGroup,children:[e.jsx("label",{children:"Client *"}),e.jsxs("select",{value:n.clientId,onChange:i=>o({...n,clientId:i.target.value}),required:!0,children:[e.jsx("option",{value:"",children:"Select client..."}),C.length>0?C.map(i=>{var y;const p=((y=d.find(D=>D.clientId===i.id))==null?void 0:y.balance)||0;return e.jsxs("option",{value:i.id,children:[i.displayName||i.name," ($",p.toLocaleString(),")"]},i.id)}):e.jsx("option",{value:"",disabled:!0,children:"No clients with funds"})]})]}),n.clientId&&e.jsx("div",{style:{padding:"0.75rem",background:"rgba(245, 158, 11, 0.1)",borderRadius:"8px",marginBottom:"1rem"},children:e.jsxs("span",{style:{color:"var(--apex-gold-bright)"},children:["Available Balance: $",l.toLocaleString()]})}),e.jsxs("div",{className:s.formRow,children:[e.jsxs("div",{className:s.formGroup,children:[e.jsx("label",{children:"Amount *"}),e.jsx("input",{type:"number",step:"0.01",placeholder:"0.00",value:n.amount,onChange:i=>o({...n,amount:i.target.value}),max:l,required:!0})]}),e.jsxs("div",{className:s.formGroup,children:[e.jsx("label",{children:"Date *"}),e.jsx("input",{type:"date",value:n.date,onChange:i=>o({...n,date:i.target.value}),required:!0})]})]}),e.jsxs("div",{className:s.formGroup,children:[e.jsx("label",{children:"Payment Method"}),e.jsxs("select",{value:n.method,onChange:i=>o({...n,method:i.target.value}),children:[e.jsx("option",{value:"check",children:"Check"}),e.jsx("option",{value:"wire",children:"Wire Transfer"}),e.jsx("option",{value:"ach",children:"ACH"})]})]}),e.jsxs("div",{className:s.formGroup,children:[e.jsx("label",{children:"Reference/Check Number"}),e.jsx("input",{type:"text",placeholder:"CHK-10234",value:n.reference,onChange:i=>o({...n,reference:i.target.value})})]}),e.jsxs("div",{className:s.formGroup,children:[e.jsx("label",{children:"Description *"}),e.jsx("textarea",{rows:2,placeholder:"Payment to vendor for...",value:n.description,onChange:i=>o({...n,description:i.target.value}),required:!0})]}),e.jsxs("div",{className:s.modalActions,children:[e.jsx("button",{type:"button",onClick:h,className:s.cancelBtn,children:"Cancel"}),e.jsxs("button",{type:"submit",className:s.primaryBtn,disabled:C.length===0,children:[e.jsx(L,{size:16})," Record Disbursement"]})]})]})]})})}export{xs as TrustAccountingPage};
