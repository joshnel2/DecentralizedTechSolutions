import{r as l,a6 as e,h as _}from"./vendor-DrKzkH4x.js";import{g as W,p as Z}from"./documentParser-BCJJeAJ6.js";import{n as q}from"./index-CCWWoMiH.js";import{a as Q}from"./router-CNLU_KyZ.js";import{al as ee,aZ as I,L as O,F as E,X as ne,U as te,S as z,o as g,t as j,ar as N,aB as se,Y as ae}from"./icons-BtUkkwGS.js";import"./doc-parsers-U1nJMjtM.js";import"./react-dom-DfB-QKj2.js";import"./pdf-worker-CVmCB3lP.js";import"./state-72d44OIA.js";const re="_redlinePage_1ahrt_1",ce="_fadeIn_1ahrt_1",oe="_header_1ahrt_14",ie="_backBtn_1ahrt_18",le="_headerTitle_1ahrt_38",de="_headerDesc_1ahrt_57",he="_setupContainer_1ahrt_64",pe="_uploadSection_1ahrt_72",me="_instructionsSection_1ahrt_73",ue="_uploadBox_1ahrt_88",xe="_fileTypes_1ahrt_113",_e="_uploadedFile_1ahrt_118",ge="_fileInfo_1ahrt_133",je="_fileName_1ahrt_140",fe="_fileSize_1ahrt_145",Ce="_removeBtn_1ahrt_150",Ne="_hint_1ahrt_187",ve="_processBtn_1ahrt_193",we="_spinner_1ahrt_219",be="_spin_1ahrt_219",ye="_error_1ahrt_227",Te="_resultsContainer_1ahrt_240",ke="_toolbar_1ahrt_247",Be="_toolbarLeft_1ahrt_259",Se="_changeCount_1ahrt_265",Re="_statusSummary_1ahrt_270",De="_accepted_1ahrt_276",Ae="_declined_1ahrt_280",Ie="_pending_1ahrt_284",Oe="_toolbarRight_1ahrt_288",Ee="_toolBtn_1ahrt_294",ze="_downloadDropdown_1ahrt_314",Pe="_downloadBtn_1ahrt_318",Fe="_downloadMenu_1ahrt_338",Me="_changesPanel_1ahrt_393",Le="_trackedChangesContainer_1ahrt_411",$e="_changeItem_1ahrt_419",Ue="_changeHeader_1ahrt_443",He="_changeType_1ahrt_450",Xe="_insertion_1ahrt_458",Ye="_deletion_1ahrt_463",Ge="_replacement_1ahrt_468",Je="_changeStatus_1ahrt_473",Ve="_changeContent_1ahrt_490",Ke="_originalText_1ahrt_496",We="_replacementText_1ahrt_497",Ze="_label_1ahrt_503",qe="_deleted_1ahrt_509",Qe="_inserted_1ahrt_520",en="_changeReason_1ahrt_530",nn="_changeActions_1ahrt_548",tn="_actionBtn_1ahrt_556",sn="_acceptBtn_1ahrt_569",an="_declineBtn_1ahrt_583",rn="_previewPanel_1ahrt_598",cn="_previewTabs_1ahrt_605",on="_previewContent_1ahrt_617",ln="_startOverBtn_1ahrt_633",dn="_contextMenu_1ahrt_655",t={redlinePage:re,fadeIn:ce,header:oe,backBtn:ie,headerTitle:le,headerDesc:de,setupContainer:he,uploadSection:pe,instructionsSection:me,uploadBox:ue,fileTypes:xe,uploadedFile:_e,fileInfo:ge,fileName:je,fileSize:fe,removeBtn:Ce,hint:Ne,processBtn:ve,spinner:we,spin:be,error:ye,resultsContainer:Te,toolbar:ke,toolbarLeft:Be,changeCount:Se,statusSummary:Re,accepted:De,declined:Ae,pending:Ie,toolbarRight:Oe,toolBtn:Ee,downloadDropdown:ze,downloadBtn:Pe,downloadMenu:Fe,changesPanel:Me,trackedChangesContainer:Le,changeItem:$e,changeHeader:Ue,changeType:He,insertion:Xe,deletion:Ye,replacement:Ge,changeStatus:Je,changeContent:Ve,originalText:Ke,replacementText:We,label:Ze,deleted:qe,inserted:Qe,changeReason:en,changeActions:nn,actionBtn:tn,acceptBtn:sn,declineBtn:an,previewPanel:rn,previewTabs:cn,previewContent:on,startOverBtn:ln,contextMenu:dn};function Cn(){const P=Q(),v=l.useRef(null),[c,f]=l.useState(null),[C,w]=l.useState(""),[b,y]=l.useState(!1),[F,T]=l.useState(!1),[s,d]=l.useState(null),[k,m]=l.useState(null),[h,u]=l.useState(null),[B,S]=l.useState(!1),M=async n=>{var o;const r=(o=n.target.files)==null?void 0:o[0];if(r){n.target.value="",T(!0),m(null);try{const a=await Z(r);if(!a.success&&!a.content)throw new Error(a.error||"Failed to extract text from document");f({name:r.name,content:a.content,type:r.type}),d(null)}catch(a){console.error("Failed to extract document text:",a),m("Failed to extract text from document. Please try a different file format.")}finally{T(!1)}}},L=async()=>{if(c){y(!0),m(null);try{const n=`You are a professional document editor. Your task is to edit the following document to improve it.

${C?`EDITING INSTRUCTIONS FROM USER:
${C}

`:`Make improvements for clarity, grammar, and professional tone.

`}IMPORTANT RULES:
1. Always maintain proper grammar and punctuation
2. Preserve the original meaning and intent
3. Keep legal terminology accurate
4. Make the document more professional and clear

DOCUMENT TO EDIT:
---
${c.content}
---

RESPONSE FORMAT:
You MUST respond with a valid JSON object in this exact format (no markdown, no code blocks, just raw JSON):
{
  "editedText": "The complete edited document text here",
  "changes": [
    {
      "type": "replacement",
      "original": "original text that was changed",
      "replacement": "new text that replaces it",
      "reason": "brief explanation of why this change was made"
    }
  ]
}

List ALL changes you made. Types can be:
- "insertion" (new text added, original should be empty string)
- "deletion" (text removed, replacement should be empty string)
- "replacement" (text was replaced with different text)

Be thorough - include every single change, even small grammar fixes.`,r=await q.chat(n,"redline-editor",{});let o;try{let i=r.response;i=i.replace(/```json\s*/g,"").replace(/```\s*/g,"");const p=i.match(/\{[\s\S]*\}/);p&&(i=p[0]),o=JSON.parse(i)}catch(i){throw console.error("Failed to parse AI response:",i),console.log("Raw response:",r.response),new Error("Failed to parse AI response. Please try again.")}const a=(o.changes||[]).map((i,p)=>({id:`change-${p}-${Date.now()}`,type:i.type||"replacement",original:i.original||"",replacement:i.replacement||"",position:p,status:"pending",context:i.reason}));d({originalText:c.content,editedText:o.editedText||c.content,changes:a})}catch(n){console.error("AI processing error:",n),m(n instanceof Error?n.message:"Failed to process document. Please try again.")}finally{y(!1)}}},$=l.useCallback((n,r)=>{n.preventDefault(),u({x:n.clientX,y:n.clientY,changeId:r})},[]);l.useEffect(()=>{const n=()=>u(null);return document.addEventListener("click",n),()=>document.removeEventListener("click",n)},[]);const R=n=>{s&&(d({...s,changes:s.changes.map(r=>r.id===n?{...r,status:"accepted"}:r)}),u(null))},D=n=>{s&&(d({...s,changes:s.changes.map(r=>r.id===n?{...r,status:"declined"}:r)}),u(null))},U=()=>{s&&d({...s,changes:s.changes.map(n=>({...n,status:"accepted"}))})},H=()=>{s&&d({...s,changes:s.changes.map(n=>({...n,status:"declined"}))})},X=()=>{s&&d({...s,changes:s.changes.map(n=>({...n,status:"pending"}))})},A=l.useCallback(()=>{if(!s||!c)return(c==null?void 0:c.content)||"";let n=s.originalText;return s.changes.filter(a=>a.status==="accepted").forEach(a=>{a.type==="deletion"?n=n.replace(a.original,""):a.type==="insertion"||a.type==="replacement"&&(n=n.replace(a.original,a.replacement))}),s.changes.every(a=>a.status==="accepted")?s.editedText:s.changes.every(a=>a.status==="declined"||a.status==="pending")?s.originalText:n},[s,c]),x=(n,r)=>{const o=new Blob([n],{type:"text/plain;charset=utf-8"}),a=URL.createObjectURL(o),i=document.createElement("a");i.href=a,i.download=r,document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(a),S(!1)},Y=()=>{if(!s||!c)return;let n=`=== REDLINED DOCUMENT ===
`;n+=`Original File: ${c.name}
`,n+=`Total Changes: ${s.changes.length}
`,n+=`========================

`,n+=s.editedText+`

`,n+=`=== CHANGE LOG ===
`,s.changes.forEach((o,a)=>{n+=`
[Change ${a+1}] ${o.type.toUpperCase()}
`,o.original&&(n+=`  Original: "${o.original}"
`),o.replacement&&(n+=`  Replacement: "${o.replacement}"
`),o.context&&(n+=`  Reason: ${o.context}
`),n+=`  Status: ${o.status}
`});const r=c.name.replace(/\.[^/.]+$/,"");x(n,`${r}_redlined.txt`)},G=()=>{if(!s||!c)return;const n=c.name.replace(/\.[^/.]+$/,"");x(s.editedText,`${n}_final.txt`)},J=()=>{if(!c)return;const n=A(),r=c.name.replace(/\.[^/.]+$/,"");x(n,`${r}_custom.txt`)},V=()=>{if(!c)return;const n=c.name.replace(/\.[^/.]+$/,"");x(c.content,`${n}_original.txt`)},K=()=>s?e.jsx("div",{className:t.trackedChangesContainer,children:s.changes.map(n=>e.jsxs("div",{className:_(t.changeItem,t[n.type],t[n.status]),onContextMenu:r=>$(r,n.id),children:[e.jsxs("div",{className:t.changeHeader,children:[e.jsxs("span",{className:t.changeType,children:[n.type==="insertion"&&"+ Added",n.type==="deletion"&&"− Deleted",n.type==="replacement"&&"↔ Changed"]}),e.jsxs("span",{className:_(t.changeStatus,t[n.status]),children:[n.status==="pending"&&"Pending",n.status==="accepted"&&"✓ Accepted",n.status==="declined"&&"✗ Declined"]})]}),e.jsxs("div",{className:t.changeContent,children:[n.original&&e.jsxs("div",{className:t.originalText,children:[e.jsx("span",{className:t.label,children:"Original:"}),e.jsx("span",{className:t.deleted,children:n.original})]}),n.replacement&&e.jsxs("div",{className:t.replacementText,children:[e.jsx("span",{className:t.label,children:"New:"}),e.jsx("span",{className:t.inserted,children:n.replacement})]})]}),n.context&&e.jsxs("div",{className:t.changeReason,children:[e.jsx(z,{size:12}),n.context]}),e.jsxs("div",{className:t.changeActions,children:[e.jsxs("button",{className:_(t.actionBtn,t.acceptBtn),onClick:()=>R(n.id),disabled:n.status==="accepted",children:[e.jsx(j,{size:14})," Accept"]}),e.jsxs("button",{className:_(t.actionBtn,t.declineBtn),onClick:()=>D(n.id),disabled:n.status==="declined",children:[e.jsx(g,{size:14})," Decline"]})]})]},n.id))}):null;return e.jsxs("div",{className:t.redlinePage,children:[e.jsxs("div",{className:t.header,children:[e.jsxs("button",{className:t.backBtn,onClick:()=>P("/app/ai"),children:[e.jsx(ee,{size:18}),"Back to AI Assistant"]}),e.jsxs("div",{className:t.headerTitle,children:[e.jsx(I,{size:24}),e.jsx("h1",{children:"Redline AI"})]}),e.jsx("p",{className:t.headerDesc,children:"Upload a document, provide optional instructions, and let AI suggest improvements with tracked changes."})]}),s?e.jsxs("div",{className:t.resultsContainer,children:[e.jsxs("div",{className:t.toolbar,children:[e.jsxs("div",{className:t.toolbarLeft,children:[e.jsxs("span",{className:t.changeCount,children:[s.changes.length," change",s.changes.length!==1?"s":""," found"]}),e.jsxs("span",{className:t.statusSummary,children:[e.jsxs("span",{className:t.accepted,children:[s.changes.filter(n=>n.status==="accepted").length," accepted"]}),e.jsxs("span",{className:t.declined,children:[s.changes.filter(n=>n.status==="declined").length," declined"]}),e.jsxs("span",{className:t.pending,children:[s.changes.filter(n=>n.status==="pending").length," pending"]})]})]}),e.jsxs("div",{className:t.toolbarRight,children:[e.jsxs("button",{className:t.toolBtn,onClick:U,children:[e.jsx(j,{size:16})," Accept All"]}),e.jsxs("button",{className:t.toolBtn,onClick:H,children:[e.jsx(g,{size:16})," Decline All"]}),e.jsxs("button",{className:t.toolBtn,onClick:X,children:[e.jsx(N,{size:16})," Reset"]}),e.jsxs("div",{className:t.downloadDropdown,children:[e.jsxs("button",{className:t.downloadBtn,onClick:()=>S(!B),children:[e.jsx(se,{size:16}),"Download",e.jsx(ae,{size:14})]}),B&&e.jsxs("div",{className:t.downloadMenu,children:[e.jsxs("button",{onClick:J,children:[e.jsx(E,{size:16}),e.jsxs("div",{children:[e.jsx("span",{children:"This Version"}),e.jsx("small",{children:"Based on your accept/decline choices"})]})]}),e.jsxs("button",{onClick:G,children:[e.jsx(j,{size:16}),e.jsxs("div",{children:[e.jsx("span",{children:"Final (All Changes)"}),e.jsx("small",{children:"All AI suggestions applied"})]})]}),e.jsxs("button",{onClick:Y,children:[e.jsx(I,{size:16}),e.jsxs("div",{children:[e.jsx("span",{children:"Redlined Version"}),e.jsx("small",{children:"With change log and annotations"})]})]}),e.jsxs("button",{onClick:V,children:[e.jsx(N,{size:16}),e.jsxs("div",{children:[e.jsx("span",{children:"Original Document"}),e.jsx("small",{children:"Unmodified source document"})]})]})]})]})]})]}),e.jsxs("div",{className:t.changesPanel,children:[e.jsx("h3",{children:"Tracked Changes"}),e.jsx("p",{className:t.hint,children:"Right-click on any change to accept or decline it."}),K()]}),e.jsxs("div",{className:t.previewPanel,children:[e.jsx("div",{className:t.previewTabs,children:e.jsx("h3",{children:"Document Preview"})}),e.jsx("div",{className:t.previewContent,children:e.jsx("pre",{children:A()})})]}),e.jsxs("button",{className:t.startOverBtn,onClick:()=>{d(null),f(null),w("")},children:[e.jsx(N,{size:18}),"Start Over with New Document"]})]}):e.jsxs("div",{className:t.setupContainer,children:[e.jsxs("div",{className:t.uploadSection,children:[e.jsx("h3",{children:"1. Upload Document"}),F?e.jsxs("div",{className:t.uploadBox,children:[e.jsx(O,{size:32,className:t.spinner}),e.jsx("span",{children:"Extracting text from document..."})]}):c?e.jsxs("div",{className:t.uploadedFile,children:[e.jsx(E,{size:24}),e.jsxs("div",{className:t.fileInfo,children:[e.jsx("span",{className:t.fileName,children:c.name}),e.jsxs("span",{className:t.fileSize,children:[c.content.length.toLocaleString()," characters extracted"]})]}),e.jsx("button",{className:t.removeBtn,onClick:()=>f(null),children:e.jsx(ne,{size:18})})]}):e.jsxs("button",{className:t.uploadBox,onClick:()=>{var n;return(n=v.current)==null?void 0:n.click()},children:[e.jsx(te,{size:32}),e.jsx("span",{children:"Click to upload or drag & drop"}),e.jsx("span",{className:t.fileTypes,children:"PDF, DOCX, DOC, TXT, RTF"})]}),e.jsx("input",{type:"file",ref:v,onChange:M,style:{display:"none"},accept:W()})]}),e.jsxs("div",{className:t.instructionsSection,children:[e.jsx("h3",{children:"2. Add Instructions (Optional)"}),e.jsx("textarea",{value:C,onChange:n=>w(n.target.value),placeholder:"E.g., 'Make this more formal', 'Simplify the language', 'Fix grammar and punctuation', 'Make it more concise'...",rows:4}),e.jsx("p",{className:t.hint,children:"Leave blank for general improvements to grammar, clarity, and professionalism."})]}),e.jsx("button",{className:t.processBtn,onClick:L,disabled:!c||b,children:b?e.jsxs(e.Fragment,{children:[e.jsx(O,{size:20,className:t.spinner}),"Processing with AI..."]}):e.jsxs(e.Fragment,{children:[e.jsx(z,{size:20}),"Generate Redline"]})}),k&&e.jsxs("div",{className:t.error,children:[e.jsx(g,{size:18}),k]})]}),h&&e.jsxs("div",{className:t.contextMenu,style:{top:h.y,left:h.x},children:[e.jsxs("button",{onClick:()=>R(h.changeId),children:[e.jsx(j,{size:14})," Accept Change"]}),e.jsxs("button",{onClick:()=>D(h.changeId),children:[e.jsx(g,{size:14})," Decline Change"]})]})]})}export{Cn as RedlineAIPage};
