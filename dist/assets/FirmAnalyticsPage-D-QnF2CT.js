import{a6 as e,r as _}from"./vendor-DrKzkH4x.js";import{b as he,a as ue,u as me,e as X}from"./index-CCWWoMiH.js";import{p as J}from"./dateUtils-Bq7Z0P5c.js";import{S as _e,A as D,R as Z,aB as xe,D as ee,aK as pe,aM as je,G as ge,J as te,aL as ve,bw as be,x as ae,Q as se,y as P}from"./icons-BtUkkwGS.js";import{e as f,s as A,l as R,p as $,k as I,f as L}from"./date-utils-BkNAU8cl.js";import{R as B,A as ke,c as V,X as E,Y as O,T as z,L as ye,a as ne,P as Ne,b as Ce,C as Se,B as ie,d as re}from"./charts-CBxIs53B.js";import"./doc-parsers-U1nJMjtM.js";import"./react-dom-DfB-QKj2.js";import"./pdf-worker-CVmCB3lP.js";import"./router-CNLU_KyZ.js";import"./state-72d44OIA.js";const fe="_aiButtonWrapper_nq55l_1",Ae="_aiButton_nq55l_1",Re="_sparkle_nq55l_1",Le="_button_nq55l_50",Me="_icon_nq55l_54",$e="_inline_nq55l_62",Ie="_sm_nq55l_76",Be="_lg_nq55l_86",ze="_aiPanel_nq55l_97",Te="_panelSlide_nq55l_1",Fe="_panelHeader_nq55l_122",He="_panelTitle_nq55l_131",we="_closeBtn_nq55l_143",qe="_panelContent_nq55l_162",De="_contextLabel_nq55l_166",Pe="_promptGrid_nq55l_172",Ve="_promptBtn_nq55l_178",Ee="_loadingState_nq55l_196",Oe="_spinner_nq55l_206",Ge="_spin_nq55l_206",Ue="_loadingDots_nq55l_216",Ke="_bounce_nq55l_1",Ye="_resultContainer_nq55l_239",We="_resultHeader_nq55l_245",Qe="_resultLabel_nq55l_251",Xe="_resultActions_nq55l_259",Je="_resultText_nq55l_283",Ze="_newQueryBtn_nq55l_303",et="_inlineSuggestion_nq55l_321",tt="_slideIn_nq55l_1",at="_suggestionIcon_nq55l_343",st="_suggestionContent_nq55l_355",nt="_suggestionLabel_nq55l_360",it="_suggestionActions_nq55l_376",rt="_acceptBtn_nq55l_383",lt="_dismissBtn_nq55l_399",ot="_aiStatus_nq55l_417",ct="_ready_nq55l_427",dt="_analyzing_nq55l_432",ht="_complete_nq55l_437",ut="_aiInsightsCard_nq55l_443",mt="_aiInsightsHeader_nq55l_450",_t="_aiInsightsList_nq55l_467",xt="_aiInsightItem_nq55l_473",T={aiButtonWrapper:fe,aiButton:Ae,sparkle:Re,button:Le,icon:Me,inline:$e,sm:Ie,lg:Be,aiPanel:ze,panelSlide:Te,panelHeader:Fe,panelTitle:He,closeBtn:we,panelContent:qe,contextLabel:De,promptGrid:Pe,promptBtn:Ve,loadingState:Ee,spinner:Oe,spin:Ge,loadingDots:Ue,bounce:Ke,resultContainer:Ye,resultHeader:We,resultLabel:Qe,resultActions:Xe,resultText:Je,newQueryBtn:Ze,inlineSuggestion:et,slideIn:tt,suggestionIcon:at,suggestionContent:st,suggestionLabel:nt,suggestionActions:it,acceptBtn:rt,dismissBtn:lt,aiStatus:ot,ready:ct,analyzing:dt,complete:ht,aiInsightsCard:ut,aiInsightsHeader:mt,aiInsightsList:_t,aiInsightItem:xt};function F({context:y,contextData:x,onInsight:p,variant:j="button",size:g="md",label:v="AI Assist",prompts:G}){const{openChat:k}=he(),H=`${T.aiButton} ${T[j]} ${T[g]}`;return e.jsx("div",{className:T.aiButtonWrapper,children:e.jsxs("button",{className:H,onClick:()=>k(),title:"Open AI Assistant",children:[e.jsx(_e,{size:j==="icon"?16:18}),j!=="icon"&&e.jsx("span",{children:v})]})})}const pt="_analyticsPage_nkgje_1",jt="_noAccess_nkgje_6",gt="_header_nkgje_25",vt="_headerLeft_nkgje_32",bt="_headerActions_nkgje_45",kt="_dateFilter_nkgje_51",yt="_exportBtn_nkgje_66",Nt="_spinning_nkgje_94",Ct="_spin_nkgje_94",St="_tabs_nkgje_99",ft="_tab_nkgje_99",At="_active_nkgje_123",Rt="_kpiGrid_nkgje_130",Lt="_kpiCard_nkgje_137",Mt="_kpiIcon_nkgje_147",$t="_kpiContent_nkgje_157",It="_kpiLabel_nkgje_161",Bt="_kpiValue_nkgje_168",zt="_kpiChange_nkgje_176",Tt="_positive_nkgje_184",Ft="_negative_nkgje_188",Ht="_kpiSubtext_nkgje_192",wt="_chartsRow_nkgje_200",qt="_chartCard_nkgje_207",Dt="_chartHeader_nkgje_214",Pt="_chartSubtitle_nkgje_228",Vt="_chartBody_nkgje_233",Et="_tableCard_nkgje_238",Ot="_tableHeader_nkgje_245",Gt="_table_nkgje_238",Ut="_memberCell_nkgje_298",Kt="_memberAvatar_nkgje_304",Yt="_utilizationBar_nkgje_317",Wt="_utilizationFill_nkgje_323",Qt="_revenue_nkgje_330",Xt="_statusBadge_nkgje_335",Jt="_draft_nkgje_344",Zt="_sent_nkgje_349",ea="_paid_nkgje_354",ta="_overdue_nkgje_359",aa="_pending_nkgje_369",sa="_closed_won_nkgje_374",na="_closed_settled_nkgje_375",ia="_revenueTab_nkgje_381",ra="_revenueCards_nkgje_387",la="_revenueCard_nkgje_387",oa="_bigNumber_nkgje_407",ca="_danger_nkgje_415",da="_teamTab_nkgje_426",ha="_teamGrid_nkgje_430",ua="_teamCard_nkgje_436",ma="_teamCardHeader_nkgje_443",_a="_teamAvatar_nkgje_450",xa="_teamStats_nkgje_482",pa="_teamStat_nkgje_482",ja="_teamStatLabel_nkgje_496",ga="_teamStatValue_nkgje_505",va="_teamUtilization_nkgje_512",ba="_utilizationHeader_nkgje_517",ka="_utilizationTrack_nkgje_525",ya="_utilizationProgress_nkgje_532",Na="_mattersTab_nkgje_539",Ca="_matterStats_nkgje_545",Sa="_matterStatCard_nkgje_551",fa="_matterStatValue_nkgje_565",Aa="_matterStatLabel_nkgje_573",Ra="_matterCell_nkgje_579",La="_matterName_nkgje_585",Ma="_matterNumber_nkgje_591",t={analyticsPage:pt,noAccess:jt,header:gt,headerLeft:vt,headerActions:bt,dateFilter:kt,exportBtn:yt,spinning:Nt,spin:Ct,tabs:St,tab:ft,active:At,kpiGrid:Rt,kpiCard:Lt,kpiIcon:Mt,kpiContent:$t,kpiLabel:It,kpiValue:Bt,kpiChange:zt,positive:Tt,negative:Ft,kpiSubtext:Ht,chartsRow:wt,chartCard:qt,chartHeader:Dt,chartSubtitle:Pt,chartBody:Vt,tableCard:Et,tableHeader:Ot,table:Gt,memberCell:Ut,memberAvatar:Kt,utilizationBar:Yt,utilizationFill:Wt,revenue:Qt,statusBadge:Xt,draft:Jt,sent:Zt,paid:ea,overdue:ta,pending:aa,closed_won:sa,closed_settled:na,revenueTab:ia,revenueCards:ra,revenueCard:la,bigNumber:oa,danger:ca,teamTab:da,teamGrid:ha,teamCard:ua,teamCardHeader:ma,teamAvatar:_a,teamStats:xa,teamStat:pa,teamStatLabel:ja,teamStatValue:ga,teamUtilization:va,utilizationHeader:ba,utilizationTrack:ka,utilizationProgress:ya,mattersTab:Na,matterStats:Ca,matterStatCard:Sa,matterStatValue:fa,matterStatLabel:Aa,matterCell:Ra,matterName:La,matterNumber:Ma},le=["#D4AF37","#8B5CF6","#3B82F6","#10B981","#F59E0B","#EF4444"],$a={thisMonth:"current_month",lastMonth:"last_month",last3Months:"last_quarter",last6Months:"last_6_months",thisYear:"year_to_date",allTime:"all_time"};function Oa(){var Y,W,Q;const{timeEntries:y,invoices:x,matters:p,clients:j}=ue(),{user:g}=me(),[v,G]=_.useState("thisMonth"),[k,H]=_.useState("overview"),[n,oe]=_.useState(null),[N,U]=_.useState(!0),[M,ce]=_.useState(null),w=_.useCallback(async()=>{try{U(!0);const a=$a[v]||"current_month",[s,l]=await Promise.all([X.getFirmDashboard(a),X.getAttorneyProduction()]);s.success&&oe(s.data),l.success&&ce(l.data)}catch(a){console.error("Failed to fetch firm analytics:",a)}finally{U(!1)}},[v]);_.useEffect(()=>{w()},[w]);const C=_.useMemo(()=>{const a=new Date;switch(v){case"thisMonth":return{start:A(a),end:f(a)};case"lastMonth":return{start:A(R(a,1)),end:f(R(a,1))};case"last3Months":return{start:A(R(a,2)),end:f(a)};case"last6Months":return{start:A(R(a,5)),end:f(a)};case"thisYear":return{start:new Date(a.getFullYear(),0,1),end:a};default:return{start:A(a),end:f(a)}}},[v]),r=_.useMemo(()=>{if(n)return{totalInvoiced:n.invoices.total_invoiced,totalCollected:n.invoices.total_collected,outstanding:n.invoices.total_outstanding,overdue:n.invoices.total_overdue,growthRate:n.changes.revenue_change_percent,collectionRate:n.invoices.collection_rate};const a=x.filter(o=>{const m=$(o.issueDate);return I(m,C)}),s=a.reduce((o,m)=>o+m.total,0),l=a.reduce((o,m)=>o+m.amountPaid,0),u=s-l,d=a.filter(o=>o.status==="overdue").reduce((o,m)=>o+(m.total-m.amountPaid),0),i=s*.85,c=i>0?(s-i)/i*100:0;return{totalInvoiced:s,totalCollected:l,outstanding:u,overdue:d,growthRate:c,collectionRate:0}},[x,C,n]),h=_.useMemo(()=>{if(n)return{totalHours:n.summary.total_hours,billableHours:n.summary.billable_hours,billedAmount:n.summary.billable_amount,utilizationRate:n.productivity.utilization_rate,unbilledHours:n.summary.unbilled_hours,unbilledAmount:n.summary.unbilled_amount};const a=y.filter(i=>{const c=J(i.date);return I(c,C)}),s=a.reduce((i,c)=>i+c.hours,0),l=a.filter(i=>i.billable).reduce((i,c)=>i+c.hours,0),u=a.filter(i=>i.billable).reduce((i,c)=>i+c.amount,0),d=s>0?l/s*100:0;return{totalHours:s,billableHours:l,billedAmount:u,utilizationRate:d,unbilledHours:0,unbilledAmount:0}},[y,C,n]),b=_.useMemo(()=>{if(n)return{activeMatters:n.matters.active,avgMatterValue:n.matters.total>0?r.totalInvoiced/n.matters.total:0,realizationRate:h.billedAmount>0?r.totalCollected/h.billedAmount*100:0,effectiveRate:h.billableHours>0?r.totalCollected/h.billableHours:0,totalMatters:n.matters.total,totalClients:n.clients.total};const a=p.filter(d=>d.status==="active").length,s=p.length>0?r.totalInvoiced/p.length:0,l=h.billedAmount>0?r.totalCollected/h.billedAmount*100:0,u=h.billableHours>0?r.totalCollected/h.billableHours:0;return{activeMatters:a,avgMatterValue:s,realizationRate:l,effectiveRate:u,totalMatters:p.length,totalClients:j.length}},[p,j,r,h,n]),S=_.useMemo(()=>n!=null&&n.team_productivity?n.team_productivity.filter(a=>a.total_hours>0):[],[n]),q=_.useMemo(()=>{if(n!=null&&n.revenue_by_practice_area)return n.revenue_by_practice_area.map(s=>({name:(s.type||"unassigned").replace(/_/g," "),value:s.total_amount}));const a={};return y.forEach(s=>{const l=J(s.date);if(I(l,C)&&s.billable){const u=p.find(d=>d.id===s.matterId);if(u){const d=(u.type||"other").replace(/_/g," ");a[d]=(a[d]||0)+s.amount}}}),Object.entries(a).map(([s,l])=>({name:s,value:l})).sort((s,l)=>l.value-s.value)},[y,p,C]),K=_.useMemo(()=>{if(n!=null&&n.monthly_trend&&n.monthly_trend.length>0)return n.monthly_trend.map(s=>({month:L(new Date(s.month),"MMM"),invoiced:Math.round(s.billable_amount),collected:Math.round(s.total_amount),hours:Math.round(s.billable_hours)}));const a=[];for(let s=5;s>=0;s--){const l=A(R(new Date,s)),u=f(R(new Date,s)),d=x.filter(o=>{const m=$(o.issueDate);return I(m,{start:l,end:u})}),i=d.reduce((o,m)=>o+m.total,0),c=d.reduce((o,m)=>o+m.amountPaid,0);a.push({month:L(l,"MMM"),invoiced:i,collected:c,hours:0})}return a},[x,n]),de=()=>{const a=L(new Date,"yyyy-MM-dd"),s=v.replace(/([A-Z])/g," $1").trim(),u=[`Firm Analytics Report - ${a}`,`Period: ${s}`,"","KEY METRICS",`Total Invoiced,$${r.totalInvoiced.toLocaleString()}`,`Total Collected,$${r.totalCollected.toLocaleString()}`,`Outstanding,$${r.outstanding.toLocaleString()}`,`Overdue,$${r.overdue.toLocaleString()}`,`Collection Rate,${r.totalInvoiced>0?(r.totalCollected/r.totalInvoiced*100).toFixed(1):0}%`,"","TIME METRICS",`Total Hours,${h.totalHours.toFixed(1)}`,`Billable Hours,${h.billableHours.toFixed(1)}`,`Utilization Rate,${h.utilizationRate.toFixed(1)}%`,`Effective Hourly Rate,$${b.effectiveRate.toFixed(2)}`,"","MATTER METRICS",`Active Matters,${b.activeMatters}`,`Total Clients,${j.length}`,`Avg Matter Value,$${b.avgMatterValue.toFixed(2)}`,`Realization Rate,${b.realizationRate.toFixed(1)}%`,"","REVENUE BY PRACTICE AREA",...q.map(o=>`${o.name},$${o.value.toLocaleString()}`),"","MONTHLY TREND","Month,Invoiced,Collected",...K.map(o=>`${o.month},$${o.invoiced.toLocaleString()},$${o.collected.toLocaleString()}`)].join(`
`),d=new Blob([u],{type:"text/csv"}),i=URL.createObjectURL(d),c=document.createElement("a");c.href=i,c.download=`firm-analytics-${a}.csv`,c.click(),URL.revokeObjectURL(i)};return(g==null?void 0:g.role)==="admin"||(g==null?void 0:g.role)==="owner"?e.jsxs("div",{className:t.analyticsPage,children:[e.jsxs("div",{className:t.header,children:[e.jsxs("div",{className:t.headerLeft,children:[e.jsx("h1",{children:"Firm Analytics"}),e.jsx("p",{children:N?"Loading firm data...":n?"Comprehensive firm-wide analytics":"Revenue, productivity, and team performance insights"})]}),e.jsxs("div",{className:t.headerActions,children:[e.jsxs("button",{className:t.exportBtn,onClick:w,disabled:N,style:{marginRight:"8px"},children:[e.jsx(Z,{size:18,className:N?t.spinning:""}),N?"Loading...":"Refresh"]}),e.jsxs("select",{className:t.dateFilter,value:v,onChange:a=>G(a.target.value),children:[e.jsx("option",{value:"thisMonth",children:"This Month"}),e.jsx("option",{value:"lastMonth",children:"Last Month"}),e.jsx("option",{value:"last3Months",children:"Last 3 Months"}),e.jsx("option",{value:"last6Months",children:"Last 6 Months"}),e.jsx("option",{value:"thisYear",children:"Year to Date"}),e.jsx("option",{value:"allTime",children:"All Time"})]}),e.jsx(F,{context:"Firm Analytics",label:"AI Insights",prompts:[{label:"Summary",prompt:"Summarize performance"},{label:"Trends",prompt:"Identify trends"},{label:"Recommendations",prompt:"Provide recommendations"},{label:"Forecast",prompt:"Revenue forecast"}]}),e.jsxs("button",{className:t.exportBtn,onClick:de,children:[e.jsx(xe,{size:18}),"Export"]})]})]}),e.jsx("div",{className:t.tabs,children:["overview","revenue","team","matters"].map(a=>e.jsx("button",{className:`${t.tab} ${k===a?t.active:""}`,onClick:()=>H(a),children:a.charAt(0).toUpperCase()+a.slice(1)},a))}),k==="overview"&&e.jsxs(e.Fragment,{children:[!N&&r.totalInvoiced===0&&h.totalHours===0&&e.jsxs("div",{style:{background:"linear-gradient(135deg, #F59E0B 0%, #D97706 100%)",color:"white",padding:"1.5rem",borderRadius:"12px",marginBottom:"1.5rem",display:"flex",alignItems:"flex-start",gap:"1rem"},children:[e.jsx(D,{size:24,style:{flexShrink:0,marginTop:"2px"}}),e.jsxs("div",{children:[e.jsx("strong",{style:{fontSize:"1.1rem"},children:"No Data to Display"}),e.jsxs("p",{style:{margin:"0.5rem 0 0 0",opacity:.95},children:["Analytics require ",e.jsx("strong",{children:"time entries"})," and ",e.jsx("strong",{children:"invoices"})," to calculate metrics. To see data here:"]}),e.jsxs("ul",{style:{margin:"0.5rem 0 0 1rem",padding:0},children:[e.jsx("li",{children:"Record billable time entries for matters"}),e.jsx("li",{children:"Create and send invoices to clients"}),e.jsx("li",{children:'Try changing the date range to "All Time"'})]})]})]}),e.jsxs("div",{className:t.kpiGrid,children:[e.jsxs("div",{className:t.kpiCard,children:[e.jsx("div",{className:t.kpiIcon,style:{background:"rgba(212, 175, 55, 0.1)"},children:e.jsx(ee,{size:24,style:{color:"var(--gold-primary)"}})}),e.jsxs("div",{className:t.kpiContent,children:[e.jsx("span",{className:t.kpiLabel,children:"Total Invoiced"}),e.jsxs("span",{className:t.kpiValue,children:["$",r.totalInvoiced.toLocaleString()]}),e.jsxs("span",{className:`${t.kpiChange} ${r.growthRate>=0?t.positive:t.negative}`,children:[r.growthRate>=0?e.jsx(pe,{size:14}):e.jsx(je,{size:14}),Math.abs(r.growthRate).toFixed(1),"% vs last period"]})]})]}),e.jsxs("div",{className:t.kpiCard,children:[e.jsx("div",{className:t.kpiIcon,style:{background:"rgba(16, 185, 129, 0.1)"},children:e.jsx(ge,{size:24,style:{color:"var(--success)"}})}),e.jsxs("div",{className:t.kpiContent,children:[e.jsx("span",{className:t.kpiLabel,children:"Collected"}),e.jsxs("span",{className:t.kpiValue,children:["$",r.totalCollected.toLocaleString()]}),e.jsx("span",{className:t.kpiSubtext,children:r.totalInvoiced>0?`${(r.totalCollected/r.totalInvoiced*100).toFixed(0)}% collection rate`:"No invoices"})]})]}),e.jsxs("div",{className:t.kpiCard,children:[e.jsx("div",{className:t.kpiIcon,style:{background:"rgba(139, 92, 246, 0.1)"},children:e.jsx(te,{size:24,style:{color:"var(--ai-purple)"}})}),e.jsxs("div",{className:t.kpiContent,children:[e.jsx("span",{className:t.kpiLabel,children:"Billable Hours"}),e.jsxs("span",{className:t.kpiValue,children:[h.billableHours.toFixed(1),"h"]}),e.jsxs("span",{className:t.kpiSubtext,children:[h.utilizationRate.toFixed(0),"% utilization rate"]})]})]}),e.jsxs("div",{className:t.kpiCard,children:[e.jsx("div",{className:t.kpiIcon,style:{background:"rgba(239, 68, 68, 0.1)"},children:e.jsx(D,{size:24,style:{color:"#ef4444"}})}),e.jsxs("div",{className:t.kpiContent,children:[e.jsx("span",{className:t.kpiLabel,children:"Outstanding"}),e.jsxs("span",{className:t.kpiValue,children:["$",r.outstanding.toLocaleString()]}),e.jsxs("span",{className:t.kpiSubtext,children:["$",r.overdue.toLocaleString()," overdue"]})]})]}),e.jsxs("div",{className:t.kpiCard,children:[e.jsx("div",{className:t.kpiIcon,style:{background:"rgba(59, 130, 246, 0.1)"},children:e.jsx(ve,{size:24,style:{color:"#3B82F6"}})}),e.jsxs("div",{className:t.kpiContent,children:[e.jsx("span",{className:t.kpiLabel,children:"Effective Rate"}),e.jsxs("span",{className:t.kpiValue,children:["$",b.effectiveRate.toFixed(0),"/hr"]}),e.jsx("span",{className:t.kpiSubtext,children:"Based on collected revenue"})]})]}),e.jsxs("div",{className:t.kpiCard,children:[e.jsx("div",{className:t.kpiIcon,style:{background:"rgba(245, 158, 11, 0.1)"},children:e.jsx(be,{size:24,style:{color:"#F59E0B"}})}),e.jsxs("div",{className:t.kpiContent,children:[e.jsx("span",{className:t.kpiLabel,children:"Realization Rate"}),e.jsxs("span",{className:t.kpiValue,children:[b.realizationRate.toFixed(0),"%"]}),e.jsx("span",{className:t.kpiSubtext,children:"Collected vs billed"})]})]}),e.jsxs("div",{className:t.kpiCard,children:[e.jsx("div",{className:t.kpiIcon,style:{background:"rgba(16, 185, 129, 0.1)"},children:e.jsx(ae,{size:24,style:{color:"#10B981"}})}),e.jsxs("div",{className:t.kpiContent,children:[e.jsx("span",{className:t.kpiLabel,children:"Active Matters"}),e.jsx("span",{className:t.kpiValue,children:b.activeMatters}),e.jsxs("span",{className:t.kpiSubtext,children:[j.length," clients"]})]})]}),e.jsxs("div",{className:t.kpiCard,children:[e.jsx("div",{className:t.kpiIcon,style:{background:"rgba(139, 92, 246, 0.1)"},children:e.jsx(se,{size:24,style:{color:"#8B5CF6"}})}),e.jsxs("div",{className:t.kpiContent,children:[e.jsx("span",{className:t.kpiLabel,children:"Avg Matter Value"}),e.jsxs("span",{className:t.kpiValue,children:["$",b.avgMatterValue.toLocaleString(void 0,{maximumFractionDigits:0})]}),e.jsx("span",{className:t.kpiSubtext,children:"Per matter invoiced"})]})]})]}),e.jsxs("div",{className:t.chartsRow,children:[e.jsxs("div",{className:t.chartCard,children:[e.jsxs("div",{className:t.chartHeader,children:[e.jsx("h3",{children:"Revenue Trend"}),e.jsx("span",{className:t.chartSubtitle,children:"Last 6 months"})]}),e.jsx("div",{className:t.chartBody,children:e.jsx(B,{width:"100%",height:280,children:e.jsxs(ke,{data:K,children:[e.jsxs("defs",{children:[e.jsxs("linearGradient",{id:"invoicedGradient",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:"#D4AF37",stopOpacity:.3}),e.jsx("stop",{offset:"95%",stopColor:"#D4AF37",stopOpacity:0})]}),e.jsxs("linearGradient",{id:"collectedGradient",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:"#10B981",stopOpacity:.3}),e.jsx("stop",{offset:"95%",stopColor:"#10B981",stopOpacity:0})]})]}),e.jsx(V,{strokeDasharray:"3 3",stroke:"var(--border-primary)"}),e.jsx(E,{dataKey:"month",stroke:"var(--text-tertiary)",fontSize:12}),e.jsx(O,{stroke:"var(--text-tertiary)",fontSize:12,tickFormatter:a=>`$${(a/1e3).toFixed(0)}k`}),e.jsx(z,{contentStyle:{background:"var(--bg-secondary)",border:"1px solid var(--border-primary)",borderRadius:"8px"},formatter:a=>[`$${a.toLocaleString()}`,""]}),e.jsx(ye,{}),e.jsx(ne,{type:"monotone",dataKey:"invoiced",name:"Invoiced",stroke:"#D4AF37",fillOpacity:1,fill:"url(#invoicedGradient)"}),e.jsx(ne,{type:"monotone",dataKey:"collected",name:"Collected",stroke:"#10B981",fillOpacity:1,fill:"url(#collectedGradient)"})]})})})]}),e.jsxs("div",{className:t.chartCard,children:[e.jsxs("div",{className:t.chartHeader,children:[e.jsx("h3",{children:"Revenue by Practice Area"}),e.jsx(F,{context:"Practice Area Revenue",variant:"icon",size:"sm"})]}),e.jsx("div",{className:t.chartBody,children:e.jsx(B,{width:"100%",height:280,children:e.jsxs(Ne,{children:[e.jsx(Ce,{data:q,cx:"50%",cy:"50%",innerRadius:60,outerRadius:100,paddingAngle:2,dataKey:"value",label:({name:a,percent:s})=>`${a} ${(s*100).toFixed(0)}%`,labelLine:!1,children:q.map((a,s)=>e.jsx(Se,{fill:le[s%le.length]},`cell-${s}`))}),e.jsx(z,{formatter:a=>[`$${a.toLocaleString()}`,"Revenue"],contentStyle:{background:"var(--bg-secondary)",border:"1px solid var(--border-primary)",borderRadius:"8px"}})]})})})]})]}),M&&e.jsx("div",{className:t.chartsRow,children:e.jsxs("div",{className:t.chartCard,style:{flex:1},children:[e.jsxs("div",{className:t.chartHeader,children:[e.jsx("h3",{children:"Production Value by Attorney"}),e.jsxs("span",{className:t.chartSubtitle,children:["Last 12 months â€¢ Total: $",((W=(Y=M.summary)==null?void 0:Y.total_production_value)==null?void 0:W.toLocaleString())||"0"]})]}),e.jsx("div",{className:t.chartBody,children:e.jsx(B,{width:"100%",height:Math.max(300,M.by_attorney.length*45),children:e.jsxs(ie,{data:M.by_attorney,layout:"vertical",margin:{left:20,right:40},children:[e.jsx(V,{strokeDasharray:"3 3",stroke:"var(--border-primary)"}),e.jsx(E,{type:"number",stroke:"var(--text-tertiary)",fontSize:12,tickFormatter:a=>`$${(a/1e3).toFixed(0)}k`}),e.jsx(O,{type:"category",dataKey:"name",stroke:"var(--text-tertiary)",fontSize:12,width:140,tick:{fill:"var(--text-secondary)"}}),e.jsx(z,{contentStyle:{background:"var(--bg-secondary)",border:"1px solid var(--border-primary)",borderRadius:"8px"},formatter:(a,s)=>s==="production_value"?[`$${a.toLocaleString()}`,"Production Value"]:[a,s],labelFormatter:a=>a}),e.jsx(re,{dataKey:"production_value",fill:"#D4AF37",radius:[0,4,4,0],name:"Production Value"})]})})}),e.jsxs("div",{style:{padding:"12px 16px",borderTop:"1px solid var(--border-primary)",fontSize:"13px",color:"var(--text-secondary)"},children:[e.jsx("strong",{children:"How it's calculated:"})," Billable Hours Ã— Hourly Rate = Production Value. Non-billable entries are excluded."]})]})})]}),k==="revenue"&&e.jsxs("div",{className:t.revenueTab,children:[e.jsxs("div",{className:t.revenueCards,children:[e.jsxs("div",{className:t.revenueCard,children:[e.jsx("h4",{children:"Invoices Sent"}),e.jsx("span",{className:t.bigNumber,children:x.filter(a=>a.status==="sent").length}),e.jsxs("p",{children:["$",x.filter(a=>a.status==="sent").reduce((a,s)=>a+s.total,0).toLocaleString()]})]}),e.jsxs("div",{className:t.revenueCard,children:[e.jsx("h4",{children:"Invoices Paid"}),e.jsx("span",{className:t.bigNumber,children:x.filter(a=>a.status==="paid").length}),e.jsxs("p",{children:["$",x.filter(a=>a.status==="paid").reduce((a,s)=>a+s.total,0).toLocaleString()]})]}),e.jsxs("div",{className:t.revenueCard,children:[e.jsx("h4",{children:"Overdue"}),e.jsx("span",{className:`${t.bigNumber} ${t.danger}`,children:x.filter(a=>a.status==="overdue").length}),e.jsxs("p",{children:["$",x.filter(a=>a.status==="overdue").reduce((a,s)=>a+s.total,0).toLocaleString()]})]})]}),e.jsxs("div",{className:t.tableCard,children:[e.jsx("div",{className:t.tableHeader,children:e.jsx("h3",{children:"Recent Invoices"})}),e.jsxs("table",{className:t.table,children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Invoice #"}),e.jsx("th",{children:"Client"}),e.jsx("th",{children:"Issue Date"}),e.jsx("th",{children:"Due Date"}),e.jsx("th",{children:"Amount"}),e.jsx("th",{children:"Paid"}),e.jsx("th",{children:"Status"})]})}),e.jsx("tbody",{children:x.slice(0,10).map(a=>{const s=j.find(l=>l.id===a.clientId);return e.jsxs("tr",{children:[e.jsx("td",{children:a.number}),e.jsx("td",{children:(s==null?void 0:s.name)||"Unknown"}),e.jsx("td",{children:L($(a.issueDate),"MMM d, yyyy")}),e.jsx("td",{children:L($(a.dueDate),"MMM d, yyyy")}),e.jsxs("td",{children:["$",a.total.toLocaleString()]}),e.jsxs("td",{children:["$",a.amountPaid.toLocaleString()]}),e.jsx("td",{children:e.jsx("span",{className:`${t.statusBadge} ${t[a.status]}`,children:a.status})})]},a.id)})})]})]})]}),k==="team"&&e.jsx("div",{className:t.mattersTab,children:S.length>0?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:t.matterStats,children:[e.jsxs("div",{className:t.matterStatCard,children:[e.jsx(P,{size:24}),e.jsxs("div",{children:[e.jsx("span",{className:t.matterStatValue,children:S.length}),e.jsx("span",{className:t.matterStatLabel,children:"Active Team Members"})]})]}),e.jsxs("div",{className:t.matterStatCard,children:[e.jsx(te,{size:24}),e.jsxs("div",{children:[e.jsxs("span",{className:t.matterStatValue,children:[S.reduce((a,s)=>a+s.billable_hours,0).toFixed(1),"h"]}),e.jsx("span",{className:t.matterStatLabel,children:"Total Billable Hours"})]})]}),e.jsxs("div",{className:t.matterStatCard,children:[e.jsx(ee,{size:24}),e.jsxs("div",{children:[e.jsxs("span",{className:t.matterStatValue,children:["$",(S.reduce((a,s)=>a+s.billable_amount,0)/1e3).toFixed(1),"k"]}),e.jsx("span",{className:t.matterStatLabel,children:"Total Billable Revenue"})]})]})]}),e.jsxs("div",{className:t.tableCard,children:[e.jsxs("div",{className:t.tableHeader,children:[e.jsx("h3",{children:"Team Productivity Rankings"}),e.jsx(F,{context:"Team Productivity",variant:"icon",size:"sm"})]}),e.jsxs("table",{className:t.table,children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Team Member"}),e.jsx("th",{children:"Role"}),e.jsx("th",{children:"Billable Hours"}),e.jsx("th",{children:"Utilization"}),e.jsx("th",{children:"Revenue"}),e.jsx("th",{children:"Effective Rate"}),e.jsx("th",{children:"Matters"})]})}),e.jsx("tbody",{children:S.map((a,s)=>e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("div",{className:t.matterCell,children:e.jsxs("span",{className:t.matterName,children:[s===0&&"ðŸ¥‡ ",s===1&&"ðŸ¥ˆ ",s===2&&"ðŸ¥‰ ",a.name]})})}),e.jsx("td",{children:a.role}),e.jsxs("td",{children:[a.billable_hours.toFixed(1),"h"]}),e.jsx("td",{children:e.jsxs("span",{className:`${t.statusBadge} ${a.utilization_rate>=80?t.active:a.utilization_rate>=60?t.pending:t.closed}`,children:[a.utilization_rate.toFixed(0),"%"]})}),e.jsxs("td",{className:t.revenue,children:["$",a.billable_amount.toLocaleString()]}),e.jsxs("td",{children:["$",a.billable_hours>0?(a.billable_amount/a.billable_hours).toFixed(0):0,"/hr"]}),e.jsx("td",{children:a.matter_count})]},a.id))})]})]}),e.jsx("div",{className:t.chartsRow,children:e.jsxs("div",{className:t.chartCard,style:{flex:1},children:[e.jsx("div",{className:t.chartHeader,children:e.jsx("h3",{children:"Billable Hours by Team Member"})}),e.jsx("div",{className:t.chartBody,children:e.jsx(B,{width:"100%",height:300,children:e.jsxs(ie,{data:S.slice(0,10),layout:"vertical",children:[e.jsx(V,{strokeDasharray:"3 3",stroke:"var(--border-primary)"}),e.jsx(E,{type:"number",stroke:"var(--text-tertiary)",fontSize:12}),e.jsx(O,{type:"category",dataKey:"name",stroke:"var(--text-tertiary)",fontSize:12,width:120,tick:{fill:"var(--text-secondary)"}}),e.jsx(z,{contentStyle:{background:"var(--bg-secondary)",border:"1px solid var(--border-primary)",borderRadius:"8px"},formatter:a=>[`${a.toFixed(1)}h`,"Hours"]}),e.jsx(re,{dataKey:"billable_hours",fill:"#D4AF37",radius:[0,4,4,0]})]})})})]})})]}):N?e.jsxs("div",{style:{textAlign:"center",padding:"60px 20px",color:"var(--text-secondary)"},children:[e.jsx(Z,{size:32,className:t.spinning,style:{marginBottom:"16px"}}),e.jsx("p",{children:"Loading team productivity data..."})]}):e.jsxs("div",{style:{textAlign:"center",padding:"60px 20px",color:"var(--text-secondary)"},children:[e.jsx(P,{size:48,style:{marginBottom:"16px",opacity:.5}}),e.jsx("h3",{children:"No Team Data Available"}),e.jsx("p",{children:"Team productivity data will appear here once time entries are recorded."})]})}),k==="matters"&&e.jsxs("div",{className:t.mattersTab,children:[e.jsxs("div",{className:t.matterStats,children:[e.jsxs("div",{className:t.matterStatCard,children:[e.jsx(ae,{size:24}),e.jsxs("div",{children:[e.jsx("span",{className:t.matterStatValue,children:((Q=n==null?void 0:n.matters)==null?void 0:Q.total)||p.length}),e.jsx("span",{className:t.matterStatLabel,children:"Total Matters"})]})]}),e.jsxs("div",{className:t.matterStatCard,children:[e.jsx(se,{size:24}),e.jsxs("div",{children:[e.jsx("span",{className:t.matterStatValue,children:p.filter(a=>a.status==="active").length}),e.jsx("span",{className:t.matterStatLabel,children:"Active"})]})]}),e.jsxs("div",{className:t.matterStatCard,children:[e.jsx(P,{size:24}),e.jsxs("div",{children:[e.jsx("span",{className:t.matterStatValue,children:j.length}),e.jsx("span",{className:t.matterStatLabel,children:"Clients"})]})]})]}),e.jsxs("div",{className:t.tableCard,children:[e.jsxs("div",{className:t.tableHeader,children:[e.jsx("h3",{children:"Matters by Revenue"}),e.jsx(F,{context:"Matters Revenue",variant:"icon",size:"sm"})]}),e.jsxs("table",{className:t.table,children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Matter"}),e.jsx("th",{children:"Client"}),e.jsx("th",{children:"Type"}),e.jsx("th",{children:"Status"}),e.jsx("th",{children:"Hours"}),e.jsx("th",{children:"Revenue"})]})}),e.jsx("tbody",{children:p.map(a=>{const s=j.find(i=>i.id===a.clientId),l=y.filter(i=>i.matterId===a.id),u=l.reduce((i,c)=>i+c.hours,0),d=l.filter(i=>i.billable).reduce((i,c)=>i+c.amount,0);return e.jsxs("tr",{children:[e.jsx("td",{children:e.jsxs("div",{className:t.matterCell,children:[e.jsx("span",{className:t.matterName,children:a.name}),e.jsx("span",{className:t.matterNumber,children:a.number})]})}),e.jsx("td",{children:(s==null?void 0:s.name)||"Unknown"}),e.jsx("td",{children:(a.type||"other").replace(/_/g," ")}),e.jsx("td",{children:e.jsx("span",{className:`${t.statusBadge} ${t[a.status]}`,children:a.status.replace(/_/g," ")})}),e.jsxs("td",{children:[u.toFixed(1),"h"]}),e.jsxs("td",{className:t.revenue,children:["$",d.toLocaleString()]})]},a.id)})})]})]})]})]}):e.jsxs("div",{className:t.noAccess,children:[e.jsx(D,{size:48}),e.jsx("h2",{children:"Access Denied"}),e.jsx("p",{children:"Only firm administrators can access analytics."})]})}export{Oa as FirmAnalyticsPage};
