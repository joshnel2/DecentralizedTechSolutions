import{r as t,a6 as e}from"./vendor-DrKzkH4x.js";import{a as R,d as G}from"./router-CNLU_KyZ.js";import{l as u,t as U}from"./index-CCWWoMiH.js";import{al as K,a4 as f,t as h,a as W,X as y,H as X,f as q,aO as F,as as J,y as j,ak as b,aB as B,aP as z,K as Q,L as D,$ as Y,aE as Z,ae as ee,v as se,b9 as ne}from"./icons-BtUkkwGS.js";import"./doc-parsers-U1nJMjtM.js";import"./react-dom-DfB-QKj2.js";import"./pdf-worker-CVmCB3lP.js";import"./state-72d44OIA.js";const ie="_page_1vxnv_2",ae="_header_1vxnv_8",te="_backBtn_1vxnv_14",oe="_container_1vxnv_35",re="_titleSection_1vxnv_42",ce="_titleIcon_1vxnv_49",le="_titleText_1vxnv_61",de="_notification_1vxnv_76",me="_slideDown_1vxnv_1",ve="_success_1vxnv_99",pe="_error_1vxnv_105",xe="_notificationClose_1vxnv_111",_e="_folderNav_1vxnv_128",ue="_breadcrumb_1vxnv_132",he="_breadcrumbSegment_1vxnv_143",je="_breadcrumbSep_1vxnv_148",fe="_breadcrumbItem_1vxnv_153",be="_active_1vxnv_173",Ne="_currentFolder_1vxnv_179",ge="_folderHeader_1vxnv_186",Ce="_folderIconLarge_1vxnv_195",Pe="_folderInfo_1vxnv_207",we="_folderPath_1vxnv_219",Se="_addPermissionBtn_1vxnv_228",Ie="_addForm_1vxnv_255",ye="_addFormHeader_1vxnv_260",Fe="_closeFormBtn_1vxnv_275",De="_formContent_1vxnv_290",Le="_formGroup_1vxnv_294",Be="_select_1vxnv_308",ze="_noMembers_1vxnv_331",ke="_permissionOptions_1vxnv_343",Ae="_permissionOption_1vxnv_343",He="_selected_1vxnv_367",Ee="_optionIcon_1vxnv_372",Me="_optionText_1vxnv_389",Te="_optionLabel_1vxnv_396",Oe="_optionDesc_1vxnv_402",Ve="_optionCheck_1vxnv_407",$e="_formActions_1vxnv_419",Re="_cancelBtn_1vxnv_426",Ge="_saveBtn_1vxnv_443",Ue="_permissionsSection_1vxnv_468",Ke="_sectionHeader_1vxnv_472",We="_count_1vxnv_489",Xe="_loading_1vxnv_499",qe="_spinning_1vxnv_509",Je="_spin_1vxnv_509",Qe="_emptyState_1vxnv_518",Ye="_emptyIcon_1vxnv_523",Ze="_permissionsList_1vxnv_552",es="_permissionItem_1vxnv_558",ss="_permissionUser_1vxnv_572",ns="_userAvatar_1vxnv_580",is="_userDetails_1vxnv_592",as="_userName_1vxnv_599",ts="_userType_1vxnv_608",os="_permissionCapabilities_1vxnv_614",rs="_capability_1vxnv_619",cs="_admin_1vxnv_631",ls="_permissionBadge_1vxnv_638",ds="_removeBtn_1vxnv_652",ms="_helpSection_1vxnv_668",vs="_helpHeader_1vxnv_676",ps="_helpContent_1vxnv_691",xs="_helpItem_1vxnv_697",s={page:ie,header:ae,backBtn:te,container:oe,titleSection:re,titleIcon:ce,titleText:le,notification:de,slideDown:me,success:ve,error:pe,notificationClose:xe,folderNav:_e,breadcrumb:ue,breadcrumbSegment:he,breadcrumbSep:je,breadcrumbItem:fe,active:be,currentFolder:Ne,folderHeader:ge,folderIconLarge:Ce,folderInfo:Pe,folderPath:we,addPermissionBtn:Se,addForm:Ie,addFormHeader:ye,closeFormBtn:Fe,formContent:De,formGroup:Le,select:Be,noMembers:ze,permissionOptions:ke,permissionOption:Ae,selected:He,optionIcon:Ee,optionText:Me,optionLabel:Te,optionDesc:Oe,optionCheck:Ve,formActions:$e,cancelBtn:Re,saveBtn:Ge,permissionsSection:Ue,sectionHeader:Ke,count:We,loading:Xe,spinning:qe,spin:Je,emptyState:Qe,emptyIcon:Ye,permissionsList:Ze,permissionItem:es,permissionUser:ss,userAvatar:ns,userDetails:is,userName:as,userType:ts,permissionCapabilities:os,capability:rs,admin:cs,permissionBadge:ls,removeBtn:ds,helpSection:ms,helpHeader:vs,helpContent:ps,helpItem:xs},L=[{value:"view",label:"View Only",description:"Can see files but not download",icon:b,color:"#6b7280"},{value:"download",label:"View & Download",description:"Can view and download files",icon:B,color:"#10b981"},{value:"edit",label:"Editor",description:"Can view, download, and edit files",icon:z,color:"#3b82f6"},{value:"contributor",label:"Contributor",description:"Can create, edit, and delete files",icon:Q,color:"#8b5cf6"},{value:"admin",label:"Folder Admin",description:"Full control including managing permissions",icon:f,color:"#f59e0b"}];function Cs(){const k=R(),[A]=G(),H=A.get("path")||"/",[o,N]=t.useState(H),[d,p]=t.useState([]),[E,M]=t.useState([]),[T,g]=t.useState(!0),[l,c]=t.useState(null),[C,m]=t.useState(!1),[a,x]=t.useState({userId:"",groupId:"",permissionLevel:"view"}),[P,w]=t.useState(!1);t.useEffect(()=>{S()},[o]),t.useEffect(()=>{if(l){const n=setTimeout(()=>c(null),4e3);return()=>clearTimeout(n)}},[l]);const S=async()=>{g(!0);try{const[n,i]=await Promise.all([u.getFolderPermissions(o),U.getMembers()]);p(n.permissions||[]),M(i.members||[])}catch(n){console.error("Failed to load permissions:",n),p([])}finally{g(!1)}},O=async()=>{if(!a.userId&&!a.groupId){c({type:"error",message:"Please select a team member"});return}w(!0);try{const n=$(a.permissionLevel);await u.setFolderPermission({folderPath:o,userId:a.userId||void 0,groupId:a.groupId||void 0,permissionLevel:a.permissionLevel,canView:n.canView,canDownload:n.canDownload,canEdit:n.canEdit,canDelete:n.canDelete,canCreate:n.canCreate,canShare:n.canShare,canManagePermissions:n.canManagePermissions}),c({type:"success",message:"Permission added successfully"}),m(!1),x({userId:"",groupId:"",permissionLevel:"view"}),S()}catch(n){c({type:"error",message:n.message||"Failed to add permission"})}finally{w(!1)}},V=async n=>{try{await u.deleteFolderPermission(n),p(d.filter(i=>i.id!==n)),c({type:"success",message:"Permission removed"})}catch(i){c({type:"error",message:i.message||"Failed to remove permission"})}},$=n=>{switch(n){case"view":return{canView:!0,canDownload:!1,canEdit:!1,canDelete:!1,canCreate:!1,canShare:!1,canManagePermissions:!1};case"download":return{canView:!0,canDownload:!0,canEdit:!1,canDelete:!1,canCreate:!1,canShare:!1,canManagePermissions:!1};case"edit":return{canView:!0,canDownload:!0,canEdit:!0,canDelete:!1,canCreate:!1,canShare:!1,canManagePermissions:!1};case"contributor":return{canView:!0,canDownload:!0,canEdit:!0,canDelete:!0,canCreate:!0,canShare:!1,canManagePermissions:!1};case"admin":return{canView:!0,canDownload:!0,canEdit:!0,canDelete:!0,canCreate:!0,canShare:!0,canManagePermissions:!0};default:return{canView:!0,canDownload:!1,canEdit:!1,canDelete:!1,canCreate:!1,canShare:!1,canManagePermissions:!1}}},v=o.split("/").filter(Boolean),I=E.filter(n=>!d.some(i=>i.userId===n.id));return e.jsxs("div",{className:s.page,children:[e.jsx("header",{className:s.header,children:e.jsxs("button",{className:s.backBtn,onClick:()=>k("/app/documents"),children:[e.jsx(K,{size:20}),e.jsx("span",{children:"Back to Documents"})]})}),e.jsxs("div",{className:s.container,children:[e.jsxs("div",{className:s.titleSection,children:[e.jsx("div",{className:s.titleIcon,children:e.jsx(f,{size:28})}),e.jsxs("div",{className:s.titleText,children:[e.jsx("h1",{children:"Folder Permissions"}),e.jsx("p",{children:"Control who can access files in each folder. Permissions set here override default firm-wide access."})]})]}),l&&e.jsxs("div",{className:`${s.notification} ${s[l.type]}`,children:[l.type==="success"?e.jsx(h,{size:18}):e.jsx(W,{size:18}),e.jsx("span",{children:l.message}),e.jsx("button",{onClick:()=>c(null),className:s.notificationClose,children:e.jsx(y,{size:16})})]}),e.jsx("div",{className:s.folderNav,children:e.jsxs("div",{className:s.breadcrumb,children:[e.jsxs("button",{className:`${s.breadcrumbItem} ${o==="/"?s.active:""}`,onClick:()=>N("/"),children:[e.jsx(X,{size:14}),e.jsx("span",{children:"Root"})]}),v.map((n,i)=>{const r="/"+v.slice(0,i+1).join("/"),_=o===r;return e.jsxs("span",{className:s.breadcrumbSegment,children:[e.jsx(q,{size:14,className:s.breadcrumbSep}),e.jsxs("button",{className:`${s.breadcrumbItem} ${_?s.active:""}`,onClick:()=>N(r),children:[e.jsx(F,{size:14}),e.jsx("span",{children:n})]})]},r)})]})}),e.jsxs("div",{className:s.currentFolder,children:[e.jsxs("div",{className:s.folderHeader,children:[e.jsx("div",{className:s.folderIconLarge,children:e.jsx(F,{size:24})}),e.jsxs("div",{className:s.folderInfo,children:[e.jsx("h2",{children:o==="/"?"Root Folder":v[v.length-1]}),e.jsx("code",{className:s.folderPath,children:o})]}),e.jsxs("button",{className:s.addPermissionBtn,onClick:()=>m(!0),disabled:C,children:[e.jsx(J,{size:18}),e.jsx("span",{children:"Add Permission"})]})]}),C&&e.jsxs("div",{className:s.addForm,children:[e.jsxs("div",{className:s.addFormHeader,children:[e.jsx("h3",{children:"Add New Permission"}),e.jsx("button",{className:s.closeFormBtn,onClick:()=>m(!1),children:e.jsx(y,{size:18})})]}),e.jsxs("div",{className:s.formContent,children:[e.jsxs("div",{className:s.formGroup,children:[e.jsx("label",{children:"Team Member"}),I.length===0?e.jsxs("div",{className:s.noMembers,children:[e.jsx(j,{size:20}),e.jsx("span",{children:"All team members already have permissions for this folder"})]}):e.jsxs("select",{value:a.userId,onChange:n=>x({...a,userId:n.target.value,groupId:""}),className:s.select,children:[e.jsx("option",{value:"",children:"Select a team member..."}),I.map(n=>e.jsxs("option",{value:n.id,children:[n.firstName," ",n.lastName," (",n.email,")"]},n.id))]})]}),e.jsxs("div",{className:s.formGroup,children:[e.jsx("label",{children:"Permission Level"}),e.jsx("div",{className:s.permissionOptions,children:L.map(n=>{const i=n.icon,r=a.permissionLevel===n.value;return e.jsxs("button",{type:"button",className:`${s.permissionOption} ${r?s.selected:""}`,onClick:()=>x({...a,permissionLevel:n.value}),style:{"--level-color":n.color},children:[e.jsx("div",{className:s.optionIcon,children:e.jsx(i,{size:18})}),e.jsxs("div",{className:s.optionText,children:[e.jsx("span",{className:s.optionLabel,children:n.label}),e.jsx("span",{className:s.optionDesc,children:n.description})]}),r&&e.jsx("div",{className:s.optionCheck,children:e.jsx(h,{size:16})})]},n.value)})})]}),e.jsxs("div",{className:s.formActions,children:[e.jsx("button",{type:"button",className:s.cancelBtn,onClick:()=>m(!1),children:"Cancel"}),e.jsx("button",{type:"button",className:s.saveBtn,onClick:O,disabled:P||!a.userId,children:P?e.jsxs(e.Fragment,{children:[e.jsx(D,{size:16,className:s.spinning}),e.jsx("span",{children:"Adding..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(h,{size:16}),e.jsx("span",{children:"Add Permission"})]})})]})]})]}),e.jsxs("div",{className:s.permissionsSection,children:[e.jsxs("div",{className:s.sectionHeader,children:[e.jsx(Y,{size:16}),e.jsx("h3",{children:"Current Permissions"}),e.jsx("span",{className:s.count,children:d.length})]}),T?e.jsxs("div",{className:s.loading,children:[e.jsx(D,{size:24,className:s.spinning}),e.jsx("span",{children:"Loading permissions..."})]}):d.length===0?e.jsxs("div",{className:s.emptyState,children:[e.jsx("div",{className:s.emptyIcon,children:e.jsx(j,{size:32})}),e.jsx("h4",{children:"No Specific Permissions"}),e.jsx("p",{children:"This folder uses default firm-wide access settings. Add permissions above to restrict or grant specific access."})]}):e.jsx("div",{className:s.permissionsList,children:d.map(n=>{const i=L.find(_=>_.value===n.permissionLevel),r=(i==null?void 0:i.icon)||b;return e.jsxs("div",{className:s.permissionItem,children:[e.jsxs("div",{className:s.permissionUser,children:[e.jsx("div",{className:s.userAvatar,children:n.userId?e.jsx(Z,{size:18}):e.jsx(j,{size:18})}),e.jsxs("div",{className:s.userDetails,children:[e.jsx("span",{className:s.userName,children:n.userName||n.groupName}),e.jsx("span",{className:s.userType,children:n.userId?"Individual":"Group"})]})]}),e.jsxs("div",{className:s.permissionCapabilities,children:[n.canView&&e.jsx("span",{className:s.capability,title:"Can view",children:e.jsx(b,{size:14})}),n.canDownload&&e.jsx("span",{className:s.capability,title:"Can download",children:e.jsx(B,{size:14})}),n.canEdit&&e.jsx("span",{className:s.capability,title:"Can edit",children:e.jsx(z,{size:14})}),n.canShare&&e.jsx("span",{className:s.capability,title:"Can share",children:e.jsx(ee,{size:14})}),n.canManagePermissions&&e.jsx("span",{className:`${s.capability} ${s.admin}`,title:"Can manage permissions",children:e.jsx(f,{size:14})})]}),e.jsxs("div",{className:s.permissionBadge,style:{"--badge-color":(i==null?void 0:i.color)||"#6b7280"},children:[e.jsx(r,{size:14}),e.jsx("span",{children:(i==null?void 0:i.label)||n.permissionLevel})]}),e.jsx("button",{className:s.removeBtn,onClick:()=>V(n.id),title:"Remove permission",children:e.jsx(se,{size:16})})]},n.id)})})]})]}),e.jsxs("div",{className:s.helpSection,children:[e.jsxs("div",{className:s.helpHeader,children:[e.jsx(ne,{size:18}),e.jsx("h4",{children:"How Permissions Work"})]}),e.jsxs("div",{className:s.helpContent,children:[e.jsxs("div",{className:s.helpItem,children:[e.jsx("strong",{children:"Inheritance:"})," Child folders inherit permissions from parent folders unless overridden."]}),e.jsxs("div",{className:s.helpItem,children:[e.jsx("strong",{children:"Priority:"})," Specific user permissions take priority over group permissions."]}),e.jsxs("div",{className:s.helpItem,children:[e.jsx("strong",{children:"Admins:"})," Firm owners and admins always have full access to all folders."]})]})]})]})]})}export{Cs as FolderPermissionsPage};
