import{r as a,a6 as e}from"./vendor-DrKzkH4x.js";import{u as ce,k as b}from"./index-CCWWoMiH.js";import{a as ae}from"./router-CNLU_KyZ.js";import{a4 as ie,L as v,am as U,S as y,a6 as $,aX as k,K as G,E as oe,t as re,a as z,al as de,W as le,R as he,bn as xe,aB as Y,b9 as A,b4 as D,Y as I,bL as pe,s as je,a3 as me}from"./icons-BtUkkwGS.js";import"./doc-parsers-U1nJMjtM.js";import"./react-dom-DfB-QKj2.js";import"./pdf-worker-CVmCB3lP.js";import"./state-72d44OIA.js";const ue="_container_cj4xa_1",_e="_loading_cj4xa_8",ve="_accessDenied_cj4xa_18",fe="_spinning_cj4xa_58",ge="_spin_cj4xa_58",we="_notification_cj4xa_67",Ne="_slideIn_cj4xa_1",Se="_success_cj4xa_81",Ce="_error_cj4xa_87",be="_header_cj4xa_120",ye="_backBtn_cj4xa_124",ke="_headerContent_cj4xa_142",ze="_headerIcon_cj4xa_148",Ae="_main_cj4xa_171",De="_statusCard_cj4xa_178",Ie="_connected_cj4xa_185",Le="_statusHeader_cj4xa_190",Re="_statusIcon_cj4xa_196",Be="_statusText_cj4xa_212",Fe="_refreshBtn_cj4xa_228",Pe="_firmInfo_cj4xa_252",Te="_infoItem_cj4xa_261",He="_label_cj4xa_267",Ee="_value_cj4xa_274",Me="_driveLetterSection_cj4xa_281",We="_driveLetterSelector_cj4xa_300",Oe="_drivePreview_cj4xa_323",Ue="_downloadSection_cj4xa_330",$e="_osCards_cj4xa_349",Ge="_osCard_cj4xa_349",Ye="_osHeader_cj4xa_371",Ze="_downloadBtn_cj4xa_394",Ke="_helpToggle_cj4xa_420",qe="_instructions_cj4xa_438",Ve="_manualSection_cj4xa_476",Xe="_advancedToggle_cj4xa_483",Je="_advancedContent_cj4xa_506",Qe="_advancedNote_cj4xa_511",es="_pathBox_cj4xa_517",ss="_pathRow_cj4xa_534",ns="_pathHint_cj4xa_572",ts="_credentialsNote_cj4xa_579",cs="_troubleshootSection_cj4xa_609",as="_troubleshootGrid_cj4xa_625",is="_troubleshootItem_cj4xa_637",os="_afterSetup_cj4xa_657",rs="_syncNote_cj4xa_695",ds="_notConfigured_cj4xa_705",ls="_configSteps_cj4xa_732",hs="_connectedWrapper_cj4xa_762",xs="_connectedCard_cj4xa_770",ps="_connectedIcon_cj4xa_781",js="_connectedIconRing_cj4xa_787",ms="_pulseRing_cj4xa_1",us="_sparkle1_cj4xa_808",_s="_sparkle2_cj4xa_808",vs="_sparkle3_cj4xa_808",fs="_sparkle_cj4xa_808",gs="_connectedSubtitle_cj4xa_852",ws="_connectedDriveInfo_cj4xa_858",Ns="_driveIcon_cj4xa_870",Ss="_driveDetails_cj4xa_881",Cs="_driveLetter_cj4xa_281",bs="_firmName_cj4xa_892",ys="_connectedPath_cj4xa_898",ks="_connectedActions_cj4xa_933",zs="_primaryBtn_cj4xa_940",As="_secondaryBtn_cj4xa_961",Ds="_connectedFooter_cj4xa_981",Is="_textBtn_cj4xa_992",s={container:ue,loading:_e,accessDenied:ve,spinning:fe,spin:ge,notification:we,slideIn:Ne,success:Se,error:Ce,header:be,backBtn:ye,headerContent:ke,headerIcon:ze,main:Ae,statusCard:De,connected:Ie,statusHeader:Le,statusIcon:Re,statusText:Be,refreshBtn:Fe,firmInfo:Pe,infoItem:Te,label:He,value:Ee,driveLetterSection:Me,driveLetterSelector:We,drivePreview:Oe,downloadSection:Ue,osCards:$e,osCard:Ge,osHeader:Ye,downloadBtn:Ze,helpToggle:Ke,instructions:qe,manualSection:Ve,advancedToggle:Xe,advancedContent:Je,advancedNote:Qe,pathBox:es,pathRow:ss,pathHint:ns,credentialsNote:ts,troubleshootSection:cs,troubleshootGrid:as,troubleshootItem:is,afterSetup:os,syncNote:rs,notConfigured:ds,configSteps:ls,connectedWrapper:hs,connectedCard:xs,connectedIcon:ps,connectedIconRing:js,pulseRing:ms,sparkle1:us,sparkle2:_s,sparkle3:vs,sparkle:fs,connectedSubtitle:gs,connectedDriveInfo:ws,driveIcon:Ns,driveDetails:Ss,driveLetter:Cs,firmName:bs,connectedPath:ys,connectedActions:ks,primaryBtn:zs,secondaryBtn:As,connectedFooter:Ds,textBtn:Is};function Ms(){var E,M,W,O;const f=ae(),{user:l}=ce(),Z=(l==null?void 0:l.role)==="owner"||(l==null?void 0:l.role)==="admin",[g,L]=a.useState(!0),[p,j]=a.useState(null),[t,K]=a.useState(null),[r,R]=a.useState("Z"),[m,h]=a.useState(null),[B,F]=a.useState(!1),[w,q]=a.useState(!1),[u,V]=a.useState(!1),[_,X]=a.useState(!1),[d,N]=a.useState("checking"),[i,P]=a.useState(null),[J,Q]=a.useState(!1),ee=["Z","Y","X","W","V","U","T","S","R","Q","P","O","N","M","L","K","J","I","H","G","F","E","D"];a.useEffect(()=>{T(),se()},[]);const T=async()=>{L(!0),N("checking");try{const n=await b.getConnectionInfo();K(n),N(n.configured?"accessible":"not-configured")}catch(n){console.error("Failed to load connection info:",n),N("not-configured"),n.status===403&&h({type:"error",message:"Admin access required to set up document drive"})}finally{L(!1)}},se=async()=>{try{const n=await b.getDrivePreference();n&&(P(n),n.driveLetter&&R(n.driveLetter))}catch(n){console.error("Failed to load drive preference:",n)}},H=async n=>{try{await b.updateDrivePreference({driveLetter:r,setupCompleted:!0,setupCompletedAt:new Date().toISOString(),os:n}),P({driveLetter:r,setupCompleted:!0,setupCompletedAt:new Date().toISOString(),os:n})}catch(c){console.error("Failed to save drive preference:",c)}},ne=async()=>{var n;if(t!=null&&t.configured){j("windows");try{const c=await fetch(`https://apexai-api.azurewebsites.net/api/drive/setup-script/windows?driveLetter=${r}`,{headers:{Authorization:`Bearer ${localStorage.getItem("apex-access-token")}`}});if(!c.ok)throw new Error("Failed to generate script");const C=await c.blob(),x=window.URL.createObjectURL(C),o=document.createElement("a");o.href=x,o.download=`${((n=t.firmName)==null?void 0:n.replace(/[^a-zA-Z0-9]/g,""))||"ApexDrive"}_Setup.ps1`,document.body.appendChild(o),o.click(),window.URL.revokeObjectURL(x),document.body.removeChild(o),h({type:"success",message:"Windows setup script downloaded! Right-click and Run with PowerShell."}),await H("windows")}catch{h({type:"error",message:"Failed to download setup script"})}finally{j(null)}}},te=async()=>{var n;if(t!=null&&t.configured){j("mac");try{const c=await fetch("https://apexai-api.azurewebsites.net/api/drive/setup-script/mac",{headers:{Authorization:`Bearer ${localStorage.getItem("apex-access-token")}`}});if(!c.ok)throw new Error("Failed to generate script");const C=await c.blob(),x=window.URL.createObjectURL(C),o=document.createElement("a");o.href=x,o.download=`${((n=t.firmName)==null?void 0:n.replace(/[^a-zA-Z0-9]/g,""))||"ApexDrive"}_Setup.sh`,document.body.appendChild(o),o.click(),window.URL.revokeObjectURL(x),document.body.removeChild(o),h({type:"success",message:"Mac setup script downloaded! Open Terminal and run it."}),await H("mac")}catch{h({type:"error",message:"Failed to download setup script"})}finally{j(null)}}},S=n=>{navigator.clipboard.writeText(n),F(!0),setTimeout(()=>F(!1),2e3)};return Z?g?e.jsx("div",{className:s.container,children:e.jsxs("div",{className:s.loading,children:[e.jsx(v,{size:32,className:s.spinning}),e.jsx("span",{children:"Checking drive configuration..."})]})}):i!=null&&i.setupCompleted&&(t!=null&&t.configured)&&!J?e.jsx("div",{className:s.container,children:e.jsx("div",{className:s.connectedWrapper,children:e.jsxs("div",{className:s.connectedCard,children:[e.jsxs("div",{className:s.connectedIcon,children:[e.jsx("div",{className:s.connectedIconRing,children:e.jsx(U,{size:64})}),e.jsx(y,{className:s.sparkle1,size:20}),e.jsx(y,{className:s.sparkle2,size:16}),e.jsx(y,{className:s.sparkle3,size:14})]}),e.jsx("h1",{children:"You're All Set!"}),e.jsxs("p",{className:s.connectedSubtitle,children:["Your firm's documents are mapped to your ",i.os==="mac"?"Mac":"Windows"," computer"]}),e.jsxs("div",{className:s.connectedDriveInfo,children:[e.jsx("div",{className:s.driveIcon,children:e.jsx($,{size:32})}),e.jsxs("div",{className:s.driveDetails,children:[e.jsxs("span",{className:s.driveLetter,children:[i.driveLetter,": Drive"]}),e.jsx("span",{className:s.firmName,children:t.firmName})]})]}),e.jsxs("div",{className:s.connectedPath,children:[e.jsx("code",{children:(E=t.paths)==null?void 0:E[i.os==="mac"?"mac":"windows"]}),e.jsx("button",{onClick:()=>{var n;return S(((n=t.paths)==null?void 0:n[i.os==="mac"?"mac":"windows"])||"")},children:e.jsx(k,{size:14})})]}),e.jsxs("div",{className:s.connectedActions,children:[e.jsxs("button",{className:s.primaryBtn,onClick:()=>f("/app/documents"),children:[e.jsx(G,{size:18}),"Go to Documents"]}),e.jsxs("button",{className:s.secondaryBtn,onClick:()=>{const n=`firmdocs://${i.driveLetter}:/`,c=document.createElement("iframe");c.style.display="none",c.src=n,document.body.appendChild(c),setTimeout(()=>document.body.removeChild(c),1e3)},children:[e.jsx(oe,{size:18}),"Open in ",i.os==="mac"?"Finder":"Explorer"]})]}),e.jsxs("div",{className:s.connectedFooter,children:[e.jsxs("p",{children:["Setup completed ",i.setupCompletedAt?new Date(i.setupCompletedAt).toLocaleDateString():"previously"]}),e.jsx("button",{className:s.textBtn,onClick:()=>Q(!0),children:"Need to reconnect or change drive letter?"})]})]})})}):e.jsxs("div",{className:s.container,children:[m&&e.jsxs("div",{className:`${s.notification} ${s[m.type]}`,children:[m.type==="success"?e.jsx(re,{size:16}):e.jsx(z,{size:16}),m.message,e.jsx("button",{onClick:()=>h(null),children:"×"})]}),e.jsxs("div",{className:s.header,children:[e.jsxs("button",{className:s.backBtn,onClick:()=>f("/app/settings"),children:[e.jsx(de,{size:20}),e.jsx("span",{children:"Back to Settings"})]}),e.jsxs("div",{className:s.headerContent,children:[e.jsx("div",{className:s.headerIcon,children:e.jsx($,{size:28})}),e.jsxs("div",{children:[e.jsx("h1",{children:"Connect Your Documents Drive"}),e.jsx("p",{children:"Map your firm's cloud storage as a local drive"})]})]})]}),e.jsxs("div",{className:s.main,children:[e.jsxs("div",{className:`${s.statusCard} ${d==="accessible"?s.connected:""}`,children:[e.jsxs("div",{className:s.statusHeader,children:[e.jsxs("div",{className:s.statusIcon,children:[d==="checking"&&e.jsx(v,{size:32,className:s.spinning}),d==="accessible"&&e.jsx(U,{size:32}),d==="not-accessible"&&e.jsx(le,{size:32}),d==="not-configured"&&e.jsx(z,{size:32})]}),e.jsxs("div",{className:s.statusText,children:[d==="checking"&&e.jsx("h2",{children:"Checking connection..."}),d==="accessible"&&e.jsxs(e.Fragment,{children:[e.jsx("h2",{children:"Azure File Share Ready"}),e.jsx("p",{children:"Your firm's storage is configured and ready to connect"})]}),d==="not-accessible"&&e.jsxs(e.Fragment,{children:[e.jsx("h2",{children:"Connection Issue"}),e.jsx("p",{children:"Cannot reach Azure storage. Check firewall settings."})]}),d==="not-configured"&&e.jsxs(e.Fragment,{children:[e.jsx("h2",{children:"Not Configured"}),e.jsx("p",{children:"Azure File Share needs to be configured by your platform administrator."})]})]}),e.jsx("button",{className:s.refreshBtn,onClick:T,disabled:g,children:e.jsx(he,{size:18,className:g?s.spinning:""})})]}),(t==null?void 0:t.configured)&&e.jsxs("div",{className:s.firmInfo,children:[e.jsxs("div",{className:s.infoItem,children:[e.jsx("span",{className:s.label,children:"Firm:"}),e.jsx("span",{className:s.value,children:t.firmName})]}),e.jsxs("div",{className:s.infoItem,children:[e.jsx("span",{className:s.label,children:"Folder:"}),e.jsx("span",{className:s.value,children:t.firmFolder})]}),e.jsxs("div",{className:s.infoItem,children:[e.jsx("span",{className:s.label,children:"Storage:"}),e.jsxs("span",{className:s.value,children:[t.storageAccount,".file.core.windows.net"]})]})]})]}),(t==null?void 0:t.configured)&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:s.driveLetterSection,children:[e.jsx("h3",{children:"Select Drive Letter"}),e.jsx("p",{children:"Choose which drive letter to use for your firm's documents"}),e.jsxs("div",{className:s.driveLetterSelector,children:[e.jsx("select",{value:r,onChange:n=>R(n.target.value),children:ee.map(n=>e.jsxs("option",{value:n,children:[n,": Drive"]},n))}),e.jsxs("span",{className:s.drivePreview,children:[r,":\\",(M=t.firmName)==null?void 0:M.replace(/[^a-zA-Z0-9]/g,"")]})]})]}),e.jsxs("div",{className:s.downloadSection,children:[e.jsx("h3",{children:"Download Setup Script"}),e.jsx("p",{children:"Choose your operating system to download the one-click setup script"}),e.jsxs("div",{className:s.osCards,children:[e.jsxs("div",{className:s.osCard,children:[e.jsxs("div",{className:s.osHeader,children:[e.jsx(xe,{size:32}),e.jsx("h4",{children:"Windows"})]}),e.jsx("p",{children:'PowerShell script that maps your firm drive and enables "Open in Explorer" links'}),e.jsxs("button",{className:s.downloadBtn,onClick:ne,disabled:p!==null,children:[p==="windows"?e.jsx(v,{size:18,className:s.spinning}):e.jsx(Y,{size:18}),"Download Windows Script"]}),e.jsxs("button",{className:s.helpToggle,onClick:()=>V(!u),children:[e.jsx(A,{size:14}),u?"Hide":"Show"," Instructions",u?e.jsx(D,{size:14}):e.jsx(I,{size:14})]}),u&&e.jsxs("div",{className:s.instructions,children:[e.jsx("h5",{children:"How to run the script:"}),e.jsxs("ol",{children:[e.jsx("li",{children:"Download the .ps1 file"}),e.jsx("li",{children:"Right-click the file"}),e.jsx("li",{children:'Select "Run with PowerShell"'}),e.jsx("li",{children:'If prompted, click "Run" to allow'}),e.jsx("li",{children:"Wait for the drive to connect"})]}),e.jsx("h5",{children:"What the script does:"}),e.jsxs("ul",{children:[e.jsx("li",{children:"Checks if port 445 is accessible"}),e.jsx("li",{children:"Stores Azure credentials securely"}),e.jsxs("li",{children:["Maps the drive to ",r,":"]}),e.jsx("li",{children:"Makes it persist after reboot"}),e.jsx("li",{children:'Registers "firmdocs://" protocol for quick links'}),e.jsx("li",{children:"Opens the drive in File Explorer"})]})]})]}),e.jsxs("div",{className:s.osCard,children:[e.jsxs("div",{className:s.osHeader,children:[e.jsx(pe,{size:32}),e.jsx("h4",{children:"Mac"})]}),e.jsx("p",{children:"Shell script that mounts your firm drive and adds it to Finder favorites"}),e.jsxs("button",{className:s.downloadBtn,onClick:te,disabled:p!==null,children:[p==="mac"?e.jsx(v,{size:18,className:s.spinning}):e.jsx(Y,{size:18}),"Download Mac Script"]}),e.jsxs("button",{className:s.helpToggle,onClick:()=>X(!_),children:[e.jsx(A,{size:14}),_?"Hide":"Show"," Instructions",_?e.jsx(D,{size:14}):e.jsx(I,{size:14})]}),_&&e.jsxs("div",{className:s.instructions,children:[e.jsx("h5",{children:"How to run the script:"}),e.jsxs("ol",{children:[e.jsx("li",{children:"Download the .sh file"}),e.jsx("li",{children:"Open Terminal app"}),e.jsxs("li",{children:["Run: ",e.jsx("code",{children:"chmod +x ~/Downloads/*_Setup.sh"})]}),e.jsxs("li",{children:["Run: ",e.jsx("code",{children:"~/Downloads/*_Setup.sh"})]}),e.jsx("li",{children:"Enter your Mac password when prompted"})]}),e.jsx("h5",{children:"What the script does:"}),e.jsxs("ul",{children:[e.jsx("li",{children:"Creates mount point in /Volumes"}),e.jsx("li",{children:"Mounts the Azure SMB share"}),e.jsx("li",{children:"Adds to Login Items for persistence"}),e.jsx("li",{children:"Opens the drive in Finder"})]})]})]})]})]}),e.jsxs("div",{className:s.manualSection,children:[e.jsxs("button",{className:s.advancedToggle,onClick:()=>q(!w),children:[e.jsx(je,{size:16}),"Advanced: Manual Connection",w?e.jsx(D,{size:16}):e.jsx(I,{size:16})]}),w&&e.jsxs("div",{className:s.advancedContent,children:[e.jsx("p",{className:s.advancedNote,children:"If the automatic script doesn't work, you can connect manually using these paths:"}),e.jsxs("div",{className:s.pathBox,children:[e.jsx("label",{children:"Windows Path:"}),e.jsxs("div",{className:s.pathRow,children:[e.jsx("code",{children:(W=t.paths)==null?void 0:W.windows}),e.jsxs("button",{onClick:()=>{var n;return S(((n=t.paths)==null?void 0:n.windows)||"")},children:[e.jsx(k,{size:14}),B?"Copied!":"Copy"]})]}),e.jsx("span",{className:s.pathHint,children:'Open File Explorer → Right-click "This PC" → "Map network drive" → Paste this path'})]}),e.jsxs("div",{className:s.pathBox,children:[e.jsx("label",{children:"Mac Path:"}),e.jsxs("div",{className:s.pathRow,children:[e.jsx("code",{children:(O=t.paths)==null?void 0:O.mac}),e.jsxs("button",{onClick:()=>{var n;return S(((n=t.paths)==null?void 0:n.mac)||"")},children:[e.jsx(k,{size:14}),B?"Copied!":"Copy"]})]}),e.jsx("span",{className:s.pathHint,children:"In Finder: Go → Connect to Server (Cmd+K) → Paste this path"})]}),e.jsxs("div",{className:s.credentialsNote,children:[e.jsx(me,{size:16}),e.jsxs("div",{children:[e.jsx("strong",{children:"Credentials:"}),e.jsxs("p",{children:["Username: AZURE\\",t.storageAccount]}),e.jsx("p",{children:"Password: Contact your platform administrator for the storage key"})]})]})]})]}),e.jsxs("div",{className:s.troubleshootSection,children:[e.jsxs("h3",{children:[e.jsx(A,{size:20}),"Troubleshooting"]}),e.jsxs("div",{className:s.troubleshootGrid,children:[e.jsxs("div",{className:s.troubleshootItem,children:[e.jsx("h4",{children:"Connection refused / Timeout"}),e.jsx("p",{children:"Your firewall or ISP may be blocking port 445. Check with your IT administrator or try connecting from a different network."})]}),e.jsxs("div",{className:s.troubleshootItem,children:[e.jsx("h4",{children:"Access denied"}),e.jsxs("p",{children:["Verify the credentials are correct. The username format should be AZURE\\",t.storageAccount]})]}),e.jsxs("div",{className:s.troubleshootItem,children:[e.jsx("h4",{children:"Drive disconnects"}),e.jsx("p",{children:'Ensure "Reconnect at sign-in" is checked when mapping, or re-run the setup script.'})]}),e.jsxs("div",{className:s.troubleshootItem,children:[e.jsx("h4",{children:"Script won't run"}),e.jsx("p",{children:'Windows may block scripts by default. Right-click → Properties → "Unblock" checkbox, then run again.'})]})]})]}),e.jsxs("div",{className:s.afterSetup,children:[e.jsxs("h3",{children:[e.jsx(G,{size:20}),"After Setup"]}),e.jsx("p",{children:"Once connected, you'll have access to:"}),e.jsxs("ul",{children:[e.jsxs("li",{children:[e.jsxs("strong",{children:[r,":\\Matters\\"]})," - All client matters organized by client name"]}),e.jsxs("li",{children:[e.jsxs("strong",{children:[r,":\\Clients\\"]})," - Client-level documents"]}),e.jsxs("li",{children:[e.jsxs("strong",{children:[r,":\\Templates\\"]})," - Document templates"]})]}),e.jsx("p",{className:s.syncNote,children:"Files you save here will automatically appear in the Documents section of Apex Drive, and vice versa - they're the same files!"})]})]}),!(t!=null&&t.configured)&&e.jsxs("div",{className:s.notConfigured,children:[e.jsx(z,{size:48}),e.jsx("h3",{children:"Azure Storage Not Configured"}),e.jsx("p",{children:"To enable document drive mapping, your platform administrator needs to configure Azure Storage settings in the Platform Admin portal."}),e.jsxs("div",{className:s.configSteps,children:[e.jsx("h4",{children:"For Platform Administrators:"}),e.jsxs("ol",{children:[e.jsx("li",{children:"Go to the Platform Admin Dashboard"}),e.jsx("li",{children:'Navigate to "Platform Settings" → "Azure Storage"'}),e.jsx("li",{children:"Enter your Azure Storage Account name and key"}),e.jsx("li",{children:"Specify the File Share name (default: apexdrive)"}),e.jsx("li",{children:"Save settings and return here"})]})]})]})]})]}):e.jsx("div",{className:s.container,children:e.jsxs("div",{className:s.accessDenied,children:[e.jsx(ie,{size:48}),e.jsx("h2",{children:"Admin Access Required"}),e.jsx("p",{children:"Only firm administrators can set up the document drive."}),e.jsx("button",{onClick:()=>f("/app/documents"),children:"Go to Documents"})]})})}export{Ms as DriveSetupPage};
