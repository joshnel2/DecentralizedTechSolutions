import{r as l,a6 as e}from"./vendor-DrKzkH4x.js";import{s}from"./SettingsPage.module-DZhI6nyr.js";import{a as I}from"./router-CNLU_KyZ.js";import{L as m,al as q,a as T,bu as D,aF as z,t as f,i as L,M,ad as P,J as A,bN as B,V as E,a4 as R}from"./icons-BtUkkwGS.js";import"./doc-parsers-U1nJMjtM.js";import"./react-dom-DfB-QKj2.js";import"./pdf-worker-CVmCB3lP.js";const h="https://apexai-api.azurewebsites.net/api";function V(){const N=I(),[y,_]=l.useState(!0),[r,p]=l.useState(!1),[b,g]=l.useState(!1),[x,c]=l.useState(""),[d,u]=l.useState(!1),[o,j]=l.useState(!1),[a,i]=l.useState({in_app:!0,document_changes:!0,document_shares:!0,co_editing:!0,matter_updates:!0,billing_updates:!0,email_immediate:!1,email_digest:!0,digest_frequency:"daily",sms_enabled:!1,sms_phone:"",sms_deadlines:!0,sms_urgent_matters:!0,sms_payments:!1,sms_calendar:!1,ai_notifications:!0,push_enabled:!0,quiet_hours_start:"",quiet_hours_end:""});l.useEffect(()=>{v()},[]);const v=async()=>{try{const t=await fetch(`${h}/api/notifications/preferences`,{headers:{"Content-Type":"application/json","x-firm-id":localStorage.getItem("firmId")||"","x-user-id":localStorage.getItem("userId")||""}});if(t.ok){const n=await t.json();n.preferences&&i(C=>({...C,...n.preferences,quiet_hours_start:n.preferences.quiet_hours_start||"",quiet_hours_end:n.preferences.quiet_hours_end||""}))}}catch(t){console.error("Error fetching preferences:",t)}finally{_(!1)}},S=async()=>{p(!0),c("");try{const t=await fetch(`${h}/api/notifications/preferences`,{method:"PUT",headers:{"Content-Type":"application/json","x-firm-id":localStorage.getItem("firmId")||"","x-user-id":localStorage.getItem("userId")||""},body:JSON.stringify(a)});if(t.ok)g(!0),setTimeout(()=>g(!1),3e3);else{const n=await t.json();c(n.error||"Failed to save preferences")}}catch{c("Failed to save preferences")}finally{p(!1)}},k=async()=>{if(!a.sms_phone){c("Please enter a phone number first");return}u(!0),c("");try{const t=await fetch(`${h}/api/notifications/test-sms`,{method:"POST",headers:{"Content-Type":"application/json","x-firm-id":localStorage.getItem("firmId")||"","x-user-id":localStorage.getItem("userId")||""},body:JSON.stringify({phone:a.sms_phone})});if(t.ok)j(!0),setTimeout(()=>j(!1),5e3);else{const n=await t.json();c(n.error||"Failed to send test SMS")}}catch{c("Failed to send test SMS")}finally{u(!1)}},w=t=>{const n=t.replace(/\D/g,"");return n.length>=10?`+1${n.slice(-10)}`:t};return y?e.jsx("div",{className:s.settingsPage,children:e.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",padding:"4rem"},children:e.jsx(m,{size:32,className:"animate-spin",style:{color:"#6366f1"}})})}):e.jsxs("div",{className:s.settingsPage,children:[e.jsxs("button",{className:s.backButton,onClick:()=>N("/app/settings"),children:[e.jsx(q,{size:16}),"Back to Settings"]}),e.jsxs("div",{className:s.header,children:[e.jsx("h1",{children:"Notifications"}),e.jsx("p",{children:"Manage how and when you receive notifications via in-app, email, and SMS"})]}),e.jsx("div",{className:s.settingsContent,style:{maxWidth:"900px"},children:e.jsxs("div",{className:s.tabContent,children:[x&&e.jsxs("div",{className:s.errorBanner,style:{marginBottom:"1.5rem",padding:"1rem",background:"#fef2f2",border:"1px solid #fecaca",borderRadius:"8px",display:"flex",alignItems:"center",gap:"0.75rem",color:"#dc2626"},children:[e.jsx(T,{size:20}),e.jsx("span",{children:x})]}),e.jsxs("div",{className:s.section,style:{background:"linear-gradient(135deg, #f0fdf4 0%, #ecfdf5 100%)",border:"1px solid #bbf7d0",borderRadius:"12px",padding:"1.5rem",marginBottom:"1.5rem"},children:[e.jsxs("div",{className:s.sectionHeader,children:[e.jsx(D,{size:20,style:{color:"#16a34a"}}),e.jsxs("div",{children:[e.jsx("h2",{style:{color:"#166534"},children:"SMS Text Notifications"}),e.jsx("p",{children:"Receive important alerts via text message"})]})]}),e.jsxs("div",{className:s.toggleGroup,children:[e.jsxs("div",{className:s.toggle,children:[e.jsxs("div",{children:[e.jsx("span",{className:s.toggleLabel,children:"Enable SMS Notifications"}),e.jsx("span",{className:s.toggleDesc,children:"Receive text messages for urgent alerts"})]}),e.jsxs("label",{className:s.switch,children:[e.jsx("input",{type:"checkbox",checked:a.sms_enabled,onChange:t=>i({...a,sms_enabled:t.target.checked})}),e.jsx("span",{className:s.slider})]})]}),a.sms_enabled&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:s.formGroup,style:{marginTop:"1rem",marginBottom:"1rem"},children:[e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx(z,{size:16}),"Phone Number"]}),e.jsxs("div",{style:{display:"flex",gap:"0.75rem"},children:[e.jsx("input",{type:"tel",placeholder:"+1 (555) 555-5555",value:a.sms_phone,onChange:t=>i({...a,sms_phone:w(t.target.value)}),style:{flex:1}}),e.jsxs("button",{onClick:k,disabled:d||!a.sms_phone,style:{padding:"0.5rem 1rem",background:o?"#16a34a":"#6366f1",color:"white",border:"none",borderRadius:"6px",cursor:"pointer",display:"flex",alignItems:"center",gap:"0.5rem",opacity:d||!a.sms_phone?.5:1},children:[d?e.jsx(m,{size:16,className:"animate-spin"}):o?e.jsx(f,{size:16}):e.jsx(L,{size:16}),o?"Sent!":"Test SMS"]})]}),e.jsx("span",{style:{fontSize:"0.75rem",color:"#6b7280",marginTop:"0.25rem"},children:"Standard message rates apply. Reply STOP to unsubscribe."})]}),e.jsxs("div",{className:s.toggle,style:{opacity:a.sms_enabled?1:.5},children:[e.jsxs("div",{children:[e.jsx("span",{className:s.toggleLabel,children:"Deadline Reminders"}),e.jsx("span",{className:s.toggleDesc,children:"SMS alerts for upcoming deadlines"})]}),e.jsxs("label",{className:s.switch,children:[e.jsx("input",{type:"checkbox",checked:a.sms_deadlines,onChange:t=>i({...a,sms_deadlines:t.target.checked}),disabled:!a.sms_enabled}),e.jsx("span",{className:s.slider})]})]}),e.jsxs("div",{className:s.toggle,style:{opacity:a.sms_enabled?1:.5},children:[e.jsxs("div",{children:[e.jsx("span",{className:s.toggleLabel,children:"Urgent Matter Alerts"}),e.jsx("span",{className:s.toggleDesc,children:"Immediate SMS for urgent case updates"})]}),e.jsxs("label",{className:s.switch,children:[e.jsx("input",{type:"checkbox",checked:a.sms_urgent_matters,onChange:t=>i({...a,sms_urgent_matters:t.target.checked}),disabled:!a.sms_enabled}),e.jsx("span",{className:s.slider})]})]}),e.jsxs("div",{className:s.toggle,style:{opacity:a.sms_enabled?1:.5},children:[e.jsxs("div",{children:[e.jsx("span",{className:s.toggleLabel,children:"Payment Notifications"}),e.jsx("span",{className:s.toggleDesc,children:"SMS when payments are received"})]}),e.jsxs("label",{className:s.switch,children:[e.jsx("input",{type:"checkbox",checked:a.sms_payments,onChange:t=>i({...a,sms_payments:t.target.checked}),disabled:!a.sms_enabled}),e.jsx("span",{className:s.slider})]})]}),e.jsxs("div",{className:s.toggle,style:{opacity:a.sms_enabled?1:.5},children:[e.jsxs("div",{children:[e.jsx("span",{className:s.toggleLabel,children:"Calendar Reminders"}),e.jsx("span",{className:s.toggleDesc,children:"SMS reminders for appointments"})]}),e.jsxs("label",{className:s.switch,children:[e.jsx("input",{type:"checkbox",checked:a.sms_calendar,onChange:t=>i({...a,sms_calendar:t.target.checked}),disabled:!a.sms_enabled}),e.jsx("span",{className:s.slider})]})]})]})]})]}),e.jsxs("div",{className:s.section,children:[e.jsxs("div",{className:s.sectionHeader,children:[e.jsx(M,{size:20}),e.jsxs("div",{children:[e.jsx("h2",{children:"Email Notifications"}),e.jsx("p",{children:"Choose what emails you want to receive"})]})]}),e.jsxs("div",{className:s.toggleGroup,children:[e.jsxs("div",{className:s.toggle,children:[e.jsxs("div",{children:[e.jsx("span",{className:s.toggleLabel,children:"Immediate Email Alerts"}),e.jsx("span",{className:s.toggleDesc,children:"Get emails immediately for important events"})]}),e.jsxs("label",{className:s.switch,children:[e.jsx("input",{type:"checkbox",checked:a.email_immediate,onChange:t=>i({...a,email_immediate:t.target.checked})}),e.jsx("span",{className:s.slider})]})]}),e.jsxs("div",{className:s.toggle,children:[e.jsxs("div",{children:[e.jsx("span",{className:s.toggleLabel,children:"Email Digest"}),e.jsx("span",{className:s.toggleDesc,children:"Receive a summary of activity"})]}),e.jsxs("label",{className:s.switch,children:[e.jsx("input",{type:"checkbox",checked:a.email_digest,onChange:t=>i({...a,email_digest:t.target.checked})}),e.jsx("span",{className:s.slider})]})]}),a.email_digest&&e.jsxs("div",{className:s.formGroup,style:{marginTop:"0.5rem",marginLeft:"1rem"},children:[e.jsx("label",{children:"Digest Frequency"}),e.jsxs("select",{value:a.digest_frequency,onChange:t=>i({...a,digest_frequency:t.target.value}),children:[e.jsx("option",{value:"daily",children:"Daily"}),e.jsx("option",{value:"weekly",children:"Weekly"})]})]})]})]}),e.jsxs("div",{className:s.section,children:[e.jsxs("div",{className:s.sectionHeader,children:[e.jsx(P,{size:20}),e.jsxs("div",{children:[e.jsx("h2",{children:"In-App Notifications"}),e.jsx("p",{children:"Notifications that appear within Apex"})]})]}),e.jsxs("div",{className:s.toggleGroup,children:[e.jsxs("div",{className:s.toggle,children:[e.jsxs("div",{children:[e.jsx("span",{className:s.toggleLabel,children:"In-App Notifications"}),e.jsx("span",{className:s.toggleDesc,children:"Show notifications in the app"})]}),e.jsxs("label",{className:s.switch,children:[e.jsx("input",{type:"checkbox",checked:a.in_app,onChange:t=>i({...a,in_app:t.target.checked})}),e.jsx("span",{className:s.slider})]})]}),e.jsxs("div",{className:s.toggle,style:{opacity:a.in_app?1:.5},children:[e.jsxs("div",{children:[e.jsx("span",{className:s.toggleLabel,children:"Matter Updates"}),e.jsx("span",{className:s.toggleDesc,children:"Activity on your assigned matters"})]}),e.jsxs("label",{className:s.switch,children:[e.jsx("input",{type:"checkbox",checked:a.matter_updates,onChange:t=>i({...a,matter_updates:t.target.checked}),disabled:!a.in_app}),e.jsx("span",{className:s.slider})]})]}),e.jsxs("div",{className:s.toggle,style:{opacity:a.in_app?1:.5},children:[e.jsxs("div",{children:[e.jsx("span",{className:s.toggleLabel,children:"Document Changes"}),e.jsx("span",{className:s.toggleDesc,children:"Edits to shared documents"})]}),e.jsxs("label",{className:s.switch,children:[e.jsx("input",{type:"checkbox",checked:a.document_changes,onChange:t=>i({...a,document_changes:t.target.checked}),disabled:!a.in_app}),e.jsx("span",{className:s.slider})]})]}),e.jsxs("div",{className:s.toggle,style:{opacity:a.in_app?1:.5},children:[e.jsxs("div",{children:[e.jsx("span",{className:s.toggleLabel,children:"Document Sharing"}),e.jsx("span",{className:s.toggleDesc,children:"When documents are shared with you"})]}),e.jsxs("label",{className:s.switch,children:[e.jsx("input",{type:"checkbox",checked:a.document_shares,onChange:t=>i({...a,document_shares:t.target.checked}),disabled:!a.in_app}),e.jsx("span",{className:s.slider})]})]}),e.jsxs("div",{className:s.toggle,style:{opacity:a.in_app?1:.5},children:[e.jsxs("div",{children:[e.jsx("span",{className:s.toggleLabel,children:"Billing Alerts"}),e.jsx("span",{className:s.toggleDesc,children:"Invoice and payment notifications"})]}),e.jsxs("label",{className:s.switch,children:[e.jsx("input",{type:"checkbox",checked:a.billing_updates,onChange:t=>i({...a,billing_updates:t.target.checked}),disabled:!a.in_app}),e.jsx("span",{className:s.slider})]})]}),e.jsxs("div",{className:s.toggle,style:{opacity:a.in_app?1:.5},children:[e.jsxs("div",{children:[e.jsx("span",{className:s.toggleLabel,children:"AI Insights & Suggestions"}),e.jsx("span",{className:s.toggleDesc,children:"AI-generated recommendations and alerts"})]}),e.jsxs("label",{className:s.switch,children:[e.jsx("input",{type:"checkbox",checked:a.ai_notifications,onChange:t=>i({...a,ai_notifications:t.target.checked}),disabled:!a.in_app}),e.jsx("span",{className:s.slider})]})]})]})]}),e.jsxs("div",{className:s.section,style:{borderBottom:"none"},children:[e.jsxs("div",{className:s.sectionHeader,children:[e.jsx(A,{size:20}),e.jsxs("div",{children:[e.jsx("h2",{children:"Quiet Hours"}),e.jsx("p",{children:"Pause non-urgent notifications during specific times"})]})]}),e.jsxs("div",{className:s.toggle,style:{marginBottom:"1rem"},children:[e.jsxs("div",{children:[e.jsx("span",{className:s.toggleLabel,children:"Enable Quiet Hours"}),e.jsx("span",{className:s.toggleDesc,children:"Only urgent notifications will come through"})]}),e.jsxs("label",{className:s.switch,children:[e.jsx("input",{type:"checkbox",checked:!!(a.quiet_hours_start&&a.quiet_hours_end),onChange:t=>{t.target.checked?i({...a,quiet_hours_start:"22:00",quiet_hours_end:"07:00"}):i({...a,quiet_hours_start:"",quiet_hours_end:""})}}),e.jsx("span",{className:s.slider})]})]}),a.quiet_hours_start&&a.quiet_hours_end&&e.jsxs("div",{className:s.formGrid,children:[e.jsxs("div",{className:s.formGroup,children:[e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx(B,{size:16}),"Start Time"]}),e.jsx("input",{type:"time",value:a.quiet_hours_start,onChange:t=>i({...a,quiet_hours_start:t.target.value})})]}),e.jsxs("div",{className:s.formGroup,children:[e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx(E,{size:16}),"End Time"]}),e.jsx("input",{type:"time",value:a.quiet_hours_end,onChange:t=>i({...a,quiet_hours_end:t.target.value})})]})]}),e.jsxs("div",{style:{marginTop:"1rem",padding:"1rem",background:"#f8fafc",borderRadius:"8px",display:"flex",alignItems:"flex-start",gap:"0.75rem"},children:[e.jsx(R,{size:18,style:{color:"#6366f1",marginTop:"2px",flexShrink:0}}),e.jsxs("div",{style:{fontSize:"0.875rem",color:"#64748b"},children:[e.jsx("strong",{style:{color:"#334155"},children:"Note:"})," Urgent notifications (marked as high priority) will still be delivered during quiet hours. This ensures you never miss critical deadlines or urgent matter updates."]})]})]}),e.jsxs("div",{className:s.saveBar,children:[b&&e.jsxs("span",{className:s.savedMessage,children:[e.jsx(f,{size:16}),"Notification preferences saved!"]}),e.jsxs("button",{className:s.saveBtn,onClick:S,disabled:r,style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[r&&e.jsx(m,{size:16,className:"animate-spin"}),r?"Saving...":"Save Changes"]})]})]})})]})}export{V as NotificationsSettingsPage};
