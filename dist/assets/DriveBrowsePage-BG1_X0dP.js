import{r as a,a6 as e}from"./vendor-DrKzkH4x.js";import{a as T,d as U}from"./router-CNLU_KyZ.js";import{u as P,k as E,h as H}from"./index-CCWWoMiH.js";import{am as O,a as y,al as W,aO as p,R as G,aN as Q,U as J,H as K,f as q,ao as X,b8 as Y,bV as Z,L as ee,J as se,aB as te,ak as ie,j as ne,a5 as ae,bW as oe,F as re,k as ce}from"./icons-BtUkkwGS.js";import"./doc-parsers-U1nJMjtM.js";import"./react-dom-DfB-QKj2.js";import"./pdf-worker-CVmCB3lP.js";import"./state-72d44OIA.js";const le="_container_12n8t_1",de="_notification_12n8t_8",me="_slideIn_12n8t_1",_e="_success_12n8t_21",he="_error_12n8t_27",ue="_header_12n8t_54",xe="_headerLeft_12n8t_63",je="_backBtn_12n8t_69",ge="_headerIcon_12n8t_88",pe="_headerActions_12n8t_112",Ne="_refreshBtn_12n8t_117",ve="_actionBtn_12n8t_118",be="_uploadBtn_12n8t_143",fe="_spinning_12n8t_163",Ce="_spin_12n8t_163",we="_toolbar_12n8t_173",Be="_breadcrumbs_12n8t_186",ze="_breadcrumb_12n8t_186",Ie="_breadcrumbItem_12n8t_212",Fe="_toolbarRight_12n8t_218",Se="_searchBox_12n8t_224",ye="_viewToggle_12n8t_253",ke="_active_12n8t_273",Ae="_content_12n8t_280",Le="_loading_12n8t_288",$e="_empty_12n8t_290",Me="_listView_12n8t_331",Ve="_listHeader_12n8t_335",De="_listItem_12n8t_348",Re="_listColName_12n8t_366",Te="_fileIcon_12n8t_372",Ue="_folder_12n8t_383",Pe="_fileName_12n8t_388",Ee="_itemCount_12n8t_393",He="_versionBadge_12n8t_401",Oe="_uploadedBy_12n8t_410",We="_listColModified_12n8t_417",Ge="_listColSize_12n8t_425",Qe="_listColActions_12n8t_430",Je="_itemAction_12n8t_436",Ke="_gridView_12n8t_456",qe="_gridItem_12n8t_463",Xe="_gridIcon_12n8t_481",Ye="_gridName_12n8t_498",Ze="_gridMeta_12n8t_510",t={container:le,notification:de,slideIn:me,success:_e,error:he,header:ue,headerLeft:xe,backBtn:je,headerIcon:ge,headerActions:pe,refreshBtn:Ne,actionBtn:ve,uploadBtn:be,spinning:fe,spin:Ce,toolbar:we,breadcrumbs:Be,breadcrumb:ze,breadcrumbItem:Ie,toolbarRight:Fe,searchBox:Se,viewToggle:ye,active:ke,content:Ae,loading:Le,empty:$e,listView:Me,listHeader:Ve,listItem:De,listColName:Re,fileIcon:Te,folder:Ue,fileName:Pe,itemCount:Ee,versionBadge:He,uploadedBy:Oe,listColModified:We,listColSize:Ge,listColActions:Qe,itemAction:Je,gridView:Ke,gridItem:qe,gridIcon:Xe,gridName:Ye,gridMeta:Ze};function ms(){const d=T(),[k,A]=U(),{user:n}=P(),N=(n==null?void 0:n.role)==="owner"||(n==null?void 0:n.role)==="admin",m=k.get("path")||"",[L,v]=a.useState([]),[es,b]=a.useState([]),[ss,$]=a.useState({totalFiles:0,totalSize:0}),[_,f]=a.useState(!0),[C,w]=a.useState(null),[h,B]=a.useState("list"),[c,M]=a.useState(""),[ts,V]=a.useState([]),[l,u]=a.useState(null);a.useEffect(()=>{x()},[m]);const x=async()=>{f(!0),w(null);try{const s=await E.browseDrive(m);let i=s.files||[];!N&&(n!=null&&n.id)&&(i=i.filter(o=>o.isOwned||o.uploadedByName===`${n.firstName} ${n.lastName}`||o.matterId)),v(i),b(s.folders||[]),$({totalFiles:i.length,totalSize:i.reduce((o,r)=>o+(r.size||0),0)})}catch(s){w(s.message||"Failed to load drive contents"),v([]),b([])}finally{f(!1)}},j=s=>{A({path:s}),V([])},z=s=>{if(s.isFolder)return e.jsx(p,{size:24});const i=s.contentType||"";return i.startsWith("image/")?e.jsx(ne,{size:24}):i.startsWith("video/")?e.jsx(ae,{size:24}):i.startsWith("audio/")?e.jsx(oe,{size:24}):i.includes("pdf")||i.includes("document")||i.includes("word")?e.jsx(re,{size:24}):e.jsx(ce,{size:24})},I=s=>s?s<1024?`${s} B`:s<1024*1024?`${(s/1024).toFixed(1)} KB`:s<1024*1024*1024?`${(s/(1024*1024)).toFixed(1)} MB`:`${(s/(1024*1024*1024)).toFixed(1)} GB`:"-",D=s=>new Date(s).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric",hour:"2-digit",minute:"2-digit"}),F=s=>{s.isFolder?j(s.folderPath||s.name):d(`/app/documents?highlight=${s.id}`)},R=async s=>{if(!s.isFolder)try{const i=await H.download(s.id),o=window.URL.createObjectURL(i),r=document.createElement("a");r.href=o,r.download=s.name,document.body.appendChild(r),r.click(),window.URL.revokeObjectURL(o),document.body.removeChild(r),u({type:"success",message:`Downloaded ${s.name}`})}catch{u({type:"error",message:"Download failed"})}},g=L.filter(s=>s.name.toLowerCase().includes(c.toLowerCase())),S=m.split("/").filter(Boolean);return e.jsxs("div",{className:t.container,children:[l&&e.jsxs("div",{className:`${t.notification} ${t[l.type]}`,children:[l.type==="success"?e.jsx(O,{size:16}):e.jsx(y,{size:16}),l.message,e.jsx("button",{onClick:()=>u(null),children:"Ã—"})]}),e.jsxs("div",{className:t.header,children:[e.jsxs("div",{className:t.headerLeft,children:[e.jsx("button",{className:t.backBtn,onClick:()=>d("/app/settings/drives"),children:e.jsx(W,{size:20})}),e.jsx("div",{className:t.headerIcon,children:e.jsx(p,{size:28})}),e.jsxs("div",{children:[e.jsx("h1",{children:"Firm Drive"}),e.jsx("p",{children:"Browse and manage all firm documents"})]})]}),e.jsxs("div",{className:t.headerActions,children:[e.jsx("button",{className:t.refreshBtn,onClick:x,disabled:_,children:e.jsx(G,{size:18,className:_?t.spinning:""})}),N&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{className:t.actionBtn,children:[e.jsx(Q,{size:18}),"New Folder"]}),e.jsxs("button",{className:t.uploadBtn,children:[e.jsx(J,{size:18}),"Upload"]})]})]})]}),e.jsxs("div",{className:t.toolbar,children:[e.jsxs("div",{className:t.breadcrumbs,children:[e.jsxs("button",{className:t.breadcrumb,onClick:()=>j(""),children:[e.jsx(K,{size:16}),e.jsx("span",{children:"Firm Drive"})]}),S.map((s,i)=>e.jsxs("span",{className:t.breadcrumbItem,children:[e.jsx(q,{size:14}),e.jsx("button",{className:t.breadcrumb,onClick:()=>j(S.slice(0,i+1).join("/")),children:s})]},i))]}),e.jsxs("div",{className:t.toolbarRight,children:[e.jsxs("div",{className:t.searchBox,children:[e.jsx(X,{size:16}),e.jsx("input",{type:"text",placeholder:"Search files...",value:c,onChange:s=>M(s.target.value)})]}),e.jsxs("div",{className:t.viewToggle,children:[e.jsx("button",{className:h==="list"?t.active:"",onClick:()=>B("list"),children:e.jsx(Y,{size:18})}),e.jsx("button",{className:h==="grid"?t.active:"",onClick:()=>B("grid"),children:e.jsx(Z,{size:18})})]})]})]}),e.jsx("div",{className:t.content,children:_?e.jsxs("div",{className:t.loading,children:[e.jsx(ee,{size:32,className:t.spinning}),e.jsx("span",{children:"Loading files..."})]}):C?e.jsxs("div",{className:t.error,children:[e.jsx(y,{size:48}),e.jsx("h3",{children:"Unable to load drive"}),e.jsx("p",{children:C}),e.jsx("button",{onClick:x,children:"Try Again"})]}):g.length===0?e.jsxs("div",{className:t.empty,children:[e.jsx(p,{size:64}),e.jsx("h3",{children:c?"No matching files":"This folder is empty"}),e.jsx("p",{children:c?"Try a different search term":"Upload files or create folders to get started"})]}):h==="list"?e.jsxs("div",{className:t.listView,children:[e.jsxs("div",{className:t.listHeader,children:[e.jsx("div",{className:t.listColName,children:"Name"}),e.jsx("div",{className:t.listColModified,children:"Modified"}),e.jsx("div",{className:t.listColSize,children:"Size"}),e.jsx("div",{className:t.listColActions})]}),g.map(s=>e.jsxs("div",{className:t.listItem,onClick:()=>F(s),children:[e.jsxs("div",{className:t.listColName,children:[e.jsx("div",{className:`${t.fileIcon} ${s.isFolder?t.folder:""}`,children:z(s)}),e.jsx("span",{className:t.fileName,children:s.name}),s.matterName&&e.jsx("span",{className:t.itemCount,children:s.matterName}),s.versionCount>1&&e.jsxs("span",{className:t.versionBadge,children:["v",s.versionCount]})]}),e.jsxs("div",{className:t.listColModified,children:[e.jsx(se,{size:14}),D(s.uploadedAt),s.uploadedByName&&e.jsx("span",{className:t.uploadedBy,children:s.uploadedByName})]}),e.jsx("div",{className:t.listColSize,children:s.isFolder?"-":I(s.size)}),e.jsx("div",{className:t.listColActions,children:!s.isFolder&&e.jsxs(e.Fragment,{children:[e.jsx("button",{className:t.itemAction,onClick:i=>{i.stopPropagation(),R(s)},title:"Download",children:e.jsx(te,{size:16})}),e.jsx("button",{className:t.itemAction,onClick:i=>{i.stopPropagation(),d(`/app/documents/${s.id}/versions`)},title:"View Versions",children:e.jsx(ie,{size:16})})]})})]},s.id))]}):e.jsx("div",{className:t.gridView,children:g.map(s=>e.jsxs("div",{className:t.gridItem,onClick:()=>F(s),children:[e.jsx("div",{className:`${t.gridIcon} ${s.isFolder?t.folder:""}`,children:z(s)}),e.jsx("div",{className:t.gridName,children:s.name}),e.jsx("div",{className:t.gridMeta,children:s.isFolder?"Folder":I(s.size)})]},s.id))})})]})}export{ms as DriveBrowsePage};
