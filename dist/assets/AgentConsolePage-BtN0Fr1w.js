import{r,a6 as e}from"./vendor-DrKzkH4x.js";import{e as D,a as M}from"./router-CNLU_KyZ.js";import{al as L,T as B,o as w,C as v,L as S,f as u,aa as E,ab as G,R as J,F as d,b7 as R,b8 as b,aJ as z,ak as q,b9 as W,ao as U,a$ as X,A as K,b5 as Q,q as V,b as Y}from"./icons-BtUkkwGS.js";import"./doc-parsers-U1nJMjtM.js";import"./react-dom-DfB-QKj2.js";import"./pdf-worker-CVmCB3lP.js";const Z="_page_91n7n_3",ee="_header_91n7n_13",se="_backBtn_91n7n_23",ne="_headerTitle_91n7n_43",te="_taskId_91n7n_56",ae="_headerStatus_91n7n_65",re="_connectionDot_91n7n_75",ce="_connected_91n7n_81",ie="_disconnected_91n7n_87",oe="_progressSection_91n7n_103",le="_progressHeader_91n7n_109",_e="_progressInfo_91n7n_116",de="_progressStatus_91n7n_122",pe="_spinIcon_91n7n_131",me="_completeIcon_91n7n_140",ue="_failedIcon_91n7n_144",ve="_progressStep_91n7n_148",he="_progressMeta_91n7n_157",xe="_elapsed_91n7n_166",je="_progressBar_91n7n_171",fe="_progressFill_91n7n_178",ge="_progressComplete_91n7n_185",Ne="_progressFailed_91n7n_189",Ce="_iracProgress_91n7n_194",Se="_iracPhase_91n7n_203",ze="_active_91n7n_212",ye="_content_91n7n_223",Ie="_terminalSection_91n7n_232",$e="_terminalHeader_91n7n_240",ke="_terminalTitle_91n7n_249",Te="_eventCount_91n7n_260",Pe="_terminalControls_91n7n_268",Be="_filterSelect_91n7n_274",we="_controlBtn_91n7n_289",Ee="_terminal_91n7n_232",Re="_emptyTerminal_91n7n_341",be="_eventRow_91n7n_351",Ae="_eventTime_91n7n_363",Fe="_eventIcon_91n7n_369",Oe="_eventMessage_91n7n_378",He="_eventGray_91n7n_384",De="_eventBlue_91n7n_392",Me="_eventGreen_91n7n_400",Le="_eventRed_91n7n_408",Ge="_eventOrange_91n7n_416",Je="_eventPurple_91n7n_424",qe="_eventIndigo_91n7n_432",We="_eventDefault_91n7n_440",Ue="_artifactSection_91n7n_449",Xe="_artifactHeader_91n7n_457",Ke="_artifactContent_91n7n_471",Qe="_artifactName_91n7n_477",Ve="_artifactPreview_91n7n_489",Ye="_artifactEmpty_91n7n_503",Ze="_stepsOverview_91n7n_515",es="_stepsHeader_91n7n_520",ss="_stepsBar_91n7n_529",ns="_stepDot_91n7n_534",ts="_completed_91n7n_541",as="_current_91n7n_545",s={page:Z,header:ee,backBtn:se,headerTitle:ne,taskId:te,headerStatus:ae,connectionDot:re,connected:ce,disconnected:ie,progressSection:oe,progressHeader:le,progressInfo:_e,progressStatus:de,spinIcon:pe,completeIcon:me,failedIcon:ue,progressStep:ve,progressMeta:he,elapsed:xe,progressBar:je,progressFill:fe,progressComplete:ge,progressFailed:Ne,iracProgress:Ce,iracPhase:Se,active:ze,content:ye,terminalSection:Ie,terminalHeader:$e,terminalTitle:ke,eventCount:Te,terminalControls:Pe,filterSelect:Be,controlBtn:we,terminal:Ee,emptyTerminal:Re,eventRow:be,eventTime:Ae,eventIcon:Fe,eventMessage:Oe,eventGray:He,eventBlue:De,eventGreen:Me,eventRed:Le,eventOrange:Ge,eventPurple:Je,eventIndigo:qe,eventDefault:We,artifactSection:Ue,artifactHeader:Xe,artifactContent:Ke,artifactName:Qe,artifactPreview:Ve,artifactEmpty:Ye,stepsOverview:Ze,stepsHeader:es,stepsBar:ss,stepDot:ns,completed:ts,current:as},rs={rocket:e.jsx(Y,{size:14}),brain:e.jsx(V,{size:14}),tool:e.jsx(Q,{size:14}),"check-circle":e.jsx(v,{size:14}),"x-circle":e.jsx(w,{size:14}),"alert-triangle":e.jsx(K,{size:14}),"file-text":e.jsx(d,{size:14}),"file-check":e.jsx(R,{size:14}),"file-plus":e.jsx(d,{size:14}),list:e.jsx(b,{size:14}),play:e.jsx(E,{size:14}),check:e.jsx(v,{size:14}),book:e.jsx(X,{size:14}),search:e.jsx(U,{size:14}),"help-circle":e.jsx(W,{size:14}),"check-square":e.jsx(v,{size:14}),eye:e.jsx(q,{size:14}),activity:e.jsx(z,{size:14}),info:e.jsx(d,{size:14}),edit:e.jsx(d,{size:14}),circle:e.jsx(z,{size:14})};function cs(t){return rs[t||"circle"]||e.jsx(z,{size:14})}function is(t){try{return new Date(t).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1})}catch{return""}}function os(t){return t<60?`${Math.round(t)}s`:t<3600?`${Math.floor(t/60)}m ${Math.round(t%60)}s`:`${Math.floor(t/3600)}h ${Math.floor(t%3600/60)}m`}function vs(){const{taskId:t}=D(),y=M(),[I,h]=r.useState(!1),[x,j]=r.useState([]),[n,A]=r.useState(null),[_,F]=r.useState(!0),[p,O]=r.useState("all"),f=r.useRef(null),m=r.useRef(null),g=r.useRef(null),N=r.useCallback(()=>{if(!t)return;const a="https://apexai-api.azurewebsites.net/api",o=localStorage.getItem("token"),P=`${a}/v1/agent-stream/${t}?token=${o}`;console.log("[AgentConsole] Connecting to:",P);const c=new EventSource(P);f.current=c,c.onopen=()=>{console.log("[AgentConsole] Connected"),h(!0)},c.onerror=()=>{console.log("[AgentConsole] Connection error, reconnecting..."),h(!1),c.close(),g.current=window.setTimeout(()=>{N()},3e3)},c.addEventListener("connected",l=>{const i=JSON.parse(l.data);console.log("[AgentConsole] Connected:",i),h(!0)}),c.addEventListener("event",l=>{const i=JSON.parse(l.data);j(C=>[...C,i])}),c.addEventListener("progress",l=>{const i=JSON.parse(l.data);A(i)}),c.addEventListener("history",l=>{const i=JSON.parse(l.data);i.events&&j(C=>[...i.events,...C])}),c.addEventListener("heartbeat",()=>{})},[t]);r.useEffect(()=>(N(),()=>{f.current&&f.current.close(),g.current&&clearTimeout(g.current)}),[N]),r.useEffect(()=>{_&&m.current&&(m.current.scrollTop=m.current.scrollHeight)},[x,_]);const $=x.filter(a=>p==="all"?!0:p==="tools"?a.type.includes("tool"):p==="irac"?a.type.includes("irac"):p==="errors"?a.type==="error"||a.type==="tool_error":!0),H=a=>{switch(a){case"gray":return s.eventGray;case"blue":return s.eventBlue;case"green":return s.eventGreen;case"red":return s.eventRed;case"orange":return s.eventOrange;case"purple":return s.eventPurple;case"indigo":return s.eventIndigo;default:return s.eventDefault}},k=(n==null?void 0:n.status)==="completed"||(n==null?void 0:n.status)==="failed",T=(n==null?void 0:n.status)==="failed";return e.jsxs("div",{className:s.page,children:[e.jsxs("header",{className:s.header,children:[e.jsxs("button",{className:s.backBtn,onClick:()=>y("/app/background-agent"),children:[e.jsx(L,{size:18}),"Back"]}),e.jsxs("div",{className:s.headerTitle,children:[e.jsx(B,{size:20}),e.jsx("h1",{children:"Agent Console"}),e.jsxs("span",{className:s.taskId,children:[t==null?void 0:t.substring(0,20),"..."]})]}),e.jsxs("div",{className:s.headerStatus,children:[e.jsx("span",{className:`${s.connectionDot} ${I?s.connected:s.disconnected}`}),I?"Live":"Reconnecting..."]})]}),e.jsxs("div",{className:s.progressSection,children:[e.jsxs("div",{className:s.progressHeader,children:[e.jsxs("div",{className:s.progressInfo,children:[e.jsx("span",{className:s.progressStatus,children:k?T?e.jsxs(e.Fragment,{children:[e.jsx(w,{size:16,className:s.failedIcon})," Failed"]}):e.jsxs(e.Fragment,{children:[e.jsx(v,{size:16,className:s.completeIcon})," Complete"]}):e.jsxs(e.Fragment,{children:[e.jsx(S,{size:16,className:s.spinIcon})," ",(n==null?void 0:n.status)||"Initializing"]})}),e.jsx("span",{className:s.progressStep,children:(n==null?void 0:n.current_step)||"Starting..."})]}),e.jsxs("div",{className:s.progressMeta,children:[e.jsxs("span",{children:[(n==null?void 0:n.progress_percent)||0,"%"]}),(n==null?void 0:n.elapsed_seconds)&&e.jsx("span",{className:s.elapsed,children:os(n.elapsed_seconds)})]})]}),e.jsx("div",{className:s.progressBar,children:e.jsx("div",{className:`${s.progressFill} ${T?s.progressFailed:k?s.progressComplete:""}`,style:{width:`${(n==null?void 0:n.progress_percent)||0}%`}})}),(n==null?void 0:n.irac_phase)&&e.jsxs("div",{className:s.iracProgress,children:[e.jsx("span",{className:`${s.iracPhase} ${n.irac_phase==="issue"?s.active:""}`,children:"Issue"}),e.jsx(u,{size:14}),e.jsx("span",{className:`${s.iracPhase} ${n.irac_phase==="rule"?s.active:""}`,children:"Rule"}),e.jsx(u,{size:14}),e.jsx("span",{className:`${s.iracPhase} ${n.irac_phase==="analysis"?s.active:""}`,children:"Analysis"}),e.jsx(u,{size:14}),e.jsx("span",{className:`${s.iracPhase} ${n.irac_phase==="conclusion"?s.active:""}`,children:"Conclusion"}),e.jsx(u,{size:14}),e.jsx("span",{className:`${s.iracPhase} ${n.irac_phase==="critique"?s.active:""}`,children:"Critique"})]})]}),e.jsxs("div",{className:s.content,children:[e.jsxs("div",{className:s.terminalSection,children:[e.jsxs("div",{className:s.terminalHeader,children:[e.jsxs("div",{className:s.terminalTitle,children:[e.jsx(B,{size:16}),e.jsx("span",{children:"Activity Log"}),e.jsxs("span",{className:s.eventCount,children:[x.length," events"]})]}),e.jsxs("div",{className:s.terminalControls,children:[e.jsxs("select",{className:s.filterSelect,value:p,onChange:a=>O(a.target.value),children:[e.jsx("option",{value:"all",children:"All Events"}),e.jsx("option",{value:"tools",children:"Tools Only"}),e.jsx("option",{value:"irac",children:"IRAC Only"}),e.jsx("option",{value:"errors",children:"Errors Only"})]}),e.jsx("button",{className:`${s.controlBtn} ${_?s.active:""}`,onClick:()=>F(!_),title:_?"Auto-scroll ON":"Auto-scroll OFF",children:_?e.jsx(E,{size:14}):e.jsx(G,{size:14})}),e.jsx("button",{className:s.controlBtn,onClick:()=>j([]),title:"Clear",children:e.jsx(J,{size:14})})]})]}),e.jsx("div",{className:s.terminal,ref:m,children:$.length===0?e.jsxs("div",{className:s.emptyTerminal,children:[e.jsx(S,{size:24,className:s.spinIcon}),e.jsx("span",{children:"Waiting for agent activity..."})]}):$.map((a,o)=>e.jsxs("div",{className:`${s.eventRow} ${H(a.color)}`,children:[e.jsx("span",{className:s.eventTime,children:is(a.timestamp)}),e.jsx("span",{className:s.eventIcon,children:cs(a.icon)}),e.jsx("span",{className:s.eventMessage,children:a.message})]},`${a.timestamp}-${o}`))})]}),e.jsxs("div",{className:s.artifactSection,children:[e.jsxs("div",{className:s.artifactHeader,children:[e.jsx(d,{size:16}),e.jsx("span",{children:"Current Artifact"})]}),e.jsx("div",{className:s.artifactContent,children:n!=null&&n.current_artifact?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:s.artifactName,children:[e.jsx(R,{size:14}),n.current_artifact]}),n.artifact_preview?e.jsx("pre",{className:s.artifactPreview,children:n.artifact_preview}):e.jsxs("div",{className:s.artifactEmpty,children:[e.jsx(S,{size:16,className:s.spinIcon}),e.jsx("span",{children:"Writing..."})]})]}):e.jsxs("div",{className:s.artifactEmpty,children:[e.jsx(d,{size:24}),e.jsx("span",{children:"No artifact in progress"})]})}),(n==null?void 0:n.total_steps)&&n.total_steps>0&&e.jsxs("div",{className:s.stepsOverview,children:[e.jsxs("div",{className:s.stepsHeader,children:[e.jsx(b,{size:14}),e.jsxs("span",{children:["Steps (",n.completed_steps,"/",n.total_steps,")"]})]}),e.jsx("div",{className:s.stepsBar,children:Array.from({length:n.total_steps}).map((a,o)=>e.jsx("div",{className:`${s.stepDot} ${o<n.completed_steps?s.completed:o===n.completed_steps?s.current:""}`},o))})]})]})]})]})}export{vs as AgentConsolePage};
