import{r as i,a6 as e,h as I}from"./vendor-DrKzkH4x.js";import{a as X,L as ee}from"./router-CNLU_KyZ.js";import{a as te,u as ae,b as se,d as ne}from"./index-CCWWoMiH.js";import{s as a}from"./ListPages.module-B2P1D6uk.js";import{C as le}from"./ConfirmationModal-X7YGPBKC.js";import{as as ie,y as F,x as oe,ao as re,a0 as ce,aE as de,au as me,ak as ue,av as he,v as pe}from"./icons-BtUkkwGS.js";import"./doc-parsers-U1nJMjtM.js";import"./react-dom-DfB-QKj2.js";import"./pdf-worker-CVmCB3lP.js";import"./state-72d44OIA.js";const xe=c=>{const d=[{value:"my",label:"My Clients"}];return c&&d.push({value:"all",label:"All Clients"}),d};function Me(){const{clients:c,matters:d,addClient:m,updateClient:v,deleteClient:n,fetchClients:o,fetchMatters:N}=te(),{user:s}=ae(),{openChat:je}=se(),L=X();ne();const[j,B]=i.useState(""),[g,u]=i.useState(null),w=i.useRef(null),[r,E]=i.useState("my"),R=i.useRef(null),[G,$]=i.useState(0),y=60,M=5,P=(s==null?void 0:s.role)==="owner"||(s==null?void 0:s.role)==="admin";i.useEffect(()=>{function t(l){w.current&&!w.current.contains(l.target)&&u(null)}return document.addEventListener("mousedown",t),()=>document.removeEventListener("mousedown",t)},[]),i.useEffect(()=>{o({view:r}),N({view:"my"})},[r]);const[C,H]=i.useState("all"),[p,V]=i.useState("all"),[Q,S]=i.useState(!1),[b,f]=i.useState({isOpen:!1,clientId:"",clientName:"",action:"delete"}),U=async()=>{const{action:t,clientId:l}=b;try{t==="delete"?await n(l):await v(l,{isActive:t==="activate"}),f({isOpen:!1,clientId:"",clientName:"",action:"delete"}),u(null),o()}catch(x){console.error(`Failed to ${t} client:`,x),alert(`Failed to ${t} client`)}},W=()=>{const{action:t,clientName:l}=b;switch(t){case"delete":return{title:"Delete Client",message:`Are you sure you want to delete "${l}"? This action cannot be undone and will remove all associated data.`,confirmText:"Delete Client",type:"danger"};case"deactivate":return{title:"Deactivate Client",message:`Are you sure you want to deactivate "${l}"? The client will be marked as inactive.`,confirmText:"Deactivate",type:"warning"};case"activate":return{title:"Activate Client",message:`Are you sure you want to activate "${l}"? The client will be marked as active.`,confirmText:"Activate",type:"success"};default:return{title:"Confirm Action",message:"Are you sure you want to proceed?",confirmText:"Confirm",type:"info"}}},h=i.useMemo(()=>c.filter(t=>{var D;const x=(t.name||t.displayName||"").toLowerCase().includes(j.toLowerCase())||(((D=t.email)==null?void 0:D.toLowerCase().includes(j.toLowerCase()))??!1),T=t.isActive!==!1?"active":"inactive",q=C==="all"||T===C,K=p==="all"||p==="individual"&&t.type==="person"||p==="organization"&&t.type==="company";return x&&q&&K}).sort((t,l)=>{const x=(t.name||t.displayName||"").toLowerCase(),T=(l.name||l.displayName||"").toLowerCase();return x.localeCompare(T)}),[c,j,C,p]),Y=Math.ceil(600/y)+M*2,A=Math.max(0,Math.floor(G/y)-M),k=Math.min(h.length,A+Y),J=r==="all"?h.slice(A,k):h,z=r==="all"?A*y:0,O=r==="all"?Math.max(0,(h.length-k)*y):0,Z=i.useCallback(t=>{r==="all"&&$(t.currentTarget.scrollTop)},[r]),_=t=>d.filter(l=>l.clientId===t).length;return e.jsxs("div",{className:a.page,children:[e.jsxs("div",{className:a.header,children:[e.jsxs("div",{className:a.headerLeft,children:[e.jsx("h1",{children:r==="my"?"My Clients":"All Clients"}),e.jsxs("span",{className:a.count,children:[h.length," total"]})]}),e.jsx("div",{className:a.headerActions,children:e.jsxs("button",{className:a.primaryBtn,onClick:()=>S(!0),children:[e.jsx(ie,{size:18}),"New Client"]})})]}),e.jsxs("div",{className:a.filters,children:[e.jsx("div",{className:a.viewToggle,children:xe(P).map(t=>e.jsxs("button",{className:I(a.viewToggleBtn,r===t.value&&a.active),onClick:()=>E(t.value),children:[t.value==="my"?e.jsx(F,{size:14}):e.jsx(oe,{size:14}),t.label]},t.value))}),e.jsxs("div",{className:a.searchBox,children:[e.jsx(re,{size:18}),e.jsx("input",{type:"text",placeholder:"Search clients...",value:j,onChange:t=>B(t.target.value)})]}),e.jsxs("select",{value:C,onChange:t=>H(t.target.value),className:a.filterSelect,children:[e.jsx("option",{value:"all",children:"All Statuses"}),e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"inactive",children:"Inactive"}),e.jsx("option",{value:"prospective",children:"Prospective"})]}),e.jsxs("select",{value:p,onChange:t=>V(t.target.value),className:a.filterSelect,children:[e.jsx("option",{value:"all",children:"All Types"}),e.jsx("option",{value:"individual",children:"Individual"}),e.jsx("option",{value:"organization",children:"Organization"})]})]}),e.jsxs("div",{ref:R,className:a.tableContainer,onScroll:Z,children:[e.jsxs("table",{className:a.table,children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Client"}),e.jsx("th",{children:"Contact"}),e.jsx("th",{children:"Type"}),e.jsx("th",{children:"Status"}),e.jsx("th",{children:"Matters"}),e.jsx("th",{})]})}),e.jsxs("tbody",{children:[z>0&&e.jsx("tr",{style:{height:z},"aria-hidden":"true",children:e.jsx("td",{colSpan:6,style:{padding:0,border:"none"}})}),J.map(t=>{const l=t.isActive?"active":"inactive";return e.jsxs("tr",{children:[e.jsx("td",{children:e.jsxs(ee,{to:`/app/clients/${t.id}`,className:a.nameCell,children:[e.jsx("div",{className:a.icon,children:t.type==="company"?e.jsx(ce,{size:16}):e.jsx(de,{size:16})}),e.jsxs("div",{children:[e.jsx("span",{className:a.name,children:t.name}),e.jsxs("span",{className:a.subtitle,children:[t.addressCity,", ",t.addressState]})]})]})}),e.jsx("td",{children:e.jsxs("div",{children:[e.jsx("span",{className:a.name,children:t.email}),e.jsx("span",{className:a.subtitle,children:t.phone})]})}),e.jsx("td",{children:e.jsx("span",{className:a.typeTag,children:t.type==="company"?"Organization":"Individual"})}),e.jsx("td",{children:e.jsx("span",{className:I(a.statusBadge,a[l]),children:l})}),e.jsx("td",{children:_(t.id)}),e.jsx("td",{children:e.jsxs("div",{className:a.menuWrapper,ref:g===t.id?w:null,children:[e.jsx("button",{className:a.menuBtn,onClick:()=>u(g===t.id?null:t.id),children:e.jsx(me,{size:16})}),g===t.id&&e.jsxs("div",{className:a.dropdown,children:[e.jsxs("button",{className:a.dropdownItem,onClick:()=>{u(null),L(`/app/clients/${t.id}`)},children:[e.jsx(ue,{size:14}),"View Details"]}),e.jsxs("button",{className:a.dropdownItem,onClick:()=>{f({isOpen:!0,clientId:t.id,clientName:t.name,action:t.isActive?"deactivate":"activate"}),u(null)},children:[e.jsx(he,{size:14}),t.isActive?"Deactivate":"Activate"]}),e.jsx("div",{className:a.dropdownDivider}),e.jsxs("button",{className:I(a.dropdownItem,a.danger),onClick:()=>{f({isOpen:!0,clientId:t.id,clientName:t.name,action:"delete"}),u(null)},children:[e.jsx(pe,{size:14}),"Delete Client"]})]})]})})]},t.id)}),O>0&&e.jsx("tr",{style:{height:O},"aria-hidden":"true",children:e.jsx("td",{colSpan:6,style:{padding:0,border:"none"}})})]})]}),h.length===0&&e.jsxs("div",{className:a.emptyState,children:[e.jsx(F,{size:48}),e.jsx("h3",{children:"No clients found"}),e.jsx("p",{children:"Try adjusting your search or filters"})]})]}),Q&&e.jsx(ve,{onClose:()=>S(!1),onSave:async t=>{try{await m(t),S(!1),o()}catch(l){console.error("Failed to create client:",l),alert("Failed to create client. Please try again.")}}}),e.jsx(le,{isOpen:b.isOpen,onClose:()=>f({isOpen:!1,clientId:"",clientName:"",action:"delete"}),onConfirm:U,...W()})]})}function ve({onClose:c,onSave:d}){const[m,v]=i.useState(!1),[n,o]=i.useState({type:"person",displayName:"",name:"",email:"",phone:"",addressStreet:"",addressCity:"",addressState:"",addressZip:"",notes:"",tags:[],contactType:"client",isActive:!0}),N=async s=>{if(s.preventDefault(),!m){v(!0);try{await d({...n,displayName:n.name,email:n.email||void 0,phone:n.phone||void 0})}finally{v(!1)}}};return e.jsx("div",{className:a.modalOverlay,onClick:c,children:e.jsxs("div",{className:a.modal,onClick:s=>s.stopPropagation(),children:[e.jsxs("div",{className:a.modalHeader,children:[e.jsx("h2",{children:"New Client"}),e.jsx("button",{onClick:c,className:a.closeBtn,children:"Ã—"})]}),e.jsxs("form",{onSubmit:N,className:a.modalForm,children:[e.jsxs("div",{className:a.formGroup,children:[e.jsx("label",{children:"Client Type"}),e.jsxs("select",{value:n.type,onChange:s=>o({...n,type:s.target.value}),children:[e.jsx("option",{value:"person",children:"Individual"}),e.jsx("option",{value:"company",children:"Organization"})]})]}),e.jsxs("div",{className:a.formGroup,children:[e.jsxs("label",{children:[n.type==="company"?"Organization Name":"Full Name"," (optional)"]}),e.jsx("input",{type:"text",value:n.name,onChange:s=>o({...n,name:s.target.value}),placeholder:n.type==="company"?"Company Name, LLC":"John Smith"})]}),e.jsxs("div",{className:a.formRow,children:[e.jsxs("div",{className:a.formGroup,children:[e.jsx("label",{children:"Email (optional)"}),e.jsx("input",{type:"email",value:n.email,onChange:s=>o({...n,email:s.target.value}),placeholder:"email@example.com"})]}),e.jsxs("div",{className:a.formGroup,children:[e.jsx("label",{children:"Phone (optional)"}),e.jsx("input",{type:"tel",value:n.phone,onChange:s=>o({...n,phone:s.target.value}),placeholder:"(555) 555-0100"})]})]}),e.jsxs("div",{className:a.formGroup,children:[e.jsx("label",{children:"Address (optional)"}),e.jsx("input",{type:"text",value:n.addressStreet,onChange:s=>o({...n,addressStreet:s.target.value}),placeholder:"123 Main Street"})]}),e.jsxs("div",{className:a.formRow,children:[e.jsxs("div",{className:a.formGroup,children:[e.jsx("label",{children:"City (optional)"}),e.jsx("input",{type:"text",value:n.addressCity,onChange:s=>o({...n,addressCity:s.target.value}),placeholder:"New York"})]}),e.jsxs("div",{className:a.formGroup,children:[e.jsx("label",{children:"State (optional)"}),e.jsx("input",{type:"text",value:n.addressState,onChange:s=>o({...n,addressState:s.target.value}),placeholder:"NY"})]})]}),e.jsxs("div",{className:a.formGroup,children:[e.jsx("label",{children:"Notes (optional)"}),e.jsx("textarea",{value:n.notes,onChange:s=>o({...n,notes:s.target.value}),placeholder:"Additional notes about the client",rows:3})]}),e.jsxs("div",{className:a.modalActions,children:[e.jsx("button",{type:"button",onClick:c,className:a.cancelBtn,disabled:m,children:"Cancel"}),e.jsx("button",{type:"submit",className:a.saveBtn,disabled:m,children:m?"Creating...":"Create Client"})]})]})]})})}export{Me as ClientsPage};
