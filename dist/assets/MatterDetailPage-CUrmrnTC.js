import{r as t,a6 as e,h as I}from"./vendor-DrKzkH4x.js";import{e as Qa,a as Ja,L as Ze}from"./router-CNLU_KyZ.js";import{m as B,b as Ka,c as Xa,d as Me,a as Ya,g as Za,u as et,t as st,f as at,h as Ys,w as Zs}from"./index-CCWWoMiH.js";import{p as He}from"./dateUtils-Bq7Z0P5c.js";import{s}from"./DetailPage.module-Bt939KNz.js";import{C as tt}from"./ConfirmationModal-X7YGPBKC.js";import{M as lt}from"./MatterTypesManager-P8eWpN0d.js";import{ae as ys,X as De,ax as ss,$ as fs,a as ca,t as bs,y as Ne,a4 as es,ao as gs,L as Ae,ay as ea,ak as it,az as de,v as ae,x as vs,an as nt,S as sa,au as rt,o as ot,am as Ie,av as ct,J as Te,D as aa,F as ve,as as Q,a0 as dt,ah as mt,m as ta,z as Ns,ab as ut,n as ht,aA as pt,U as la,aB as ia,aC as xt,aD as jt,aE as vt,s as Nt}from"./icons-BtUkkwGS.js";import{D as yt,S as bt}from"./ShareDocumentModal-Uqa4Lxgn.js";import{f as A,p as U,a as ft}from"./date-utils-BkNAU8cl.js";import"./doc-parsers-U1nJMjtM.js";import"./react-dom-DfB-QKj2.js";import"./pdf-worker-CVmCB3lP.js";import"./state-72d44OIA.js";const gt="_overlay_1evap_3",Ct="_fadeIn_1evap_1",kt="_modal_1evap_20",St="_slideUp_1evap_1",_t="_header_1evap_44",wt="_headerContent_1evap_52",Tt="_matterName_1evap_70",It="_closeBtn_1evap_80",Dt="_visibilityInfo_1evap_96",At="_error_1evap_116",Mt="_success_1evap_129",zt="_tabs_1evap_143",Bt="_activeTab_1evap_170",Ft="_searchBox_1evap_176",Lt="_content_1evap_206",Pt="_loading_1evap_214",Ot="_spinner_1evap_224",Rt="_spin_1evap_224",$t="_empty_1evap_233",Ut="_list_1evap_241",Et="_item_1evap_247",Ht="_selected_1evap_263",Gt="_avatar_1evap_275",Wt="_groupAvatar_1evap_289",qt="_itemInfo_1evap_300",Vt="_itemName_1evap_305",Qt="_itemMeta_1evap_314",Jt="_roleBadge_1evap_323",Kt="_owner_1evap_332",Xt="_admin_1evap_337",Yt="_attorney_1evap_342",Zt="_paralegal_1evap_347",el="_staff_1evap_352",sl="_billing_1evap_357",al="_footer_1evap_363",tl="_selectionCount_1evap_373",ll="_footerActions_1evap_379",il="_cancelBtn_1evap_384",nl="_shareBtn_1evap_406",f={overlay:gt,fadeIn:Ct,modal:kt,slideUp:St,header:_t,headerContent:wt,matterName:Tt,closeBtn:It,visibilityInfo:Dt,error:At,success:Mt,tabs:zt,activeTab:Bt,searchBox:Ft,content:Lt,loading:Pt,spinner:Ot,spin:Rt,empty:$t,list:Ut,item:Et,selected:Ht,avatar:Gt,groupAvatar:Wt,itemInfo:qt,itemName:Vt,itemMeta:Qt,roleBadge:Jt,owner:Kt,admin:Xt,attorney:Yt,paralegal:Zt,staff:el,billing:sl,footer:al,selectionCount:tl,footerActions:ll,cancelBtn:il,shareBtn:nl};function rl({isOpen:i,onClose:j,matterId:S,matterName:N,currentVisibility:p,onPermissionsChanged:m}){const[g,d]=t.useState(!1),[c,v]=t.useState(!1),[h,r]=t.useState(null),[E,G]=t.useState(null),[P,R]=t.useState("users"),[J,C]=t.useState(""),[z,M]=t.useState([]),[L,W]=t.useState([]),[F,H]=t.useState([]);t.useEffect(()=>{i&&re()},[i,S]);const K=z.filter(y=>y.name.toLowerCase().includes(J.toLowerCase())||y.email.toLowerCase().includes(J.toLowerCase()));async function re(){try{d(!0),r(null);const[y,X]=await Promise.all([B.getAvailableUsers(S),B.getAvailableGroups(S)]);M(y.users||[]),W(X.groups||[])}catch(y){r(y.message||"Failed to load users and groups")}finally{d(!1)}}function q(y){H(X=>X.includes(y)?X.filter(le=>le!==y):[...X,y])}async function _(){if(F.length===0){r("Please select at least one user or group");return}try{v(!0),r(null);for(const y of F){const X=z.some(me=>me.id===y),le=L.some(me=>me.id===y);X?await B.addPermission(S,{userId:y}):le&&await B.addPermission(S,{groupId:y})}G(`Shared with ${F.length} user${F.length>1?"s/groups":""}`),H([]),m&&m(),setTimeout(()=>{j(),G(null)},1500)}catch(y){r(y.message||"Failed to share matter")}finally{v(!1)}}return i?e.jsx("div",{className:f.overlay,onClick:j,children:e.jsxs("div",{className:f.modal,onClick:y=>y.stopPropagation(),children:[e.jsxs("div",{className:f.header,children:[e.jsxs("div",{className:f.headerContent,children:[e.jsx(ys,{size:20}),e.jsxs("div",{children:[e.jsx("h3",{children:"Share Matter"}),e.jsx("p",{className:f.matterName,children:N})]})]}),e.jsx("button",{className:f.closeBtn,onClick:j,children:e.jsx(De,{size:20})})]}),e.jsx("div",{className:f.visibilityInfo,children:p==="firm_wide"?e.jsxs(e.Fragment,{children:[e.jsx(ss,{size:16}),e.jsxs("span",{children:["This matter is ",e.jsx("strong",{children:"Firm Wide"})," - all users can access it."]})]}):e.jsxs(e.Fragment,{children:[e.jsx(fs,{size:16}),e.jsxs("span",{children:["This matter is ",e.jsx("strong",{children:"Restricted"})," - only selected users can access it."]})]})}),h&&e.jsxs("div",{className:f.error,children:[e.jsx(ca,{size:16}),h]}),E&&e.jsxs("div",{className:f.success,children:[e.jsx(bs,{size:16}),E]}),e.jsxs("div",{className:f.tabs,children:[e.jsxs("button",{className:I(P==="users"&&f.activeTab),onClick:()=>R("users"),children:[e.jsx(Ne,{size:16}),"Users (",z.length,")"]}),e.jsxs("button",{className:I(P==="groups"&&f.activeTab),onClick:()=>R("groups"),children:[e.jsx(es,{size:16}),"Groups (",L.length,")"]})]}),P==="users"&&e.jsxs("div",{className:f.searchBox,children:[e.jsx(gs,{size:16}),e.jsx("input",{type:"text",placeholder:"Search by name or email...",value:J,onChange:y=>C(y.target.value)})]}),e.jsx("div",{className:f.content,children:g?e.jsxs("div",{className:f.loading,children:[e.jsx(Ae,{className:f.spinner,size:24}),e.jsx("span",{children:"Loading..."})]}):P==="users"?K.length===0?e.jsx("div",{className:f.empty,children:J?"No users match your search":"No users available to add"}):e.jsx("div",{className:f.list,children:K.map(y=>e.jsxs("label",{className:I(f.item,F.includes(y.id)&&f.selected),children:[e.jsx("input",{type:"checkbox",checked:F.includes(y.id),onChange:()=>q(y.id)}),e.jsx("div",{className:f.avatar,children:y.name.split(" ").map(X=>X[0]).join("")}),e.jsxs("div",{className:f.itemInfo,children:[e.jsx("span",{className:f.itemName,children:y.name}),e.jsx("span",{className:f.itemMeta,children:y.email})]}),e.jsx("span",{className:I(f.roleBadge,f[y.role]),children:y.role})]},y.id))}):L.length===0?e.jsx("div",{className:f.empty,children:"No groups available to add"}):e.jsx("div",{className:f.list,children:L.map(y=>e.jsxs("label",{className:I(f.item,F.includes(y.id)&&f.selected),children:[e.jsx("input",{type:"checkbox",checked:F.includes(y.id),onChange:()=>q(y.id)}),e.jsx("div",{className:f.groupAvatar,style:{backgroundColor:y.color},children:e.jsx(Ne,{size:14})}),e.jsxs("div",{className:f.itemInfo,children:[e.jsx("span",{className:f.itemName,children:y.name}),e.jsxs("span",{className:f.itemMeta,children:[y.memberCount," member",y.memberCount!==1?"s":""]})]})]},y.id))})}),e.jsxs("div",{className:f.footer,children:[e.jsx("span",{className:f.selectionCount,children:F.length>0&&`${F.length} selected`}),e.jsxs("div",{className:f.footerActions,children:[e.jsx("button",{className:f.cancelBtn,onClick:j,disabled:c,children:"Cancel"}),e.jsx("button",{className:f.shareBtn,onClick:_,disabled:c||F.length===0,children:c?e.jsxs(e.Fragment,{children:[e.jsx(Ae,{className:f.spinner,size:16}),"Sharing..."]}):e.jsxs(e.Fragment,{children:[e.jsx(ys,{size:16}),"Share"]})})]})]})]})}):null}const ol="_container_1l22i_3",cl="_compact_1l22i_9",dl="_header_1l22i_13",ml="_closeBtn_1l22i_32",ul="_loading_1l22i_48",hl="_spinner_1l22i_58",pl="_spin_1l22i_58",xl="_error_1l22i_68",jl="_section_1l22i_92",vl="_sectionLabel_1l22i_96",Nl="_sectionHeader_1l22i_106",yl="_visibilityToggle_1l22i_118",bl="_visibilityOption_1l22i_123",fl="_active_1l22i_142",gl="_optionContent_1l22i_162",Cl="_optionTitle_1l22i_166",kl="_optionDesc_1l22i_173",Sl="_checkIcon_1l22i_179",_l="_responsibleAttorney_1l22i_185",wl="_userAvatar_1l22i_194",Tl="_groupAvatar_1l22i_208",Il="_badge_1l22i_219",Dl="_addBtn_1l22i_230",Al="_emptyPermissions_1l22i_255",Ml="_addFirstBtn_1l22i_274",zl="_permissionsList_1l22i_294",Bl="_permissionItem_1l22i_300",Fl="_permInfo_1l22i_314",Ll="_permName_1l22i_319",Pl="_permMeta_1l22i_328",Ol="_permActions_1l22i_337",Rl="_permLevel_1l22i_344",$l="_view_1l22i_355",Ul="_edit_1l22i_360",El="_admin_1l22i_365",Hl="_removeBtn_1l22i_370",Gl="_pickerOverlay_1l22i_391",Wl="_picker_1l22i_391",ql="_pickerHeader_1l22i_413",Vl="_pickerTabs_1l22i_442",Ql="_activeTab_1l22i_470",Jl="_searchBox_1l22i_475",Kl="_pickerList_1l22i_501",Xl="_pickerLoading_1l22i_508",Yl="_pickerEmpty_1l22i_516",Zl="_pickerItem_1l22i_523",ei="_pickerItemInfo_1l22i_546",si="_pickerItemName_1l22i_551",ai="_pickerItemMeta_1l22i_557",ti="_roleBadge_1l22i_563",li="_owner_1l22i_571",ii="_attorney_1l22i_581",ni="_paralegal_1l22i_586",ri="_staff_1l22i_591",oi="_billing_1l22i_596",u={container:ol,compact:cl,header:dl,closeBtn:ml,loading:ul,spinner:hl,spin:pl,error:xl,section:jl,sectionLabel:vl,sectionHeader:Nl,visibilityToggle:yl,visibilityOption:bl,active:fl,optionContent:gl,optionTitle:Cl,optionDesc:kl,checkIcon:Sl,responsibleAttorney:_l,userAvatar:wl,groupAvatar:Tl,badge:Il,addBtn:Dl,emptyPermissions:Al,addFirstBtn:Ml,permissionsList:zl,permissionItem:Bl,permInfo:Fl,permName:Ll,permMeta:Pl,permActions:Ol,permLevel:Rl,view:$l,edit:Ul,admin:El,removeBtn:Hl,pickerOverlay:Gl,picker:Wl,pickerHeader:ql,pickerTabs:Vl,activeTab:Ql,searchBox:Jl,pickerList:Kl,pickerLoading:Xl,pickerEmpty:Yl,pickerItem:Zl,pickerItemInfo:ei,pickerItemName:si,pickerItemMeta:ai,roleBadge:ti,owner:li,attorney:ii,paralegal:ni,staff:ri,billing:oi};function ci({matterId:i,matterName:j,canManagePermissions:S,onClose:N,compact:p=!1}){const[m,g]=t.useState(!0),[d,c]=t.useState(!1),[v,h]=t.useState(null),[r,E]=t.useState("firm_wide"),[G,P]=t.useState([]),[R,J]=t.useState(0),[C]=t.useState(20),[z,M]=t.useState(null),[L,W]=t.useState(null),[F,H]=t.useState(!1),[K,re]=t.useState("users"),[q,_]=t.useState(""),[y,X]=t.useState([]),[le,me]=t.useState([]),[ee,ze]=t.useState(!1);t.useEffect(()=>{Ge()},[i]);async function Ge(){try{g(!0),h(null);const x=await B.getPermissions(i);E(x.visibility||"firm_wide"),P(x.permissions||[]),J(x.permissionCount||0),M(x.responsibleAttorney),W(x.responsibleAttorneyName)}catch(x){h(x.message||"Failed to load permissions")}finally{g(!1)}}t.useEffect(()=>{F&&Cs()},[F,q]);async function Cs(){try{ze(!0);const[x,Y]=await Promise.all([B.getAvailableUsers(i,q||void 0),B.getAvailableGroups(i)]);X(x.users||[]),me(Y.groups||[])}catch(x){console.error("Failed to load users/groups:",x)}finally{ze(!1)}}async function as(x){if(S)try{c(!0),await B.updateVisibility(i,x),E(x)}catch(Y){h(Y.message||"Failed to update visibility")}finally{c(!1)}}async function ts(x,Y){if(S){if(R>=C){h(`Maximum ${C} permissions reached`);return}try{c(!0),await B.addPermission(i,{userId:x,groupId:Y}),await Ge(),H(!1),_("")}catch(We){h(We.message||"Failed to add permission")}finally{c(!1)}}}async function ks(x){if(S)try{c(!0),await B.removePermission(i,x),await Ge()}catch(Y){h(Y.message||"Failed to remove permission")}finally{c(!1)}}return m?e.jsx("div",{className:I(u.container,p&&u.compact),children:e.jsxs("div",{className:u.loading,children:[e.jsx(Ae,{className:u.spinner,size:24}),e.jsx("span",{children:"Loading permissions..."})]})}):e.jsxs("div",{className:I(u.container,p&&u.compact),children:[N&&e.jsxs("div",{className:u.header,children:[e.jsxs("h3",{children:[e.jsx(es,{size:20}),"Matter Permissions"]}),e.jsx("button",{className:u.closeBtn,onClick:N,children:e.jsx(De,{size:20})})]}),v&&e.jsxs("div",{className:u.error,children:[e.jsx(ca,{size:16}),v,e.jsx("button",{onClick:()=>h(null),children:"×"})]}),e.jsxs("div",{className:u.section,children:[e.jsx("label",{className:u.sectionLabel,children:"Visibility"}),e.jsxs("div",{className:u.visibilityToggle,children:[e.jsxs("button",{className:I(u.visibilityOption,r==="firm_wide"&&u.active),onClick:()=>as("firm_wide"),disabled:!S||d,children:[e.jsx(ss,{size:18}),e.jsxs("div",{className:u.optionContent,children:[e.jsx("span",{className:u.optionTitle,children:"Firm Wide"}),e.jsx("span",{className:u.optionDesc,children:"All users can access"})]}),r==="firm_wide"&&e.jsx(bs,{size:18,className:u.checkIcon})]}),e.jsxs("button",{className:I(u.visibilityOption,r==="restricted"&&u.active),onClick:()=>as("restricted"),disabled:!S||d,children:[e.jsx(fs,{size:18}),e.jsxs("div",{className:u.optionContent,children:[e.jsx("span",{className:u.optionTitle,children:"Restricted"}),e.jsx("span",{className:u.optionDesc,children:"Only selected users"})]}),r==="restricted"&&e.jsx(bs,{size:18,className:u.checkIcon})]})]})]}),L&&e.jsxs("div",{className:u.section,children:[e.jsx("label",{className:u.sectionLabel,children:"Responsible Attorney"}),e.jsxs("div",{className:u.responsibleAttorney,children:[e.jsx("div",{className:u.userAvatar,children:L.split(" ").map(x=>x[0]).join("")}),e.jsx("span",{children:L}),e.jsx("span",{className:u.badge,children:"Always has access"})]})]}),r==="restricted"&&e.jsxs("div",{className:u.section,children:[e.jsxs("div",{className:u.sectionHeader,children:[e.jsxs("label",{className:u.sectionLabel,children:["Who Has Access (",R,"/",C,")"]}),S&&R<C&&e.jsxs("button",{className:u.addBtn,onClick:()=>H(!0),disabled:d,children:[e.jsx(ea,{size:16}),"Add"]})]}),G.length===0?e.jsxs("div",{className:u.emptyPermissions,children:[e.jsx(Ne,{size:24}),e.jsx("p",{children:"No additional users or groups have access yet."}),S&&e.jsxs("button",{className:u.addFirstBtn,onClick:()=>H(!0),children:[e.jsx(ea,{size:16}),"Add Users or Groups"]})]}):e.jsx("div",{className:u.permissionsList,children:G.map(x=>{var Y;return e.jsxs("div",{className:u.permissionItem,children:[x.userId?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:u.userAvatar,children:((Y=x.userName)==null?void 0:Y.split(" ").map(We=>We[0]).join(""))||"?"}),e.jsxs("div",{className:u.permInfo,children:[e.jsx("span",{className:u.permName,children:x.userName}),e.jsx("span",{className:u.permMeta,children:x.userEmail})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:u.groupAvatar,style:{backgroundColor:x.groupColor||"#3B82F6"},children:e.jsx(Ne,{size:14})}),e.jsxs("div",{className:u.permInfo,children:[e.jsx("span",{className:u.permName,children:x.groupName}),e.jsx("span",{className:u.permMeta,children:"Group"})]})]}),e.jsxs("div",{className:u.permActions,children:[e.jsxs("span",{className:I(u.permLevel,u[x.permissionLevel]),children:[x.permissionLevel==="view"&&e.jsx(it,{size:12}),x.permissionLevel==="edit"&&e.jsx(de,{size:12}),x.permissionLevel==="admin"&&e.jsx(es,{size:12}),x.permissionLevel]}),S&&e.jsx("button",{className:u.removeBtn,onClick:()=>ks(x.permissionId),disabled:d,title:"Remove access",children:e.jsx(ae,{size:14})})]})]},x.permissionId)})})]}),F&&e.jsx("div",{className:u.pickerOverlay,onClick:()=>H(!1),children:e.jsxs("div",{className:u.picker,onClick:x=>x.stopPropagation(),children:[e.jsxs("div",{className:u.pickerHeader,children:[e.jsx("h4",{children:"Add Access"}),e.jsx("button",{onClick:()=>H(!1),children:e.jsx(De,{size:18})})]}),e.jsxs("div",{className:u.pickerTabs,children:[e.jsxs("button",{className:I(K==="users"&&u.activeTab),onClick:()=>re("users"),children:[e.jsx(Ne,{size:16}),"Users"]}),e.jsxs("button",{className:I(K==="groups"&&u.activeTab),onClick:()=>re("groups"),children:[e.jsx(es,{size:16}),"Groups"]})]}),K==="users"&&e.jsxs("div",{className:u.searchBox,children:[e.jsx(gs,{size:16}),e.jsx("input",{type:"text",placeholder:"Search users...",value:q,onChange:x=>_(x.target.value),autoFocus:!0})]}),e.jsx("div",{className:u.pickerList,children:ee?e.jsx("div",{className:u.pickerLoading,children:e.jsx(Ae,{className:u.spinner,size:20})}):K==="users"?y.length===0?e.jsx("div",{className:u.pickerEmpty,children:"No users available to add"}):y.map(x=>e.jsxs("button",{className:u.pickerItem,onClick:()=>ts(x.id),disabled:d,children:[e.jsx("div",{className:u.userAvatar,children:x.name.split(" ").map(Y=>Y[0]).join("")}),e.jsxs("div",{className:u.pickerItemInfo,children:[e.jsx("span",{className:u.pickerItemName,children:x.name}),e.jsx("span",{className:u.pickerItemMeta,children:x.email})]}),e.jsx("span",{className:I(u.roleBadge,u[x.role]),children:x.role})]},x.id)):le.length===0?e.jsx("div",{className:u.pickerEmpty,children:"No groups available to add"}):le.map(x=>e.jsxs("button",{className:u.pickerItem,onClick:()=>ts(void 0,x.id),disabled:d,children:[e.jsx("div",{className:u.groupAvatar,style:{backgroundColor:x.color},children:e.jsx(Ne,{size:14})}),e.jsxs("div",{className:u.pickerItemInfo,children:[e.jsx("span",{className:u.pickerItemName,children:x.name}),e.jsxs("span",{className:u.pickerItemMeta,children:[x.memberCount," member",x.memberCount!==1?"s":""]})]})]},x.id))})]})})]})}function Bi(){var Qs,Js,Ks;const{id:i}=Qa(),j=Ja(),{openChat:S}=Ka(),{timer:N,startTimer:p,stopTimer:m,discardTimer:g}=Xa(),d=Me(),{matters:c,clients:v,timeEntries:h,invoices:r,events:E,documents:G,updateMatter:P,addTimeEntry:R,addInvoice:J,addEvent:C,addDocument:z,fetchMatters:M,fetchClients:L,fetchTimeEntries:W,fetchInvoices:F,fetchEvents:H,fetchDocuments:K,deleteTimeEntry:re,updateTimeEntry:q,deleteEvent:_,updateEvent:y,deleteMatter:X,matterTypes:le}=Ya(),me=t.useMemo(()=>le.filter(a=>a.active).map(a=>({value:a.value,label:a.label})),[le]),[ee,ze]=t.useState("overview"),[Ge,Cs]=t.useState(!1),[as,ts]=t.useState(null),[ks,x]=t.useState(!1),[Y,We]=t.useState(!1),[da,Be]=t.useState(!1),[ma,ue]=t.useState(!1),[ua,ye]=t.useState(!1),[ha,be]=t.useState(!1),[O,ls]=t.useState(null),[pa,is]=t.useState(!1),[ns,Ss]=t.useState({isOpen:!1,documentId:"",documentName:""}),[Fe,_s]=t.useState(null),[ws,qe]=t.useState(""),[xa,Ts]=t.useState(!1),[Is,Ds]=t.useState(!1),{emailDocument:ja}=Za(),[va,he]=t.useState(!1),[As,Ve]=t.useState(!1),[rs,fe]=t.useState(null),[os,ge]=t.useState(null),[cs,Le]=t.useState(null),[Na,ya]=t.useState([]),[ba,Pe]=t.useState(!1),[Ms,ds]=t.useState([]),[ji,zs]=t.useState(!0),[vi,Bs]=t.useState(!0),[Ni,Fs]=t.useState(!0),[fa,Ls]=t.useState(!1),[ga,ms]=t.useState(!1),{user:Ce,hasPermission:Ca}=et(),ka=Ca("matters:delete"),Oe=t.useRef(null),us=t.useRef(null),[pe,hs]=t.useState(5),[Ps,Os]=t.useState(""),[Rs,$s]=t.useState(!1),[se,ke]=t.useState([]),[Sa,ps]=t.useState(!1),[Se,Qe]=t.useState(""),[Re,xs]=t.useState("all"),[ie,yi]=t.useState(""),[_e,Z]=t.useState({isOpen:!1,title:"",message:"",confirmText:"Confirm",type:"danger",onConfirm:()=>{}});t.useEffect(()=>{function a(l){us.current&&!us.current.contains(l.target)&&Ve(!1)}return document.addEventListener("mousedown",a),()=>document.removeEventListener("mousedown",a)},[]);const[xe,$e]=t.useState([]),[oe,Je]=t.useState([]),[_a,ne]=t.useState(!1),[Ke,je]=t.useState(null),[wa,Us]=t.useState(!1);t.useEffect(()=>{i&&(zs(!0),B.getTasks(i).then(a=>{$e(a.tasks||[])}).catch(a=>console.error("Failed to load tasks:",a)).finally(()=>zs(!1)))},[i]),t.useEffect(()=>{i&&(Bs(!0),B.getUpdates(i).then(a=>{Je(a.updates||[])}).catch(a=>console.error("Failed to load updates:",a)).finally(()=>Bs(!1)))},[i]),t.useEffect(()=>{i&&(Fs(!0),B.getContacts(i).then(a=>{ds(a.contacts||[])}).catch(a=>console.error("Failed to load contacts:",a)).finally(()=>Fs(!1)))},[i]);const Ta=async a=>{if(i)try{const l=await B.createContact(i,a);ds(o=>[...o,l])}catch(l){console.error("Failed to add contact:",l)}},Ia=a=>{const l=Ms.find(o=>o.id===a);Z({isOpen:!0,title:"Remove Contact",message:`Are you sure you want to remove "${(l==null?void 0:l.name)||"this contact"}" from this matter?`,confirmText:"Remove",type:"danger",onConfirm:async()=>{if(i){try{await B.deleteContact(i,a),ds(o=>o.filter(b=>b.id!==a))}catch(o){console.error("Failed to delete contact:",o)}Z(o=>({...o,isOpen:!1}))}}})},Da=async a=>{if(i)try{const l=await B.createTask(i,a);$e(o=>[...o,l])}catch(l){console.error("Failed to add task:",l)}},Aa=async(a,l)=>{if(i)try{const o=await B.updateTask(i,a,l);$e(b=>b.map(D=>D.id===a?o:D))}catch(o){console.error("Failed to update task:",o)}},Ma=a=>{const l=xe.find(o=>o.id===a);Z({isOpen:!0,title:"Delete Task",message:`Are you sure you want to delete "${(l==null?void 0:l.name)||"this task"}"?`,confirmText:"Delete",type:"danger",onConfirm:async()=>{if(i){try{await B.deleteTask(i,a),$e(o=>o.filter(b=>b.id!==a))}catch(o){console.error("Failed to delete task:",o)}Z(o=>({...o,isOpen:!1}))}}})},za=async a=>{if(!i)return;const l=xe.find(b=>b.id===a);if(!l)return;const o=l.status==="completed"?"pending":"completed";try{const b=await B.updateTask(i,a,{status:o});$e(D=>D.map(k=>k.id===a?b:k))}catch(b){console.error("Failed to toggle task status:",b)}},Ba=async a=>{if(i)try{const l=await B.createUpdate(i,a);Je(o=>[l,...o].sort((b,D)=>new Date(D.date).getTime()-new Date(b.date).getTime()))}catch(l){console.error("Failed to add update:",l)}},Fa=async(a,l)=>{if(i)try{const o=await B.updateUpdate(i,a,l);Je(b=>b.map(D=>D.id===a?o:D).sort((D,k)=>new Date(k.date).getTime()-new Date(D.date).getTime()))}catch(o){console.error("Failed to update record:",o)}},Es=a=>{const l=oe.find(o=>o.id===a);Z({isOpen:!0,title:"Delete Update",message:`Are you sure you want to delete "${(l==null?void 0:l.title)||"this update"}"?`,confirmText:"Delete",type:"danger",onConfirm:async()=>{if(i){try{await B.deleteUpdate(i,a),Je(o=>o.filter(b=>b.id!==a))}catch(o){console.error("Failed to delete update:",o)}Z(o=>({...o,isOpen:!1}))}}})};t.useEffect(()=>{M(),L(),W({matterId:i}),F(),H(),K({matterId:i}),st.getAttorneys().then(a=>ya(a.attorneys||[])).catch(a=>console.log("Could not fetch attorneys:",a))},[i]);const La=(a,l)=>{S({label:a,contextType:"matter-detail",suggestedQuestions:l,additionalContext:{matterId:i,matterName:n==null?void 0:n.name}})},Xe=async a=>{try{await P(i,{status:a}),Ve(!1),M()}catch(l){console.error("Failed to update matter status:",l),d.error("Failed to update matter status")}},Hs=async()=>{if(!(pe<=0)){$s(!0);try{await R({matterId:i,date:new Date().toISOString(),hours:pe/60,description:Ps||`Quick time entry - ${pe} minutes`,billable:!0,billed:!1,rate:(n==null?void 0:n.billingRate)||0,aiGenerated:!1,status:"pending",entryType:"manual",updatedAt:new Date().toISOString()}),hs(10),Os(""),await W({matterId:i})}catch(a){console.error("Failed to save quick time entry:",a),d.error("Failed to save time entry")}finally{$s(!1)}}},Pa=async()=>{Z({isOpen:!0,title:"Delete Matter",message:`Are you sure you want to delete "${n==null?void 0:n.name}"? This action cannot be undone and will remove all associated time entries, documents, and invoices.`,confirmText:"Delete Matter",type:"danger",onConfirm:async()=>{try{await X(i),Z(a=>({...a,isOpen:!1})),j("/app/matters")}catch(a){console.error("Failed to delete matter:",a),d.error("Failed to delete matter")}}})},Gs=async a=>{var o;const l=$.find(b=>b.id===a);Z({isOpen:!0,title:"Delete Time Entry",message:`Are you sure you want to delete this time entry? (${(l==null?void 0:l.hours)||0} hours - $${((o=l==null?void 0:l.amount)==null?void 0:o.toLocaleString())||0})`,confirmText:"Delete",type:"danger",onConfirm:async()=>{try{await re(a),await W({matterId:i}),Z(b=>({...b,isOpen:!1}))}catch(b){console.error("Failed to delete time entry:",b),d.error("Failed to delete time entry")}}})},Oa=a=>{ke(l=>l.includes(a)?l.filter(o=>o!==a):[...l,a])},Ws=async a=>{const l=Ee.find(o=>o.id===a);Z({isOpen:!0,title:"Delete Event",message:`Are you sure you want to delete "${(l==null?void 0:l.title)||"this event"}"?`,confirmText:"Delete",type:"danger",onConfirm:async()=>{try{await _(a),H(),Z(o=>({...o,isOpen:!1}))}catch(o){console.error("Failed to delete event:",o),d.error("Failed to delete event")}}})},te=async(a,l)=>{const o="https://apexai-api.azurewebsites.net/api",b=localStorage.getItem("apex-access-token")||localStorage.getItem("token")||"";try{const D=await fetch(`${o}/documents/${a.id}/download`,{headers:{Authorization:`Bearer ${b}`}});if(D.ok){const k=await D.blob(),T=window.URL.createObjectURL(k),V=document.createElement("a");V.href=T,V.download=a.originalName||a.name,document.body.appendChild(V),V.click(),window.URL.revokeObjectURL(T),document.body.removeChild(V)}else d.error("Failed to download document")}catch(D){console.error("Download error:",D),d.error("Failed to download document")}},Ra=async a=>{const l="https://apexai-api.azurewebsites.net/api",o=localStorage.getItem("apex-access-token")||localStorage.getItem("token")||"";try{const b=await fetch(`${l}/documents/${a.id}/download`,{headers:{Authorization:`Bearer ${o}`}});if(b.ok){const D=await b.blob(),k=window.URL.createObjectURL(D);window.open(k,"_blank")}else d.error("Failed to open document")}catch(b){console.error("Failed to open document:",b),d.error("Failed to open document")}},$a=async(a,l=!0)=>{const o=[".doc",".docx",".odt",".rtf"],b=a.originalName||a.name;if(!o.some(k=>b.toLowerCase().endsWith(k))){d.warning("Word editing is only available for Word documents (.doc, .docx)");return}try{if(l){const T=await Zs.openDesktop(a.id);if(T.desktopUrl){const V=document.createElement("iframe");V.style.display="none",document.body.appendChild(V);const Xs=setTimeout(()=>{document.body.removeChild(V),confirm(`Could not open Microsoft Word automatically.

Options:
• Click OK to open in Word Online (browser)
• Click Cancel to download the file

Tip: Make sure Microsoft Office is installed on your computer.`)&&T.webUrl?window.open(T.webUrl,"_blank"):te(a)},2e3);try{V.contentWindow.location.href=T.desktopUrl,setTimeout(()=>{clearTimeout(Xs);try{document.body.removeChild(V)}catch{}},3e3)}catch{clearTimeout(Xs);try{document.body.removeChild(V)}catch{}T.webUrl?window.open(T.webUrl,"_blank"):te(a)}return}else if(T.needsMicrosoftAuth){confirm(`Microsoft is not connected. Would you like to download the document to edit locally?

Tip: Connect Microsoft in Settings → Integrations for seamless editing.`)&&te(a);return}else if(T.downloadUrl){confirm(`Could not sync to cloud. Would you like to download and edit locally?

After editing, upload the file back to save your changes.`)&&te(a);return}}const k=await Zs.openDocument(a.id);k.editUrl?window.open(k.editUrl,"_blank"):k.desktopUrl?window.open(k.desktopUrl,"_blank"):k.fallback==="desktop"||k.downloadUrl||k.needsMicrosoftAuth?confirm("Would you like to download the document to edit locally?")&&te(a):(console.error("Open in Word failed:",k.message),confirm("Could not open in Word. Would you like to download instead?")&&te(a))}catch(k){console.error("Failed to open in Word:",k),confirm("Could not connect to Word service. Would you like to download the document instead?")&&te(a)}},Ua=async a=>{_s(a),Ts(!0),qe("");try{const l=await Ys.getContent(a.id),o=l.content||l.text||"";qe(o)}catch(l){console.error("Failed to load document content:",l),qe("[Unable to load document content. Try downloading the file instead.]")}finally{Ts(!1)}},js=()=>{_s(null),qe("")},qs=a=>{j("/app/ai",{state:{documentId:a.id,documentName:a.name}})},Ea=async a=>{if(confirm("Are you sure you want to delete this document?"))try{await Ys.delete(a),ls(null),is(!1),K({matterId:i})}catch(l){console.error("Delete error:",l),d.error("Failed to delete document")}},Ha=a=>{ls(a),is(!0)},n=t.useMemo(()=>c.find(a=>a.id===i),[c,i]),w=t.useMemo(()=>v.find(a=>a.id===(n==null?void 0:n.clientId)),[v,n]),$=t.useMemo(()=>h.filter(a=>a.matterId===i).sort((a,l)=>new Date(l.date).getTime()-new Date(a.date).getTime()),[h,i]),we=t.useMemo(()=>$.filter(a=>{if(Se){const l=Se.toLowerCase();if(!(a.description||"").toLowerCase().includes(l))return!1}return!(Re==="billed"&&!a.billed||Re==="unbilled"&&a.billed)}),[$,Se,Re]),Ga=t.useMemo(()=>$.filter(a=>se.includes(a.id)).reduce((a,l)=>a+l.amount,0),[$,se]),Wa=t.useMemo(()=>$.filter(a=>se.includes(a.id)).reduce((a,l)=>a+l.hours,0),[$,se]),Vs=t.useMemo(()=>we.filter(a=>!a.billed&&a.billable),[we]),qa=()=>{const a=$.filter(o=>!o.billed&&o.billable).map(o=>o.id),l=a.every(o=>se.includes(o));ke(l?[]:a)},Ue=t.useMemo(()=>r.filter(a=>a.matterId===i),[r,i]),Ee=t.useMemo(()=>E.filter(a=>a.matterId===i).sort((a,l)=>new Date(a.startTime).getTime()-new Date(l.startTime).getTime()),[E,i]),Ye=t.useMemo(()=>G.filter(a=>a.matterId===i),[G,i]);t.useMemo(()=>{const a=new Map,l=[];return Ye.forEach(o=>{const b=o.folderPath||"";if(ie==="")if(b){const D=b.split("/")[0];a.has(D)||a.set(D,{name:D,path:D,count:0}),a.get(D).count++}else l.push(o);else if(b===ie)l.push(o);else if(b.startsWith(ie+"/")){const k=b.slice(ie.length+1).split("/")[0],T=`${ie}/${k}`;a.has(T)||a.set(T,{name:k,path:T,count:0}),a.get(T).count++}}),{folders:Array.from(a.values()).sort((o,b)=>o.name.localeCompare(b.name)),files:l}},[Ye,ie]),t.useMemo(()=>ie?ie.split("/").map((a,l,o)=>({name:a,path:o.slice(0,l+1).join("/")})):[],[ie]);const ce=t.useMemo(()=>{const a=$.reduce((k,T)=>k+T.hours,0),l=$.filter(k=>k.billed).reduce((k,T)=>k+T.amount,0),o=$.filter(k=>!k.billed).reduce((k,T)=>k+T.amount,0),b=Ue.reduce((k,T)=>k+T.total,0),D=Ue.reduce((k,T)=>k+T.amountPaid,0);return{totalHours:a,totalBilled:l,totalUnbilled:o,invoicedAmount:b,paidAmount:D}},[$,Ue]);return n?e.jsxs("div",{className:s.detailPage,children:[e.jsxs("div",{className:s.header,children:[e.jsxs("div",{className:s.headerTop,children:[e.jsxs(Ze,{to:"/app/matters",className:s.backLink,children:[e.jsx(nt,{size:18}),"Back to Matters"]}),e.jsxs("div",{className:s.headerActions,children:[e.jsx("button",{className:I(s.visibilityBadge,n.visibility==="restricted"&&s.restricted),onClick:()=>ms(!0),title:n.visibility==="restricted"?"Restricted - Click to manage access":"Firm Wide - Click to manage access",children:n.visibility==="restricted"?e.jsxs(e.Fragment,{children:[e.jsx(fs,{size:14})," Restricted"]}):e.jsxs(e.Fragment,{children:[e.jsx(ss,{size:14})," Firm Wide"]})}),e.jsxs("button",{className:s.shareBtn,onClick:()=>Ls(!0),title:"Share Matter",children:[e.jsx(ys,{size:16}),"Share"]}),e.jsxs("button",{className:s.aiBtn,onClick:()=>La(`Matter: ${n.name}`,["Summarize this matter including current status and key details","What are the potential risks in this matter?","Review the timeline and upcoming deadlines","Analyze the billing and financials for this matter","What are the recommended next steps?"]),children:[e.jsx(sa,{size:16}),"AI Analysis"]}),e.jsx("button",{className:s.iconBtn,onClick:()=>he(!0),title:"Edit Matter",children:e.jsx(de,{size:18})}),e.jsxs("div",{className:s.menuWrapper,ref:us,children:[e.jsx("button",{className:s.iconBtn,onMouseDown:a=>a.stopPropagation(),onClick:()=>Ve(!As),title:"More Options",children:e.jsx(rt,{size:18})}),As&&e.jsxs("div",{className:s.dropdown,children:[e.jsxs("button",{className:s.dropdownItem,onClick:()=>{Ve(!1),he(!0)},children:[e.jsx(de,{size:14}),"Edit Matter"]}),n.status==="active"&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{className:s.dropdownItem,onClick:()=>Xe("on_hold"),children:[e.jsx(ot,{size:14}),"Put On Hold"]}),e.jsxs("button",{className:I(s.dropdownItem,s.success),onClick:()=>Xe("closed_won"),children:[e.jsx(Ie,{size:14}),"Close - Won"]})]}),n.status==="on_hold"&&e.jsxs("button",{className:s.dropdownItem,onClick:()=>Xe("active"),children:[e.jsx(vs,{size:14}),"Reactivate"]}),!n.status.startsWith("closed")&&e.jsxs("button",{className:s.dropdownItem,onClick:()=>Xe("closed_other"),children:[e.jsx(ct,{size:14}),"Archive / Close"]}),ka&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:s.dropdownDivider}),e.jsxs("button",{className:I(s.dropdownItem,s.danger),onClick:Pa,children:[e.jsx(ae,{size:14}),"Delete Matter"]})]})]})]})]})]}),e.jsxs("div",{className:s.headerMain,children:[e.jsx("div",{className:s.headerIcon,children:e.jsx(vs,{size:28})}),e.jsxs("div",{className:s.headerInfo,children:[e.jsxs("div",{className:s.headerMeta,children:[e.jsx("span",{className:s.matterNumber,children:n.number}),e.jsx("span",{className:I(s.statusBadge,s[n.status]),children:n.status.replace(/_/g," ")}),e.jsx("span",{className:I(s.priorityBadge,s[n.priority]),children:n.priority})]}),e.jsx("h1",{children:n.name}),e.jsx("p",{className:s.description,children:n.description})]})]}),e.jsxs("div",{className:s.quickStats,children:[e.jsxs("div",{className:s.quickStat,children:[e.jsx(Te,{size:18}),e.jsxs("div",{children:[e.jsx("span",{className:s.statValue,children:ce.totalHours.toFixed(1)}),e.jsx("span",{className:s.statLabel,children:"Hours"})]})]}),e.jsxs("div",{className:s.quickStat,children:[e.jsx(aa,{size:18}),e.jsxs("div",{children:[e.jsxs("span",{className:s.statValue,children:["$",ce.totalUnbilled.toLocaleString()]}),e.jsx("span",{className:s.statLabel,children:"Unbilled"})]})]}),e.jsxs("div",{className:s.quickStat,children:[e.jsx(ve,{size:18}),e.jsxs("div",{children:[e.jsxs("span",{className:s.statValue,children:["$",ce.invoicedAmount.toLocaleString()]}),e.jsx("span",{className:s.statLabel,children:"Invoiced"})]})]}),e.jsxs("div",{className:s.quickStat,children:[e.jsx(Ie,{size:18}),e.jsxs("div",{children:[e.jsxs("span",{className:s.statValue,children:["$",ce.paidAmount.toLocaleString()]}),e.jsx("span",{className:s.statLabel,children:"Collected"})]})]})]}),e.jsxs("div",{className:s.quickTimeWidget,children:[e.jsxs("span",{className:s.quickTimeLabel,children:[e.jsx(Q,{size:14}),"Quick Time"]}),e.jsxs("div",{className:s.quickTimeControls,children:[e.jsx("button",{className:s.quickTimeBtn,onClick:()=>hs(Math.max(0,pe-5)),children:"−"}),e.jsxs("div",{className:s.quickTimeDisplay,children:[e.jsx(Te,{size:14}),pe," min"]}),e.jsx("button",{className:s.quickTimeBtn,onClick:()=>hs(pe+5),children:"+"})]}),e.jsx("input",{type:"text",className:s.quickTimeNotes,placeholder:"What did you work on?",value:Ps,onChange:a=>Os(a.target.value),onKeyPress:a=>a.key==="Enter"&&Hs()}),e.jsx("button",{className:s.quickTimeSave,onClick:Hs,disabled:pe<=0||Rs,children:Rs?"Saving...":"Add Time"})]})]}),e.jsx("div",{className:s.tabs,children:["overview","notes","updates","tasks","time","billing","documents","calendar","contacts"].map(a=>e.jsx("button",{className:I(s.tab,ee===a&&s.active),onClick:()=>ze(a),children:a.charAt(0).toUpperCase()+a.slice(1)},a))}),e.jsxs("div",{className:s.content,children:[ee==="overview"&&e.jsxs("div",{className:s.overviewGrid,children:[e.jsxs("div",{className:s.card,children:[e.jsx("div",{className:s.cardHeader,children:e.jsx("h3",{children:"Matter Details"})}),e.jsxs("div",{className:s.detailGrid,children:[e.jsxs("div",{className:s.detailItem,children:[e.jsx("span",{className:s.detailLabel,children:"Client"}),e.jsxs(Ze,{to:`/app/clients/${w==null?void 0:w.id}`,className:s.detailLink,children:[e.jsx(dt,{size:14}),w==null?void 0:w.name]})]}),e.jsxs("div",{className:s.detailItem,children:[e.jsx("span",{className:s.detailLabel,children:"Practice Area"}),e.jsx("span",{className:s.detailValue,children:(n.type||"other").replace(/_/g," ")})]}),e.jsxs("div",{className:s.detailItem,children:[e.jsx("span",{className:s.detailLabel,children:"Responsible Attorney"}),e.jsx("span",{className:s.detailValue,children:n.responsibleAttorneyName||"Unassigned"})]}),e.jsxs("div",{className:s.detailItem,children:[e.jsx("span",{className:s.detailLabel,children:"Originating Attorney"}),e.jsx("span",{className:s.detailValue,children:n.originatingAttorneyName||"Unassigned"})]}),e.jsxs("div",{className:s.detailItem,children:[e.jsx("span",{className:s.detailLabel,children:"Opened"}),e.jsx("span",{className:s.detailValue,children:n.openDate?A(U(n.openDate),"MMM d, yyyy"):"—"})]}),e.jsxs("div",{className:s.detailItem,children:[e.jsx("span",{className:s.detailLabel,children:"Billing Type"}),e.jsxs("span",{className:s.detailValue,children:[n.billingType==="hourly"&&`Hourly ($${n.billingRate}/hr)`,n.billingType==="flat"&&`Flat Fee ($${(Qs=n.flatFee)==null?void 0:Qs.toLocaleString()})`,n.billingType==="contingency"&&`${n.contingencyPercent}% Contingency`,n.billingType==="retainer"&&`Retainer ($${(Js=n.retainerAmount)==null?void 0:Js.toLocaleString()})`]})]}),n.budget&&e.jsxs("div",{className:s.detailItem,children:[e.jsx("span",{className:s.detailLabel,children:"Budget"}),e.jsxs("span",{className:s.detailValue,children:["$",n.budget.toLocaleString()]})]}),n.statuteOfLimitations&&e.jsxs("div",{className:s.detailItem,children:[e.jsx("span",{className:s.detailLabel,children:"Statute of Limitations"}),e.jsx("span",{className:s.detailValue,children:A(U(n.statuteOfLimitations),"MMM d, yyyy")})]})]})]}),n.courtInfo&&e.jsxs("div",{className:s.card,children:[e.jsx("div",{className:s.cardHeader,children:e.jsxs("h3",{children:[e.jsx(mt,{size:18}),"Court Information"]})}),e.jsxs("div",{className:s.detailGrid,children:[e.jsxs("div",{className:s.detailItem,children:[e.jsx("span",{className:s.detailLabel,children:"Court"}),e.jsx("span",{className:s.detailValue,children:n.courtInfo.courtName})]}),e.jsxs("div",{className:s.detailItem,children:[e.jsx("span",{className:s.detailLabel,children:"Case Number"}),e.jsx("span",{className:s.detailValue,children:n.courtInfo.caseNumber})]}),e.jsxs("div",{className:s.detailItem,children:[e.jsx("span",{className:s.detailLabel,children:"Judge"}),e.jsx("span",{className:s.detailValue,children:n.courtInfo.judge})]}),e.jsxs("div",{className:s.detailItem,children:[e.jsx("span",{className:s.detailLabel,children:"Jurisdiction"}),e.jsx("span",{className:s.detailValue,children:n.courtInfo.jurisdiction})]})]})]}),e.jsxs("div",{className:s.card,children:[e.jsxs("div",{className:s.cardHeader,children:[e.jsxs("h3",{children:[e.jsx(ta,{size:18}),"Recent Updates"]}),e.jsx("div",{className:s.cardActions,children:e.jsxs("button",{className:s.addBtn,onClick:()=>ne(!0),children:[e.jsx(Q,{size:14}),"Add"]})})]}),e.jsxs("div",{className:s.updatesList,children:[oe.slice(0,3).map(a=>e.jsxs("div",{className:s.updateItem,onClick:()=>{je(a),ne(!0)},children:[e.jsxs("div",{className:s.updateDate,children:[e.jsx("span",{className:s.updateDay,children:A(U(a.date),"d")}),e.jsx("span",{className:s.updateMonth,children:A(U(a.date),"MMM")})]}),e.jsxs("div",{className:s.updateContent,children:[e.jsx("span",{className:s.updateTitle,children:a.title}),e.jsx("span",{className:s.updateCategory,children:a.category.replace(/_/g," ")})]}),e.jsx("button",{className:s.iconBtn,onClick:l=>{l.stopPropagation(),Es(a.id)},style:{padding:"4px",opacity:.6},title:"Delete",children:e.jsx(ae,{size:12})})]},a.id)),oe.length===0&&e.jsx("p",{className:s.noData,children:"No updates yet"}),oe.length>3&&e.jsxs("button",{className:s.viewAllBtn,onClick:()=>ze("updates"),children:["View all ",oe.length," updates →"]})]})]}),e.jsxs("div",{className:s.card,children:[e.jsxs("div",{className:s.cardHeader,children:[e.jsxs("h3",{children:[e.jsx(Ns,{size:18}),"Upcoming Events"]}),e.jsx("div",{className:s.cardActions,children:e.jsxs("button",{className:s.addBtn,onClick:()=>ye(!0),children:[e.jsx(Q,{size:14}),"Add"]})})]}),e.jsxs("div",{className:s.eventsList,children:[Ee.slice(0,3).map(a=>e.jsxs("div",{className:s.eventItem,style:{cursor:"pointer"},onClick:()=>ge(a),children:[e.jsx("div",{className:s.eventDot,style:{background:a.color}}),e.jsxs("div",{style:{flex:1},children:[e.jsx("span",{className:s.eventTitle,children:a.title}),e.jsx("span",{className:s.eventDate,children:A(U(a.startTime),"MMM d, yyyy h:mm a")})]}),e.jsx("button",{className:s.iconBtn,onClick:l=>{l.stopPropagation(),Ws(a.id)},style:{padding:"4px",opacity:.6},title:"Delete",children:e.jsx(ae,{size:12})})]},a.id)),Ee.length===0&&e.jsx("p",{className:s.noData,children:"No upcoming events"})]})]}),e.jsxs("div",{className:s.card,children:[e.jsxs("div",{className:s.cardHeader,children:[e.jsxs("h3",{children:[e.jsx(Te,{size:18}),"Recent Time Entries"]}),e.jsx("div",{className:s.cardActions,children:e.jsxs("button",{className:s.addBtn,onClick:()=>ue(!0),children:[e.jsx(Q,{size:14}),"Add"]})})]}),e.jsxs("div",{className:s.timeList,children:[$.slice(0,5).map(a=>e.jsxs("div",{className:s.timeItem,style:{cursor:"pointer"},onClick:()=>fe(a),children:[e.jsxs("div",{style:{flex:1},children:[e.jsx("span",{className:s.timeDesc,children:a.description}),e.jsx("span",{className:s.timeDate,children:A(He(a.date),"MMM d, yyyy")})]}),e.jsxs("div",{className:s.timeHours,children:[e.jsxs("span",{children:[a.hours,"h"]}),e.jsxs("span",{className:s.timeAmount,children:["$",a.amount.toLocaleString()]})]}),e.jsx("button",{className:s.iconBtn,onClick:l=>{l.stopPropagation(),Gs(a.id)},style:{padding:"4px",opacity:.6},title:"Delete",children:e.jsx(ae,{size:12})})]},a.id)),$.length===0&&e.jsx("p",{className:s.noData,children:"No time entries"})]})]})]}),ee==="notes"&&e.jsx(xi,{matterId:i,legacyNotes:n.notes||"",onSaveLegacyNotes:async a=>{await P(i,{notes:a}),await M()}}),ee==="updates"&&e.jsxs("div",{className:s.updatesTab,children:[e.jsxs("div",{className:s.tabHeader,children:[e.jsx("h2",{children:"Case Updates & Progress"}),e.jsx("div",{className:s.tabActions,children:e.jsxs("button",{className:s.primaryBtn,onClick:()=>{je(null),ne(!0)},children:[e.jsx(Q,{size:18}),"Add Update"]})})]}),oe.length===0?e.jsxs("div",{className:s.emptyUpdates,children:[e.jsx(ta,{size:48}),e.jsx("p",{children:"No updates yet"}),e.jsx("p",{style:{fontSize:"0.875rem",color:"var(--apex-muted)",marginTop:"8px"},children:"Track case progress, client communications, and key milestones"}),e.jsxs("button",{className:s.primaryBtn,onClick:()=>ne(!0),style:{marginTop:"1rem"},children:[e.jsx(Q,{size:18}),"Add First Update"]})]}):e.jsx("div",{className:s.updatesTimeline,children:oe.map((a,l)=>e.jsxs("div",{className:s.updateCard,children:[e.jsxs("div",{className:s.updateTimelineMarker,children:[e.jsx("div",{className:I(s.updateDot,s[a.category])}),l<oe.length-1&&e.jsx("div",{className:s.updateLine})]}),e.jsxs("div",{className:s.updateCardContent,children:[e.jsxs("div",{className:s.updateCardHeader,children:[e.jsxs("div",{children:[e.jsx("span",{className:I(s.updateCategoryBadge,s[a.category]),children:a.category.replace(/_/g," ")}),e.jsx("span",{className:s.updateCardDate,children:A(U(a.date),"MMMM d, yyyy")})]}),e.jsxs("div",{className:s.cardActions,children:[e.jsx("button",{className:s.iconBtn,onClick:()=>{je(a),ne(!0)},title:"Edit",style:{padding:"6px"},children:e.jsx(de,{size:14})}),e.jsx("button",{className:s.iconBtn,onClick:()=>Es(a.id),title:"Delete",style:{padding:"6px",color:"var(--apex-error)"},children:e.jsx(ae,{size:14})})]})]}),e.jsx("h4",{className:s.updateCardTitle,children:a.title}),e.jsx("p",{className:s.updateCardDescription,children:a.description}),e.jsxs("span",{className:s.updateCardTimestamp,children:["Added ",ft(U(a.createdAt),{addSuffix:!0})]})]})]},a.id))})]}),ee==="time"&&e.jsxs("div",{className:s.timeTab,children:[e.jsxs("div",{className:s.tabHeader,children:[e.jsx("h2",{children:"Time Entries"}),e.jsxs("div",{className:s.tabActions,children:[N.isRunning&&N.matterId===i?e.jsxs("div",{className:s.activeTimerBadge,children:[e.jsx(Te,{size:16}),e.jsx("span",{className:s.timerDisplay,children:at(N.elapsed)}),e.jsx("button",{className:s.timerControlBtn,onClick:m,title:"Pause Timer",children:e.jsx(ut,{size:16})}),e.jsx("button",{className:I(s.timerControlBtn,s.danger),onClick:g,title:"Discard Timer",children:e.jsx(ht,{size:16})})]}):N.isRunning?e.jsx("span",{className:s.timerOnOtherMatter,children:"Timer active on another matter"}):null,e.jsxs("button",{className:s.primaryBtn,onClick:()=>ue(!0),children:[e.jsx(Q,{size:18}),"New Time Entry"]})]})]}),e.jsxs("div",{className:s.timeStats,children:[e.jsxs("div",{className:s.timeStat,children:[e.jsx(Te,{size:20}),e.jsxs("div",{children:[e.jsxs("span",{className:s.timeStatValue,children:[ce.totalHours.toFixed(1),"h"]}),e.jsx("span",{className:s.timeStatLabel,children:"Total Hours"})]})]}),e.jsxs("div",{className:s.timeStat,children:[e.jsx(aa,{size:20}),e.jsxs("div",{children:[e.jsxs("span",{className:s.timeStatValue,children:["$",ce.totalUnbilled.toLocaleString()]}),e.jsx("span",{className:s.timeStatLabel,children:"Unbilled"})]})]}),e.jsxs("div",{className:s.timeStat,children:[e.jsx(Ie,{size:20}),e.jsxs("div",{children:[e.jsxs("span",{className:s.timeStatValue,children:["$",ce.totalBilled.toLocaleString()]}),e.jsx("span",{className:s.timeStatLabel,children:"Billed"})]})]})]}),se.length>0&&e.jsxs("div",{className:s.selectionBar,children:[e.jsxs("div",{className:s.selectionInfo,children:[e.jsx(Ie,{size:18}),e.jsxs("span",{children:[se.length," entries selected"]}),e.jsxs("span",{className:s.selectionAmount,children:[Wa.toFixed(1),"h • $",Ga.toLocaleString()]})]}),e.jsxs("div",{className:s.selectionActions,children:[e.jsx("button",{className:s.clearSelectionBtn,onClick:()=>ke([]),children:"Clear"}),e.jsxs("button",{className:s.createInvoiceBtn,onClick:()=>ps(!0),children:[e.jsx(ve,{size:16}),"Create Invoice"]})]})]}),Vs.length>0&&se.length===0&&e.jsx("div",{className:s.selectAllBar,children:e.jsxs("button",{className:s.selectAllBtn,onClick:qa,children:["Select All Unbilled (",Vs.length,")"]})}),$.length>0&&e.jsxs("div",{className:s.filterBar,children:[e.jsxs("div",{className:s.searchInputWrapper,children:[e.jsx(gs,{size:16,className:s.searchIcon}),e.jsx("input",{type:"text",placeholder:"Search by description...",value:Se,onChange:a=>Qe(a.target.value),className:s.searchInput}),Se&&e.jsx("button",{className:s.clearSearchBtn,onClick:()=>Qe(""),children:e.jsx(De,{size:14})})]}),e.jsxs("div",{className:s.filterControls,children:[e.jsxs("select",{value:Re,onChange:a=>xs(a.target.value),className:s.filterSelect,children:[e.jsx("option",{value:"all",children:"All Status"}),e.jsx("option",{value:"unbilled",children:"Unbilled"}),e.jsx("option",{value:"billed",children:"Billed"})]}),(Se||Re!=="all")&&e.jsx("button",{className:s.clearFiltersBtn,onClick:()=>{Qe(""),xs("all")},children:"Clear Filters"})]}),we.length!==$.length&&e.jsxs("span",{className:s.filterCount,children:["Showing ",we.length," of ",$.length," entries"]})]}),$.length===0?e.jsxs("div",{className:s.emptyTime,children:[e.jsx(Te,{size:48}),e.jsx("p",{children:"No time entries yet"}),e.jsxs("button",{className:s.primaryBtn,onClick:()=>ue(!0),children:[e.jsx(Q,{size:18}),"Log First Time Entry"]})]}):we.length===0?e.jsxs("div",{className:s.emptyTime,children:[e.jsx(pt,{size:48}),e.jsx("p",{children:"No entries match your filters"}),e.jsx("button",{className:s.primaryBtn,onClick:()=>{Qe(""),xs("all")},children:"Clear Filters"})]}):e.jsx("div",{className:s.timeEntryCards,children:we.map(a=>e.jsxs("div",{className:I(s.timeEntryCard,se.includes(a.id)&&s.selected),children:[!a.billed&&a.billable&&e.jsx("div",{className:s.entryCheckbox,children:e.jsx("input",{type:"checkbox",checked:se.includes(a.id),onChange:()=>Oa(a.id)})}),e.jsxs("div",{className:s.timeEntryDate,children:[e.jsx("span",{className:s.timeEntryDay,children:A(He(a.date),"d")}),e.jsx("span",{className:s.timeEntryMonth,children:A(He(a.date),"MMM")})]}),e.jsxs("div",{className:s.timeEntryContent,children:[e.jsx("span",{className:s.timeEntryDesc,children:a.description||"No description"}),e.jsx("div",{className:s.timeEntryMeta,children:e.jsxs("span",{children:[a.hours,"h @ $",a.rate,"/hr"]})})]}),e.jsxs("div",{className:s.timeEntryRight,children:[e.jsxs("span",{className:s.timeEntryAmount,children:["$",a.amount.toLocaleString()]}),e.jsx("span",{className:I(s.badge,a.billed?s.billed:s.unbilled),children:a.billed?"Billed":"Unbilled"})]}),e.jsxs("div",{className:s.cardActions,style:{marginLeft:"12px"},children:[e.jsx("button",{className:s.iconBtn,onClick:()=>fe(a),title:"Edit",style:{padding:"6px"},children:e.jsx(de,{size:14})}),e.jsx("button",{className:s.iconBtn,onClick:()=>Gs(a.id),title:"Delete",style:{padding:"6px",color:"var(--apex-error)"},children:e.jsx(ae,{size:14})})]})]},a.id))})]}),ee==="billing"&&e.jsxs("div",{className:s.billingTab,children:[e.jsxs("div",{className:s.tabHeader,children:[e.jsx("h2",{children:"Invoices"}),e.jsx("div",{className:s.tabActions,children:e.jsxs("button",{className:s.primaryBtn,onClick:()=>Be(!0),children:[e.jsx(Q,{size:18}),"Create Invoice"]})})]}),e.jsxs("div",{className:s.tableCard,children:[e.jsxs("table",{className:s.table,children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Invoice #"}),e.jsx("th",{children:"Issue Date"}),e.jsx("th",{children:"Due Date"}),e.jsx("th",{children:"Amount"}),e.jsx("th",{children:"Status"})]})}),e.jsx("tbody",{children:Ue.map(a=>e.jsxs("tr",{children:[e.jsx("td",{children:a.number}),e.jsx("td",{children:A(U(a.issueDate),"MMM d, yyyy")}),e.jsx("td",{children:A(U(a.dueDate),"MMM d, yyyy")}),e.jsxs("td",{children:["$",a.total.toLocaleString()]}),e.jsx("td",{children:e.jsx("span",{className:I(s.badge,s[a.status]),children:a.status})})]},a.id))})]}),Ue.length===0&&e.jsx("div",{className:s.emptyTable,children:"No invoices yet"})]})]}),ee==="documents"&&e.jsxs("div",{className:s.documentsTab,children:[e.jsxs("div",{className:s.tabHeader,children:[e.jsx("h2",{children:"Documents"}),e.jsxs("div",{className:s.tabActions,children:[e.jsx("input",{type:"file",ref:Oe,style:{display:"none"},onChange:async a=>{var o;const l=(o=a.target.files)==null?void 0:o[0];if(l){Ds(!0);try{await z(l,{matterId:i,clientId:n==null?void 0:n.clientId}),K({matterId:i})}catch(b){console.error("Upload failed:",b),d.error("Failed to upload document","Please try again.")}finally{Ds(!1),Oe.current&&(Oe.current.value="")}}}}),e.jsx("button",{className:s.primaryBtn,onClick:()=>{var a;return(a=Oe.current)==null?void 0:a.click()},disabled:Is,children:Is?e.jsxs(e.Fragment,{children:[e.jsx(Ae,{size:18,className:s.spinner}),"Uploading..."]}):e.jsxs(e.Fragment,{children:[e.jsx(la,{size:18}),"Upload Document"]})})]})]}),e.jsxs("div",{className:s.documentTable,children:[e.jsxs("table",{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Name"}),e.jsx("th",{children:"Date"}),e.jsx("th",{children:"Size"}),e.jsx("th",{children:"Actions"})]})}),e.jsx("tbody",{children:Ye.map(a=>{const l=a.originalName||a.name;return e.jsxs("tr",{className:I((O==null?void 0:O.id)===a.id&&s.selectedRow),onClick:()=>Ha(a),children:[e.jsx("td",{children:e.jsxs("div",{className:s.docNameCell,children:[e.jsx(ve,{size:18}),e.jsx("span",{children:l})]})}),e.jsx("td",{children:A(U(a.uploadedAt),"MMM d, yyyy")}),e.jsxs("td",{children:[(a.size/1024).toFixed(0)," KB"]}),e.jsx("td",{children:e.jsx("div",{className:s.docTableActions,onClick:o=>o.stopPropagation(),children:e.jsx("button",{onClick:()=>te(a),title:"Download",children:e.jsx(ia,{size:16})})})})]},a.id)})})]}),Ye.length===0&&e.jsxs("div",{className:s.emptyDocs,children:[e.jsx(ve,{size:48}),e.jsx("p",{children:"No documents uploaded"}),e.jsxs("button",{className:s.primaryBtn,onClick:()=>{var a;return(a=Oe.current)==null?void 0:a.click()},style:{marginTop:"1rem"},children:[e.jsx(la,{size:18}),"Upload First Document"]})]})]})]}),ee==="calendar"&&e.jsxs("div",{className:s.calendarTab,children:[e.jsxs("div",{className:s.tabHeader,children:[e.jsx("h2",{children:"Events & Deadlines"}),e.jsx("div",{className:s.tabActions,children:e.jsxs("button",{className:s.primaryBtn,onClick:()=>ye(!0),children:[e.jsx(Q,{size:18}),"Add Event"]})})]}),e.jsxs("div",{className:s.eventCards,children:[Ee.map(a=>e.jsxs("div",{className:s.eventCard,style:{borderLeftColor:a.color},children:[e.jsxs("div",{className:s.eventHeader,children:[e.jsx("span",{className:s.eventType,style:{color:a.color},children:a.type.replace("_"," ")}),e.jsxs("div",{className:s.eventCardActions,children:[e.jsx("button",{className:s.iconBtn,onClick:()=>ge(a),title:"Edit",style:{padding:"4px"},children:e.jsx(de,{size:14})}),e.jsx("button",{className:s.iconBtn,onClick:()=>Ws(a.id),title:"Delete",style:{padding:"4px",color:"var(--apex-error)"},children:e.jsx(ae,{size:14})}),e.jsx("span",{className:s.eventTime,children:A(U(a.startTime),"h:mm a")})]})]}),e.jsx("h4",{children:a.title}),e.jsx("p",{children:A(U(a.startTime),"EEEE, MMMM d, yyyy")}),a.location&&e.jsx("span",{className:s.eventLocation,children:a.location})]},a.id)),Ee.length===0&&e.jsxs("div",{className:s.emptyEvents,children:[e.jsx(Ns,{size:48}),e.jsx("p",{children:"No events scheduled"})]})]})]}),ee==="tasks"&&e.jsxs("div",{className:s.tasksTab,children:[e.jsxs("div",{className:s.tabHeader,children:[e.jsx("h2",{children:"Tasks"}),e.jsx("div",{className:s.tabActions,children:e.jsxs("button",{className:s.primaryBtn,onClick:()=>be(!0),children:[e.jsx(Q,{size:18}),"Add Task"]})})]}),e.jsxs("div",{className:s.tasksSummary,children:[e.jsxs("div",{className:s.taskStat,children:[e.jsx("span",{className:s.taskStatValue,children:xe.filter(a=>a.status==="completed").length}),e.jsx("span",{className:s.taskStatLabel,children:"Completed"})]}),e.jsxs("div",{className:s.taskStat,children:[e.jsx("span",{className:s.taskStatValue,children:xe.filter(a=>a.status==="in_progress").length}),e.jsx("span",{className:s.taskStatLabel,children:"In Progress"})]}),e.jsxs("div",{className:s.taskStat,children:[e.jsx("span",{className:s.taskStatValue,children:xe.filter(a=>a.status==="pending").length}),e.jsx("span",{className:s.taskStatLabel,children:"Pending"})]})]}),xe.length===0?e.jsxs("div",{className:s.emptyTasks,children:[e.jsx(xt,{size:48}),e.jsx("p",{children:"No tasks yet"}),e.jsxs("button",{className:s.primaryBtn,onClick:()=>be(!0),children:[e.jsx(Q,{size:18}),"Create First Task"]})]}):e.jsx("div",{className:s.tasksList,children:xe.map(a=>e.jsxs("div",{className:I(s.taskCard,s[a.status]),children:[e.jsx("div",{className:s.taskCheckbox,onClick:()=>za(a.id),children:a.status==="completed"?e.jsx(Ie,{size:20,className:s.taskCompleted}):e.jsx(jt,{size:20})}),e.jsxs("div",{className:s.taskContent,children:[e.jsx("span",{className:s.taskName,children:a.name}),e.jsxs("div",{className:s.taskMeta,children:[e.jsxs("span",{className:s.taskAssignee,children:[e.jsx(Ne,{size:12}),a.assignee]}),e.jsxs("span",{className:s.taskDue,children:[e.jsx(Ns,{size:12}),"Due: ",A(U(a.dueDate),"MMM d, yyyy")]})]})]}),e.jsx("div",{className:s.taskStatus,children:e.jsx("span",{className:I(s.taskStatusBadge,s[a.status]),children:a.status.replace("_"," ")})}),e.jsxs("div",{className:s.cardActions,style:{marginLeft:"12px"},children:[e.jsx("button",{className:s.iconBtn,onClick:()=>Le(a),title:"Edit",style:{padding:"6px"},children:e.jsx(de,{size:14})}),e.jsx("button",{className:s.iconBtn,onClick:()=>Ma(a.id),title:"Delete",style:{padding:"6px",color:"var(--apex-error)"},children:e.jsx(ae,{size:14})})]})]},a.id))})]}),ee==="contacts"&&e.jsxs("div",{className:s.contactsTab,children:[e.jsxs("div",{className:s.tabHeader,children:[e.jsx("h2",{children:"Related Contacts"}),e.jsx("div",{className:s.tabActions,children:e.jsxs("button",{className:s.primaryBtn,onClick:()=>Pe(!0),children:[e.jsx(Q,{size:18}),"Add Contact"]})})]}),e.jsxs("div",{className:s.contactsGrid,children:[e.jsxs("div",{className:I(s.contactCard,s.clientCard),children:[e.jsx("div",{className:s.contactCardHeader,children:e.jsx("span",{className:s.contactRole,children:"Client"})}),e.jsxs("div",{className:s.contactInfo,children:[e.jsx("div",{className:s.contactAvatar,children:(Ks=w==null?void 0:w.name)==null?void 0:Ks[0]}),e.jsxs("div",{children:[e.jsx(Ze,{to:`/app/clients/${w==null?void 0:w.id}`,className:s.contactName,children:w==null?void 0:w.name}),e.jsx("span",{className:s.contactEmail,children:w==null?void 0:w.email})]})]}),(w==null?void 0:w.phone)&&e.jsxs("div",{className:s.contactDetail,children:[e.jsx("span",{children:"Phone:"})," ",w.phone]}),(w==null?void 0:w.addressStreet)&&e.jsxs("div",{className:s.contactDetail,children:[e.jsx("span",{children:"Address:"})," ",w.addressStreet]})]}),Ms.map(a=>e.jsxs("div",{className:s.contactCard,children:[e.jsxs("div",{className:s.contactCardHeader,children:[e.jsx("span",{className:s.contactRole,children:a.role}),e.jsx("button",{className:s.iconBtn,onClick:()=>Ia(a.id),title:"Remove Contact",style:{padding:"4px",color:"var(--apex-text)"},children:e.jsx(ae,{size:14})})]}),e.jsxs("div",{className:s.contactInfo,children:[e.jsx("div",{className:s.contactAvatar,children:a.name[0]}),e.jsxs("div",{children:[e.jsx("span",{className:s.contactName,children:a.name}),a.firm&&e.jsx("span",{className:s.contactFirm,children:a.firm})]})]}),a.email&&e.jsxs("div",{className:s.contactDetail,children:[e.jsx("span",{children:"Email:"})," ",a.email]}),a.phone&&e.jsxs("div",{className:s.contactDetail,children:[e.jsx("span",{children:"Phone:"})," ",a.phone]})]},a.id))]})]})]}),ma&&e.jsx("div",{className:s.modalOverlay,onClick:()=>ue(!1),children:e.jsxs("div",{className:s.modal,onClick:a=>a.stopPropagation(),children:[e.jsxs("div",{className:s.modalHeader,children:[e.jsx("h2",{children:"New Time Entry"}),e.jsx("button",{onClick:()=>ue(!1),className:s.closeBtn,children:"×"})]}),e.jsx(ra,{matterId:i,matterName:(n==null?void 0:n.name)||"",defaultRate:(n==null?void 0:n.billingRate)||450,onClose:()=>ue(!1),onSave:async a=>{try{await R(a),ue(!1),await W({matterId:i})}catch(l){console.error("Failed to save time entry:",l),d.error("Failed to save time entry","Please try again.")}}})]})}),da&&e.jsx("div",{className:s.modalOverlay,onClick:()=>Be(!1),children:e.jsxs("div",{className:s.modal,onClick:a=>a.stopPropagation(),children:[e.jsxs("div",{className:s.modalHeader,children:[e.jsx("h2",{children:"Create Invoice"}),e.jsx("button",{onClick:()=>Be(!1),className:s.closeBtn,children:"×"})]}),e.jsx(mi,{matterId:i,clientId:(n==null?void 0:n.clientId)||"",clientName:(w==null?void 0:w.name)||"",matterName:(n==null?void 0:n.name)||"",unbilledAmount:ce.totalUnbilled,onClose:()=>Be(!1),onSave:async a=>{try{await J(a),Be(!1),F()}catch(l){console.error("Failed to create invoice:",l),d.error("Failed to create invoice","Please try again.")}}})]})}),ua&&e.jsx("div",{className:s.modalOverlay,onClick:()=>ye(!1),children:e.jsxs("div",{className:s.modal,onClick:a=>a.stopPropagation(),children:[e.jsxs("div",{className:s.modalHeader,children:[e.jsx("h2",{children:"Add Event"}),e.jsx("button",{onClick:()=>ye(!1),className:s.closeBtn,children:"×"})]}),e.jsx(oa,{matterId:i,matterName:(n==null?void 0:n.name)||"",onClose:()=>ye(!1),onSave:async a=>{try{await C(a),ye(!1),H()}catch(l){console.error("Failed to create event:",l),d.error("Failed to create event","Please try again.")}}})]})}),ha&&e.jsx("div",{className:s.modalOverlay,onClick:()=>be(!1),children:e.jsxs("div",{className:s.modal,onClick:a=>a.stopPropagation(),children:[e.jsxs("div",{className:s.modalHeader,children:[e.jsx("h2",{children:"Add Task"}),e.jsx("button",{onClick:()=>be(!1),className:s.closeBtn,children:"×"})]}),e.jsx(na,{matterName:(n==null?void 0:n.name)||"",onClose:()=>be(!1),onSave:a=>{Da(a),be(!1)}})]})}),pa&&O&&e.jsx("div",{className:s.docVersionPanelOverlay,children:e.jsx(yt,{document:{id:O.id,name:O.name,originalName:O.originalName,type:O.type,size:O.size,uploadedAt:O.uploadedAt,matterName:n==null?void 0:n.name,uploadedByName:O.uploadedByName},onClose:()=>{is(!1),ls(null)},onOpenInWord:a=>$a(O,a),onDownload:()=>te(O),onShare:()=>Ss({isOpen:!0,documentId:O.id,documentName:O.name}),onEmail:()=>ja({id:O.id,name:O.name,size:O.size}),onAnalyze:()=>qs(O),onDelete:()=>Ea(O.id),onPreview:()=>Ua(O)})}),e.jsx(bt,{isOpen:ns.isOpen,onClose:()=>Ss({isOpen:!1,documentId:"",documentName:""}),documentId:ns.documentId,documentName:ns.documentName}),Fe&&e.jsx("div",{className:s.editorOverlay,onClick:js,children:e.jsxs("div",{className:s.editorModal,onClick:a=>a.stopPropagation(),children:[e.jsxs("div",{className:s.editorHeader,children:[e.jsxs("div",{className:s.editorTitle,children:[e.jsx(ve,{size:20}),e.jsx("h2",{children:Fe.name})]}),e.jsxs("div",{className:s.editorActions,children:[e.jsxs("button",{className:s.openFileBtn,onClick:()=>Ra(Fe),title:"Open file on your computer",children:[e.jsx(ss,{size:16}),"Open File"]}),e.jsxs("button",{className:s.downloadBtn,onClick:()=>te(Fe),title:"Download file",children:[e.jsx(ia,{size:16}),"Download"]}),e.jsx("button",{className:s.closeEditorBtn,onClick:js,children:e.jsx(De,{size:18})})]})]}),e.jsx("div",{className:s.editorBody,children:xa?e.jsxs("div",{className:s.editorLoading,children:[e.jsx(Ae,{size:32,className:s.spinner}),e.jsx("span",{children:"Loading document preview..."})]}):e.jsx("div",{className:s.editorPreview,children:e.jsx("pre",{children:ws||"No content available for preview"})})}),e.jsxs("div",{className:s.editorFooter,children:[e.jsxs("span",{className:s.editorMeta,children:[ws.length.toLocaleString()," characters"]}),e.jsx("div",{className:s.editorFooterActions,children:e.jsxs("button",{className:s.aiAnalyzeBtn,onClick:()=>{qs(Fe),js()},title:"Analyze with AI",children:[e.jsx(sa,{size:16}),"Analyze with AI"]})})]})]})}),va&&n&&e.jsx("div",{className:s.modalOverlay,onClick:()=>he(!1),children:e.jsxs("div",{className:s.modal,onClick:a=>a.stopPropagation(),style:{maxWidth:"600px"},children:[e.jsxs("div",{className:s.modalHeader,children:[e.jsx("h2",{children:"Edit Matter"}),e.jsx("button",{onClick:()=>he(!1),className:s.closeBtn,children:"×"})]}),e.jsx(pi,{matter:n,attorneys:Na,typeOptions:me,onClose:()=>he(!1),onSave:async a=>{try{await P(i,a),he(!1),M()}catch(l){console.error("Failed to update matter:",l),d.error("Failed to update matter","Please try again.")}},onManageTypes:()=>{he(!1),Us(!0)}})]})}),rs&&e.jsx("div",{className:s.modalOverlay,onClick:()=>fe(null),children:e.jsxs("div",{className:s.modal,onClick:a=>a.stopPropagation(),children:[e.jsxs("div",{className:s.modalHeader,children:[e.jsx("h2",{children:"Edit Time Entry"}),e.jsx("button",{onClick:()=>fe(null),className:s.closeBtn,children:"×"})]}),e.jsx(ra,{matterId:i,matterName:(n==null?void 0:n.name)||"",defaultRate:(n==null?void 0:n.billingRate)||450,existingEntry:rs,onClose:()=>fe(null),onSave:async a=>{try{await q(rs.id,a),fe(null),await W({matterId:i})}catch(l){console.error("Failed to update time entry:",l),d.error("Failed to update time entry","Please try again.")}}})]})}),os&&e.jsx("div",{className:s.modalOverlay,onClick:()=>ge(null),children:e.jsxs("div",{className:s.modal,onClick:a=>a.stopPropagation(),children:[e.jsxs("div",{className:s.modalHeader,children:[e.jsx("h2",{children:"Edit Event"}),e.jsx("button",{onClick:()=>ge(null),className:s.closeBtn,children:"×"})]}),e.jsx(oa,{matterId:i,matterName:(n==null?void 0:n.name)||"",existingEvent:os,onClose:()=>ge(null),onSave:async a=>{try{await y(os.id,a),ge(null),H()}catch(l){console.error("Failed to update event:",l),d.error("Failed to update event","Please try again.")}}})]})}),cs&&e.jsx("div",{className:s.modalOverlay,onClick:()=>Le(null),children:e.jsxs("div",{className:s.modal,onClick:a=>a.stopPropagation(),children:[e.jsxs("div",{className:s.modalHeader,children:[e.jsx("h2",{children:"Edit Task"}),e.jsx("button",{onClick:()=>Le(null),className:s.closeBtn,children:"×"})]}),e.jsx(na,{matterName:(n==null?void 0:n.name)||"",existingTask:cs,onClose:()=>Le(null),onSave:a=>{Aa(cs.id,a),Le(null)}})]})}),ba&&e.jsx("div",{className:s.modalOverlay,onClick:()=>Pe(!1),children:e.jsxs("div",{className:s.modal,onClick:a=>a.stopPropagation(),children:[e.jsxs("div",{className:s.modalHeader,children:[e.jsx("h2",{children:"Add Contact"}),e.jsx("button",{onClick:()=>Pe(!1),className:s.closeBtn,children:"×"})]}),e.jsx(ui,{matterName:(n==null?void 0:n.name)||"",onClose:()=>Pe(!1),onSave:a=>{Ta(a),Pe(!1)}})]})}),_a&&e.jsx("div",{className:s.modalOverlay,onClick:()=>{ne(!1),je(null)},children:e.jsxs("div",{className:s.modal,onClick:a=>a.stopPropagation(),children:[e.jsxs("div",{className:s.modalHeader,children:[e.jsx("h2",{children:Ke?"Edit Update":"Add Update"}),e.jsx("button",{onClick:()=>{ne(!1),je(null)},className:s.closeBtn,children:"×"})]}),e.jsx(hi,{matterName:(n==null?void 0:n.name)||"",existingUpdate:Ke,onClose:()=>{ne(!1),je(null)},onSave:a=>{Ke?Fa(Ke.id,a):Ba(a),ne(!1),je(null)}})]})}),Sa&&w&&e.jsx(di,{onClose:()=>{ps(!1),ke([])},selectedEntries:$.filter(a=>se.includes(a.id)),matter:n,client:w,onCreateInvoice:async a=>{try{await J(a);for(const l of se)await q(l,{billed:!0});await W({matterId:i}),await F(),ke([]),ps(!1)}catch(l){console.error("Failed to create invoice:",l),d.error("Failed to create invoice","Please try again.")}}}),e.jsx(tt,{isOpen:_e.isOpen,onClose:()=>Z(a=>({...a,isOpen:!1})),onConfirm:_e.onConfirm,title:_e.title,message:_e.message,confirmText:_e.confirmText,type:_e.type}),e.jsx(lt,{isOpen:wa,onClose:()=>Us(!1)}),e.jsx(rl,{isOpen:fa,onClose:()=>Ls(!1),matterId:i||"",matterName:n.name,currentVisibility:n.visibility||"firm_wide",onPermissionsChanged:()=>{M()}}),ga&&e.jsx("div",{className:s.permissionsPanelOverlay,onClick:()=>ms(!1),children:e.jsx("div",{className:s.permissionsPanel,onClick:a=>a.stopPropagation(),children:e.jsx(ci,{matterId:i||"",matterName:n.name,canManagePermissions:["owner","admin","billing"].includes((Ce==null?void 0:Ce.role)||"")||n.responsibleAttorney===(Ce==null?void 0:Ce.id),onClose:()=>ms(!1)})})})]}):e.jsxs("div",{className:s.notFound,children:[e.jsx(vs,{size:48}),e.jsx("h2",{children:"Matter not found"}),e.jsx(Ze,{to:"/app/matters",children:"Back to Matters"})]})}function na({matterName:i,onClose:j,onSave:S,existingTask:N}){const p=Me(),[m,g]=t.useState({name:(N==null?void 0:N.name)||"",status:(N==null?void 0:N.status)||"pending",dueDate:(N==null?void 0:N.dueDate)||A(new Date,"yyyy-MM-dd"),assignee:(N==null?void 0:N.assignee)||"",description:(N==null?void 0:N.description)||""}),d=c=>{if(c.preventDefault(),!m.name.trim()){p.warning("Please enter a task name");return}if(!m.assignee.trim()){p.warning("Please enter an assignee");return}S(m)};return e.jsxs("form",{onSubmit:d,className:s.modalForm,children:[e.jsxs("div",{className:s.formInfo,children:[e.jsx("strong",{children:"Matter:"})," ",i]}),e.jsxs("div",{className:s.formGroup,children:[e.jsx("label",{children:"Task Name *"}),e.jsx("input",{type:"text",value:m.name,onChange:c=>g({...m,name:c.target.value}),placeholder:"Enter task name...",required:!0})]}),e.jsxs("div",{className:s.formRow,children:[e.jsxs("div",{className:s.formGroup,children:[e.jsx("label",{children:"Due Date"}),e.jsx("input",{type:"date",value:m.dueDate,onChange:c=>g({...m,dueDate:c.target.value}),required:!0})]}),e.jsxs("div",{className:s.formGroup,children:[e.jsx("label",{children:"Status"}),e.jsxs("select",{value:m.status,onChange:c=>g({...m,status:c.target.value}),children:[e.jsx("option",{value:"pending",children:"Pending"}),e.jsx("option",{value:"in_progress",children:"In Progress"}),e.jsx("option",{value:"completed",children:"Completed"})]})]})]}),e.jsxs("div",{className:s.formGroup,children:[e.jsx("label",{children:"Assignee *"}),e.jsx("input",{type:"text",value:m.assignee,onChange:c=>g({...m,assignee:c.target.value}),placeholder:"Who is responsible for this task?",required:!0})]}),e.jsxs("div",{className:s.formGroup,children:[e.jsx("label",{children:"Description"}),e.jsx("textarea",{value:m.description,onChange:c=>g({...m,description:c.target.value}),placeholder:"Task details...",rows:3})]}),e.jsxs("div",{className:s.modalActions,children:[e.jsx("button",{type:"button",onClick:j,className:s.cancelBtn,children:"Cancel"}),e.jsx("button",{type:"submit",className:s.saveBtn,children:N?"Update Task":"Create Task"})]})]})}function di({onClose:i,selectedEntries:j,matter:S,client:N,onCreateInvoice:p}){const[m,g]=t.useState(!1),d=j.reduce((h,r)=>h+r.amount,0),c=j.reduce((h,r)=>h+r.hours,0),v=async()=>{g(!0);try{const h=j.map(r=>({description:r.description||"Legal services",quantity:r.hours,rate:r.rate,amount:r.amount}));await p({clientId:N.id,matterId:S.id,issueDate:new Date().toISOString(),dueDate:new Date(Date.now()+30*24*60*60*1e3).toISOString(),status:"draft",subtotal:d,total:d,amountPaid:0,lineItems:h,timeEntryIds:j.map(r=>r.id)})}finally{g(!1)}};return e.jsx("div",{className:s.modalOverlay,onClick:i,children:e.jsxs("div",{className:s.billModal,onClick:h=>h.stopPropagation(),children:[e.jsxs("div",{className:s.billModalHeader,children:[e.jsxs("div",{className:s.billModalTitle,children:[e.jsx(ve,{size:20}),e.jsx("h2",{children:"Create Invoice"})]}),e.jsx("button",{onClick:i,className:s.closeBtn,children:e.jsx(De,{size:20})})]}),e.jsxs("div",{className:s.billModalContent,children:[e.jsxs("div",{className:s.billClientInfo,children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Client:"})," ",N.name]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Matter:"})," ",S.name]})]}),e.jsxs("div",{className:s.billSummaryCompact,children:[e.jsxs("div",{className:s.billStatItem,children:[e.jsx("span",{className:s.billStatValue,children:j.length}),e.jsx("span",{className:s.billStatLabel,children:"Entries"})]}),e.jsx("div",{className:s.billStatDivider}),e.jsxs("div",{className:s.billStatItem,children:[e.jsxs("span",{className:s.billStatValue,children:[c.toFixed(1),"h"]}),e.jsx("span",{className:s.billStatLabel,children:"Hours"})]}),e.jsx("div",{className:s.billStatDivider}),e.jsxs("div",{className:s.billStatItem,children:[e.jsxs("span",{className:s.billStatValue,children:["$",d.toLocaleString()]}),e.jsx("span",{className:s.billStatLabel,children:"Total"})]})]}),e.jsxs("div",{className:s.billPreviewList,children:[e.jsx("div",{className:s.billPreviewHeader,children:"Line Items"}),e.jsx("div",{className:s.billPreviewItems,children:j.map((h,r)=>e.jsxs("div",{className:s.billPreviewItem,children:[e.jsxs("div",{className:s.billPreviewItemLeft,children:[e.jsx("span",{className:s.billPreviewDesc,children:h.description||"Legal services"}),e.jsx("span",{className:s.billPreviewMeta,children:A(He(h.date),"MMM d, yyyy")})]}),e.jsxs("div",{className:s.billPreviewItemRight,children:[e.jsxs("span",{className:s.billPreviewHours,children:[h.hours,"h"]}),e.jsxs("span",{className:s.billPreviewAmount,children:["$",h.amount.toLocaleString()]})]})]},r))})]}),e.jsx("div",{className:s.billNote,children:e.jsx("span",{children:"Invoice created as draft • Time entries marked as billed"})})]}),e.jsxs("div",{className:s.billModalFooter,children:[e.jsx("button",{onClick:i,className:s.cancelBtn,disabled:m,children:"Cancel"}),e.jsx("button",{onClick:v,className:s.saveBtn,disabled:m||j.length===0,children:m?"Creating...":`Create Invoice ($${d.toLocaleString()})`})]})]})})}function ra({matterId:i,matterName:j,defaultRate:S,onClose:N,onSave:p,existingEntry:m}){const[g,d]=t.useState(!1),[c,v]=t.useState({matterId:i,date:m!=null&&m.date?A(He(m.date),"yyyy-MM-dd"):A(new Date,"yyyy-MM-dd"),hours:(m==null?void 0:m.hours)||1,rate:(m==null?void 0:m.rate)||S,description:(m==null?void 0:m.description)||"",billable:(m==null?void 0:m.billable)!==void 0?m.billable:!0}),h=async r=>{if(r.preventDefault(),!g){d(!0);try{await p(c)}finally{d(!1)}}};return e.jsxs("form",{onSubmit:h,className:s.modalForm,children:[e.jsxs("div",{className:s.formInfo,children:[e.jsx("strong",{children:"Matter:"})," ",j]}),e.jsxs("div",{className:s.formRow,children:[e.jsxs("div",{className:s.formGroup,children:[e.jsx("label",{children:"Date"}),e.jsx("input",{type:"date",value:c.date,onChange:r=>v({...c,date:r.target.value}),required:!0})]}),e.jsxs("div",{className:s.formGroup,children:[e.jsx("label",{children:"Hours"}),e.jsx("input",{type:"number",step:"0.1",min:"0.1",value:c.hours,onChange:r=>v({...c,hours:parseFloat(r.target.value)||0}),required:!0})]})]}),e.jsxs("div",{className:s.formRow,children:[e.jsxs("div",{className:s.formGroup,children:[e.jsx("label",{children:"Rate ($/hr)"}),e.jsx("input",{type:"number",value:c.rate,onChange:r=>v({...c,rate:parseFloat(r.target.value)||0}),required:!0})]}),e.jsxs("div",{className:s.formGroup,children:[e.jsx("label",{children:"Total"}),e.jsxs("div",{className:s.formValue,children:["$",(c.hours*c.rate).toFixed(2)]})]})]}),e.jsxs("div",{className:s.formGroup,children:[e.jsx("label",{children:"Description (optional)"}),e.jsx("textarea",{value:c.description,onChange:r=>v({...c,description:r.target.value}),placeholder:"Describe the work performed...",rows:3})]}),e.jsx("div",{className:s.formGroup,children:e.jsxs("label",{className:s.checkboxLabel,children:[e.jsx("input",{type:"checkbox",checked:c.billable,onChange:r=>v({...c,billable:r.target.checked})}),"Billable"]})}),e.jsxs("div",{className:s.modalActions,children:[e.jsx("button",{type:"button",onClick:N,className:s.cancelBtn,disabled:g,children:"Cancel"}),e.jsx("button",{type:"submit",className:s.saveBtn,disabled:g,children:g?"Saving...":m?"Update Time Entry":"Save Time Entry"})]})]})}function mi({matterId:i,clientId:j,clientName:S,matterName:N,unbilledAmount:p,onClose:m,onSave:g}){const d=Me(),[c,v]=t.useState(!1),[h,r]=t.useState({matterId:i,clientId:j,issueDate:A(new Date,"yyyy-MM-dd"),dueDate:A(new Date(Date.now()+30*24*60*60*1e3),"yyyy-MM-dd"),notes:"",lineItems:[{type:"fee",description:`Legal Services - ${N}`,quantity:1,rate:p,amount:p}]}),E=()=>{r({...h,lineItems:[...h.lineItems,{type:"fee",description:"",quantity:1,rate:0,amount:0}]})},G=C=>{r({...h,lineItems:h.lineItems.filter((z,M)=>M!==C)})},P=(C,z,M)=>{const L=[...h.lineItems];L[C]={...L[C],[z]:M},(z==="quantity"||z==="rate")&&(L[C].amount=L[C].quantity*L[C].rate),z==="amount"&&L[C].quantity>0&&(L[C].rate=M/L[C].quantity),r({...h,lineItems:L})},R=h.lineItems.reduce((C,z)=>C+(z.amount||0),0),J=async C=>{if(C.preventDefault(),!c){if(R<=0){d.warning("Please add at least one line item with an amount");return}v(!0);try{await g({...h,total:R})}finally{v(!1)}}};return e.jsxs("form",{onSubmit:J,className:s.modalForm,children:[e.jsxs("div",{className:s.formInfo,children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Client:"})," ",S]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Matter:"})," ",N]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Unbilled Amount:"})," $",p.toLocaleString()]})]}),e.jsxs("div",{className:s.formRow,children:[e.jsxs("div",{className:s.formGroup,children:[e.jsx("label",{children:"Issue Date"}),e.jsx("input",{type:"date",value:h.issueDate,onChange:C=>r({...h,issueDate:C.target.value}),required:!0})]}),e.jsxs("div",{className:s.formGroup,children:[e.jsx("label",{children:"Due Date"}),e.jsx("input",{type:"date",value:h.dueDate,onChange:C=>r({...h,dueDate:C.target.value}),required:!0})]})]}),e.jsxs("div",{className:s.formGroup,children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:"0.5rem"},children:[e.jsx("label",{style:{marginBottom:0},children:"Line Items"}),e.jsx("button",{type:"button",onClick:E,style:{display:"flex",alignItems:"center",gap:"0.25rem",padding:"0.25rem 0.5rem",background:"rgba(245, 158, 11, 0.1)",border:"1px solid var(--apex-gold)",borderRadius:"4px",color:"var(--apex-gold)",fontSize:"0.75rem",cursor:"pointer"},children:"+ Add Item"})]}),e.jsxs("div",{style:{background:"var(--apex-slate)",border:"1px solid rgba(255, 255, 255, 0.1)",borderRadius:"8px",overflow:"hidden"},children:[e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"2fr 80px 100px 120px 40px",gap:"0.5rem",padding:"0.5rem 1rem",background:"rgba(0, 0, 0, 0.2)",borderBottom:"1px solid rgba(255, 255, 255, 0.05)",fontSize:"0.7rem",fontWeight:"600",color:"var(--apex-text)",textTransform:"uppercase"},children:[e.jsx("span",{children:"Description"}),e.jsx("span",{style:{textAlign:"center"},children:"Qty"}),e.jsx("span",{style:{textAlign:"right"},children:"Rate"}),e.jsx("span",{style:{textAlign:"right"},children:"Amount"}),e.jsx("span",{})]}),h.lineItems.map((C,z)=>e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"2fr 80px 100px 120px 40px",gap:"0.5rem",padding:"0.5rem 1rem",borderBottom:z<h.lineItems.length-1?"1px solid rgba(255, 255, 255, 0.05)":"none"},children:[e.jsx("input",{type:"text",value:C.description,onChange:M=>P(z,"description",M.target.value),placeholder:"Description",style:{padding:"0.375rem 0.5rem",background:"var(--apex-deep)",border:"1px solid rgba(255, 255, 255, 0.1)",borderRadius:"4px",color:"var(--apex-white)",fontSize:"0.875rem"},required:!0}),e.jsx("input",{type:"number",value:C.quantity,onChange:M=>P(z,"quantity",parseFloat(M.target.value)||0),min:"0",step:"0.5",style:{padding:"0.375rem 0.5rem",background:"var(--apex-deep)",border:"1px solid rgba(255, 255, 255, 0.1)",borderRadius:"4px",color:"var(--apex-white)",fontSize:"0.875rem",textAlign:"center"}}),e.jsx("input",{type:"number",value:C.rate,onChange:M=>P(z,"rate",parseFloat(M.target.value)||0),min:"0",step:"0.01",placeholder:"0.00",style:{padding:"0.375rem 0.5rem",background:"var(--apex-deep)",border:"1px solid rgba(255, 255, 255, 0.1)",borderRadius:"4px",color:"var(--apex-white)",fontSize:"0.875rem",textAlign:"right"}}),e.jsx("input",{type:"number",value:C.amount,onChange:M=>P(z,"amount",parseFloat(M.target.value)||0),min:"0",step:"0.01",placeholder:"0.00",style:{padding:"0.375rem 0.5rem",background:"var(--apex-deep)",border:"1px solid rgba(255, 255, 255, 0.1)",borderRadius:"4px",color:"var(--apex-white)",fontSize:"0.875rem",textAlign:"right",fontWeight:"bold"}}),e.jsx("button",{type:"button",onClick:()=>G(z),disabled:h.lineItems.length===1,style:{background:"none",border:"none",color:h.lineItems.length===1?"rgba(255,255,255,0.2)":"var(--apex-text)",cursor:h.lineItems.length===1?"not-allowed":"pointer",padding:"0.25rem"},children:"×"})]},z)),e.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"2rem",padding:"0.75rem 1rem",background:"rgba(0, 0, 0, 0.2)",fontWeight:"600"},children:[e.jsx("span",{style:{color:"var(--apex-text)"},children:"Total:"}),e.jsxs("span",{style:{color:"var(--apex-gold-bright)",fontSize:"1.125rem"},children:["$",R.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})]})]})]})]}),e.jsxs("div",{className:s.formGroup,children:[e.jsx("label",{children:"Notes"}),e.jsx("textarea",{value:h.notes,onChange:C=>r({...h,notes:C.target.value}),placeholder:"Invoice notes...",rows:3})]}),e.jsxs("div",{className:s.modalActions,children:[e.jsx("button",{type:"button",onClick:m,className:s.cancelBtn,disabled:c,children:"Cancel"}),e.jsx("button",{type:"submit",className:s.saveBtn,disabled:c,children:c?"Creating...":`Create Invoice ($${R.toLocaleString(void 0,{minimumFractionDigits:2})})`})]})]})}function oa({matterId:i,matterName:j,onClose:S,onSave:N,existingEvent:p}){const[m,g]=t.useState(!1),[d,c]=t.useState({matterId:i,title:(p==null?void 0:p.title)||"",type:(p==null?void 0:p.type)||"meeting",startTime:p!=null&&p.startTime?A(U(p.startTime),"yyyy-MM-dd'T'HH:mm"):A(new Date,"yyyy-MM-dd'T'10:00"),endTime:p!=null&&p.endTime?A(U(p.endTime),"yyyy-MM-dd'T'HH:mm"):A(new Date,"yyyy-MM-dd'T'11:00"),location:(p==null?void 0:p.location)||"",description:(p==null?void 0:p.description)||"",allDay:(p==null?void 0:p.allDay)||!1}),v=async h=>{if(h.preventDefault(),!m){g(!0);try{await N({...d,startTime:new Date(d.startTime).toISOString(),endTime:new Date(d.endTime).toISOString()})}finally{g(!1)}}};return e.jsxs("form",{onSubmit:v,className:s.modalForm,children:[e.jsxs("div",{className:s.formInfo,children:[e.jsx("strong",{children:"Matter:"})," ",j]}),e.jsxs("div",{className:s.formGroup,children:[e.jsx("label",{children:"Title"}),e.jsx("input",{type:"text",value:d.title,onChange:h=>c({...d,title:h.target.value}),placeholder:"Event title...",required:!0})]}),e.jsxs("div",{className:s.formRow,children:[e.jsxs("div",{className:s.formGroup,children:[e.jsx("label",{children:"Type"}),e.jsxs("select",{value:d.type,onChange:h=>c({...d,type:h.target.value}),children:[e.jsx("option",{value:"meeting",children:"Meeting"}),e.jsx("option",{value:"court_date",children:"Court Date"}),e.jsx("option",{value:"hearing",children:"Hearing"}),e.jsx("option",{value:"deposition",children:"Deposition"}),e.jsx("option",{value:"deadline",children:"Deadline"}),e.jsx("option",{value:"filing_deadline",children:"Filing Deadline"}),e.jsx("option",{value:"appointment",children:"Appointment"}),e.jsx("option",{value:"conference_call",children:"Conference Call"})]})]}),e.jsxs("div",{className:s.formGroup,children:[e.jsx("label",{children:"Location"}),e.jsx("input",{type:"text",value:d.location,onChange:h=>c({...d,location:h.target.value}),placeholder:"Location (optional)"})]})]}),e.jsxs("div",{className:s.formRow,children:[e.jsxs("div",{className:s.formGroup,children:[e.jsx("label",{children:"Start"}),e.jsx("input",{type:"datetime-local",value:d.startTime,onChange:h=>c({...d,startTime:h.target.value}),required:!0})]}),e.jsxs("div",{className:s.formGroup,children:[e.jsx("label",{children:"End"}),e.jsx("input",{type:"datetime-local",value:d.endTime,onChange:h=>c({...d,endTime:h.target.value}),required:!0})]})]}),e.jsxs("div",{className:s.formGroup,children:[e.jsx("label",{children:"Description"}),e.jsx("textarea",{value:d.description,onChange:h=>c({...d,description:h.target.value}),placeholder:"Event details...",rows:2})]}),e.jsxs("div",{className:s.modalActions,children:[e.jsx("button",{type:"button",onClick:S,className:s.cancelBtn,disabled:m,children:"Cancel"}),e.jsx("button",{type:"submit",className:s.saveBtn,disabled:m,children:m?"Saving...":p?"Update Event":"Create Event"})]})]})}function ui({matterName:i,onClose:j,onSave:S}){const N=Me(),[p,m]=t.useState({name:"",role:"",firm:"",email:"",phone:""}),g=d=>{if(d.preventDefault(),!p.name.trim()){N.warning("Please enter a contact name");return}if(!p.role.trim()){N.warning("Please enter a role");return}S(p)};return e.jsxs("form",{onSubmit:g,className:s.modalForm,children:[e.jsxs("div",{className:s.formInfo,children:[e.jsx("strong",{children:"Matter:"})," ",i]}),e.jsxs("div",{className:s.formGroup,children:[e.jsx("label",{children:"Contact Name *"}),e.jsx("input",{type:"text",value:p.name,onChange:d=>m({...p,name:d.target.value}),placeholder:"Enter contact name...",required:!0})]}),e.jsxs("div",{className:s.formGroup,children:[e.jsx("label",{children:"Role *"}),e.jsxs("select",{value:p.role,onChange:d=>m({...p,role:d.target.value}),required:!0,children:[e.jsx("option",{value:"",children:"Select a role..."}),e.jsx("option",{value:"Opposing Counsel",children:"Opposing Counsel"}),e.jsx("option",{value:"Co-Counsel",children:"Co-Counsel"}),e.jsx("option",{value:"Expert Witness",children:"Expert Witness"}),e.jsx("option",{value:"Witness",children:"Witness"}),e.jsx("option",{value:"Insurance Adjuster",children:"Insurance Adjuster"}),e.jsx("option",{value:"Mediator",children:"Mediator"}),e.jsx("option",{value:"Arbitrator",children:"Arbitrator"}),e.jsx("option",{value:"Court Clerk",children:"Court Clerk"}),e.jsx("option",{value:"Judge's Chambers",children:"Judge's Chambers"}),e.jsx("option",{value:"Other",children:"Other"})]})]}),e.jsxs("div",{className:s.formGroup,children:[e.jsx("label",{children:"Firm / Organization"}),e.jsx("input",{type:"text",value:p.firm,onChange:d=>m({...p,firm:d.target.value}),placeholder:"Enter firm or organization..."})]}),e.jsxs("div",{className:s.formRow,children:[e.jsxs("div",{className:s.formGroup,children:[e.jsx("label",{children:"Email"}),e.jsx("input",{type:"email",value:p.email,onChange:d=>m({...p,email:d.target.value}),placeholder:"email@example.com"})]}),e.jsxs("div",{className:s.formGroup,children:[e.jsx("label",{children:"Phone"}),e.jsx("input",{type:"tel",value:p.phone,onChange:d=>m({...p,phone:d.target.value}),placeholder:"(555) 555-5555"})]})]}),e.jsxs("div",{className:s.modalActions,children:[e.jsx("button",{type:"button",onClick:j,className:s.cancelBtn,children:"Cancel"}),e.jsx("button",{type:"submit",className:s.saveBtn,children:"Add Contact"})]})]})}function hi({matterName:i,existingUpdate:j,onClose:S,onSave:N}){const p=Me(),[m,g]=t.useState({date:j!=null&&j.date?A(U(j.date),"yyyy-MM-dd"):A(new Date,"yyyy-MM-dd"),title:(j==null?void 0:j.title)||"",description:(j==null?void 0:j.description)||"",category:(j==null?void 0:j.category)||"general"}),d=v=>{const[h,r,E]=v.split("-").map(Number);return new Date(h,r-1,E,12,0,0).toISOString()},c=v=>{if(v.preventDefault(),!m.title.trim()){p.warning("Please enter a title");return}N({...m,date:d(m.date)})};return e.jsxs("form",{onSubmit:c,className:s.modalForm,children:[e.jsxs("div",{className:s.formInfo,children:[e.jsx("strong",{children:"Matter:"})," ",i]}),e.jsxs("div",{className:s.formRow,children:[e.jsxs("div",{className:s.formGroup,children:[e.jsx("label",{children:"Date"}),e.jsx("input",{type:"date",value:m.date,onChange:v=>g({...m,date:v.target.value}),required:!0})]}),e.jsxs("div",{className:s.formGroup,children:[e.jsx("label",{children:"Category"}),e.jsxs("select",{value:m.category,onChange:v=>g({...m,category:v.target.value}),children:[e.jsx("option",{value:"general",children:"General Update"}),e.jsx("option",{value:"court",children:"Court Filing/Ruling"}),e.jsx("option",{value:"client_communication",children:"Client Communication"}),e.jsx("option",{value:"document",children:"Document"}),e.jsx("option",{value:"billing",children:"Billing"}),e.jsx("option",{value:"milestone",children:"Milestone"})]})]})]}),e.jsxs("div",{className:s.formGroup,children:[e.jsx("label",{children:"Title *"}),e.jsx("input",{type:"text",value:m.title,onChange:v=>g({...m,title:v.target.value}),placeholder:"Brief summary of the update...",required:!0})]}),e.jsxs("div",{className:s.formGroup,children:[e.jsx("label",{children:"Description"}),e.jsx("textarea",{value:m.description,onChange:v=>g({...m,description:v.target.value}),placeholder:"Detailed notes about what happened...",rows:5})]}),e.jsxs("div",{className:s.modalActions,children:[e.jsx("button",{type:"button",onClick:S,className:s.cancelBtn,children:"Cancel"}),e.jsx("button",{type:"submit",className:s.saveBtn,children:j?"Update":"Add Update"})]})]})}function pi({matter:i,attorneys:j,typeOptions:S,onClose:N,onSave:p,onManageTypes:m}){const[g,d]=t.useState(!1),[c,v]=t.useState({name:i.name||"",description:i.description||"",notes:i.notes||"",type:i.type||(S.length>0?S[0].value:"other"),status:i.status||"active",priority:i.priority||"medium",billingType:i.billingType||"hourly",billingRate:i.billingRate||450,responsibleAttorney:i.responsibleAttorney||"",originatingAttorney:i.originatingAttorney||""}),h=async r=>{if(r.preventDefault(),!g){d(!0);try{await p(c)}finally{d(!1)}}};return e.jsxs("form",{onSubmit:h,className:s.modalForm,children:[e.jsxs("div",{className:s.formGroup,children:[e.jsx("label",{children:"Matter Name"}),e.jsx("input",{type:"text",value:c.name,onChange:r=>v({...c,name:r.target.value}),placeholder:"Enter matter name",required:!0})]}),e.jsxs("div",{className:s.formRow,children:[e.jsxs("div",{className:s.formGroup,children:[e.jsxs("label",{style:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:["Type",m&&e.jsxs("button",{type:"button",onClick:m,style:{background:"none",border:"none",color:"var(--apex-gold-bright)",fontSize:"0.75rem",cursor:"pointer",display:"flex",alignItems:"center",gap:"4px",padding:0},children:[e.jsx(Nt,{size:12}),"Manage"]})]}),e.jsx("select",{value:c.type,onChange:r=>v({...c,type:r.target.value}),children:S.map(r=>e.jsx("option",{value:r.value,children:r.label},r.value))})]}),e.jsxs("div",{className:s.formGroup,children:[e.jsx("label",{children:"Priority"}),e.jsxs("select",{value:c.priority,onChange:r=>v({...c,priority:r.target.value}),children:[e.jsx("option",{value:"low",children:"Low"}),e.jsx("option",{value:"medium",children:"Medium"}),e.jsx("option",{value:"high",children:"High"}),e.jsx("option",{value:"urgent",children:"Urgent"})]})]})]}),e.jsxs("div",{className:s.formRow,children:[e.jsxs("div",{className:s.formGroup,children:[e.jsx("label",{children:"Status"}),e.jsxs("select",{value:c.status,onChange:r=>v({...c,status:r.target.value}),children:[e.jsx("option",{value:"intake",children:"Intake"}),e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"pending",children:"Pending"}),e.jsx("option",{value:"on_hold",children:"On Hold"}),e.jsx("option",{value:"closed",children:"Closed"}),e.jsx("option",{value:"closed_won",children:"Closed - Won"}),e.jsx("option",{value:"closed_lost",children:"Closed - Lost"}),e.jsx("option",{value:"closed_settled",children:"Closed - Settled"}),e.jsx("option",{value:"closed_other",children:"Closed - Other"})]})]}),e.jsxs("div",{className:s.formGroup,children:[e.jsx("label",{children:"Billing Type"}),e.jsxs("select",{value:c.billingType,onChange:r=>v({...c,billingType:r.target.value}),children:[e.jsx("option",{value:"hourly",children:"Hourly"}),e.jsx("option",{value:"flat",children:"Flat Fee"}),e.jsx("option",{value:"contingency",children:"Contingency"}),e.jsx("option",{value:"retainer",children:"Retainer"})]})]})]}),e.jsxs("div",{className:s.formRow,children:[e.jsxs("div",{className:s.formGroup,children:[e.jsx("label",{children:"Responsible Attorney"}),e.jsxs("select",{value:c.responsibleAttorney,onChange:r=>v({...c,responsibleAttorney:r.target.value}),children:[e.jsx("option",{value:"",children:"Select responsible attorney..."}),j.map(r=>e.jsxs("option",{value:r.id,children:[r.name," ",r.role?`(${r.role})`:""]},r.id))]})]}),e.jsxs("div",{className:s.formGroup,children:[e.jsx("label",{children:"Originating Attorney"}),e.jsxs("select",{value:c.originatingAttorney,onChange:r=>v({...c,originatingAttorney:r.target.value}),children:[e.jsx("option",{value:"",children:"Select originating attorney..."}),j.map(r=>e.jsxs("option",{value:r.id,children:[r.name," ",r.role?`(${r.role})`:""]},r.id))]})]})]}),c.billingType==="hourly"&&e.jsxs("div",{className:s.formGroup,children:[e.jsx("label",{children:"Default Rate ($/hr)"}),e.jsx("input",{type:"number",value:c.billingRate,onChange:r=>v({...c,billingRate:Number(r.target.value)})})]}),e.jsxs("div",{className:s.formGroup,children:[e.jsx("label",{children:"Description"}),e.jsx("textarea",{value:c.description,onChange:r=>v({...c,description:r.target.value}),placeholder:"Brief description of the matter",rows:3})]}),e.jsxs("div",{className:s.formGroup,children:[e.jsx("label",{children:"Notes"}),e.jsx("textarea",{value:c.notes,onChange:r=>v({...c,notes:r.target.value}),placeholder:"Internal notes about this matter (not shown on invoices)",rows:4})]}),e.jsxs("div",{className:s.modalActions,children:[e.jsx("button",{type:"button",onClick:N,className:s.cancelBtn,disabled:g,children:"Cancel"}),e.jsx("button",{type:"submit",className:s.saveBtn,disabled:g,children:g?"Saving...":"Update Matter"})]})]})}function xi({matterId:i,legacyNotes:j,onSaveLegacyNotes:S}){const N=Me(),[p,m]=t.useState([]),[g,d]=t.useState(!0),[c,v]=t.useState(!1),[h,r]=t.useState(""),[E,G]=t.useState("general"),[P,R]=t.useState(!1),[J,C]=t.useState(!1),[z,M]=t.useState(!1),[L,W]=t.useState(j),F=t.useCallback(async()=>{try{d(!0);const _=await B.getNotes(i);m(_.notes||[])}catch(_){console.error("Failed to fetch notes:",_)}finally{d(!1)}},[i]);t.useEffect(()=>{F()},[F]),t.useEffect(()=>{W(j)},[j]);const H=async()=>{if(h.trim()){R(!0);try{await B.addNote(i,{content:h.trim(),noteType:E}),r(""),G("general"),v(!1),C(!0),setTimeout(()=>C(!1),3e3),await F()}catch(_){console.error("Failed to add note:",_),N.error("Failed to add note","Please try again.")}finally{R(!1)}}},K=async _=>{if(confirm("Are you sure you want to delete this note?"))try{await B.deleteNote(i,_),await F()}catch(y){console.error("Failed to delete note:",y),N.error("Failed to delete note","Please try again.")}},re=async()=>{R(!0);try{await S(L),M(!1),C(!0),setTimeout(()=>C(!1),3e3)}catch(_){console.error("Failed to save notes:",_),N.error("Failed to save notes","Please try again.")}finally{R(!1)}},q={general:"#64748b",case_note:"#3b82f6",meeting_note:"#8b5cf6",research:"#f59e0b",status_update:"#22c55e",client_communication:"#ec4899",court_filing:"#ef4444",discovery:"#14b8a6"};return e.jsxs("div",{className:s.notesTab,children:[e.jsxs("div",{className:s.tabHeader,children:[e.jsx("h2",{children:"Notes"}),e.jsx("div",{className:s.tabActions,children:e.jsxs("button",{className:s.primaryBtn,onClick:()=>v(!0),children:[e.jsx(Q,{size:18}),"Add Note"]})})]}),J&&e.jsxs("div",{className:s.successMessage,children:[e.jsx(Ie,{size:18}),"Note saved successfully!"]}),c&&e.jsxs("div",{className:s.addNoteForm,style:{background:"var(--apex-dark)",borderRadius:"12px",padding:"20px",marginBottom:"20px",border:"1px solid rgba(139, 92, 246, 0.3)"},children:[e.jsxs("div",{style:{marginBottom:"12px"},children:[e.jsx("label",{style:{display:"block",marginBottom:"6px",color:"var(--apex-white)",fontSize:"0.9rem"},children:"Note Type"}),e.jsxs("select",{value:E,onChange:_=>G(_.target.value),style:{width:"100%",padding:"10px 12px",borderRadius:"8px",background:"var(--apex-charcoal)",border:"1px solid rgba(255,255,255,0.1)",color:"var(--apex-white)",fontSize:"0.9rem"},children:[e.jsx("option",{value:"general",children:"General Note"}),e.jsx("option",{value:"case_note",children:"Case Note"}),e.jsx("option",{value:"meeting_note",children:"Meeting Note"}),e.jsx("option",{value:"research",children:"Research"}),e.jsx("option",{value:"status_update",children:"Status Update"}),e.jsx("option",{value:"client_communication",children:"Client Communication"}),e.jsx("option",{value:"court_filing",children:"Court Filing"}),e.jsx("option",{value:"discovery",children:"Discovery"})]})]}),e.jsxs("div",{style:{marginBottom:"12px"},children:[e.jsx("label",{style:{display:"block",marginBottom:"6px",color:"var(--apex-white)",fontSize:"0.9rem"},children:"Note Content"}),e.jsx("textarea",{value:h,onChange:_=>r(_.target.value),placeholder:"Enter your note here...",rows:5,style:{width:"100%",padding:"12px",borderRadius:"8px",background:"var(--apex-charcoal)",border:"1px solid rgba(255,255,255,0.1)",color:"var(--apex-white)",fontSize:"0.9rem",resize:"vertical"},autoFocus:!0})]}),e.jsxs("div",{style:{display:"flex",gap:"10px",justifyContent:"flex-end"},children:[e.jsx("button",{className:s.cancelBtn,onClick:()=>{v(!1),r("")},disabled:P,children:"Cancel"}),e.jsx("button",{className:s.primaryBtn,onClick:H,disabled:P||!h.trim(),children:P?"Saving...":"Add Note"})]})]}),g?e.jsx("div",{style:{textAlign:"center",padding:"40px",color:"var(--apex-text-muted)"},children:"Loading notes..."}):p.length>0?e.jsx("div",{className:s.notesList,style:{display:"flex",flexDirection:"column",gap:"12px"},children:p.map(_=>e.jsxs("div",{className:s.noteCard,style:{background:"var(--apex-dark)",borderRadius:"12px",padding:"16px 20px",border:"1px solid rgba(255,255,255,0.08)"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:"10px"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px"},children:[e.jsx("span",{style:{padding:"4px 10px",borderRadius:"6px",fontSize:"0.75rem",fontWeight:600,background:`${q[_.noteType]||q.general}20`,color:q[_.noteType]||q.general,textTransform:"uppercase"},children:_.noteType.replace(/_/g," ")}),e.jsx("span",{style:{color:"var(--apex-text-muted)",fontSize:"0.85rem"},children:new Date(_.createdAt).toLocaleString()})]}),e.jsx("button",{onClick:()=>K(_.id),style:{background:"transparent",border:"none",color:"var(--apex-text-muted)",cursor:"pointer",padding:"4px"},title:"Delete note",children:e.jsx(ae,{size:16})})]}),e.jsx("div",{style:{color:"var(--apex-white)",whiteSpace:"pre-wrap",lineHeight:"1.6",fontSize:"0.95rem"},children:_.content}),e.jsxs("div",{style:{marginTop:"10px",color:"var(--apex-text-muted)",fontSize:"0.8rem",display:"flex",alignItems:"center",gap:"6px"},children:[e.jsx(vt,{size:14}),_.createdByName]})]},_.id))}):e.jsxs("div",{className:s.emptyNotes,style:{textAlign:"center",padding:"60px 20px",background:"var(--apex-dark)",borderRadius:"12px",border:"1px dashed rgba(255,255,255,0.1)"},children:[e.jsx(ve,{size:48,style:{color:"var(--apex-text-muted)",marginBottom:"16px"}}),e.jsx("p",{style:{color:"var(--apex-white)",fontSize:"1.1rem",marginBottom:"8px"},children:"No notes yet"}),e.jsxs("span",{style:{color:"var(--apex-text-muted)",fontSize:"0.9rem"},children:['Click "Add Note" to create a note for this matter.',e.jsx("br",{}),"Notes created by the AI agent will also appear here."]})]}),j&&e.jsxs("div",{style:{marginTop:"30px",paddingTop:"20px",borderTop:"1px solid rgba(255,255,255,0.1)"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"12px"},children:[e.jsx("h3",{style:{color:"var(--apex-text-muted)",fontSize:"0.9rem",fontWeight:500},children:"Legacy Matter Notes"}),z?e.jsxs("div",{style:{display:"flex",gap:"8px"},children:[e.jsx("button",{onClick:()=>{M(!1),W(j)},style:{background:"transparent",border:"none",color:"var(--apex-text-muted)",cursor:"pointer",fontSize:"0.85rem"},children:"Cancel"}),e.jsx("button",{onClick:re,disabled:P,style:{background:"transparent",border:"none",color:"var(--apex-purple)",cursor:"pointer",fontSize:"0.85rem"},children:P?"Saving...":"Save"})]}):e.jsxs("button",{onClick:()=>M(!0),style:{background:"transparent",border:"none",color:"var(--apex-purple)",cursor:"pointer",fontSize:"0.85rem",display:"flex",alignItems:"center",gap:"4px"},children:[e.jsx(de,{size:14})," Edit"]})]}),z?e.jsx("textarea",{value:L,onChange:_=>W(_.target.value),style:{width:"100%",padding:"12px",borderRadius:"8px",background:"var(--apex-charcoal)",border:"1px solid rgba(255,255,255,0.1)",color:"var(--apex-white)",fontSize:"0.9rem",minHeight:"100px",resize:"vertical"}}):e.jsx("p",{style:{color:"var(--apex-text-muted)",fontSize:"0.9rem",whiteSpace:"pre-wrap",background:"var(--apex-charcoal)",padding:"12px",borderRadius:"8px"},children:j})]})]})}export{Bi as MatterDetailPage};
