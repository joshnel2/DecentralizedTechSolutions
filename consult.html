<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Book Consultation | Decentralized Technology Solutions</title>
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="assets/css/style.css">
  <style>
    .question-card { background: rgba(255,255,255,0.05); padding:1.5rem; border-radius:15px; margin-bottom:1.5rem; }
    .question-card h4 { margin-bottom:1rem; }
    .question-card label { display:block; margin:0.5rem 0; cursor:pointer; }
    #calendar-wrapper { display:none; margin-top:3rem; }
    iframe { width:100%; height:650px; border:none; }
    @media(max-width:640px){
      body{font-size:14px;}
      .question-card{padding:1rem;}
      .question-card h4{font-size:1rem;}
      .btn-primary{width:100%;box-sizing:border-box;}
    }
  </style>
</head>
<body>
  <div id="tsparticles"></div>
  <header>
    <div class="container nav-container">
      <h1 class="logo">DTS</h1>
    </div>
  </header>

  <section class="section-hero">
    <div class="container hero-content" data-aos="fade-up">
      <h2 class="company-name">Book a Consultation</h2>
      <h3 class="tagline">Step 1 · Quick Questionnaire</h3>
      <p class="subtitle">4 quick multiple-choice questions so we can tailor the call.</p>
    </div>
  </section>

  <section class="section section-light">
    <div class="container">
      <form id="consult-form">
        <div class="question-card">
          <h4>1. What type of project do you have in mind?</h4>
          <label><input type="radio" name="projectType" value="AI Solution" required> AI Solution</label>
          <label><input type="radio" name="projectType" value="Web App"> Web App</label>
          <label><input type="radio" name="projectType" value="Blockchain"> Blockchain / Smart Contracts</label>
          <label><input type="radio" name="projectType" value="Automation"> Workflow Automation</label>
        </div>
        <div class="question-card">
          <h4>2. Estimated budget range?</h4>
          <label><input type="radio" name="budget" value="<10k" required> &lt;$10k</label>
          <label><input type="radio" name="budget" value="10-50k"> $10k – $50k</label>
          <label><input type="radio" name="budget" value="50-100k"> $50k – $100k</label>
          <label><input type="radio" name="budget" value=">100k"> $100k+</label>
        </div>
        <div class="question-card">
          <h4>3. Do you already have specifications?</h4>
          <label><input type="radio" name="specs" value="Yes" required> Yes, detailed spec</label>
          <label><input type="radio" name="specs" value="Partial"> Partial docs</label>
          <label><input type="radio" name="specs" value="No"> No, need help scoping</label>
        </div>
        <div class="question-card">
          <h4>4. Call duration</h4>
          <label><input type="radio" name="callDuration" value="15" checked required> 15-minute intro call</label>
        </div>
        <button type="submit" class="btn-primary">Submit &amp; Pick Time</button>
      </form>

      <div id="slots-wrapper" style="display:none;">
        <h3 class="section-title" style="margin-top:3rem;">Step 2 · Select a Time</h3>
        <form id="slot-form"></form>
      </div>
    </div>
  </section>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/tsparticles/3.1.1/tsparticles.min.js"></script>
  <script>
    tsParticles.load('tsparticles', { fpsLimit:60, particles:{ number:{value:90,density:{enable:true,area:800}}, color:{value:['#14ff00','#00ffff']}, shape:{type:'circle'}, opacity:{value:0.4}, size:{value:3}, links:{enable:true,color:'#fff',opacity:0.1}, move:{enable:true,speed:1.5,outMode:'out'} } });

    const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbwshckiDCwYoBqMwkyCR1SaLk3ZtG3sOH58JxFJmVA1Q8SJiXBqTlG08bvsvd8dCaK_1Q/exec';

    const form = document.getElementById('consult-form');
    const slotWrapper = document.getElementById('slots-wrapper');
    const slotForm   = document.getElementById('slot-form');

    // First step — questionnaire
    form.addEventListener('submit', async (e)=>{
      e.preventDefault();
      const answers = Object.fromEntries(new FormData(form).entries());

      // Fetch available slots from Apps Script (GET ?action=slots)
      let slots = [];
      try {
        const res = await fetch(`${SCRIPT_URL}?action=slots`);
        const json = await res.json();
        slots = json.slots || [];
      } catch(err){
        console.error('Failed fetching slots', err);
      }

      // Build slot radio inputs + contact fields
      if(slots.length){
        const slotOptions = slots.map((s,i)=>
          `<label style="display:block;margin:0.5rem 0;">
             <input type="radio" name="slot" value="${s.id}" ${i===0?'checked':''}>
             ${s.date} · ${s.time}
           </label>`).join('');

        const contactFields = `
          <div style="margin-top:1rem;">
            <input type="text"  name="clientName"  placeholder="Your Name"     required style="width:100%;padding:0.5rem;margin-bottom:0.5rem;">
            <input type="tel"   name="clientPhone" placeholder="Phone Number" required style="width:100%;padding:0.5rem;margin-bottom:0.5rem;">
          </div>`;

        slotForm.innerHTML = slotOptions + contactFields + '<button type="submit" class="btn-primary" style="margin-top:0.5rem;">Confirm Booking</button>';
      } else {
        slotForm.innerHTML = '<p>No slots available. Please check back later.</p>';
      }

      // Move to step-2 UI
      form.style.display='none';
      slotWrapper.style.display='block';
      slotWrapper.scrollIntoView({behavior:'smooth'});

      // Second step — pick slot & send data
      slotForm.onsubmit = async (ev)=>{
        ev.preventDefault();
        const fd = new FormData(slotForm);
        const slotId      = fd.get('slot');
        const clientName  = fd.get('clientName');
        const clientPhone = fd.get('clientPhone');
        if(!slotId) return;
        const payload = {...answers, slotId, clientName, clientPhone};
        try {
          await fetch(SCRIPT_URL, {
            method:'POST',
            headers:{'Content-Type':'application/json'},
            body:JSON.stringify(payload)
          });
          slotForm.innerHTML = '<p>✅ Booked! Check your inbox for confirmation.</p>';
        } catch(err){
          console.error('Booking failed', err);
          slotForm.innerHTML = '<p>❌ Booking failed. Please try again.</p>';
        }
      };
    });
  </script>
</body>
</html>